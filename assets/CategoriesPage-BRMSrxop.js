import{d as N,u as j,c as P,r as y,ac as z,ad as C,ae as s,ak as m,f as t,af as f,ag as g,ai as n,av as c,aj as o,F as E,am as T,aw as w,al as Q,a7 as O,aF as x,aD as V,a9 as G,aB as b,aE as H,U as q,aC as J}from"./index-B6Ss7_sK.js";import{Q as K,b as W,a as S}from"./QItem-DtXzaPRO.js";import{Q as X}from"./QList-DAs5aOlh.js";import{Q as Y,a as Z}from"./QUploader-D06tUKxt.js";import{Q as ee}from"./QImg-CJaUwxcG.js";import{C as h}from"./ClosePopup-B5aMjGFf.js";import{u as ae}from"./use-quasar-D4lwK1bb.js";import{f as te}from"./useUtils-BlK2jOMY.js";import{u as oe}from"./categoriesStore-B9Gj0qU1.js";import{u as le}from"./usePermissionVisibility.hook-BWCC8YOp.js";import"./format-CJebrXOQ.js";const re={class:"q-mx-md"},ne={class:"text-h6"},ie={class:"text-center upload-title"},se={key:0,class:"flex justify-center q-mb-md"},ke=N({__name:"CategoriesPage",setup(de){const u=ae(),D=j(),d=oe(),{isManager:_,isAdmin:v}=le(P(()=>D.user)),p=y(!1),F=y({name:"",parent_id:null,description:""}),a=y({id:null,name:"",parent_id:null,description:"",image:""}),i=new FormData;function I(){a?.value?.id&&i.append("id",a.value.id.toString()),a.value?.name&&i.append("name",a.value.name),a.value?.parent_id&&i.append("price",a.value.parent_id.toString()),a.value?.description&&i.append("category_id",a.value.description.toString())}function k(l){l?.id?a.value=l:a.value=F.value,p.value=!p.value}function U(l){const e=new FileReader;e.readAsDataURL(l[0]),e.onload=()=>{a.value.image=e.result},i.delete("image"),i.append("image",l[0])}function A(l){u.dialog({title:"Удаление категорию",message:"Вы уверенны что хотите удалить категорию?",cancel:!0,persistent:!0}).onOk(()=>{B(l)})}async function B(l){try{await d.deleteCategorie(l)}catch(e){console.error(e)}finally{await d.fetchCategories()}}async function $(){try{if(I(),u.loading.show(),!a.value)return;await(a.value.id?d.updateCategorie:d.createCategories)(i)&&(await d.fetchCategories(),u.notify({message:"Категория успешно добавлена",color:"primary"}))}catch(l){console.error(l)}finally{u.loading.hide()}}return(l,e)=>{const L=z("q-item-action");return s(),C("div",null,[m("div",re,[n(_)||n(v)?(s(),f(c,{key:0,onClick:e[0]||(e[0]=r=>k()),class:"full-width q-mb-sm",color:"green",label:"Добавление категории"})):g("",!0)]),e[8]||(e[8]=m("h6",{class:"text-center q-mt-md q-mb-md"},"Категории",-1)),t(x,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:o(()=>[(s(!0),C(E,null,T(n(d).categories,(r,M)=>(s(),f(X,{key:M},{default:o(()=>[t(K,null,{default:o(()=>[t(W,null,{default:o(()=>[t(S,null,{default:o(()=>[w(Q(r.name),1)]),_:2},1024),t(S,{caption:""},{default:o(()=>[w(Q(r.description),1)]),_:2},1024)]),_:2},1024),t(L,null,{default:o(()=>[n(v)?(s(),f(c,{key:0,flat:"",round:"",color:"red",icon:"delete",onClick:R=>A(r.id)},null,8,["onClick"])):g("",!0),n(_)||n(v)?(s(),f(c,{key:1,flat:"",round:"",color:"secondary",icon:"mode_edit",onClick:R=>k(r)},null,8,["onClick"])):g("",!0)]),_:2},1024)]),_:2},1024),t(O)]),_:2},1024))),128))]),_:1}),t(J,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=r=>p.value=r)},{default:o(()=>[t(x,{style:{"min-width":"90svw"}},{default:o(()=>[t(V,null,{default:o(()=>[m("div",ne,Q(a.value.id?"Редактировать категорию":"Добавить категорию"),1)]),_:1}),t(V,{class:"q-pt-none"},{default:o(()=>[t(Y,{ref:"uploaderRef",color:"primary",flat:"","max-file-size":"15728640",onAdded:U,onRejected:e[1]||(e[1]=r=>n(te)(n(u)))},{header:o(()=>[...e[6]||(e[6]=[])]),list:o(()=>[t(Z),m("div",ie,[t(G,{class:"q-mr-sm",name:"note_add",size:"24px"}),e[7]||(e[7]=m("span",null,"Загрузить картинку",-1))])]),_:1},512),a.value.image?(s(),C("div",se,[t(ee,{class:"cursor-pointer radius-8",src:a.value.image,height:"120px",width:"120px",fit:"cover"},null,8,["src"])])):g("",!0),t(b,{modelValue:a.value.name,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.name=r),class:"q-mb-xs",outlined:"",label:"Наиминование категории"},null,8,["modelValue"]),t(b,{class:"q-mt-sm",modelValue:a.value.description,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.description=r),filled:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),t(H,{align:"right"},{default:o(()=>[q(t(c,{flat:"",label:"Отмена",color:"negative"},null,512),[[h]]),q(t(c,{flat:"",label:"Подтвердить",color:"primary",onClick:e[4]||(e[4]=r=>$())},null,512),[[h]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{ke as default};
