import{Q as J}from"./QImg-E7WW7NPI.js";import{d as D,r as v,o as P,aj as A,ae as h,aE as K,af as n,f as e,aH as I,as as M,aF as z,aq as u,ak as y,au as x,aP as X,aG as Y,W as ee,ah as q,u as le,c as S,aD as $,av as ae,ar as se,ad as _,am as b,a6 as p,aC as oe,al as te}from"./index-BL4Uf-8I.js";import{u as B,Q as ne}from"./addressesStore-B2upoGWF.js";import{Q as de,a as re,b as ie}from"./QItem-D72RGXiK.js";import{Q as j}from"./QSelect-CsmK4VC9.js";import{u as N}from"./use-quasar-BxnWE74C.js";import{Q as ue}from"./QForm-5BUJAQCI.js";import{C as me}from"./ClosePopup-DTAt1ULH.js";import{r as U,g as ce}from"./useUtils-rEAWjIO8.js";import{u as pe}from"./usersStore-QDu637Zh.js";import"./QBtnGroup-DO2Qk3D1.js";import"./QMenu-B-1LNM8D.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const ve=D({__name:"AddAddressModal",props:{newAddress:{}},setup(Q){const i=Q,c=N(),f=B(),w=v(!0),k=v(),o=v();P(async()=>{try{const m={area_id:null,address_line:"",comment:"",is_default:!1};i.newAddress?o.value=i.newAddress:o.value=m,c.loading.show();const l=await f.fetchDeliveryZones();l&&(f.deliveryZones=l)}catch(m){console.error(m)}finally{c.loading.hide()}});async function g(){try{await(o?.value?.id?f.updateAddress:f.createAddress)(o.value)}catch(m){console.error(m)}finally{k.value.hide()}}return(m,l)=>(h(),A(K,{ref_key:"dialogRef",ref:k,modelValue:w.value,"onUpdate:modelValue":l[5]||(l[5]=d=>w.value=d),persistent:""},{default:n(()=>[e(I,{class:""},{default:n(()=>[e(ue,{greedy:"",onSubmit:l[4]||(l[4]=d=>g())},{default:n(()=>[o.value?(h(),A(z,{key:0},{default:n(()=>[l[6]||(l[6]=u("div",{class:"text-h6"},"Создание нового адреса доставки",-1)),e(j,{modelValue:o.value.area_id,"onUpdate:modelValue":l[0]||(l[0]=d=>o.value.area_id=d),options:y(f).deliveryZones,class:"q-mb-xs",outlined:"",label:"Зона доставки *","emit-value":"","map-options":"","option-label":"title","option-value":"id",rules:[y(U)]},null,8,["modelValue","options","rules"]),e(x,{class:"q-mb-sm",outlined:"",modelValue:o.value.address_line,"onUpdate:modelValue":l[1]||(l[1]=d=>o.value.address_line=d),label:"Адрес *",rules:[y(U)]},null,8,["modelValue","rules"]),e(x,{label:"Комментарий",modelValue:o.value.comment,"onUpdate:modelValue":l[2]||(l[2]=d=>o.value.comment=d),outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"]),e(X,{modelValue:o.value.is_default,"onUpdate:modelValue":l[3]||(l[3]=d=>o.value.is_default=d),label:"Активный аддрес"},null,8,["modelValue"])]),_:1})):M("",!0),e(Y,{align:"right"},{default:n(()=>[ee(e(q,{color:"red",flat:"",label:"Отмена"},null,512),[[me]]),e(q,{color:"primary",flat:"",label:"Сохранить",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),fe={class:"q-pa-sm"},ge={class:"justify-center row q-mb-md"},he={class:"text-h5 justify-between q-mb-sm row"},ye={class:"items-center"},we={class:"items-center"},ke={key:0,class:"row items-center q-mb-sm text-h6"},Ve={style:{height:"40px"},class:"col-10 content-center"},_e={key:1,class:"row items-center q-mb-sm"},be={class:"row items-center q-mb-sm"},je=D({__name:"UserPage",setup(Q){const i=N(),c=B(),f=pe(),w=le(),k=S(()=>$.isActive),o=ae({dark:"dark",light:"light"}),g=v(!1),m=S(()=>k.value?o.dark:o.light),l=v(!1),d=v("dark"),r=v({full_name:"",mail:"",phone:"",addres:null}),V=v();P(()=>{r.value=w.user,O()});function T(t){r.value.addres=t,console.log(r.value.addres),F(t)}function R(){V.value=null,l.value=!l.value}async function Z(t){try{i.loading.show(),await c.deleteAddress(t.id)}catch(a){console.error(a)}finally{i.loading.hide()}}function E(t){V.value=t,l.value=!l.value}async function F(t){try{i.loading.show(),await c.updateAddress(t)}catch(a){console.error(a)}finally{i.loading.hide()}}const L=()=>{$.toggle(),window.localStorage.setItem("theme",m.value)};function G(){i.dialog({title:"Смена номера телефона",message:"Вы уверенны что хотите изменить номер?",cancel:!0,persistent:!0}).onOk(()=>{H()})}async function H(){try{i.loading.show(),await f.updateMyPhone(r.value.phone)}catch(t){console.error(t)}finally{i.loading.hide()}}async function O(){try{i.loading.show();const t=await c.fetchAddresses();t&&(c.addresses=t)}catch(t){console.error(t)}finally{i.loading.hide()}}return(t,a)=>{const W=se("q-item-action");return h(),_("div",null,[a[9]||(a[9]=u("h6",{class:"text-center q-mb-md"},"Личный кабинет",-1)),u("div",fe,[e(I,{class:"my-card full-height",flat:"",bordered:""},{default:n(()=>[e(z,null,{default:n(()=>[u("div",ge,[e(J,{class:"radius-100",height:"120px",width:"120px",src:r.value?.main_image_url?r.value.main_image_url:y(ce)("/card-shop.jpg")},null,8,["src"])]),u("div",he,[u("div",null,b(r.value.full_name),1),u("div",null,[e(ne,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=s=>d.value=s),size:"sm","no-caps":"",unelevated:"",dense:"","toggle-color":"grey-9",color:"white","text-color":"grey-9",options:[{value:"dark",slot:"dark",title:"Dark mode"},{value:"light",slot:"light",title:"Light mode"}],onClick:a[1]||(a[1]=s=>L())},{dark:n(()=>[u("div",ye,[e(p,{name:"nightlight"})])]),light:n(()=>[u("div",we,[e(p,{name:"light_mode"})])]),_:1},8,["modelValue"])])]),!g.value&&r.value?.phone?(h(),_("div",ke,[u("div",Ve,b(r.value.phone),1),e(p,{onClick:a[2]||(a[2]=s=>g.value=!g.value),name:"edit",size:"30px",color:"green",class:"col-2"})])):(h(),_("div",_e,[e(p,{onClick:a[3]||(a[3]=s=>g.value=!g.value),name:"close",size:"30px",color:"red",class:"col-1"}),e(x,{class:"col-9",dense:"",outlined:"",modelValue:r.value.phone,"onUpdate:modelValue":a[4]||(a[4]=s=>r.value.phone=s),label:"Телефон",mask:"+# (###) ###-##-##",type:"tel"},null,8,["modelValue"]),e(p,{onClick:a[5]||(a[5]=s=>G()),name:"save",size:"30px",color:"green",class:"col-2"})])),u("div",be,[e(j,{modelValue:r.value.addres,"onUpdate:modelValue":a[6]||(a[6]=s=>r.value.addres=s),options:y(c).addresses,class:"col-10",dense:"",outlined:"",label:"Адрес","emit-value":"","map-options":"","option-label":"address_line","option-value":"id"},{option:n(s=>[e(de,oe(s.itemProps,{class:"justify-between flex"}),{default:n(()=>[e(re,{onClick:C=>T(s.opt)},{default:n(()=>[e(ie,null,{default:n(()=>[te(b(s.opt.address_line),1)]),_:2},1024)]),_:2},1032,["onClick"]),e(W,null,{default:n(()=>[e(p,{class:"q-mr-sm",color:"red",name:"delete",size:"26px",onClick:C=>Z(s.opt)},null,8,["onClick"]),e(p,{color:"green",name:"edit",size:"26px",onClick:C=>E(s.opt)},null,8,["onClick"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),e(p,{onClick:a[7]||(a[7]=s=>R()),name:"add",size:"34px",color:"green",class:"col-2"})])]),_:1})]),_:1})]),l.value?(h(),A(ve,{key:0,modelValue:l.value,"onUpdate:modelValue":a[8]||(a[8]=s=>l.value=s),newAddress:V.value},null,8,["modelValue","newAddress"])):M("",!0)])}}});export{je as default};
