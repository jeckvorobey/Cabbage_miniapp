import{V as M,r as y,w as b,a4 as Q,M as c,$ as t,_ as e,a2 as B,a0 as F,N as I,a1 as C,a9 as w,aa as R,ab as q,S as p,ac as E,h as O,a3 as T,L as U,a5 as x,Z as g,X,Y,a6 as $,a7 as Z}from"./index-B18Ac6EF.js";import{Q as j,a as h,b as D}from"./QItem-8F67ppZ-.js";import{Q as z}from"./QList-yY7Awcpb.js";import{u as N}from"./use-quasar-D4ucj3x8.js";import{u as L}from"./unitsStore-whMfhEpS.js";import{Q as G}from"./QForm-Cx8R7Pi1.js";import{C as S}from"./ClosePopup-C-Nl1Atw.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as J}from"./usePermissionVisibility.hook-BmGylBfj.js";import"./useUtils-BNyv7Twq.js";const K={class:"text-h6 q-mb-md"},W=M({__name:"AddUnitModal",props:{modelValue:{type:Boolean,default:!1},unitData:{default:()=>({name:"",symbol:""})}},emits:["update:modelValue","update"],setup(k,{emit:f}){const s=k,v=f,r=N(),m=L(),i=y(s.modelValue),l=y({...s.unitData});b(()=>s.unitData,o=>{l.value={...o??{name:"",symbol:""}}},{immediate:!0,deep:!0}),b(()=>s.modelValue,o=>{i.value=o},{immediate:!0}),b(i,o=>{v("update:modelValue",o)});async function _(){try{l.value?.id?await m.updateUnit(l.value.id,l.value)&&r.notify({message:"Единица измерения успешно обновлена",color:"primary"}):await m.createUnit(l.value)&&r.notify({message:"Единица измерения успешно создана",color:"primary"})}catch(o){console.error(o)}finally{i.value=!1,v("update")}}return(o,u)=>(c(),Q(E,{ref:"dialogRef",modelValue:i.value,"onUpdate:modelValue":u[3]||(u[3]=a=>i.value=a),persistent:""},{default:t(()=>[e(B,{class:"add-product"},{default:t(()=>[e(G,{greedy:""},{default:t(()=>[e(F,null,{default:t(()=>[I("div",K,C(l.value.id?"Редактирование":"Добавление")+" единицы измерения ",1),e(w,{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=a=>l.value.name=a),class:"q-mb-xs",label:"Наименование (пример: кг, гр, шт)",outlined:""},null,8,["modelValue"]),e(w,{modelValue:l.value.symbol,"onUpdate:modelValue":u[1]||(u[1]=a=>l.value.symbol=a),class:"q-mb-xs",label:"Символ (пример: kg, gr, sh)",outlined:""},null,8,["modelValue"])]),_:1}),e(R,{align:"right"},{default:t(()=>[q(e(p,{color:"red",flat:"",label:"Отмена"},null,512),[[S]]),q(e(p,{color:"primary",flat:"",label:"Сохранить",onClick:u[2]||(u[2]=a=>_())},null,512),[[S]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ee=H(W,[["__scopeId","data-v-78941c8e"]]),ae={key:0},ce=M({__name:"UnitsPage",setup(k){const f=N(),s=L(),{isManager:v}=J(),r=y(!1),m=y();O(()=>{i()});async function i(){try{await s.fetchUnits(),f.loading.show()}catch(a){console.error(a)}finally{f.loading.hide()}}function l(a){f.dialog({title:"Удаление единицы измерения",message:"Вы уверенны что хотите удалить единицу измерения?",cancel:!0,persistent:!0}).onOk(()=>{_(a)})}async function _(a){try{await s.deleteUnit(a)}catch(n){console.error(n)}finally{await i()}}function o(){m.value=void 0,r.value=!0}function u(a){const n=s.units.find(V=>V.id===a);n&&(m.value={...n},r.value=!0)}return(a,n)=>{const V=T("q-item-action");return c(),U("div",null,[e(p,{onClick:o,class:"full-width q-mb-sm",color:"secondary",label:"Добавление единицы измерения"}),g(s).units?(c(),U("div",ae,[n[2]||(n[2]=I("h6",{class:"text-center q-mt-md q-mb-md"},"Единицы измерения",-1)),e(B,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:t(()=>[(c(!0),U(X,null,Y(g(s).units,(d,P)=>(c(),Q(z,{key:P},{default:t(()=>[e(j,null,{default:t(()=>[e(h,null,{default:t(()=>[e(D,null,{default:t(()=>[$(C(d.name),1)]),_:2},1024)]),_:2},1024),e(h,null,{default:t(()=>[e(D,null,{default:t(()=>[$(C(d.symbol),1)]),_:2},1024)]),_:2},1024),e(V,null,{default:t(()=>[g(v)?(c(),Q(p,{key:0,flat:"",round:"",color:"red",icon:"delete",onClick:A=>l(d.id)},null,8,["onClick"])):x("",!0),e(p,{flat:"",round:"",color:"primary",icon:"mode_edit",onClick:A=>u(d.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),e(Z)]),_:2},1024))),128))]),_:1})])):x("",!0),e(ee,{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=d=>r.value=d),"unit-data":m.value,onUpdate:n[1]||(n[1]=d=>i())},null,8,["modelValue","unit-data"])])}}});export{ce as default};
