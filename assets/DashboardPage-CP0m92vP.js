import{k as se,g as W,a as M,x as D,y as ie,X as re,c as N,h as ue,l as de,r as Q,d as A,ah as x,ac as v,aC as ce,ad as i,f as t,ai as b,aD as H,ao as m,ak as y,a4 as pe,aq as U,as as $,aE as E,U as F,af as w,ab as z,aF as me,aa as fe,o as ge,ae as ve,F as ye,aG as K,aj as T,az as _e,ag as he}from"./index-BtcsNcRd.js";import{Q as Y}from"./QImg-BBmg4ckM.js";import{Q as be,a as L,b as O}from"./QItem-aMi6nbsh.js";import{Q as xe}from"./QList-etRnyz74.js";import{Q as ke}from"./QInfiniteScroll-BlVFQKX-.js";import{u as Z}from"./productsStore-BpE-insu.js";import{e as Ce}from"./orderStore-CAX0a7TM.js";import{u as ee}from"./use-quasar-NHCBRNxs.js";import{g as Qe,Q as Ve,a as De}from"./QUploader-CdHa1CF6.js";import{Q as G}from"./QSelect-CNzfxky-.js";import{Q as J}from"./QForm-Ba-0JI1J.js";import{C as I}from"./ClosePopup-AzTV9piN.js";import{u as ae}from"./usePermissionVisibility.hook-BP2O4-08.js";import{P as X}from"./ProductImgCarusel-C-KieCnE.js";import{u as we}from"./categoriesStore-DAjvEEyB.js";import{u as te}from"./unitsStore-CuUJL5Cs.js";import{f as Pe,g as oe}from"./useUtils-CwtG7muQ.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QMenu-COqQ56DN.js";import"./format-CJebrXOQ.js";import"./rtl-DFPa-2ov.js";const qe=se({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(h,{slots:f}){const{proxy:{$q:c}}=W(),d=M(ie,D);if(d===D)return console.error("QPage needs to be a deep child of QLayout"),D;if(M(re,D)===D)return console.error("QPage needs to be child of QPageContainer"),D;const p=N(()=>{const _=(d.header.space===!0?d.header.size:0)+(d.footer.space===!0?d.footer.size:0);if(typeof h.styleFn=="function"){const C=d.isContainer.value===!0?d.containerHeight.value:c.screen.height;return h.styleFn(_,C)}return{minHeight:d.isContainer.value===!0?d.containerHeight.value-_+"px":c.screen.height===0?_!==0?`calc(100vh - ${_}px)`:"100vh":c.screen.height-_+"px"}}),k=N(()=>`q-page${h.padding===!0?" q-layout-padding":""}`);return()=>ue("main",{class:k.value,style:p.value},de(f.default))}});function B(){const{emit:h,proxy:f}=W(),c=Q(null);function d(){c.value.show()}function n(){c.value.hide()}function p(_){h("ok",_),n()}function k(){h("hide")}return Object.assign(f,{show:d,hide:n}),{dialogRef:c,onDialogHide:k,onDialogOK:p,onDialogCancel:n}}const le=["ok","hide"];B.emits=le;B.emitsObject=Qe(le);const Se={class:"text-h6 q-mb-md"},$e={class:"text-center upload-title"},Fe={key:1},Ie={class:"text-h6 text-center q-mt-sm"},Ue={class:"text-bold"},Re=A({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(h,{emit:f}){const c=h,d=f,n=ee(),p=Z(),k=we(),{dialogRef:_}=B(),{isManager:C}=ae(),R=te(),q=Q(!1),V=Q(),e=Q({id:null,name:"",price:null,category_id:null,unit_id:null,description:"",images:"",origin_country:"",unit:null}),g=new FormData;c.productData&&(e.value=c.productData);async function S(){try{let u=null;e.value?.id?u=p.updateProduct(e.value):(o(),u=await p.createProduct(g)),u&&(e.value.id=u.id,n.notify({message:"Успешно сохранено",color:"primary"}),d("refresh-data"))}catch(u){console.error(u)}}function r(){d("add-product",e.value)}function o(){e?.value?.id&&g.append("id",e.value.id.toString()),e.value?.name&&g.append("name",e.value.name),e.value?.price&&g.append("price",e.value.price.toString()),e.value?.category_id&&g.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&g.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&g.append("qty",e.value.qty.toString()),e.value?.description&&g.append("description",e.value.description),e.value?.origin_country&&g.append("origin_country",e.value.origin_country)}function l(u){const a=new FileReader;a.readAsDataURL(u[0]),a.onload=()=>{},g.delete("images"),g.append("images",u[0]),e.value?.id&&j(u[0])}async function j(u){const a=new FormData;a.append("file",u),a.append("is_primary","true");try{await p.uploadFile(e.value.id,a)&&(P(),n.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(s){console.error(s)}finally{V.value&&V.value.reset()}}async function P(){try{const u=await p.fetchProductsById(e.value.id);e.value=u}catch(u){console.error(u)}}return(u,a)=>(v(),x(ce,{ref_key:"dialogRef",ref:_,modelValue:q.value,"onUpdate:modelValue":a[10]||(a[10]=s=>q.value=s),persistent:""},{default:i(()=>[t(me,{class:"add-product"},{default:i(()=>[b(C)?(v(),x(J,{key:0,greedy:""},{default:i(()=>[t(H,null,{default:i(()=>[m("div",Se,y(e.value.id?"Редактирование товара":"Добавление товара"),1),t(Ve,{ref_key:"uploaderRef",ref:V,color:"primary",flat:"","max-file-size":"15728640",onAdded:l,onRejected:a[0]||(a[0]=s=>b(Pe)(b(n)))},{header:i(()=>[...a[11]||(a[11]=[])]),list:i(()=>[t(De),m("div",$e,[t(pe,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[12]||(a[12]=m("span",null,"Загрузить картинку",-1))])]),_:1},512),m("div",null,[e.value?.images?.length?(v(),x(X,{key:0,onRefreshData:a[1]||(a[1]=s=>P()),images:e.value.images},null,8,["images"])):U("",!0)]),t($,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=s=>e.value.name=s),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),t($,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=s=>e.value.price=s),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),t($,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[4]||(a[4]=s=>e.value.origin_country=s),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),t(G,{modelValue:e.value.category_id,"onUpdate:modelValue":a[5]||(a[5]=s=>e.value.category_id=s),options:b(k).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),t(G,{modelValue:e.value.unit_id,"onUpdate:modelValue":a[6]||(a[6]=s=>e.value.unit_id=s),options:b(R).units,outlined:"",label:"Единица измерения","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),t($,{class:"q-mt-sm",modelValue:e.value.description,"onUpdate:modelValue":a[7]||(a[7]=s=>e.value.description=s),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),t(E,{align:"right"},{default:i(()=>[F(t(w,{color:"red",label:"Отмена"},null,512),[[I]]),F(t(w,{color:"primary",label:"Подтвердить",onClick:a[8]||(a[8]=s=>S())},null,512),[[I]])]),_:1})]),_:1})):(v(),x(J,{key:1},{default:i(()=>[t(H,null,{default:i(()=>[m("div",null,[e.value?.images?.length?(v(),x(X,{key:0,images:e.value.images},null,8,["images"])):(v(),z("div",Fe,[t(Y,{class:"q-mt-sm",src:b(oe)("/card-shop.jpg")},null,8,["src"])]))]),m("div",Ie,y(e.value.name),1),m("div",Ue,"Стоимость товара: "+y(e.value.price),1),m("div",null,"Вес: 11 "+y(e.value?.unit?.name||"")+".",1),m("div",null,"Страна происхождения: "+y(e.value.origin_country),1),m("div",null,"Описание: "+y(e.value.description),1)]),_:1}),t(E,{align:"right"},{default:i(()=>[F(t(w,{color:"red",label:"Отмена"},null,512),[[I]]),F(t(w,{color:"primary",label:"Добавить в корзину",onClick:a[9]||(a[9]=s=>r())},null,512),[[I]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),je=ne(Re,[["__scopeId","data-v-76a805e9"]]),Le={class:"product-card"},Oe={key:0,class:"text-grey old-price"},ze={class:"row items-end"},Ae=A({__name:"ProductList",setup(h){const f=ee(),c=fe(),d=te(),n=Z(),p=Ce(),{isManager:k}=ae(),_=Q(!1),C=Q(!1),R=Q();ge(async()=>{try{await d.fetchUnits(),f.loading.show()}catch(r){console.error(r)}finally{f.loading.hide()}});function q(){n.pagination.offset=0,V()}async function V(){try{f.loading.show();const r={offset:n.pagination.offset,limit:n.pagination.limit},o=await n.fetchProducts(r);o&&(n.pagination.total=o.total,n.pagination.has_more=o.has_more,n?.products?.length?n.products.push(o.items):n.products=o.items)}catch(r){console.error(r)}finally{f.loading.hide()}}function e(r){try{if(r.quantity=1,r.product_id=r.id,f.loading.show(),!p.basketData.length)p.basketData.push(structuredClone(K(r)));else{const o=p.basketData.find(l=>l.id===r.id);o?o.quantity+=1:p.basketData.push(structuredClone(K(r)))}window.localStorage.setItem("basket",JSON.stringify(p.basketData))}catch(o){console.error(o)}finally{f.loading.hide()}}const g=async(r,o)=>{if(!n.pagination.has_more){_.value=!0,o(!0);return}await V(),n.pagination.offset+=n.pagination.limit,o()};function S(r){c.push({name:"products-edit",params:{id:r.id}})}return(r,o)=>(v(),x(ke,{onLoad:g,offset:250},{default:i(()=>[b(k)?(v(),x(w,{key:0,onClick:o[0]||(o[0]=l=>b(c).push({name:"products-create"})),class:"full-width q-mb-sm",color:"green",label:"Добавить товар"})):U("",!0),m("div",Le,[(v(!0),z(ye,null,ve(b(n).products,(l,j)=>(v(),x(xe,{key:j},{default:i(()=>[t(be,null,{default:i(()=>[t(L,{top:"",avatar:"",onClick:P=>S(l)},{default:i(()=>[t(Y,{class:"cursor-pointer radius-8",src:l[0]?.primary_image?l[0].primary_image:b(oe)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),t(L,{class:"column justify-between",onClick:P=>S(l)},{default:i(()=>[t(O,{caption:"",class:"text-size-16"},{default:i(()=>[T(y(l.name),1)]),_:2},1024),t(O,null,{default:i(()=>[l?.old_price?(v(),z("div",Oe,y(l.old_price)+" ₽",1)):U("",!0),m("div",{class:_e(l?.old_price?"text-red":"")},y(l.price)+" ₽/ "+y(l.unit_name),3)]),_:2},1024)]),_:2},1032,["onClick"]),t(L,{side:"",top:"",class:"column justify-between"},{default:i(()=>[o[3]||(o[3]=m("div",null,null,-1)),m("div",ze,[t(O,{class:"q-mr-xs",caption:""},{default:i(()=>[T(y(l.price)+" ₽/ "+y(l.unit_name),1)]),_:2},1024),t(w,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:P=>e(l)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024),t(he,{spaced:"",inset:""})]),_:2},1024))),128))]),C.value?(v(),x(je,{key:1,modelValue:C.value,"onUpdate:modelValue":o[1]||(o[1]=l=>C.value=l),productData:R.value,onRefreshData:o[2]||(o[2]=l=>q()),onAddProduct:e},null,8,["modelValue","productData"])):U("",!0)]),_:1}))}}),Be=ne(Ae,[["__scopeId","data-v-a99b0c76"]]),ua=A({__name:"DashboardPage",setup(h){return(f,c)=>(v(),x(qe,{class:"q-mx-xs"},{default:i(()=>[t(Be,{class:"q-mb-lg"})]),_:1}))}});export{ua as default};
