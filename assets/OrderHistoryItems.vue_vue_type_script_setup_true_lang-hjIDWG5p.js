import{Q as v,a as c,b as o}from"./QItem-C6LXZDTY.js";import{Q as D}from"./QList-7-VUiExy.js";import{Q as T}from"./QBtnDropdown-BbZZBmyD.js";import{V as O,W as R,a1 as p,Y as r,$ as a,Z as e,a2 as I,a3 as N,X as _,ab as E,a5 as s,a6 as m,a4 as k,a7 as V,z as w}from"./index-D-7JaD_y.js";import{C as G}from"./ClosePopup-DGk5kQfF.js";import{u as $,d as P}from"./use-quasar-BM3273VG.js";import{u as x}from"./orderStore-Bxn6raw7.js";var u=(i=>(i.CREATED="created",i.ASSEMBLING="assembling",i.DELIVERING="delivering",i.COMPLETED="completed",i.CANCELLED="cancelled",i))(u||{});const U=["href"],q={key:1},J=O({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},setup(i){const f=$(),Q=x(),g=[{label:"создан",value:u.CREATED},{label:"собирается",value:u.ASSEMBLING},{label:"в пути",value:u.DELIVERING},{label:"завершён",value:u.COMPLETED},{label:"отменён",value:u.CANCELLED}];function S(n,t){f.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{L(n,t)})}async function L(n,t){try{f.loading.show(),await Q.updateOrderStatus(n,t)&&f.notify({color:"primary",message:"Статус успешно изменен"})}catch(d){console.error(d)}finally{f.loading.hide()}}function A(n){return g.find(d=>d.value===n)?.label}function B(n){f.dialog({cancel:!0,message:"Вы уверенны что хотите отменить заказ?",persistent:!0,title:"Отмена заказа"}).onOk(()=>{L(n,u.CANCELLED)})}function y(n){const t=n.username?.trim().replace(/^@/,"");return t?`https://t.me/${encodeURIComponent(t)}`:null}function b(n){if(!n.phone)return null;const t=n.phone.trim();return t.length?t:null}return(n,t)=>{const d=R("q-item-action");return r(),p("div",null,[a(D,null,{default:e(()=>[(r(!0),p(I,null,N(n.orderData,(l,M)=>(r(),_(v,{key:l.id??M,class:"border-bot"},{default:e(()=>[a(c,null,{default:e(()=>[a(o,{caption:"",lines:"2"},{default:e(()=>[...t[0]||(t[0]=[s("Дата",-1)])]),_:1}),a(o,null,{default:e(()=>[s(m(k(P)(l.order_date)),1)]),_:2},1024)]),_:2},1024),a(c,null,{default:e(()=>[a(o,{caption:"",lines:"2"},{default:e(()=>[...t[1]||(t[1]=[s("Имя",-1)])]),_:1}),a(o,null,{default:e(()=>[y(l.user)?(r(),p("a",{key:0,href:y(l.user),target:"_blank",rel:"noopener noreferrer",class:"text-primary text-decoration-none"},m(l.user.full_name),9,U)):(r(),p("span",q,m(l.user.full_name),1))]),_:2},1024),b(l.user)?(r(),_(o,{key:0,caption:""},{default:e(()=>[s(m(b(l.user)),1)]),_:2},1024)):E("",!0)]),_:2},1024),a(c,null,{default:e(()=>[a(o,{caption:"",lines:"2"},{default:e(()=>[...t[2]||(t[2]=[s("Статус",-1)])]),_:1}),a(o,null,{default:e(()=>[s(m(A(l.status)),1)]),_:2},1024)]),_:2},1024),a(c,null,{default:e(()=>[a(o,{caption:"",lines:"2"},{default:e(()=>[...t[3]||(t[3]=[s("Общая сумма",-1)])]),_:1}),a(o,null,{default:e(()=>[s(m(l.total_amount),1)]),_:2},1024)]),_:2},1024),n.adminMode?(r(),_(d,{key:0},{default:e(()=>[a(T,{color:"green",dense:""},{default:e(()=>[(r(),p(I,null,N(g,(C,h)=>a(D,{key:h},{default:e(()=>[V((r(),_(v,{clickable:"",onClick:z=>S(l.id,C.value)},{default:e(()=>[a(c,null,{default:e(()=>[a(o,null,{default:e(()=>[s(m(C.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[G]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):E("",!0),!n.adminMode&&(l.status===k(u).CREATED||l.status===k(u).ASSEMBLING)?(r(),_(d,{key:1},{default:e(()=>[a(w,{round:"",color:"deep-orange",icon:"close",onClick:C=>B(l.id)},null,8,["onClick"])]),_:2},1024)):E("",!0)]),_:2},1024))),128))]),_:1})])}}});export{J as _};
