import{k as re,g as W,a as H,x as k,y as ue,X as de,c as j,h as ce,l as pe,r as C,d as M,u as Y,o as Z,af as x,ae as g,aC as me,aj as s,f as t,ai as b,aD as E,ak as c,al as v,a9 as fe,ag as R,aA as q,aE as K,U,av as w,ad as z,aF as ge,aa as ve,am as ye,F as _e,aG as he,aw as T,ah as be,a7 as xe}from"./index-BwC_XB_e.js";import{Q as ee}from"./QImg-CjzA9GGi.js";import{Q as Ve,b as O,a as B}from"./QItem-eZzufJZt.js";import{Q as Ce}from"./QList-ClqHarfZ.js";import{Q as Qe}from"./QInfiniteScroll-B-BQk_8B.js";import{u as ae}from"./productsStore-C_mHdVTW.js";import{e as ke}from"./orderStore-B7tDlage.js";import{u as te}from"./use-quasar-4Hx1Vfa4.js";import{g as we,Q as Pe,a as Se}from"./QUploader-mAP9jfga.js";import{Q as G}from"./QSelect-fo99TntW.js";import{Q as J}from"./QForm-DRsa4oGx.js";import{C as I}from"./ClosePopup-Ch3uWRBb.js";import{u as oe}from"./usePermissionVisibility.hook-DBWbnxhw.js";import{P as X}from"./ProductImgCarusel-NvnR31cH.js";import{u as De}from"./categoriesStore-Bw6EUR1Z.js";import{u as le}from"./unitsStore-DLH0szGc.js";import{f as qe,g as ne}from"./useUtils-DQIq_dTD.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QMenu-N82fB4oN.js";import"./format-CJebrXOQ.js";import"./rtl-DFPa-2ov.js";const $e=re({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(h,{slots:p}){const{proxy:{$q:d}}=W(),u=H(ue,k);if(u===k)return console.error("QPage needs to be a deep child of QLayout"),k;if(H(de,k)===k)return console.error("QPage needs to be child of QPageContainer"),k;const y=j(()=>{const _=(u.header.space===!0?u.header.size:0)+(u.footer.space===!0?u.footer.size:0);if(typeof h.styleFn=="function"){const P=u.isContainer.value===!0?u.containerHeight.value:d.screen.height;return h.styleFn(_,P)}return{minHeight:u.isContainer.value===!0?u.containerHeight.value-_+"px":d.screen.height===0?_!==0?`calc(100vh - ${_}px)`:"100vh":d.screen.height-_+"px"}}),V=j(()=>`q-page${h.padding===!0?" q-layout-padding":""}`);return()=>ce("main",{class:V.value,style:y.value},pe(p.default))}});function N(){const{emit:h,proxy:p}=W(),d=C(null);function u(){d.value.show()}function o(){d.value.hide()}function y(_){h("ok",_),o()}function V(){h("hide")}return Object.assign(p,{show:u,hide:o}),{dialogRef:d,onDialogHide:V,onDialogOK:y,onDialogCancel:o}}const ie=["ok","hide"];N.emits=ie;N.emitsObject=we(ie);const Fe={class:"text-h6 q-mb-md"},Ue={class:"text-center upload-title"},Ie={key:1},Re={class:"text-h6 text-center q-mt-sm"},je={class:"text-bold"},Le=M({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(h,{emit:p}){const d=h,u=p,o=te(),y=ae(),V=De(),{dialogRef:_}=N(),P=Y(),{isManager:S}=oe(j(()=>P.user)),L=le(),$=C(!1),Q=C(),e=C({id:null,name:"",price:null,category_id:null,unit_id:null,qty:null,description:"",images:"",origin_country:"",unit:null}),m=new FormData;Z(()=>{d.productData&&(e.value=d.productData)});async function F(){try{let r=null;e.value?.id?r=y.updateProduct(e.value):(n(),r=await y.createProduct(m)),r&&(e.value.id=r.id,o.notify({message:"Успешно сохранено",color:"primary"}),u("refresh-data"))}catch(r){console.error(r)}}function f(){u("add-product",e.value)}function n(){e?.value?.id&&m.append("id",e.value.id.toString()),e.value?.name&&m.append("name",e.value.name),e.value?.price&&m.append("price",e.value.price.toString()),e.value?.category_id&&m.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&m.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&m.append("qty",e.value.qty.toString()),e.value?.description&&m.append("description",e.value.description),e.value?.origin_country&&m.append("origin_country",e.value.origin_country)}function i(r){const a=new FileReader;a.readAsDataURL(r[0]),a.onload=()=>{},m.delete("images"),m.append("images",r[0]),e.value?.id&&A(r[0])}async function A(r){const a=new FormData;a.append("file",r),a.append("is_primary","true");try{await y.uploadFile(e.value.id,a)&&(D(),o.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(l){console.error(l)}finally{Q.value&&Q.value.reset()}}async function D(){try{const r=await y.fetchProductsById(e.value.id);e.value=r}catch(r){console.error(r)}}return(r,a)=>(g(),x(me,{ref_key:"dialogRef",ref:_,modelValue:$.value,"onUpdate:modelValue":a[11]||(a[11]=l=>$.value=l),persistent:""},{default:s(()=>[t(ge,{class:"add-product"},{default:s(()=>[b(S)?(g(),x(J,{key:0,greedy:""},{default:s(()=>[t(E,null,{default:s(()=>[c("div",Fe,v(e.value.id?"Редактирование товара":"Добавление товара"),1),t(Pe,{ref_key:"uploaderRef",ref:Q,color:"primary",flat:"","max-file-size":"15728640",onAdded:i,onRejected:a[0]||(a[0]=l=>b(qe)(b(o)))},{header:s(()=>[...a[12]||(a[12]=[])]),list:s(()=>[t(Se),c("div",Ue,[t(fe,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[13]||(a[13]=c("span",null,"Загрузить картинку",-1))])]),_:1},512),c("div",null,[e.value?.images?.length?(g(),x(X,{key:0,onRefreshData:a[1]||(a[1]=l=>D()),images:e.value.images},null,8,["images"])):R("",!0)]),t(q,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.name=l),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),t(q,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.price=l),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),t(q,{modelValue:e.value.qty,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.qty=l),class:"q-mb-xs",outlined:"",label:"Количество"},null,8,["modelValue"]),t(q,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.origin_country=l),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),t(G,{modelValue:e.value.category_id,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.category_id=l),options:b(V).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),t(G,{modelValue:e.value.unit_id,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.unit_id=l),options:b(L).units,outlined:"",label:"Единица измерения","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),t(q,{class:"q-mt-sm",modelValue:e.value.description,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.description=l),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),t(K,{align:"right"},{default:s(()=>[U(t(w,{color:"red",label:"Отмена"},null,512),[[I]]),U(t(w,{color:"primary",label:"Подтвердить",onClick:a[9]||(a[9]=l=>F())},null,512),[[I]])]),_:1})]),_:1})):(g(),x(J,{key:1},{default:s(()=>[t(E,null,{default:s(()=>[c("div",null,[e.value?.images?.length?(g(),x(X,{key:0,images:e.value.images},null,8,["images"])):(g(),z("div",Ie,[t(ee,{class:"q-mt-sm",src:b(ne)("/card-shop.jpg")},null,8,["src"])]))]),c("div",Re,v(e.value.name),1),c("div",je,"Стоимость товара: "+v(e.value.price),1),c("div",null,"Вес: 11 "+v(e.value?.unit?.name||"")+".",1),c("div",null,"Страна происхождения: "+v(e.value.origin_country),1),c("div",null,"Описание: "+v(e.value.description),1)]),_:1}),t(K,{align:"right"},{default:s(()=>[U(t(w,{color:"red",label:"Отмена"},null,512),[[I]]),U(t(w,{color:"primary",label:"Добавить в корзину",onClick:a[10]||(a[10]=l=>f())},null,512),[[I]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),Ae=se(Le,[["__scopeId","data-v-745dd5a6"]]),Oe={class:"product-card"},Be={key:0,class:"text-grey old-price"},ze={class:"row items-end"},Me=M({__name:"ProductList",setup(h){const p=te(),d=ve(),u=le(),o=ae(),y=ke(),V=Y(),{isManager:_}=oe(j(()=>V.user)),P=C(!1),S=C(!1),L=C();Z(async()=>{try{await u.fetchUnits(),p.loading.show()}catch(f){console.error(f)}finally{p.loading.hide()}});function $(){o.pagination.offset=0,Q()}async function Q(){try{p.loading.show();const f={offset:o.pagination.offset,limit:o.pagination.limit},n=await o.fetchProducts(f);n&&(o.pagination.total=n.total,o.pagination.has_more=n.has_more,o?.products?.length?o.products.push(n.items):o.products=n.items)}catch(f){console.error(f)}finally{p.loading.hide()}}function e(f){try{p.loading.show(),y.basketData.push(structuredClone(he(f))),window.localStorage.setItem("basket",JSON.stringify(y.basketData))}catch(n){console.error(n)}finally{p.loading.hide()}}const m=async(f,n)=>{if(!o.pagination.has_more){P.value=!0,n(!0);return}await Q(),o.pagination.offset+=o.pagination.limit,n()};function F(f){d.push({name:"products-edit",params:{id:f.id}})}return(f,n)=>(g(),x(Qe,{onLoad:m,offset:250},{default:s(()=>[b(_)?(g(),x(w,{key:0,onClick:n[0]||(n[0]=i=>b(d).push({name:"products-create"})),class:"full-width q-mb-sm",color:"green",label:"Добавить товар"})):R("",!0),c("div",Oe,[(g(!0),z(_e,null,ye(b(o).products,(i,A)=>(g(),x(Ce,{key:A},{default:s(()=>[t(Ve,null,{default:s(()=>[t(O,{top:"",avatar:"",onClick:D=>F(i)},{default:s(()=>[t(ee,{class:"cursor-pointer radius-8",src:i[0]?.primary_image?i[0].primary_image:b(ne)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),t(O,{class:"column justify-between",onClick:D=>F(i)},{default:s(()=>[t(B,{caption:"",class:"text-size-16"},{default:s(()=>[T(v(i.name),1)]),_:2},1024),t(B,null,{default:s(()=>[i?.old_price?(g(),z("div",Be,v(i.old_price)+" ₽",1)):R("",!0),c("div",{class:be(i?.old_price?"text-red":"")},v(i.price)+" ₽/ "+v(i.unit_name),3)]),_:2},1024)]),_:2},1032,["onClick"]),t(O,{side:"",top:"",class:"column justify-between"},{default:s(()=>[n[3]||(n[3]=c("div",null,null,-1)),c("div",ze,[t(B,{class:"q-mr-xs",caption:""},{default:s(()=>[T(v(i.price)+" ₽/ "+v(i.unit_name),1)]),_:2},1024),t(w,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:D=>e(i)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024),t(xe,{spaced:"",inset:""})]),_:2},1024))),128))]),S.value?(g(),x(Ae,{key:1,modelValue:S.value,"onUpdate:modelValue":n[1]||(n[1]=i=>S.value=i),productData:L.value,onRefreshData:n[2]||(n[2]=i=>$()),onAddProduct:e},null,8,["modelValue","productData"])):R("",!0)]),_:1}))}}),Ne=se(Me,[["__scopeId","data-v-1b9c79ea"]]),ca=M({__name:"DashboardPage",setup(h){return(p,d)=>(g(),x($e,{class:"q-mx-xs"},{default:s(()=>[t(Ne,{class:"q-mb-lg"})]),_:1}))}});export{ca as default};
