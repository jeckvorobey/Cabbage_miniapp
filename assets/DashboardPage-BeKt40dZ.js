import{k as le,g as W,a as M,x as V,y as se,X as ie,c as N,h as re,l as ue,r as C,d as z,ah as x,ac as g,aC as de,ad as i,f as t,ai as b,aD as H,ao as m,ak as v,a4 as ce,aq as I,as as S,aE as E,U as $,af as D,ab as O,aF as pe,aa as me,ae as fe,F as ge,aG as K,aj as T,az as ve,ag as ye}from"./index-DiTKrkak.js";import{Q as Y}from"./QImg-oWz4-7sM.js";import{Q as _e,a as j,b as L}from"./QItem-DvDE2n8f.js";import{Q as he}from"./QList-MitOhU08.js";import{Q as be}from"./QInfiniteScroll-D_v1DbDC.js";import{u as Z}from"./productsStore-7M8FESY1.js";import{e as xe}from"./orderStore-BhEteGSL.js";import{u as ee}from"./use-quasar-_FxUXvHL.js";import{g as ke,Q as Ce,a as Qe}from"./QUploader-FikPbgqG.js";import{Q as G}from"./QSelect-DuuIiYG7.js";import{Q as J}from"./QForm-BQVW_lD2.js";import{C as F}from"./ClosePopup-C5CDFmFm.js";import{u as ae}from"./usePermissionVisibility.hook-UxsiyQLD.js";import{P as X}from"./ProductImgCarusel-BzfIFxYp.js";import{u as Ve}from"./categoriesStore-C61Wq8FX.js";import{u as De}from"./unitsStore-BJZK98Qc.js";import{f as Pe,g as te}from"./useUtils-BZuzCZeZ.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QMenu-CzNB_QvR.js";import"./format-CJebrXOQ.js";import"./rtl-DFPa-2ov.js";const we=le({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(_,{slots:y}){const{proxy:{$q:d}}=W(),o=M(se,V);if(o===V)return console.error("QPage needs to be a deep child of QLayout"),V;if(M(ie,V)===V)return console.error("QPage needs to be child of QPageContainer"),V;const h=N(()=>{const f=(o.header.space===!0?o.header.size:0)+(o.footer.space===!0?o.footer.size:0);if(typeof _.styleFn=="function"){const P=o.isContainer.value===!0?o.containerHeight.value:d.screen.height;return _.styleFn(f,P)}return{minHeight:o.isContainer.value===!0?o.containerHeight.value-f+"px":d.screen.height===0?f!==0?`calc(100vh - ${f}px)`:"100vh":d.screen.height-f+"px"}}),k=N(()=>`q-page${_.padding===!0?" q-layout-padding":""}`);return()=>re("main",{class:k.value,style:h.value},ue(y.default))}});function A(){const{emit:_,proxy:y}=W(),d=C(null);function o(){d.value.show()}function c(){d.value.hide()}function h(f){_("ok",f),c()}function k(){_("hide")}return Object.assign(y,{show:o,hide:c}),{dialogRef:d,onDialogHide:k,onDialogOK:h,onDialogCancel:c}}const ne=["ok","hide"];A.emits=ne;A.emitsObject=ke(ne);const qe={class:"text-h6 q-mb-md"},Se={class:"text-center upload-title"},$e={key:1},Fe={class:"text-h6 text-center q-mt-sm"},Ie={class:"text-bold"},Re=z({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(_,{emit:y}){const d=_,o=y,c=ee(),h=Z(),k=Ve(),{dialogRef:f}=A(),{isManager:P}=ae(),R=De(),w=C(!1),Q=C(),e=C({id:null,name:"",price:null,category_id:null,unit_id:null,description:"",images:"",origin_country:"",unit:null}),p=new FormData;d.productData&&(e.value=d.productData);async function u(){try{let r=null;e.value?.id?r=h.updateProduct(e.value):(l(),r=await h.createProduct(p)),r&&(e.value.id=r.id,c.notify({message:"Успешно сохранено",color:"primary"}),o("refresh-data"))}catch(r){console.error(r)}}function n(){o("add-product",e.value)}function l(){e?.value?.id&&p.append("id",e.value.id.toString()),e.value?.name&&p.append("name",e.value.name),e.value?.price&&p.append("price",e.value.price.toString()),e.value?.category_id&&p.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&p.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&p.append("qty",e.value.qty.toString()),e.value?.description&&p.append("description",e.value.description),e.value?.origin_country&&p.append("origin_country",e.value.origin_country)}function U(r){const a=new FileReader;a.readAsDataURL(r[0]),a.onload=()=>{},p.delete("images"),p.append("images",r[0]),e.value?.id&&q(r[0])}async function q(r){const a=new FormData;a.append("file",r),a.append("is_primary","true");try{await h.uploadFile(e.value.id,a)&&(B(),c.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(s){console.error(s)}finally{Q.value&&Q.value.reset()}}async function B(){try{const r=await h.fetchProductsById(e.value.id);e.value=r}catch(r){console.error(r)}}return(r,a)=>(g(),x(de,{ref_key:"dialogRef",ref:f,modelValue:w.value,"onUpdate:modelValue":a[10]||(a[10]=s=>w.value=s),persistent:""},{default:i(()=>[t(pe,{class:"add-product"},{default:i(()=>[b(P)?(g(),x(J,{key:0,greedy:""},{default:i(()=>[t(H,null,{default:i(()=>[m("div",qe,v(e.value.id?"Редактирование товара":"Добавление товара"),1),t(Ce,{ref_key:"uploaderRef",ref:Q,color:"primary",flat:"","max-file-size":"15728640",onAdded:U,onRejected:a[0]||(a[0]=s=>b(Pe)(b(c)))},{header:i(()=>[...a[11]||(a[11]=[])]),list:i(()=>[t(Qe),m("div",Se,[t(ce,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[12]||(a[12]=m("span",null,"Загрузить картинку",-1))])]),_:1},512),m("div",null,[e.value?.images?.length?(g(),x(X,{key:0,onRefreshData:a[1]||(a[1]=s=>B()),images:e.value.images},null,8,["images"])):I("",!0)]),t(S,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=s=>e.value.name=s),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),t(S,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=s=>e.value.price=s),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),t(S,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[4]||(a[4]=s=>e.value.origin_country=s),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),t(G,{modelValue:e.value.category_id,"onUpdate:modelValue":a[5]||(a[5]=s=>e.value.category_id=s),options:b(k).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),t(G,{modelValue:e.value.unit_id,"onUpdate:modelValue":a[6]||(a[6]=s=>e.value.unit_id=s),options:b(R).units,outlined:"",label:"Единица измерения","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),t(S,{class:"q-mt-sm",modelValue:e.value.description,"onUpdate:modelValue":a[7]||(a[7]=s=>e.value.description=s),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),t(E,{align:"right"},{default:i(()=>[$(t(D,{color:"red",label:"Отмена"},null,512),[[F]]),$(t(D,{color:"primary",label:"Подтвердить",onClick:a[8]||(a[8]=s=>u())},null,512),[[F]])]),_:1})]),_:1})):(g(),x(J,{key:1},{default:i(()=>[t(H,null,{default:i(()=>[m("div",null,[e.value?.images?.length?(g(),x(X,{key:0,images:e.value.images},null,8,["images"])):(g(),O("div",$e,[t(Y,{class:"q-mt-sm",src:b(te)("/card-shop.jpg")},null,8,["src"])]))]),m("div",Fe,v(e.value.name),1),m("div",Ie,"Стоимость товара: "+v(e.value.price),1),m("div",null,"Вес: 11 "+v(e.value?.unit?.name||"")+".",1),m("div",null,"Страна происхождения: "+v(e.value.origin_country),1),m("div",null,"Описание: "+v(e.value.description),1)]),_:1}),t(E,{align:"right"},{default:i(()=>[$(t(D,{color:"red",label:"Отмена"},null,512),[[F]]),$(t(D,{color:"primary",label:"Добавить в корзину",onClick:a[9]||(a[9]=s=>n())},null,512),[[F]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),Ue=oe(Re,[["__scopeId","data-v-76a805e9"]]),je={class:"product-card"},Le={key:0,class:"text-grey old-price"},Oe={class:"row items-end"},ze=z({__name:"ProductList",setup(_){const y=ee(),d=me(),o=Z(),c=xe(),{isManager:h}=ae(),k=C(!1),f=C(!1),P=C();function R(){o.pagination.offset=0,w()}async function w(){try{y.loading.show();const u={offset:o.pagination.offset,limit:o.pagination.limit},n=await o.fetchProducts(u);n&&(o.pagination.total=n.total,o.pagination.has_more=n.has_more,o?.products?.length?o.products.push(n.items):o.products=n.items)}catch(u){console.error(u)}finally{y.loading.hide()}}function Q(u){try{if(u.quantity=1,u.product_id=u.id,y.loading.show(),!c.basketData.length)c.basketData.push(structuredClone(K(u)));else{const n=c.basketData.find(l=>l.id===u.id);n?n.quantity+=1:c.basketData.push(structuredClone(K(u)))}window.localStorage.setItem("basket",JSON.stringify(c.basketData))}catch(n){console.error(n)}finally{y.loading.hide()}}const e=async(u,n)=>{if(!o.pagination.has_more){k.value=!0,n(!0);return}await w(),o.pagination.offset+=o.pagination.limit,n()};function p(u){d.push({name:"products-edit",params:{id:u.id}})}return(u,n)=>(g(),x(be,{onLoad:e,offset:250},{default:i(()=>[b(h)?(g(),x(D,{key:0,onClick:n[0]||(n[0]=l=>b(d).push({name:"products-create"})),class:"full-width q-mb-sm",color:"green",label:"Добавить товар"})):I("",!0),m("div",je,[(g(!0),O(ge,null,fe(b(o).products,(l,U)=>(g(),x(he,{key:U},{default:i(()=>[t(_e,null,{default:i(()=>[t(j,{top:"",avatar:"",onClick:q=>p(l)},{default:i(()=>[t(Y,{class:"cursor-pointer radius-8",src:l[0]?.primary_image?l[0].primary_image:b(te)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),t(j,{class:"column justify-between",onClick:q=>p(l)},{default:i(()=>[t(L,{caption:"",class:"text-size-16"},{default:i(()=>[T(v(l.name),1)]),_:2},1024),t(L,null,{default:i(()=>[l?.old_price?(g(),O("div",Le,v(l.old_price)+" ₽",1)):I("",!0),m("div",{class:ve(l?.old_price?"text-red":"")},v(l.price)+" ₽/ "+v(l.unit_name),3)]),_:2},1024)]),_:2},1032,["onClick"]),t(j,{side:"",top:"",class:"column justify-between"},{default:i(()=>[n[3]||(n[3]=m("div",null,null,-1)),m("div",Oe,[t(L,{class:"q-mr-xs",caption:""},{default:i(()=>[T(v(l.price)+" ₽/ "+v(l.unit_name),1)]),_:2},1024),t(D,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:q=>Q(l)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024),t(ye,{spaced:"",inset:""})]),_:2},1024))),128))]),f.value?(g(),x(Ue,{key:1,modelValue:f.value,"onUpdate:modelValue":n[1]||(n[1]=l=>f.value=l),productData:P.value,onRefreshData:n[2]||(n[2]=l=>R()),onAddProduct:Q},null,8,["modelValue","productData"])):I("",!0)]),_:1}))}}),Ae=oe(ze,[["__scopeId","data-v-cf151ac1"]]),ra=z({__name:"DashboardPage",setup(_){return(y,d)=>(g(),x(we,{class:"q-mx-xs"},{default:i(()=>[t(Ae,{class:"q-mb-lg"})]),_:1}))}});export{ra as default};
