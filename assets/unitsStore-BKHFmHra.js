import{k as R,r as I,aM as P,aN as D,o as F,g as C,h as V,l as q,aD as B,N as M,q as G,bk as $,_ as j,bm as k,c as h,am as w,b3 as O,b4 as g}from"./index-DxlRxBr2.js";import{E as s}from"./useUtils-Djmp8UCV.js";const z=R({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(a,{slots:r,emit:u}){const v=C(),c=I(null);let l=0;const t=[];function e(n){const m=typeof n=="boolean"?n:a.noErrorFocus!==!0,b=++l,p=(o,i)=>{u(`validation${o===!0?"Success":"Error"}`,i)},E=o=>{const i=o.validate();return typeof i.then=="function"?i.then(f=>({valid:f,comp:o}),f=>({valid:!1,comp:o,err:f})):Promise.resolve({valid:i,comp:o})};return(a.greedy===!0?Promise.all(t.map(E)).then(o=>o.filter(i=>i.valid!==!0)):t.reduce((o,i)=>o.then(()=>E(i).then(f=>{if(f.valid===!1)return Promise.reject(f)})),Promise.resolve()).catch(o=>[o])).then(o=>{if(o===void 0||o.length===0)return b===l&&p(!0),!0;if(b===l){const{comp:i,err:f}=o[0];if(f!==void 0&&console.error(f),p(!1,i),m===!0){const N=o.find(({comp:x})=>typeof x.focus=="function"&&B(x.$)===!1);N!==void 0&&N.comp.focus()}}return!1})}function d(){l++,t.forEach(n=>{typeof n.resetValidation=="function"&&n.resetValidation()})}function y(n){n!==void 0&&M(n);const m=l+1;e().then(b=>{m===l&&b===!0&&(a.onSubmit!==void 0?u("submit",n):n?.target!==void 0&&typeof n.target.submit=="function"&&n.target.submit())})}function S(n){n!==void 0&&M(n),u("reset"),G(()=>{d(),a.autofocus===!0&&a.noResetFocus!==!0&&A()})}function A(){$(()=>{if(c.value===null)return;(c.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||c.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||c.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(c.value.querySelectorAll("[tabindex]"),m=>m.tabIndex!==-1))?.focus({preventScroll:!0})})}j(k,{bindComponent(n){t.push(n)},unbindComponent(n){const m=t.indexOf(n);m!==-1&&t.splice(m,1)}});let U=!1;return P(()=>{U=!0}),D(()=>{U===!0&&a.autofocus===!0&&A()}),F(()=>{a.autofocus===!0&&A()}),Object.assign(v.proxy,{validate:e,resetValidation:d,submit:y,reset:S,focus:A,getValidationComponents:()=>t}),()=>V("form",{class:"q-form",ref:c,onSubmit:y,onReset:S},q(r.default))}});function Q(a){const r=w(a);if(r&&typeof r=="object"&&"role"in r){const u=r.role;return u!=null?w(u):null}return r}function H(a){const r=h(()=>{const t=Q(a);if(t==null)return;const e=Number(t);if(Object.values(s).includes(e))return e}),u=h(()=>r.value===s.ADMIN),v=h(()=>r.value===s.MANAGER||r.value===s.ADMIN),c=h(()=>{const t=r.value;return t===s.USER||t===s.MANAGER||t===s.ADMIN});return{permission:r,isAdmin:u,isManager:v,isUser:c,hasPermission:t=>h(()=>{const e=r.value;if(e==null)return!1;switch(Number(t)){case s.ADMIN:return e===s.ADMIN;case s.MANAGER:return e===s.MANAGER||e===s.ADMIN;case s.USER:return e===s.USER||e===s.MANAGER||e===s.ADMIN;default:return!1}})}}const J=O("Units",()=>{const a=I();async function r(t){return g.post("units",t).then(e=>e.data).catch(e=>{throw console.error("[UnitsStore] - An error occurred while createing via createUnit",e.message),e})}async function u(t){return g.get(`/units/${t}`).then(e=>e.data).catch(e=>{throw console.error("[UnitsStore] - An error occurred while fetching via fetchUnitsById",e.message),e})}async function v(){return g.get("units").then(t=>{a.value=t.data}).catch(t=>{throw console.error("[UnitsStore] - An error occurred while fetching via fetchUnits",t.message),t})}async function c(t,e){return g.put(`/units/${t}`,{data:e}).then(d=>d.data).catch(d=>{throw console.error("[UnitsStore] - An error occurred while fetching via updateUnit",d.message),d})}async function l(t){return g.delete(`units/${t}`).then(e=>e.data).catch(e=>{throw console.error("[UnitsStore] - An error occurred while deleting via deleteUnit",e.message),e})}return{createUnit:r,fetchUnitsById:u,fetchUnits:v,updateUnit:c,deleteUnit:l,units:a}});export{z as Q,J as a,H as u};
