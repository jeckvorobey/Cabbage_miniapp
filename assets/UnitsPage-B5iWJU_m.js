import{d as I,r as _,w as b,af as Q,ae as f,aj as t,f as e,aF as M,aD as E,ak as A,al as k,aB as q,aE as R,U as x,av as v,aC as j,u as O,c as T,o as z,ac as G,ad as g,ag as h,ai as C,F as H,am as J,aw as D,a7 as K}from"./index-B_nJ1CnL.js";import{Q as W,b as S,a as $}from"./QItem-Do-lWtoB.js";import{Q as X}from"./QList-D3rL7qR_.js";import{u as F}from"./use-quasar-C4E25BP3.js";import{u as N}from"./unitsStore-aDjAFRvs.js";import{Q as Y}from"./QForm-BYfiKklj.js";import{C as B}from"./ClosePopup-BIqazoOM.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ee}from"./usePermissionVisibility.hook-DA3wesnl.js";import"./useUtils-B0I_KiU2.js";const ae={class:"text-h6 q-mb-md"},te=I({__name:"AddUnitModal",props:{modelValue:{type:Boolean,default:!1},unitData:{default:()=>({name:"",symbol:""})}},emits:["update:modelValue","update"],setup(w,{emit:p}){const c=w,u=p,y=F(),d=N(),s=_(c.modelValue),a=_({...c.unitData});b(()=>c.unitData,l=>{a.value={...l??{name:"",symbol:""}}},{immediate:!0,deep:!0}),b(()=>c.modelValue,l=>{s.value=l},{immediate:!0}),b(s,l=>{u("update:modelValue",l)});async function V(){try{a.value?.id?await d.updateUnit(a.value.id,a.value)&&y.notify({message:"Единица измерения успешно обновлена",color:"primary"}):await d.createUnit(a.value)&&y.notify({message:"Единица измерения успешно создана",color:"primary"})}catch(l){console.error(l)}finally{s.value=!1,u("update")}}return(l,n)=>(f(),Q(j,{ref:"dialogRef",modelValue:s.value,"onUpdate:modelValue":n[3]||(n[3]=i=>s.value=i),persistent:""},{default:t(()=>[e(M,{class:"add-product"},{default:t(()=>[e(Y,{greedy:""},{default:t(()=>[e(E,null,{default:t(()=>[A("div",ae,k(a.value.id?"Редактирование":"Добавление")+" единицы измерения ",1),e(q,{modelValue:a.value.name,"onUpdate:modelValue":n[0]||(n[0]=i=>a.value.name=i),class:"q-mb-xs",label:"Наименование (пример: кг, гр, шт)",outlined:""},null,8,["modelValue"]),e(q,{modelValue:a.value.symbol,"onUpdate:modelValue":n[1]||(n[1]=i=>a.value.symbol=i),class:"q-mb-xs",label:"Символ (пример: kg, gr, sh)",outlined:""},null,8,["modelValue"])]),_:1}),e(R,{align:"right"},{default:t(()=>[x(e(v,{color:"red",flat:"",label:"Отмена"},null,512),[[B]]),x(e(v,{color:"primary",flat:"",label:"Сохранить",onClick:n[2]||(n[2]=i=>V())},null,512),[[B]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),le=Z(te,[["__scopeId","data-v-78941c8e"]]),oe={key:0},ve=I({__name:"UnitsPage",setup(w){const p=F(),c=O(),u=N(),{isManager:y}=ee(T(()=>c.user)),d=_(!1),s=_();z(()=>{a()});async function a(){try{await u.fetchUnits(),p.loading.show()}catch(r){console.error(r)}finally{p.loading.hide()}}function V(r){p.dialog({title:"Удаление единицы измерения",message:"Вы уверенны что хотите удалить единицу измерения?",cancel:!0,persistent:!0}).onOk(()=>{l(r)})}async function l(r){try{await u.deleteUnit(r)}catch(o){console.error(o)}finally{await a()}}function n(){s.value=void 0,d.value=!0}function i(r){const o=u.units.find(U=>U.id===r);o&&(s.value={...o},d.value=!0)}return(r,o)=>{const U=G("q-item-action");return f(),g("div",null,[e(v,{onClick:n,class:"full-width q-mb-sm",color:"secondary",label:"Добавление единицы измерения"}),C(u).units?(f(),g("div",oe,[o[2]||(o[2]=A("h6",{class:"text-center q-mt-md q-mb-md"},"Единицы измерения",-1)),e(M,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:t(()=>[(f(!0),g(H,null,J(C(u).units,(m,P)=>(f(),Q(X,{key:P},{default:t(()=>[e(W,null,{default:t(()=>[e(S,null,{default:t(()=>[e($,null,{default:t(()=>[D(k(m.name),1)]),_:2},1024)]),_:2},1024),e(S,null,{default:t(()=>[e($,null,{default:t(()=>[D(k(m.symbol),1)]),_:2},1024)]),_:2},1024),e(U,null,{default:t(()=>[C(y)?(f(),Q(v,{key:0,flat:"",round:"",color:"red",icon:"delete",onClick:L=>V(m.id)},null,8,["onClick"])):h("",!0),e(v,{flat:"",round:"",color:"primary",icon:"mode_edit",onClick:L=>i(m.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),e(K)]),_:2},1024))),128))]),_:1})])):h("",!0),e(le,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=m=>d.value=m),"unit-data":s.value,onUpdate:o[1]||(o[1]=m=>a())},null,8,["modelValue","unit-data"])])}}});export{ve as default};
