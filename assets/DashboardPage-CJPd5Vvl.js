import{k as re,g as te,a as ie,v as V,x as Te,$ as He,c as m,h,l as Ge,aw as Be,ax as Ke,ay as We,az as Ye,r as k,L as we,N as Ce,G as Xe,P as Je,S as Ze,w as et,n as tt,i as at,aA as ot,aB as lt,aC as Fe,aD as rt,ad as ze,Q as X,_ as nt,aE as st,d as fe,aj as H,ai as $,aF as ut,an as E,f as q,aG as de,ao as O,ak as ee,av as se,am as J,aH as Ue,Y as it,as as Pe,u as dt,o as ct,ah as ue,aq as ft,F as vt,ap as oe,at as De,aI as Se}from"./index-D3euJIFo.js";import{u as Ae,Q as Ee,a as pt}from"./orderStore-DpRhzqTr.js";import{Q as mt}from"./QInfiniteScroll-BA3hm0PB.js";import{u as Re}from"./use-quasar-D_AIPKwy.js";import{Q as xe}from"./QSelect-Cbzab5Qr.js";import{b as gt,h as qe,u as _t}from"./categoriesStore-5Ico7kTd.js";import{u as Ne,Q as ht}from"./unitsStore-DvaeP22Y.js";import{C as yt}from"./ClosePopup-CY_qWuW0.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as w}from"./useUtils-C2jzA7Ej.js";import"./QMenu-CuDsB7xy.js";const bt=re({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(t,{slots:n}){const{proxy:{$q:s}}=te(),o=ie(Te,V);if(o===V)return console.error("QPage needs to be a deep child of QLayout"),V;if(ie(He,V)===V)return console.error("QPage needs to be child of QPageContainer"),V;const f=m(()=>{const c=(o.header.space===!0?o.header.size:0)+(o.footer.space===!0?o.footer.size:0);if(typeof t.styleFn=="function"){const D=o.isContainer.value===!0?o.containerHeight.value:s.screen.height;return t.styleFn(c,D)}return{minHeight:o.isContainer.value===!0?o.containerHeight.value-c+"px":s.screen.height===0?c!==0?`calc(100vh - ${c}px)`:"100vh":s.screen.height-c+"px"}}),d=m(()=>`q-page${t.padding===!0?" q-layout-padding":""}`);return()=>h("main",{class:d.value,style:f.value},Ge(n.default))}}),Ft=re({name:"QUploaderAddTrigger",setup(){const t=ie(Be,V);return t===V&&console.error("QUploaderAddTrigger needs to be child of QUploader"),t}}),Dt={...Ke,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:t=>t>=0&&t<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},ce=50,Qe=2*ce,Ie=Qe*Math.PI,St=Math.round(Ie*1e3)/1e3,xt=re({name:"QCircularProgress",props:{...Dt,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(t,{slots:n}){const{proxy:{$q:s}}=te(),o=We(t),u=m(()=>{const F=(s.lang.rtl===!0?-1:1)*t.angle;return{transform:t.reverse!==(s.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-F}deg)`:`rotate3d(0, 0, 1, ${F-90}deg)`}}),f=m(()=>t.instantFeedback!==!0&&t.indeterminate!==!0?{transition:`stroke-dashoffset ${t.animationSpeed}ms ease 0s, stroke ${t.animationSpeed}ms ease`}:""),d=m(()=>Qe/(1-t.thickness/2)),c=m(()=>`${d.value/2} ${d.value/2} ${d.value} ${d.value}`),D=m(()=>gt(t.value,t.min,t.max)),B=m(()=>t.max-t.min),v=m(()=>t.thickness/2*d.value),P=m(()=>{const F=(t.max-D.value)/B.value,e=t.rounded===!0&&D.value<t.max&&F<.25?v.value/2*(1-F/.25):0;return Ie*F+e});function C({thickness:F,offset:e,color:a,cls:i,rounded:g}){return h("circle",{class:"q-circular-progress__"+i+(a!==void 0?` text-${a}`:""),style:f.value,fill:"transparent",stroke:"currentColor","stroke-width":F,"stroke-dasharray":St,"stroke-dashoffset":e,"stroke-linecap":g,cx:d.value,cy:d.value,r:ce})}return()=>{const F=[];t.centerColor!==void 0&&t.centerColor!=="transparent"&&F.push(h("circle",{class:`q-circular-progress__center text-${t.centerColor}`,fill:"currentColor",r:ce-v.value/2,cx:d.value,cy:d.value})),t.trackColor!==void 0&&t.trackColor!=="transparent"&&F.push(C({cls:"track",thickness:v.value,offset:0,color:t.trackColor})),F.push(C({cls:"circle",thickness:v.value,offset:P.value,color:t.color,rounded:t.rounded===!0?"round":void 0}));const e=[h("svg",{class:"q-circular-progress__svg",style:u.value,viewBox:c.value,"aria-hidden":"true"},F)];return t.showValue===!0&&e.push(h("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:t.fontSize}},n.default!==void 0?n.default():[h("div",D.value)])),h("div",{class:`q-circular-progress q-circular-progress--${t.indeterminate===!0?"in":""}determinate`,style:o.value,role:"progressbar","aria-valuemin":t.min,"aria-valuemax":t.max,"aria-valuenow":t.indeterminate===!0?void 0:D.value},Ye(n.internal,e))}}});function Y(t,n,s,o){const u=[];return t.forEach(f=>{o(f)===!0?u.push(f):n.push({failedPropValidation:s,file:f})}),u}function le(t){t?.dataTransfer&&(t.dataTransfer.dropEffect="copy"),Ce(t)}const qt={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},kt=["rejected"];function Bt({editable:t,dnd:n,getFileInput:s,addFilesToQueue:o}){const{props:u,emit:f,proxy:d}=te(),c=k(null),D=m(()=>u.accept!==void 0?u.accept.split(",").map(r=>(r=r.trim(),r==="*"?"*/":(r.endsWith("/*")&&(r=r.slice(0,r.length-1)),r.toUpperCase()))):null),B=m(()=>parseInt(u.maxFiles,10)),v=m(()=>parseInt(u.maxTotalSize,10));function P(r){if(t.value)if(r!==Object(r)&&(r={target:null}),r.target?.matches('input[type="file"]')===!0)r.clientX===0&&r.clientY===0&&we(r);else{const A=s();A!==r.target&&A?.click(r)}}function C(r){t.value&&r&&o(null,r)}function F(r,A,L,M){let _=Array.from(A||r.target.files);const S=[],R=()=>{S.length!==0&&f("rejected",S)};if(u.accept!==void 0&&D.value.indexOf("*/")===-1&&(_=Y(_,S,"accept",y=>D.value.some(x=>y.type.toUpperCase().startsWith(x)||y.name.toUpperCase().endsWith(x))),_.length===0))return R();if(u.maxFileSize!==void 0){const y=parseInt(u.maxFileSize,10);if(_=Y(_,S,"max-file-size",x=>x.size<=y),_.length===0)return R()}if(u.multiple!==!0&&_.length!==0&&(_=[_[0]]),_.forEach(y=>{y.__key=y.webkitRelativePath+y.lastModified+y.name+y.size}),M===!0){const y=L.map(x=>x.__key);_=Y(_,S,"duplicate",x=>y.includes(x.__key)===!1)}if(_.length===0)return R();if(u.maxTotalSize!==void 0){let y=M===!0?L.reduce((x,Q)=>x+Q.size,0):0;if(_=Y(_,S,"max-total-size",x=>(y+=x.size,y<=v.value)),_.length===0)return R()}if(typeof u.filter=="function"){const y=u.filter(_);_=Y(_,S,"filter",x=>y.includes(x))}if(u.maxFiles!==void 0){let y=M===!0?L.length:0;if(_=Y(_,S,"max-files",()=>(y++,y<=B.value)),_.length===0)return R()}if(R(),_.length!==0)return _}function e(r){le(r),n.value!==!0&&(n.value=!0)}function a(r){Ce(r),(r.relatedTarget!==null||Xe.is.safari!==!0?r.relatedTarget!==c.value:document.elementsFromPoint(r.clientX,r.clientY).includes(c.value)===!1)===!0&&(n.value=!1)}function i(r){le(r);const A=r.dataTransfer.files;A.length!==0&&o(null,A),n.value=!1}function g(r){if(n.value===!0)return h("div",{ref:c,class:`q-${r}__dnd absolute-full`,onDragenter:le,onDragover:le,onDragleave:a,onDrop:i})}return Object.assign(d,{pickFiles:P,addFiles:C}),{pickFiles:P,addFiles:C,onDragover:e,onDragleave:a,processFiles:F,getDndNode:g,maxFilesNumber:B,maxTotalSizeNumber:v}}function ke(t){return(t*100).toFixed(2)+"%"}const wt={...Je,...qt,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,thumbnailFit:{type:String,default:"cover"},autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},je=[...kt,"start","finish","added","removed"];function Ct(t,n){const s=te(),{props:o,slots:u,emit:f,proxy:d}=s,{$q:c}=d,D=Ze(o,c);function B(l,b,z){if(l.__status=b,b==="idle"){l.__uploaded=0,l.__progress=0,l.__sizeLabel=qe(l.size),l.__progressLabel="0.00%";return}if(b==="failed"){d.$forceUpdate();return}l.__uploaded=b==="uploaded"?l.size:z,l.__progress=b==="uploaded"?1:Math.min(.9999,l.__uploaded/l.size),l.__progressLabel=ke(l.__progress),d.$forceUpdate()}const v=m(()=>o.disable!==!0&&o.readonly!==!0),P=k(!1),C=k(null),F=k(null),e={files:k([]),queuedFiles:k([]),uploadedFiles:k([]),uploadedSize:k(0),updateFileStatus:B,isAlive:()=>rt(s)===!1},{pickFiles:a,addFiles:i,onDragover:g,onDragleave:r,processFiles:A,getDndNode:L,maxFilesNumber:M,maxTotalSizeNumber:_}=Bt({editable:v,dnd:P,getFileInput:ge,addFilesToQueue:_e});Object.assign(e,t({props:o,slots:u,emit:f,helpers:e,exposeApi:l=>{Object.assign(e,l)}})),e.isBusy===void 0&&(e.isBusy=k(!1));const S=k(0),R=m(()=>S.value===0?0:e.uploadedSize.value/S.value),y=m(()=>ke(R.value)),x=m(()=>qe(S.value)),Q=m(()=>v.value===!0&&e.isUploading.value!==!0&&(o.multiple===!0||e.queuedFiles.value.length===0)&&(o.maxFiles===void 0||e.files.value.length<M.value)&&(o.maxTotalSize===void 0||S.value<_.value)),p=m(()=>v.value===!0&&e.isBusy.value!==!0&&e.isUploading.value!==!0&&e.queuedFiles.value.length!==0);nt(Be,ye);const T=m(()=>"q-uploader column no-wrap"+(D.value===!0?" q-uploader--dark q-dark":"")+(o.bordered===!0?" q-uploader--bordered":"")+(o.square===!0?" q-uploader--square no-border-radius":"")+(o.flat===!0?" q-uploader--flat no-shadow":"")+(o.disable===!0?" disabled q-uploader--disable":"")+(P.value===!0?" q-uploader--dnd":"")),G=m(()=>"q-uploader__header"+(o.color!==void 0?` bg-${o.color}`:"")+(o.textColor!==void 0?` text-${o.textColor}`:""));et(e.isUploading,(l,b)=>{b===!1&&l===!0?f("start"):b===!0&&l===!1&&f("finish")});function K(){o.disable===!1&&(e.abort(),e.uploadedSize.value=0,S.value=0,me(),e.files.value=[],e.queuedFiles.value=[],e.uploadedFiles.value=[])}function N(){o.disable===!1&&pe(["uploaded"],()=>{e.uploadedFiles.value=[]})}function ae(){pe(["idle","failed"],({size:l})=>{S.value-=l,e.queuedFiles.value=[]})}function pe(l,b){if(o.disable===!0)return;const z={files:[],size:0},I=e.files.value.filter(U=>l.indexOf(U.__status)===-1?!0:(z.size+=U.size,z.files.push(U),U.__img!==void 0&&window.URL.revokeObjectURL(U.__img.src),!1));z.files.length!==0&&(e.files.value=I,b(z),f("removed",z.files))}function ne(l){o.disable||(l.__status==="uploaded"?e.uploadedFiles.value=e.uploadedFiles.value.filter(b=>b.__key!==l.__key):l.__status==="uploading"?l.__abort():S.value-=l.size,e.files.value=e.files.value.filter(b=>b.__key!==l.__key?!0:(b.__img!==void 0&&window.URL.revokeObjectURL(b.__img.src),!1)),e.queuedFiles.value=e.queuedFiles.value.filter(b=>b.__key!==l.__key),f("removed",[l]))}function me(){e.files.value.forEach(l=>{l.__img!==void 0&&window.URL.revokeObjectURL(l.__img.src)})}function ge(){return F.value||C.value.getElementsByClassName("q-uploader__input")[0]}function _e(l,b){const z=A(l,b,e.files.value,!0),I=ge();I!=null&&(I.value=""),z!==void 0&&(z.forEach(U=>{if(e.updateFileStatus(U,"idle"),S.value+=U.size,o.noThumbnails!==!0&&U.type.toUpperCase().startsWith("IMAGE")){const be=new Image;be.src=window.URL.createObjectURL(U),U.__img=be}}),e.files.value=e.files.value.concat(z),e.queuedFiles.value=e.queuedFiles.value.concat(z),f("added",z),o.autoUpload===!0&&e.upload())}function he(){p.value===!0&&e.upload()}function Z(l,b,z){if(l===!0){const I={type:"a",key:b,icon:c.iconSet.uploader[b],flat:!0,dense:!0};let U;return b==="add"?(I.onClick=a,U=ye):I.onClick=z,h(X,I,U)}}function ye(){return h("input",{ref:F,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:o.accept,multiple:o.multiple===!0?"multiple":void 0,capture:o.capture,onMousedown:we,onClick:a,onChange:_e})}function Ve(){return u.header!==void 0?u.header(W):[h("div",{class:"q-uploader__header-content column"},[h("div",{class:"flex flex-center no-wrap q-gutter-xs"},[Z(e.queuedFiles.value.length!==0,"removeQueue",ae),Z(e.uploadedFiles.value.length!==0,"removeUploaded",N),e.isUploading.value===!0?h(Fe,{class:"q-uploader__spinner"}):null,h("div",{class:"col column justify-center"},[o.label!==void 0?h("div",{class:"q-uploader__title"},[o.label]):null,h("div",{class:"q-uploader__subtitle"},[x.value+" / "+y.value])]),Z(Q.value,"add"),Z(o.hideUploadBtn===!1&&p.value===!0,"upload",e.upload),Z(e.isUploading.value,"clear",e.abort)])])]}function Oe(){return u.list!==void 0?u.list(W):e.files.value.map(l=>h("div",{key:l.__key,class:"q-uploader__file relative-position"+(o.noThumbnails!==!0&&l.__img!==void 0?" q-uploader__file--img":"")+(l.__status==="failed"?" q-uploader__file--failed":l.__status==="uploaded"?" q-uploader__file--uploaded":""),style:o.noThumbnails!==!0&&l.__img!==void 0?{backgroundImage:'url("'+l.__img.src+'")',backgroundSize:o.thumbnailFit}:null},[h("div",{class:"q-uploader__file-header row flex-center no-wrap"},[l.__status==="failed"?h(ze,{class:"q-uploader__file-status",name:c.iconSet.type.negative,color:"negative"}):null,h("div",{class:"q-uploader__file-header-content col"},[h("div",{class:"q-uploader__title"},[l.name]),h("div",{class:"q-uploader__subtitle row items-center no-wrap"},[l.__sizeLabel+" / "+l.__progressLabel])]),l.__status==="uploading"?h(xt,{value:l.__progress,min:0,max:1,indeterminate:l.__progress===0}):h(X,{round:!0,dense:!0,flat:!0,icon:c.iconSet.uploader[l.__status==="uploaded"?"done":"clear"],onClick:()=>{ne(l)}})])]))}tt(()=>{e.isUploading.value===!0&&e.abort(),e.files.value.length!==0&&me()});const W={};for(const l in e)at(e[l])===!0?ot(W,l,()=>e[l].value):W[l]=e[l];return Object.assign(W,{upload:he,reset:K,removeUploadedFiles:N,removeQueuedFiles:ae,removeFile:ne,pickFiles:a,addFiles:i}),lt(W,{canAddFiles:()=>Q.value,canUpload:()=>p.value,uploadSizeLabel:()=>x.value,uploadProgressLabel:()=>y.value}),n({...e,upload:he,reset:K,removeUploadedFiles:N,removeQueuedFiles:ae,removeFile:ne,pickFiles:a,addFiles:i,canAddFiles:Q,canUpload:p,uploadSizeLabel:x,uploadProgressLabel:y}),()=>{const l=[h("div",{class:G.value},Ve()),h("div",{class:"q-uploader__list scroll"},Oe()),L("uploader")];e.isBusy.value===!0&&l.push(h("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[h(Fe)]));const b={ref:C,class:T.value};return Q.value===!0&&Object.assign(b,{onDragover:g,onDragleave:r}),h("div",b,l)}}const zt=()=>!0;function Le(t){const n={};return t.forEach(s=>{n[s]=zt}),n}const Ut=Le(je),Pt=({name:t,props:n,emits:s,injectPlugin:o})=>re({name:t,props:{...wt,...n},emits:st(s)===!0?{...Ut,...s}:[...je,...s],setup(u,{expose:f}){return Ct(o,f)}});function j(t){return typeof t=="function"?t:()=>t}const At="QUploader",Et={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>t=>t.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},Rt=["factoryFailed","uploaded","failed","uploading"];function Nt({props:t,emit:n,helpers:s}){const o=k([]),u=k([]),f=k(0),d=m(()=>({url:j(t.url),method:j(t.method),headers:j(t.headers),formFields:j(t.formFields),fieldName:j(t.fieldName),withCredentials:j(t.withCredentials),sendRaw:j(t.sendRaw),batch:j(t.batch)})),c=m(()=>f.value>0),D=m(()=>u.value.length!==0);let B;function v(){o.value.forEach(e=>{e.abort()}),u.value.length!==0&&(B=!0)}function P(){const e=s.queuedFiles.value.slice(0);s.queuedFiles.value=[],d.value.batch(e)?C(e):e.forEach(a=>{C([a])})}function C(e){if(f.value++,typeof t.factory!="function"){F(e,{});return}const a=t.factory(e);if(!a)n("factoryFailed",new Error("QUploader: factory() does not return properly"),e),f.value--;else if(typeof a.catch=="function"&&typeof a.then=="function"){u.value.push(a);const i=g=>{s.isAlive()===!0&&(u.value=u.value.filter(r=>r!==a),u.value.length===0&&(B=!1),s.queuedFiles.value=s.queuedFiles.value.concat(e),e.forEach(r=>{s.updateFileStatus(r,"failed")}),n("factoryFailed",g,e),f.value--)};a.then(g=>{B===!0?i(new Error("Aborted")):s.isAlive()===!0&&(u.value=u.value.filter(r=>r!==a),F(e,g))}).catch(i)}else F(e,a||{})}function F(e,a){const i=new FormData,g=new XMLHttpRequest,r=(p,T)=>a[p]!==void 0?j(a[p])(T):d.value[p](T),A=r("url",e);if(!A){console.error("q-uploader: invalid or no URL specified"),f.value--;return}const L=r("formFields",e);L!==void 0&&L.forEach(p=>{i.append(p.name,p.value)});let M=0,_=0,S=0,R=0,y;g.upload.addEventListener("progress",p=>{if(y===!0)return;const T=Math.min(R,p.loaded);s.uploadedSize.value+=T-S,S=T;let G=S-_;for(let K=M;G>0&&K<e.length;K++){const N=e[K];if(G>N.size)G-=N.size,M++,_+=N.size,s.updateFileStatus(N,"uploading",N.size);else{s.updateFileStatus(N,"uploading",G);return}}},!1),g.onreadystatechange=()=>{g.readyState<4||(g.status&&g.status<400?(s.uploadedFiles.value=s.uploadedFiles.value.concat(e),e.forEach(p=>{s.updateFileStatus(p,"uploaded")}),n("uploaded",{files:e,xhr:g})):(y=!0,s.uploadedSize.value-=S,s.queuedFiles.value=s.queuedFiles.value.concat(e),e.forEach(p=>{s.updateFileStatus(p,"failed")}),n("failed",{files:e,xhr:g})),f.value--,o.value=o.value.filter(p=>p!==g))},g.open(r("method",e),A),r("withCredentials",e)===!0&&(g.withCredentials=!0);const x=r("headers",e);x!==void 0&&x.forEach(p=>{g.setRequestHeader(p.name,p.value)});const Q=r("sendRaw",e);e.forEach(p=>{s.updateFileStatus(p,"uploading",0),Q!==!0&&i.append(r("fieldName",p),p,p.name),p.xhr=g,p.__abort=()=>{g.abort()},R+=p.size}),n("uploading",{files:e,xhr:g}),o.value.push(g),Q===!0?g.send(new Blob(e)):g.send(i)}return{isUploading:c,isBusy:D,abort:v,upload:P}}const $t={name:At,props:Et,emits:Rt,injectPlugin:Nt},Qt=Pt($t);function ve(){const{emit:t,proxy:n}=te(),s=k(null);function o(){s.value.show()}function u(){s.value.hide()}function f(c){t("ok",c),u()}function d(){t("hide")}return Object.assign(n,{show:o,hide:u}),{dialogRef:s,onDialogHide:d,onDialogOK:f,onDialogCancel:u}}const Me=["ok","hide"];ve.emits=Me;ve.emitsObject=Le(Me);const It={class:"text-center upload-title"},jt=fe({__name:"AddProductModal",emits:["refresh-data"],setup(t,{emit:n}){const s=n,o=Re(),u=Ae(),f=_t(),{dialogRef:d}=ve(),c=Ne(),D=k(!1),B=k(),v=k({id:null,name:"",category_id:"",unit_id:"",qty:null,description:""});async function P(){try{const e=await u.createProduct(v.value);e&&(v.value.id=e.id,o.notify({message:"Товар успешно создан, теперь вам необходимо добавить картинку",color:"primary"}))}catch(e){console.error(e)}}function C(e){const a=new FileReader;a.readAsDataURL(e[0]),a.onload=()=>{a?.result&&(B.value=String(a.result))},F(e[0])}async function F(e){const a=new FormData;a.append("file",e);try{await u.uploadFile(v.value.id,a)&&(o.notify({message:"Картинка успешно добавлена",color:"primary"}),d.value?.hide())}catch(i){console.error(i)}finally{s("refresh-data")}}return(e,a)=>($(),H(ut,{ref_key:"dialogRef",ref:d,modelValue:D.value,"onUpdate:modelValue":a[6]||(a[6]=i=>D.value=i),persistent:""},{default:E(()=>[q(Pe,{class:"add-product"},{default:E(()=>[q(ht,{greedy:""},{default:E(()=>[q(de,null,{default:E(()=>[a[9]||(a[9]=O("div",{class:"text-h6 q-mb-md"},"Добавление товара",-1)),q(se,{modelValue:v.value.name,"onUpdate:modelValue":a[0]||(a[0]=i=>v.value.name=i),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),q(se,{modelValue:v.value.qty,"onUpdate:modelValue":a[1]||(a[1]=i=>v.value.qty=i),class:"q-mb-xs",outlined:"",label:"Количество"},null,8,["modelValue"]),q(xe,{modelValue:v.value.category_id,"onUpdate:modelValue":a[2]||(a[2]=i=>v.value.category_id=i),options:J(f).categories,class:"q-mb-xs",outlined:"",label:"Тип тары","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),q(xe,{modelValue:v.value.unit_id,"onUpdate:modelValue":a[3]||(a[3]=i=>v.value.unit_id=i),options:J(c).units,outlined:"",label:"Вес","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),q(se,{class:"q-mt-sm",modelValue:v.value.description,"onUpdate:modelValue":a[4]||(a[4]=i=>v.value.description=i),filled:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"]),!B.value&&v.value.id?($(),H(Qt,{key:0,class:"q-mt-sm",ref:"uploaderRef",color:"primary",flat:"",onAdded:C},{header:E(()=>[...a[7]||(a[7]=[])]),list:E(()=>[q(Ft),O("div",It,[q(ze,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[8]||(a[8]=O("span",null,"Загрузить картинку",-1))])]),_:1},512)):ee("",!0),B.value?($(),H(Ee,{key:1,class:"q-mt-sm",src:B.value},null,8,["src"])):ee("",!0)]),_:1}),q(Ue,{align:"right"},{default:E(()=>[it(q(X,{color:"red",label:"Отмена"},null,512),[[yt]]),q(X,{color:"primary",label:"Подтвердить",onClick:a[5]||(a[5]=i=>P())})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Lt=$e(jt,[["__scopeId","data-v-15064176"]]);function Mt(t){const n=J(t);if(n&&typeof n=="object"&&"role"in n){const s=n.role;return s!=null?J(s):null}return n}function Vt(t){const n=m(()=>{const d=Mt(t);if(d==null)return;const c=Number(d);if(Object.values(w).includes(c))return c}),s=m(()=>n.value===w.ADMIN),o=m(()=>n.value===w.MANAGER||n.value===w.ADMIN),u=m(()=>{const d=n.value;return d===w.USER||d===w.MANAGER||d===w.ADMIN});return{permission:n,isAdmin:s,isManager:o,isUser:u,hasPermission:d=>m(()=>{const c=n.value;if(c==null)return!1;switch(Number(d)){case w.ADMIN:return c===w.ADMIN;case w.MANAGER:return c===w.MANAGER||c===w.ADMIN;case w.USER:return c===w.USER||c===w.MANAGER||c===w.ADMIN;default:return!1}})}}const Ot={class:"product-card row q-col-gutter-xs"},Tt={class:"text-center card-title"},Ht={class:"text-center"},Gt={class:"text-bold"},Kt={key:0,class:"text-grey old-price"},Wt=fe({__name:"ProductList",setup(t){const n=Re(),s=Ne(),o=Ae(),u=pt(),f=dt(),{isManager:d}=Vt(m(()=>f.user?.role)),c=k(!1),D=k(!1);ct(async()=>{try{await s.fetchUnits(),n.loading.show()}catch(e){console.error(e)}finally{n.loading.hide()}});function B(){v()}async function v(){try{n.loading.show();const e=await o.fetchProducts(o.pagination);e&&(o.pagination.total=e.total,o.pagination.has_more=e.has_more,o?.products?.length?o.products.push(e.items):o.products=e.items)}catch(e){console.error(e)}finally{n.loading.hide()}}function P(e){try{if(n.loading.show(),u.basketData?.length){const a=u.basketData.find(i=>i.id===e.id);a?C(a,e):u.basketData.push(structuredClone(Se(e)))}else u.basketData.push(structuredClone(Se(e)))}catch(a){console.error(a)}finally{n.notify({message:`Товар ${e.name} добавлен в корзину`,color:"primary"}),n.loading.hide()}}function C(e,a){e.price&&(e.price+=a.price),e.weight&&(e.weight+=a.weight),e.oldPrice&&(e.oldPrice+=a.oldPrice)}const F=async(e,a)=>{if(!o.pagination.has_more){c.value=!0,a(!0);return}await v(),o.pagination.offset+=o.pagination.limit,a()};return(e,a)=>($(),H(mt,{onLoad:F,offset:250},{default:E(()=>[J(d)?($(),H(X,{key:0,onClick:a[0]||(a[0]=i=>D.value=!D.value),class:"full-width q-mb-sm",color:"secondary",label:"Добавление товара"})):ee("",!0),O("div",Ot,[($(!0),ue(vt,null,ft(J(o).products,(i,g)=>($(),ue("div",{class:"col-6",key:g},[q(Pe,{class:"my-card radius-12 full-height",style:{"border-radius":"20px"},flat:"",bordered:""},{default:E(()=>[q(de,{class:"q-pa-sm full-height"},{default:E(()=>[O("div",null,[q(Ee,{class:"cursor-pointer",src:"https://media.istockphoto.com/id/1141529240/ru/%D0%B2%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%BD%D0%B0%D1%8F/%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%D0%B5-%D1%8F%D0%B1%D0%BB%D0%BE%D0%BA%D0%BE-%D0%B2-%D0%BF%D0%BB%D0%BE%D1%81%D0%BA%D0%BE%D0%BC-%D1%81%D1%82%D0%B8%D0%BB%D0%B5-%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%B2%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0.jpg?s=612x612&w=0&k=20&c=B-KXrA7VTm8E6t4jk9qcuFz8bDFzTJwiIGaYGYUcsZI="})]),q(de,{class:"q-pa-sm"},{default:E(()=>[O("div",Tt,oe(i.name),1),O("div",Ht,[O("span",Gt,oe(i.price),1),a[3]||(a[3]=De(" ₽ ",-1)),i?.oldPrice?($(),ue("span",Kt,oe(i.old_price)+" ₽",1)):ee("",!0),De(" / "+oe(i.unit_symbol),1)])]),_:2},1024),q(Ue,{class:"justify-center"},{default:E(()=>[q(X,{dense:"","no-caps":"",class:"full-width",color:"secondary",icon:"add_shopping_cart",label:"В корзину",onClick:r=>P(i)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),D.value?($(),H(Lt,{key:1,modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=i=>D.value=i),onRefreshData:a[2]||(a[2]=i=>B())},null,8,["modelValue"])):ee("",!0)]),_:1}))}}),Yt=$e(Wt,[["__scopeId","data-v-1cebc01b"]]),ua=fe({__name:"DashboardPage",setup(t){return(n,s)=>($(),H(bt,{class:"q-mx-xs"},{default:E(()=>[q(Yt,{class:"q-mb-lg"})]),_:1}))}});export{ua as default};
