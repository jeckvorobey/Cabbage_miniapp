import{Q as W}from"./QImg-G3dQyX11.js";import{d as z,r as p,o as j,aj as I,ae as y,aF as J,af as l,f as s,aI as L,as as E,aG as O,aq as u,am as S,av as R,aP as K,aH as X,W as Y,ah as P,u as ee,c as B,aE as M,aw as se,ar as te,ad as q,ak as C,a6 as g,aD as ae,al as oe}from"./index-H9N5e26t.js";import{Q as le}from"./QBtnToggle-pMKVpEkG.js";import{Q as ne,a as de,b as re}from"./QItem-DafRUWDY.js";import{Q as T}from"./QSelect-nhS8S6hc.js";import{u as F}from"./use-quasar-BfvQNktz.js";import{u as Z}from"./addressesStore-9ZbgmlD-.js";import{Q as ie}from"./QForm-DdPcBLtY.js";import{C as ue}from"./ClosePopup-DwzNqLKl.js";import{g as me}from"./useUtils-B9JP9wdY.js";import{u as ce}from"./usersStore-CjTGxDvV.js";import"./QBtnGroup-7iWtgjEK.js";import"./QMenu-CMxtr_Mf.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const pe={class:"row q-pl-sm flex-center justify-between"},ve={class:"text-grey-6"},fe=z({__name:"AddAddressModal",props:{newAddress:{}},setup(D){const c=[[55.97,37.12],[56.02,37.33]],d=p([]),k=p(!1),w=p("Начните вводить адрес..."),b=D,h=F(),v=Z(),V=p(!0),f=p(),n=p();j(async()=>{try{const m={area_id:1,address_line:"",comment:"",is_default:!1};b.newAddress?n.value=b.newAddress:n.value=m,h.loading.show();const t=await v.fetchDeliveryZones();t&&(v.deliveryZones=t)}catch(m){console.error(m)}finally{h.loading.hide()}});async function r(){try{await(n?.value?.id?v.updateAddress:v.createAddress)(n.value)}catch(m){console.error(m)}finally{f.value.hide()}}async function _(m,t){if(!m){w.value="Начните вводить адрес...",t(()=>{d.value=[]});return}const i=window.ymaps;if(!i){h.notify({type:"negative",message:"Сервис карт недоступен."});return}k.value=!0;try{const x=(await i.geocode(m,{results:5,boundedBy:c,strictBounds:!0})).geoObjects.toArray().map(Q=>({displayName:Q.properties.get("text"),coords:Q.geometry.getCoordinates()}));t(()=>{if(!x?.length){d.value=[],w.value="Адрес не найден";return}d.value=x})}catch(A){console.error("Ошибка геокодирования:",A)}finally{k.value=!1}}return(m,t)=>(y(),I(J,{ref_key:"dialogRef",ref:f,modelValue:V.value,"onUpdate:modelValue":t[4]||(t[4]=i=>V.value=i),persistent:""},{default:l(()=>[s(L,{class:""},{default:l(()=>[s(ie,{greedy:"",onSubmit:t[3]||(t[3]=i=>r())},{default:l(()=>[n.value?(y(),I(O,{key:0},{default:l(()=>[t[5]||(t[5]=u("div",{class:"text-h6"},"Создание нового адреса доставки",-1)),s(T,{class:"q-mb-sm",clearable:"",outlined:"","use-input":"","emit-value":"","map-options":"",modelValue:n.value.address_line,"onUpdate:modelValue":t[0]||(t[0]=i=>n.value.address_line=i),options:d.value,"option-label":"displayName","option-value":"displayName",label:"Адрес доставки",onFilter:_},{"no-option":l(()=>[u("div",pe,[u("div",ve,S(w.value),1)])]),_:1},8,["modelValue","options"]),s(R,{label:"Комментарий",modelValue:n.value.comment,"onUpdate:modelValue":t[1]||(t[1]=i=>n.value.comment=i),outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"]),s(K,{modelValue:n.value.is_default,"onUpdate:modelValue":t[2]||(t[2]=i=>n.value.is_default=i),label:"Активный аддрес"},null,8,["modelValue"])]),_:1})):E("",!0),s(X,{align:"right"},{default:l(()=>[Y(s(P,{color:"red",flat:"",label:"Отмена"},null,512),[[ue]]),s(P,{color:"primary",flat:"",label:"Сохранить",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ge={class:"q-pa-sm"},he={class:"justify-center row q-mb-md"},ye={class:"text-h5 justify-between q-mb-sm row"},we={class:"items-center"},_e={class:"items-center"},ke={key:0,class:"row items-center q-mb-sm text-h6"},be={style:{height:"40px"},class:"col-10 content-center"},Ve={key:1,class:"row items-center q-mb-sm"},Ae={class:"row items-center q-mb-sm"},Le=z({__name:"UserPage",setup(D){const c=F(),d=Z(),k=ce(),w=ee(),b=B(()=>M.isActive),h=se({dark:"dark",light:"light"}),v=p(!1),V=B(()=>b.value?h.dark:h.light),f=p(!1),n=p("dark"),r=p({full_name:"",mail:"",phone:"",addres:null}),_=p();j(()=>{r.value=w.user});function m(o){r.value.addres=o,console.log(r.value.addres),x(o)}function t(){_.value=null,f.value=!f.value}async function i(o){try{c.loading.show(),await d.deleteAddress(o.id)&&U()}catch(e){console.error(e)}finally{c.loading.hide()}}function A(o){_.value=o,f.value=!f.value}async function x(o){try{c.loading.show(),await d.updateAddress(o)&&U()}catch(e){console.error(e)}finally{c.loading.hide()}}const Q=()=>{M.toggle(),window.localStorage.setItem("theme",V.value)};function G(){c.dialog({title:"Смена номера телефона",message:"Вы уверенны что хотите изменить номер?",cancel:!0,persistent:!0}).onOk(()=>{H()})}async function H(){try{c.loading.show(),await k.updateMyPhone(r.value.phone)}catch(o){console.error(o)}finally{c.loading.hide()}}async function U(){try{c.loading.show();const o=await d.fetchAddresses();if(o){d.addresses=o;const e=o.find($=>$.is_default===!0);d.addressId=e.id}}catch(o){console.error(o)}finally{c.loading.hide()}}return(o,e)=>{const $=te("q-item-action");return y(),q("div",null,[e[9]||(e[9]=u("h6",{class:"text-center q-mb-md"},"Личный кабинет",-1)),u("div",ge,[s(L,{class:"my-card full-height",flat:"",bordered:""},{default:l(()=>[s(O,null,{default:l(()=>[u("div",he,[s(W,{class:"radius-100",height:"120px",width:"120px",src:r.value?.main_image_url?r.value.main_image_url:C(me)("/card-shop.jpg")},null,8,["src"])]),u("div",ye,[u("div",null,S(r.value.full_name),1),u("div",null,[s(le,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),size:"sm","no-caps":"",unelevated:"",dense:"","toggle-color":"grey-9",color:"white","text-color":"grey-9",options:[{value:"dark",slot:"dark",title:"Dark mode"},{value:"light",slot:"light",title:"Light mode"}],onClick:e[1]||(e[1]=a=>Q())},{dark:l(()=>[u("div",we,[s(g,{name:"nightlight"})])]),light:l(()=>[u("div",_e,[s(g,{name:"light_mode"})])]),_:1},8,["modelValue"])])]),!v.value&&r.value?.phone?(y(),q("div",ke,[u("div",be,S(r.value.phone),1),s(g,{onClick:e[2]||(e[2]=a=>v.value=!v.value),name:"edit",size:"30px",color:"green",class:"col-2"})])):(y(),q("div",Ve,[s(g,{onClick:e[3]||(e[3]=a=>v.value=!v.value),name:"close",size:"30px",color:"red",class:"col-1"}),s(R,{class:"col-9",dense:"",outlined:"",modelValue:r.value.phone,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.phone=a),label:"Телефон",mask:"+# (###) ###-##-##",type:"tel"},null,8,["modelValue"]),s(g,{onClick:e[5]||(e[5]=a=>G()),name:"save",size:"30px",color:"green",class:"col-2"})])),u("div",Ae,[s(T,{modelValue:C(d).addressId,"onUpdate:modelValue":e[6]||(e[6]=a=>C(d).addressId=a),options:C(d).addresses,class:"col-10",dense:"",outlined:"",label:"Адрес","emit-value":"","map-options":"","option-label":"address_line","option-value":"id"},{option:l(a=>[s(ne,ae(a.itemProps,{class:"justify-between flex"}),{default:l(()=>[s(de,{onClick:N=>m(a.opt)},{default:l(()=>[s(re,null,{default:l(()=>[oe(S(a.opt.address_line),1)]),_:2},1024)]),_:2},1032,["onClick"]),s($,null,{default:l(()=>[s(g,{class:"q-mr-sm",color:"red",name:"delete",size:"26px",onClick:N=>i(a.opt)},null,8,["onClick"]),s(g,{color:"green",name:"edit",size:"26px",onClick:N=>A(a.opt)},null,8,["onClick"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),s(g,{onClick:e[7]||(e[7]=a=>t()),name:"add",size:"34px",color:"green",class:"col-2"})])]),_:1})]),_:1})]),f.value?(y(),I(fe,{key:0,modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=a=>f.value=a),newAddress:_.value},null,8,["modelValue","newAddress"])):E("",!0)])}}});export{Le as default};
