import{k as Z,g as G,a as O,u as b,v as me,O as ve,c as q,h as U,l as ee,t as ge,P as pe,r as h,w as S,ai as De,aj as he,n as ye,o as te,x as Be,ak as C,S as $,al as R,q as z,am as A,R as be,an as _e,d as H,a7 as M,a6 as x,ab as p,f as u,ac as _,aa as ae,L as K,Q as E,a5 as I,ae as xe,F as Pe,ad as k,ag as Y,a8 as Ve,ao as J}from"./index-TPQl1CoS.js";import{u as le,Q as W,a as Se,d as Qe}from"./orderStore-BoIGV9ZD.js";import{Q as N,d as T}from"./QCardSection-Cp67muDo.js";import{f as Ce,Q as oe,C as X}from"./ClosePopup-BkoPUQYV.js";import{Q as se}from"./QCard-CDYAt0AE.js";import{u as ne}from"./use-quasar-Bvp_rFW6.js";import{u as re,Q as ke}from"./unitsStore-DLUNppx6.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const qe=Z({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(o,{slots:f}){const{proxy:{$q:D}}=G(),a=O(me,b);if(a===b)return console.error("QPage needs to be a deep child of QLayout"),b;if(O(ve,b)===b)return console.error("QPage needs to be child of QPageContainer"),b;const n=q(()=>{const c=(a.header.space===!0?a.header.size:0)+(a.footer.space===!0?a.footer.size:0);if(typeof o.styleFn=="function"){const e=a.isContainer.value===!0?a.containerHeight.value:D.screen.height;return o.styleFn(c,e)}return{minHeight:a.isContainer.value===!0?a.containerHeight.value-c+"px":D.screen.height===0?c!==0?`calc(100vh - ${c}px)`:"100vh":D.screen.height-c+"px"}}),v=q(()=>`q-page${o.padding===!0?" q-layout-padding":""}`);return()=>U("main",{class:v.value,style:n.value},ee(f.default))}}),{passive:B}=ge,Ee=Z({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:pe,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(o,{slots:f,emit:D}){const a=h(!1),s=h(!0),n=h(null),v=h(null);let c=o.initialIndex,e,t;const d=q(()=>"q-infinite-scroll__loading"+(a.value===!0?"":" invisible"));function y(){if(o.disable===!0||a.value===!0||s.value===!1)return;const i=C(e),g=$(e),V=R(e);o.reverse===!1?Math.round(g+V+o.offset)>=Math.round(i)&&l():Math.round(g)<=o.offset&&l()}function l(){if(o.disable===!0||a.value===!0||s.value===!1)return;c++,a.value=!0;const i=C(e);D("load",c,g=>{s.value===!0&&(a.value=!1,z(()=>{if(o.reverse===!0){const V=C(e),de=$(e),fe=V-i;A(e,de+fe)}g===!0?P():n.value&&n.value.closest("body")&&t()}))})}function r(){c=0}function m(){s.value===!1&&(s.value=!0,e.addEventListener("scroll",t,B)),y()}function P(){s.value===!0&&(s.value=!1,a.value=!1,e.removeEventListener("scroll",t,B),t?.cancel?.())}function Q(){if(e&&s.value===!0&&e.removeEventListener("scroll",t,B),e=be(n.value,o.scrollTarget),s.value===!0){if(e.addEventListener("scroll",t,B),o.reverse===!0){const i=C(e),g=R(e);A(e,i-g)}y()}}function ue(i){c=i}function j(i){i=parseInt(i,10);const g=t;t=i<=0?y:_e(y,isNaN(i)===!0?100:i),e&&s.value===!0&&(g!==void 0&&e.removeEventListener("scroll",g,B),e.addEventListener("scroll",t,B))}function w(i){if(F.value===!0){if(v.value===null){i!==!0&&z(()=>{w(!0)});return}const g=`${a.value===!0?"un":""}pauseAnimations`;Array.from(v.value.getElementsByTagName("svg")).forEach(V=>{V[g]()})}}const F=q(()=>o.disable!==!0&&s.value===!0);S([a,F],()=>{w()}),S(()=>o.disable,i=>{i===!0?P():m()}),S(()=>o.reverse,()=>{a.value===!1&&s.value===!0&&y()}),S(()=>o.scrollTarget,Q),S(()=>o.debounce,j);let L=!1;De(()=>{L!==!1&&e&&A(e,L)}),he(()=>{L=e?$(e):!1}),ye(()=>{s.value===!0&&e.removeEventListener("scroll",t,B)}),te(()=>{j(o.debounce),Q(),a.value===!1&&w()});const ce=G();return Object.assign(ce.proxy,{poll:()=>{t?.()},trigger:l,stop:P,reset:r,resume:m,setIndex:ue,updateScrollTarget:Q}),()=>{const i=Be(f.default,[]);return F.value===!0&&i[o.reverse===!1?"push":"unshift"](U("div",{ref:v,class:d.value},ee(f.loading))),U("div",{class:"q-infinite-scroll",ref:n},i)}}}),we=H({__name:"AddProductModal",setup(o){const f=ne(),D=le(),a=re(),s=h(!1),n=h({name:"",category_id:"",unit_id:"",qty:null,description:""}),v=[{label:"Овощи",value:1},{label:"Фрукты",value:2},{label:"Ягоды",value:3}];async function c(){try{await D.createProduct(n.value)&&f.notify({message:"Товар успешно создан",color:"primary"})}catch(e){console.error(e)}}return(e,t)=>(x(),M(Ce,{ref:"dialogRef",modelValue:s.value,"onUpdate:modelValue":t[6]||(t[6]=d=>s.value=d),persistent:""},{default:p(()=>[u(se,{class:"add-product"},{default:p(()=>[u(ke,{greedy:""},{default:p(()=>[u(N,null,{default:p(()=>[t[7]||(t[7]=_("div",{class:"text-h6 q-mb-md"},"Добавление товара",-1)),u(T,{modelValue:n.value.name,"onUpdate:modelValue":t[0]||(t[0]=d=>n.value.name=d),label:"Наименование товара","stack-label":""},null,8,["modelValue"]),u(T,{modelValue:n.value.qty,"onUpdate:modelValue":t[1]||(t[1]=d=>n.value.qty=d),label:"Количество","stack-label":""},null,8,["modelValue"]),u(W,{modelValue:n.value.category_id,"onUpdate:modelValue":t[2]||(t[2]=d=>n.value.category_id=d),options:v,label:"Тип тары","emit-value":"","map-options":""},null,8,["modelValue"]),u(W,{modelValue:n.value.unit_id,"onUpdate:modelValue":t[3]||(t[3]=d=>n.value.unit_id=d),options:ae(a).units,label:"Вес","emit-value":"","map-options":"","option-label":"name","option-value":"symbol"},null,8,["modelValue","options"]),u(T,{class:"q-mt-sm",modelValue:n.value.description,"onUpdate:modelValue":t[4]||(t[4]=d=>n.value.description=d),filled:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),u(oe,{align:"right"},{default:p(()=>[K(u(E,{color:"red",label:"Отмена"},null,512),[[X]]),K(u(E,{color:"primary",label:"Подтвердить",onClick:t[5]||(t[5]=d=>c())},null,512),[[X]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Fe=ie(we,[["__scopeId","data-v-f2d97a50"]]),Le={class:"product-card row q-col-gutter-xs"},$e={class:"text-center card-title"},Ae={class:"text-center"},Ie={class:"text-bold"},Te={key:0,class:"text-grey old-price"},Ue=H({__name:"ProductList",setup(o){const f=ne(),D=re(),a=le(),s=Se(),n=h(!1),v=h(!1),c=h({offset:0,limit:20,totla:0});te(async()=>{try{await D.fetchUnits(),f.loading.show()}catch(l){console.error(l)}finally{f.loading.hide()}});async function e(){try{f.loading.show();const l=await a.fetchProducts(c.value);l&&(a?.products?.length?a.products.push(l.items):(a.products=l.items,c.value.totla=l.total))}catch(l){console.error(l)}finally{f.loading.hide()}}function t(l){try{if(f.loading.show(),s.basketData?.length){const r=s.basketData.find(m=>m.id===l.id);r?d(r,l):s.basketData.push(structuredClone(J(l)))}else s.basketData.push(structuredClone(J(l)))}catch(r){console.error(r)}finally{f.notify({message:`Товар ${l.name} добавлен в корзину`,color:"primary"}),f.loading.hide()}}function d(l,r){l.price&&(l.price+=r.price),l.weight&&(l.weight+=r.weight),l.oldPrice&&(l.oldPrice+=r.oldPrice)}const y=(l,r)=>{if(a?.products?.length>=c.value.totla){n.value=!0,r(!0);return}e(),c.value.offset++,r()};return(l,r)=>(x(),M(Ee,{onLoad:y,offset:250},{default:p(()=>[u(E,{onClick:r[0]||(r[0]=m=>v.value=!v.value),class:"full-width q-mb-sm",color:"secondary",label:"Добавление товара"}),_("div",Le,[(x(!0),I(Pe,null,xe(ae(a).products,(m,P)=>(x(),I("div",{class:"col-6",key:P},[u(se,{class:"my-card radius-12 full-height",style:{"border-radius":"20px"},flat:"",bordered:""},{default:p(()=>[u(N,{class:"q-pa-sm full-height"},{default:p(()=>[_("div",null,[u(Qe,{class:"cursor-pointer",src:"https://media.istockphoto.com/id/1141529240/ru/%D0%B2%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%BD%D0%B0%D1%8F/%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%D0%B5-%D1%8F%D0%B1%D0%BB%D0%BE%D0%BA%D0%BE-%D0%B2-%D0%BF%D0%BB%D0%BE%D1%81%D0%BA%D0%BE%D0%BC-%D1%81%D1%82%D0%B8%D0%BB%D0%B5-%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%B2%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0.jpg?s=612x612&w=0&k=20&c=B-KXrA7VTm8E6t4jk9qcuFz8bDFzTJwiIGaYGYUcsZI="})]),u(N,{class:"q-pa-sm"},{default:p(()=>[_("div",$e,k(m.name),1),_("div",Ae,[_("span",Ie,k(m.price),1),r[2]||(r[2]=Y(" ₽ ",-1)),m?.oldPrice?(x(),I("span",Te,k(m.old_price)+" ₽",1)):Ve("",!0),Y(" / "+k(m.unit_symbol),1)])]),_:2},1024),u(oe,{class:"justify-center"},{default:p(()=>[u(E,{dense:"","no-caps":"",class:"full-width",color:"secondary",icon:"add_shopping_cart",label:"В корзину",onClick:Q=>t(m)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),u(Fe,{modelValue:v.value,"onUpdate:modelValue":r[1]||(r[1]=m=>v.value=m),label:"test"},null,8,["modelValue"])]),_:1}))}}),Ne=ie(Ue,[["__scopeId","data-v-868cd156"]]),Je=H({__name:"DashboardPage",setup(o){return(f,D)=>(x(),M(qe,{class:"q-mx-xs"},{default:p(()=>[u(Ne,{class:"q-mb-lg"})]),_:1}))}});export{Je as default};
