import{Q as w}from"./QInfiniteScroll-CztsYIyE.js";import{u as Q}from"./use-quasar-DrJJw9aC.js";import{u as h}from"./orderStore-CR09_sRy.js";import{Q as L,a as _,b as i}from"./QItem-BokOOKHJ.js";import{Q as b}from"./QList-DCzrAMAH.js";import{Q as B}from"./QBtnDropdown-CvXrcSBz.js";import{C as M}from"./ClosePopup-C9kNX3dn.js";import{X as k,Y as O,a3 as D,_ as u,a1 as o,$ as a,a4 as v,a5 as I,Z as C,ad as A,a7 as d,a8 as g,a9 as V,m as q,a0 as x,a6 as T}from"./index-Bv3_Lu3E.js";import"./QBtnGroup-DfX__AO6.js";import"./QMenu-Cb6TiFOA.js";var m=(r=>(r.CREATED="created",r.ASSEMBLING="assembling",r.DELIVERING="delivering",r.COMPLETED="completed",r.CANCELLED="cancelled",r))(m||{});const $=k({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},setup(r){const l=Q(),t=h(),y=[{label:"создан",value:m.CREATED},{label:"собирается",value:m.ASSEMBLING},{label:"в пути",value:m.DELIVERING},{label:"завершён",value:m.COMPLETED},{label:"отменён",value:m.CANCELLED}];function f(e,n){l.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{s(e,n)})}async function s(e,n){try{l.loading.show(),await t.updateOrderStatus(e,n)&&l.notify({color:"primary",message:"Статус успешно изменен"})}catch(c){console.error(c)}finally{l.loading.hide()}}return(e,n)=>{const c=O("q-item-action");return u(),D("div",null,[o(b,null,{default:a(()=>[(u(!0),D(v,null,I(e.orderData,(p,N)=>(u(),C(L,{key:N,class:"border-bot"},{default:a(()=>[o(_,null,{default:a(()=>[o(i,{caption:"",lines:"2"},{default:a(()=>[...n[0]||(n[0]=[d("Дата",-1)])]),_:1}),o(i,null,{default:a(()=>[d(g(p.order_date),1)]),_:2},1024)]),_:2},1024),o(_,null,{default:a(()=>[o(i,{caption:"",lines:"2"},{default:a(()=>[...n[1]||(n[1]=[d("Статус",-1)])]),_:1}),o(i,null,{default:a(()=>[d(g(p.status),1)]),_:2},1024)]),_:2},1024),o(_,null,{default:a(()=>[o(i,{caption:"",lines:"2"},{default:a(()=>[...n[2]||(n[2]=[d("Общая сумма",-1)])]),_:1}),o(i,null,{default:a(()=>[d(g(p.total_amount),1)]),_:2},1024)]),_:2},1024),e.adminMode?(u(),C(c,{key:0},{default:a(()=>[o(B,{color:"green",dense:""},{default:a(()=>[(u(),D(v,null,I(y,(E,S)=>o(b,{key:S},{default:a(()=>[V((u(),C(L,{clickable:"",onClick:G=>f(p.id,E.value)},{default:a(()=>[o(_,null,{default:a(()=>[o(i,null,{default:a(()=>[d(g(E.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[M]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):A("",!0)]),_:2},1024))),128))]),_:1})])}}}),K=k({__name:"OrderHistoryPage",setup(r){const l=Q(),t=h();q(async()=>{t.pagination.offset=0,await f()});const y=async(s,e)=>{if(!t.pagination.has_more){e(!0);return}await f(),t.pagination.offset+=t.pagination.limit,e()};async function f(){try{l.loading.show();const s={limit:t.pagination.limit,offset:t.pagination.offset},e=await t.fetchOrders(s);e&&(t.pagination.total=e.total,t.pagination.has_more=e.has_more,t.ordersData?.length?t.ordersData.push(e.items):t.ordersData=e.items),e&&(t.ordersData=e.items)}catch(s){console.error(s)}finally{l.loading.hide()}}return(s,e)=>(u(),D("div",null,[o(w,{offset:250,onLoad:y},{default:a(()=>[e[0]||(e[0]=x("h6",{class:"text-center q-mt-md q-mb-md"},"История заказов",-1)),o($,{orderData:T(t).ordersData,adminMode:!0},null,8,["orderData"])]),_:1})]))}});export{K as default};
