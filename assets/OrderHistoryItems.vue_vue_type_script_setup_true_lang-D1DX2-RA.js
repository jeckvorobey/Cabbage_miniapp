import{Q as L,a as c,b as u}from"./QItem-BQ7qPcX-.js";import{Q as v}from"./QList-60H4ITDV.js";import{Q as T}from"./QBtnDropdown-CpFiG-ku.js";import{V as O,W as V,a1 as p,Y as o,$ as n,Z as e,a2 as D,a3 as N,X as _,ab as g,a5 as r,a6 as f,a4 as E,a7 as w,z as G}from"./index-B6Ay3U0H.js";import{C as P}from"./ClosePopup-DJyz57eb.js";import{u as R,d as $}from"./use-quasar-CNM1MuGf.js";import{u as x}from"./orderStore-DUlJbEiJ.js";var i=(d=>(d.CREATED="created",d.ASSEMBLING="assembling",d.DELIVERING="delivering",d.COMPLETED="completed",d.CANCELLED="cancelled",d))(i||{});const q=["href"],z={key:1},J=O({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},setup(d){const m=R(),I=x(),k=[{label:"создан",value:i.CREATED},{label:"собирается",value:i.ASSEMBLING},{label:"в пути",value:i.DELIVERING},{label:"завершён",value:i.COMPLETED},{label:"отменён",value:i.CANCELLED}];function S(t,a){m.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{b(t,a)})}async function b(t,a){try{m.loading.show(),await I.updateOrderStatus(t,a)&&m.notify({color:"primary",message:"Статус успешно изменен"})}catch(s){console.error(s)}finally{m.loading.hide()}}function h(t){return k.find(s=>s.value===t)?.label}function Q(t){m.dialog({cancel:!0,message:"Вы уверенны что хотите отменить заказ?",persistent:!0,title:"Отмена заказа"}).onOk(()=>{b(t,i.CANCELLED)})}function A(t){return`tg://user?id=${t}`}function y(t){const a=t?.user?.phone??t?.user?.phone_number??t?.user?.phoneNumber??t?.user_phone??t?.userPhone??t?.phone;if(typeof a=="number")return String(a);if(typeof a!="string")return null;const s=a.trim();return s.length?s:null}return(t,a)=>{const s=V("q-item-action");return o(),p("div",null,[n(v,null,{default:e(()=>[(o(!0),p(D,null,N(t.orderData,(l,B)=>(o(),_(L,{key:B,class:"border-bot"},{default:e(()=>[n(c,null,{default:e(()=>[n(u,{caption:"",lines:"2"},{default:e(()=>[...a[0]||(a[0]=[r("Дата",-1)])]),_:1}),n(u,null,{default:e(()=>[r(f(E($)(l.order_date)),1)]),_:2},1024)]),_:2},1024),n(c,null,{default:e(()=>[n(u,{caption:"",lines:"2"},{default:e(()=>[...a[1]||(a[1]=[r("Имя",-1)])]),_:1}),n(u,null,{default:e(()=>[l?.user?.id?(o(),p("a",{key:0,href:A(l.user.id),target:"_blank",class:"text-primary text-decoration-none"},f(l.user.full_name),9,q)):(o(),p("span",z,f(l?.user?.full_name),1))]),_:2},1024),y(l)?(o(),_(u,{key:0,caption:""},{default:e(()=>[r(f(y(l)),1)]),_:2},1024)):g("",!0)]),_:2},1024),n(c,null,{default:e(()=>[n(u,{caption:"",lines:"2"},{default:e(()=>[...a[2]||(a[2]=[r("Статус",-1)])]),_:1}),n(u,null,{default:e(()=>[r(f(h(l.status)),1)]),_:2},1024)]),_:2},1024),n(c,null,{default:e(()=>[n(u,{caption:"",lines:"2"},{default:e(()=>[...a[3]||(a[3]=[r("Общая сумма",-1)])]),_:1}),n(u,null,{default:e(()=>[r(f(l.total_amount),1)]),_:2},1024)]),_:2},1024),t.adminMode?(o(),_(s,{key:0},{default:e(()=>[n(T,{color:"green",dense:""},{default:e(()=>[(o(),p(D,null,N(k,(C,M)=>n(v,{key:M},{default:e(()=>[w((o(),_(L,{clickable:"",onClick:F=>S(l.id,C.value)},{default:e(()=>[n(c,null,{default:e(()=>[n(u,null,{default:e(()=>[r(f(C.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[P]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):g("",!0),!t.adminMode&&(l.status===E(i).CREATED||l.status===E(i).ASSEMBLING)?(o(),_(s,{key:1},{default:e(()=>[n(G,{round:"",color:"deep-orange",icon:"close",onClick:C=>Q(l.id)},null,8,["onClick"])]),_:2},1024)):g("",!0)]),_:2},1024))),128))]),_:1})])}}});export{J as _};
