import{b as te,q as X,T as M,bh as V,bm as oe,bn as ne,f as H,h as le,v as se,r as P,V as B,a4 as _,R as m,ac as re,$ as r,_ as n,Z as h,a0 as N,S as p,a1 as b,a8 as ie,a5 as w,a9 as q,aa as T,ab as S,Q,P as I,a2 as de,W as ue,Y as ce,X as pe,a6 as K,ai as me,a7 as fe,p as ge}from"./index-BZjd7GBC.js";import{u as O}from"./use-quasar-Bj_W2G9s.js";import{Q as Y}from"./QImg-B6zw0J4j.js";import{Q as ve,a as L,b as j}from"./QItem-DDMqTswZ.js";import{Q as ye}from"./QList-BElwcuPt.js";import{Q as _e}from"./QInfiniteScroll-B5w_7eQN.js";import{u as Z}from"./productsStore-CsZbc7f9.js";import{g as he,Q as be,a as xe}from"./QUploader-CkjVN_b9.js";import{Q as Ce}from"./QSelect-CHecBd17.js";import{Q as E}from"./QForm-DVqTc2pL.js";import{C as F}from"./ClosePopup-DlC2R70j.js";import{u as G}from"./usePermissionVisibility.hook-BbKMUw0E.js";import{P as W}from"./ProductImgCarusel-DOCWp5SJ.js";import{u as Qe}from"./categoriesStore-CzHBp1kn.js";import{f as Pe,g as J}from"./useUtils-QC3uEKhj.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ve}from"./useCart-BG6gfmdO.js";import{u as ke}from"./addressesStore-k4OUlgOu.js";import"./format-CJebrXOQ.js";import"./QMenu-C3gO3s83.js";import"./rtl-DFPa-2ov.js";const qe=te({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(y,{slots:u}){const{proxy:{$q:i}}=X(),o=M(oe,V);if(o===V)return console.error("QPage needs to be a deep child of QLayout"),V;if(M(ne,V)===V)return console.error("QPage needs to be child of QPageContainer"),V;const f=H(()=>{const v=(o.header.space===!0?o.header.size:0)+(o.footer.space===!0?o.footer.size:0);if(typeof y.styleFn=="function"){const C=o.isContainer.value===!0?o.containerHeight.value:i.screen.height;return y.styleFn(v,C)}return{minHeight:o.isContainer.value===!0?o.containerHeight.value-v+"px":i.screen.height===0?v!==0?`calc(100vh - ${v}px)`:"100vh":i.screen.height-v+"px"}}),x=H(()=>`q-page${y.padding===!0?" q-layout-padding":""}`);return()=>le("main",{class:x.value,style:f.value},se(u.default))}});function z(){const{emit:y,proxy:u}=X(),i=P(null);function o(){i.value.show()}function d(){i.value.hide()}function f(v){y("ok",v),d()}function x(){y("hide")}return Object.assign(u,{show:o,hide:d}),{dialogRef:i,onDialogHide:x,onDialogOK:f,onDialogCancel:d}}const ae=["ok","hide"];z.emits=ae;z.emitsObject=he(ae);const we={class:"text-h6 q-mb-md"},$e={class:"text-center upload-title"},De={key:1},Se={class:"text-h6 text-center q-mt-sm"},Fe={class:"text-bold"},Ie=B({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(y,{emit:u}){const i=y,o=u,d=O(),f=Z(),x=Qe(),{dialogRef:v}=z(),{isManager:C}=G(),$=P(!1),k=P(),e=P({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),g=new FormData;i.productData&&(e.value=i.productData);async function R(){try{let a=null;e.value?.id?a=f.updateProduct(e.value):(U(),a=await f.createProduct(g)),a&&(e.value.id=a.id,d.notify({color:"primary",message:"Успешно сохранено"}),o("refresh-data"))}catch(a){console.error(a)}}function A(){o("add-product",e.value)}function U(){e?.value?.id&&g.append("id",e.value.id.toString()),e.value?.name&&g.append("name",e.value.name),e.value?.price&&g.append("price",e.value.price.toString()),e.value?.category_id&&g.append("category_id",e.value.category_id.toString()),e.value?.qty&&g.append("qty",e.value.qty.toString()),e.value?.description&&g.append("description",e.value.description),e.value?.origin_country&&g.append("origin_country",e.value.origin_country)}function D(a){const t=new FileReader;t.readAsDataURL(a[0]),t.onload=()=>{},g.delete("images"),g.append("images",a[0]),e.value?.id&&c(a[0])}async function c(a){const t=new FormData;t.append("file",a),t.append("is_primary","true");try{await f.uploadFile(e.value.id,t)&&(l(),d.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(s){console.error(s)}finally{k.value&&k.value.reset()}}async function l(){try{const a=await f.fetchProductsById(e.value.id);e.value=a}catch(a){console.error(a)}}return(a,t)=>(m(),_(re,{ref_key:"dialogRef",ref:v,modelValue:$.value,"onUpdate:modelValue":t[10]||(t[10]=s=>$.value=s),persistent:""},{default:r(()=>[n(de,{class:"add-product"},{default:r(()=>[h(C)?(m(),_(E,{key:0,greedy:""},{default:r(()=>[n(N,null,{default:r(()=>[p("div",we,b(e.value.id?"Редактирование товара":"Добавление товара"),1),n(be,{ref_key:"uploaderRef",ref:k,color:"primary",flat:"","max-file-size":"15728640",onAdded:D,onRejected:t[0]||(t[0]=s=>h(Pe)(h(d)))},{header:r(()=>[...t[11]||(t[11]=[])]),list:r(()=>[n(xe),p("div",$e,[n(ie,{class:"q-mr-sm",name:"note_add",size:"24px"}),t[12]||(t[12]=p("span",null,"Загрузить картинку",-1))])]),_:1},512),p("div",null,[e.value?.images?.length?(m(),_(W,{key:0,images:e.value.images,onRefreshData:t[1]||(t[1]=s=>l())},null,8,["images"])):w("",!0)]),n(q,{modelValue:e.value.name,"onUpdate:modelValue":t[2]||(t[2]=s=>e.value.name=s),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),n(q,{modelValue:e.value.price,"onUpdate:modelValue":t[3]||(t[3]=s=>e.value.price=s),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),n(q,{modelValue:e.value.qty,"onUpdate:modelValue":t[4]||(t[4]=s=>e.value.qty=s),class:"q-mb-xs",outlined:"",label:"Количество",type:"number"},null,8,["modelValue"]),n(q,{modelValue:e.value.origin_country,"onUpdate:modelValue":t[5]||(t[5]=s=>e.value.origin_country=s),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),n(Ce,{modelValue:e.value.category_id,"onUpdate:modelValue":t[6]||(t[6]=s=>e.value.category_id=s),options:h(x).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),n(q,{modelValue:e.value.description,"onUpdate:modelValue":t[7]||(t[7]=s=>e.value.description=s),class:"q-mb-xs",outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),n(T,{align:"right"},{default:r(()=>[S(n(Q,{color:"red",label:"Отмена"},null,512),[[F]]),S(n(Q,{color:"primary",label:"Подтвердить",onClick:t[8]||(t[8]=s=>R())},null,512),[[F]])]),_:1})]),_:1})):(m(),_(E,{key:1},{default:r(()=>[n(N,null,{default:r(()=>[p("div",null,[e.value?.images?.length?(m(),_(W,{key:0,images:e.value.images},null,8,["images"])):(m(),I("div",De,[n(Y,{class:"q-mt-sm",src:h(J)("/card-shop.jpg")},null,8,["src"])]))]),p("div",Se,b(e.value.name),1),p("div",Fe,"Стоимость товара: "+b(e.value.price),1),p("div",null,"Страна происхождения: "+b(e.value.origin_country),1),p("div",null,"Описание: "+b(e.value.description),1)]),_:1}),n(T,{align:"right"},{default:r(()=>[S(n(Q,{color:"red",label:"Отмена"},null,512),[[F]]),S(n(Q,{color:"primary",label:"Добавить в корзину",onClick:t[9]||(t[9]=s=>A())},null,512),[[F]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),Re=ee(Ie,[["__scopeId","data-v-d1385f5f"]]),Ae={class:"product-card"},Ue={key:0,class:"text-grey old-price"},Le={class:"row items-end"},je={key:0,class:"q-mb-sm"},Be=B({__name:"ProductList",setup(y){const u=O(),i=ue(),o=Z(),{addToCart:d}=Ve(),{isManager:f,isAdmin:x}=G(),v=P(!1),C=P(!1),$=P();function k(){o.pagination.offset=0,e()}async function e(){try{u.loading.show();const c={limit:o.pagination.limit,offset:o.pagination.offset},l=await o.fetchProducts(c);l&&(o.pagination.total=l.total,o.pagination.has_more=l.has_more,o?.products?.length?o.products.push(l.items):o.products=l.items)}catch(c){console.error(c)}finally{u.loading.hide()}}function g(c){try{u.loading.show(),d(c)}catch(l){console.error(l)}finally{u.loading.hide()}}const R=async(c,l)=>{if(!o.pagination.has_more){v.value=!0,l(!0);return}await e(),o.pagination.offset+=o.pagination.limit,l()};function A(c){u.dialog({cancel:!0,message:"Вы уверенны что хотите удалить товар?",persistent:!0,title:"Удаление товара"}).onOk(()=>{U(c)})}async function U(c){try{if(!c?.id)return;await o.deleteProduct(c.id),u.loading.show()}catch(l){console.error(l)}finally{u.loading.hide()}}function D(c){i.push({name:"products-edit",params:{id:c.id}})}return(c,l)=>(m(),_(_e,{offset:250,onLoad:R},{default:r(()=>[h(f)?(m(),_(Q,{key:0,class:"full-width q-mb-sm",color:"green",label:"Добавить товар",onClick:l[0]||(l[0]=a=>h(i).push({name:"products-create"}))})):w("",!0),p("div",Ae,[(m(!0),I(pe,null,ce(h(o).products,(a,t)=>(m(),_(ye,{key:t},{default:r(()=>[n(ve,null,{default:r(()=>[n(L,{top:"",avatar:"",onClick:s=>D(a)},{default:r(()=>[n(Y,{class:"cursor-pointer radius-8",src:a.primary_image?a.primary_image:h(J)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),n(L,{class:"column justify-between",onClick:s=>D(a)},{default:r(()=>[n(j,{caption:"",class:"text-size-16"},{default:r(()=>[K(b(a.name),1)]),_:2},1024),n(j,null,{default:r(()=>[a?.old_price?(m(),I("div",Ue,b(a.old_price)+" ₽",1)):w("",!0),p("div",{class:me(a?.old_price?"text-red":"")},b(a.price)+" ₽",3)]),_:2},1024)]),_:2},1032,["onClick"]),n(L,{side:"",top:"",class:"column justify-between"},{default:r(()=>[l[3]||(l[3]=p("div",null,null,-1)),p("div",Le,[n(j,{class:"q-mr-xs",caption:""},{default:r(()=>[K(b(a.price)+" ₽/ "+b(a.unit_name),1)]),_:2},1024),p("div",null,[h(x)?(m(),I("div",je,[n(Q,{dense:"",round:"",color:"red",icon:"delete",onClick:s=>A(a)},null,8,["onClick"])])):w("",!0),p("div",null,[n(Q,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:s=>g(a)},null,8,["onClick"])])])])]),_:2},1024)]),_:2},1024),n(fe,{spaced:"",inset:""})]),_:2},1024))),128))]),C.value?(m(),_(Re,{key:1,modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=a=>C.value=a),productData:$.value,onRefreshData:l[2]||(l[2]=a=>k()),onAddProduct:g},null,8,["modelValue","productData"])):w("",!0)]),_:1}))}}),Oe=ee(Be,[["__scopeId","data-v-f8200ecf"]]),ia=B({__name:"DashboardPage",setup(y){const u=O(),i=ke();ge(()=>{o()});async function o(){try{u.loading.show();const d=await i.fetchAddresses();if(d){i.addresses=d;const f=d.find(x=>x.is_default===!0);i.addressId=f.id}}catch(d){console.error(d)}finally{u.loading.hide()}}return(d,f)=>(m(),_(qe,{class:"q-mx-xs"},{default:r(()=>[n(Oe,{class:"q-mb-lg"})]),_:1}))}});export{ia as default};
