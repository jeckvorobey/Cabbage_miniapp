import{Q as K}from"./QImg-xW095Ima.js";import{V as M,r as m,h as P,a4 as q,M as _,ac as W,$ as n,_ as e,a2 as z,a5 as j,a0 as L,N as u,Z as g,a1 as $,a9 as E,aj as X,aa as Y,ab as ee,S as N,u as se,e as B,ak as I,al as ae,a3 as le,L as S,a8 as v,am as te,a6 as oe}from"./index-lR2VyFMA.js";import{u as O,Q as ne}from"./addressesStore-D-ZCOP6D.js";import{Q as de,a as re,b as ie}from"./QItem-yTDSvijc.js";import{Q as R}from"./QSelect-BCHP3_Mp.js";import{u as T}from"./use-quasar-BpGytDB4.js";import{Q as ue}from"./QForm-BdEenjpN.js";import{C as me}from"./ClosePopup-DjQNiBEZ.js";import{r as ce,g as pe}from"./useUtils-DvRo9GAg.js";import{u as ve}from"./usersStore-DobJyiRO.js";import{_ as fe,a as ge,b as he,d as ye}from"./vue-yandex-maps-BRQ4TBwc.js";import"./QBtnGroup-CiM6LKsZ.js";import"./QMenu-voHclf0S.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const _e={class:"row q-pl-sm flex-center justify-between"},we={class:"text-grey-6"},Ve=M({__name:"AddAddressModal",props:{newAddress:{}},setup(D){const c=[[55.97,37.12],[56.02,37.33]],f=D,w=T(),h=O(),k=m(!0),V=m(),l=m({address_line:"",area_id:null,comment:"",is_default:!1}),b=m([]),p=m(!1),y=m("Начните вводить адрес...");P(async()=>{try{l.value=f.newAddress??{address_line:"",area_id:null,comment:"",is_default:!1},w.loading.show();const r=await h.fetchDeliveryZones();r&&(h.deliveryZones=r)}catch(r){console.error(r)}finally{w.loading.hide()}});async function x(){try{if(!l.value)return;await(l.value?.id?h.updateAddress:h.createAddress)(l.value)}catch(r){console.error(r)}finally{V.value?.hide()}}async function d(r,t){if(!r){y.value="Начните вводить адрес...",t(()=>{b.value=[]});return}const i=window.ymaps;if(!i){w.notify({message:"Сервис карт недоступен.",type:"negative"});return}p.value=!0;try{const Q=(await i.geocode(r,{boundedBy:c,results:5,strictBounds:!0})).geoObjects.toArray().map(C=>({coords:C.geometry.getCoordinates(),displayName:C.properties.get("text")}));t(()=>{b.value=Q,y.value=Q.length?"Выберите адрес из списка":"Адрес не найден"})}catch(A){console.error("Ошибка геокодирования:",A)}finally{p.value=!1}}return(r,t)=>(_(),q(W,{ref_key:"dialogRef",ref:V,modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=i=>k.value=i),persistent:""},{default:n(()=>[e(z,{class:""},{default:n(()=>[e(ue,{greedy:"",onSubmit:t[3]||(t[3]=i=>x())},{default:n(()=>[l.value?(_(),q(L,{key:0},{default:n(()=>[t[5]||(t[5]=u("div",{class:"text-h6"},"Создание нового адреса доставки",-1)),e(R,{modelValue:l.value.address_line,"onUpdate:modelValue":t[0]||(t[0]=i=>l.value.address_line=i),class:"q-mb-sm",clearable:"",outlined:"","use-input":"","input-debounce":"300",label:"Адрес доставки *",rules:[g(ce)],options:b.value,"option-label":"displayName","option-value":"displayName",loading:p.value,onFilter:d},{"no-option":n(()=>[u("div",_e,[u("div",we,$(y.value),1)])]),_:1},8,["modelValue","rules","options","loading"]),e(E,{modelValue:l.value.comment,"onUpdate:modelValue":t[1]||(t[1]=i=>l.value.comment=i),label:"Комментарий",outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"]),e(X,{modelValue:l.value.is_default,"onUpdate:modelValue":t[2]||(t[2]=i=>l.value.is_default=i),label:"Активный аддрес"},null,8,["modelValue"])]),_:1})):j("",!0),e(Y,{align:"right"},{default:n(()=>[ee(e(N,{color:"red",flat:"",label:"Отмена"},null,512),[[me]]),e(N,{color:"primary",flat:"",label:"Сохранить",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),be={class:"q-pa-sm"},ke={class:"justify-center row q-mb-md"},xe={class:"text-h5 justify-between q-mb-sm row"},Ae={class:"items-center"},Qe={class:"items-center"},Ce={key:0,class:"row items-center q-mb-sm text-h6"},$e={style:{height:"40px"},class:"col-10 content-center"},Se={key:1,class:"row items-center q-mb-sm"},qe={class:"row items-center q-mb-sm"},Fe=M({__name:"UserPage",setup(D){const c=T(),f=O(),w=ve(),h=se(),k=B(()=>I.isActive),V=ae({dark:"dark",light:"light"}),l=m(!1),b=B(()=>k.value?V.dark:V.light),p=m(!1),y=m("dark"),x=m(null),d=m({addres:null,full_name:"",mail:"",phone:""}),r=m(null);P(()=>{d.value=h.user,H()});function t(o){d.value.addres=o,console.log(d.value.addres),C(o)}function i(){r.value=null,p.value=!p.value}async function A(o){try{c.loading.show(),await f.deleteAddress(o.id)}catch(s){console.error(s)}finally{c.loading.hide()}}function Q(o){r.value=o,p.value=!p.value}async function C(o){try{c.loading.show(),await f.updateAddress(o)}catch(s){console.error(s)}finally{c.loading.hide()}}const Z=()=>{I.toggle(),window.localStorage.setItem("theme",b.value)};function F(){c.dialog({cancel:!0,message:"Вы уверенны что хотите изменить номер?",persistent:!0,title:"Смена номера телефона"}).onOk(()=>{G()})}async function G(){try{c.loading.show(),await w.updateMyPhone(d.value.phone)}catch(o){console.error(o)}finally{c.loading.hide()}}async function H(){try{c.loading.show();const o=await f.fetchAddresses();o&&(f.addresses=o)}catch(o){console.error(o)}finally{c.loading.hide()}}return(o,s)=>{const J=le("q-item-action");return _(),S("div",null,[s[10]||(s[10]=u("h6",{class:"text-center q-mb-md"},"Личный кабинет",-1)),u("div",be,[e(z,{class:"my-card full-height",flat:"",bordered:""},{default:n(()=>[e(L,null,{default:n(()=>[u("div",ke,[e(K,{class:"radius-100",height:"120px",width:"120px",src:d.value?.main_image_url?d.value.main_image_url:g(pe)("/card-shop.jpg")},null,8,["src"])]),u("div",xe,[u("div",null,$(d.value.full_name),1),u("div",null,[e(ne,{modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=a=>y.value=a),size:"sm","no-caps":"",unelevated:"",dense:"","toggle-color":"grey-9",color:"white","text-color":"grey-9",options:[{value:"dark",slot:"dark",title:"Dark mode"},{value:"light",slot:"light",title:"Light mode"}],onClick:s[1]||(s[1]=a=>Z())},{dark:n(()=>[u("div",Ae,[e(v,{name:"nightlight"})])]),light:n(()=>[u("div",Qe,[e(v,{name:"light_mode"})])]),_:1},8,["modelValue"])])]),!l.value&&d.value?.phone?(_(),S("div",Ce,[u("div",$e,$(d.value.phone),1),e(v,{name:"edit",size:"30px",color:"green",class:"col-2",onClick:s[2]||(s[2]=a=>l.value=!l.value)})])):(_(),S("div",Se,[e(v,{name:"close",size:"30px",color:"red",class:"col-1",onClick:s[3]||(s[3]=a=>l.value=!l.value)}),e(E,{modelValue:d.value.phone,"onUpdate:modelValue":s[4]||(s[4]=a=>d.value.phone=a),class:"col-9",dense:"",outlined:"",label:"Телефон",mask:"+# (###) ###-##-##",type:"tel"},null,8,["modelValue"]),e(v,{name:"save",size:"30px",color:"green",class:"col-2",onClick:s[5]||(s[5]=a=>F())})])),u("div",qe,[e(R,{modelValue:d.value.addres,"onUpdate:modelValue":s[6]||(s[6]=a=>d.value.addres=a),options:g(f).addresses,class:"col-10",dense:"",outlined:"",label:"Адрес","emit-value":"","map-options":"","option-label":"address_line","option-value":"id"},{option:n(a=>[e(de,te(a.itemProps,{class:"justify-between flex"}),{default:n(()=>[e(re,{onClick:U=>t(a.opt)},{default:n(()=>[e(ie,null,{default:n(()=>[oe($(a.opt.address_line),1)]),_:2},1024)]),_:2},1032,["onClick"]),e(J,null,{default:n(()=>[e(v,{class:"q-mr-sm",color:"red",name:"delete",size:"26px",onClick:U=>A(a.opt)},null,8,["onClick"]),e(v,{color:"green",name:"edit",size:"26px",onClick:U=>Q(a.opt)},null,8,["onClick"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),e(v,{name:"add",size:"34px",color:"green",class:"col-2",onClick:s[7]||(s[7]=a=>i())})])]),_:1})]),_:1})]),p.value?(_(),q(Ve,{key:0,modelValue:p.value,"onUpdate:modelValue":s[8]||(s[8]=a=>p.value=a),newAddress:r.value},null,8,["modelValue","newAddress"])):j("",!0),e(g(ye),{modelValue:x.value,"onUpdate:modelValue":s[9]||(s[9]=a=>x.value=a),settings:{location:{center:[37.617644,55.755819],zoom:9}},width:"100%",height:"500px"},{default:n(()=>[e(g(fe)),e(g(ge)),e(g(he),{settings:{coordinates:[37.617644,55.755819]}})]),_:1},8,["modelValue"])])}}});export{Fe as default};
