import{d as U,r as h,w as T,c as M,aj as w,ae as n,af as Q,aq as d,f as l,am as p,a6 as D,as as _,av as k,ak as V,ah as A,aB as E,ac as L,o as G,ad as c,aC as H}from"./index-DLgA12qk.js";import{u as $}from"./use-quasar-DlddhG2I.js";import{u as z}from"./productsStore-klrL2j5e.js";import{P as j}from"./ProductImgCarusel-2IHNjX9G.js";import{Q as J,a as K}from"./QUploader-D2802LZ6.js";import{Q as O}from"./QSelect-Bdne8yve.js";import{Q as W}from"./QForm-DMdHM7yp.js";import{u as X}from"./categoriesStore-DCuR6VQ9.js";import{r as I}from"./useUtils-DWiSHSOY.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Y}from"./usePermissionVisibility.hook-Bh9xFNUS.js";import{f as Z}from"./useCart-BaMITZyF.js";import"./format-CJebrXOQ.js";import"./QItem-C5Rh7Tk8.js";import"./QMenu-DfzM-Pfe.js";import"./rtl-DFPa-2ov.js";const ee={class:"text-h6 q-mb-md"},ae={class:"text-center upload-title"},te={class:"row justify-end"},oe=U({__name:"ProductForm",props:{product:{}},emits:["submit","refresh-data"],setup(R,{expose:F,emit:u}){const b=R,v=u,S=$(),f=z(),g=X(),y=h(),r=new FormData,e=h({...b.product});T(()=>b.product,i=>{e.value={...i}},{deep:!0});const q=M(()=>g.categories||[]);function o(){x(),v("submit",e.value,r)}function s(){v("refresh-data")}function x(){r.delete("id"),r.delete("name"),r.delete("price"),r.delete("category_id"),r.delete("qty"),r.delete("description"),r.delete("origin_country"),e.value?.id&&r.append("id",e.value.id.toString()),e.value?.name&&r.append("name",e.value.name),e.value?.price&&r.append("price",e.value.price.toString()),e.value?.category_id&&r.append("category_id",e.value.category_id.toString()),e.value?.qty&&r.append("qty",e.value.qty.toString()),e.value?.description&&r.append("description",e.value.description),e.value?.origin_country&&r.append("origin_country",e.value.origin_country)}function C(i){const t=new FileReader;t.readAsDataURL(i[0]),t.onload=()=>{},r.append("images",i[0]),e.value?.id&&P(i[0])}async function P(i){const t=new FormData;t.append("file",i),t.append("is_primary","true");try{await f.uploadFile(e.value.id,t)&&(s(),S.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(a){console.error(a)}finally{y.value&&y.value.reset()}}return F({generateFormData:x}),(i,t)=>(n(),w(W,{greedy:"",onSubmit:o},{default:Q(()=>[d("div",ee,p(i.product.id?"Редактирование товара":"Добавление товара"),1),l(J,{ref_key:"uploaderRef",ref:y,color:"primary",flat:"","max-file-size":"15728640",onAdded:C},{header:Q(()=>[...t[5]||(t[5]=[])]),list:Q(()=>[l(K),d("div",ae,[l(D,{class:"q-mr-sm",name:"note_add",size:"24px"}),t[6]||(t[6]=d("span",null,"Загрузить картинку",-1))])]),_:1},512),d("div",null,[i.product?.images?.length?(n(),w(j,{key:0,images:i.product.images,onRefreshData:s},null,8,["images"])):_("",!0)]),l(k,{modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.name=a),rules:[V(I)],class:"q-mb-xs",outlined:"",label:"Наименование товара *"},null,8,["modelValue","rules"]),l(k,{modelValue:e.value.price,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.price=a),rules:[V(I)],class:"q-mb-xs",outlined:"",label:"Стоимость товара *"},null,8,["modelValue","rules"]),l(k,{modelValue:e.value.origin_country,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.origin_country=a),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),l(O,{modelValue:e.value.category_id,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.category_id=a),rules:[V(I)],options:q.value,class:"q-mb-xs",outlined:"",label:"Категория *","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","rules","options"]),l(k,{modelValue:e.value.description,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.description=a),class:"q-mt-sm q-mb-sm",outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"]),d("div",te,[l(A,{color:"green",label:"Подтвердить",type:"submit"})])]),_:1}))}}),re=N(oe,[["__scopeId","data-v-6f5a475e"]]),se={class:"q-pa-md product"},ie={key:0},le={key:1},ne={class:"q-mb-sm"},de={key:0,class:"q-my-md"},ue={key:1,class:"text-grey old-price"},ce={key:2,class:"q-pa-md bg-light-gray radius-16"},me={class:"row justify-end"},pe={key:1,class:"row"},ve={class:"bg-green q-pa-xs radius-100"},fe={class:"q-mx-sm self-center"},ge={class:"bg-green q-pa-xs radius-100"},ye=U({__name:"ProductActionPage",emits:["refresh-data","add-product"],setup(R,{emit:F}){const u=$(),b=F,v=E(),S=L(),f=z(),g=h(),{isManager:y}=Y(),{addToCart:r,updateQuantity:e,getCartItem:q}=Z(),o=h({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),s=h([]);G(()=>{t()});function x(){try{u.loading.show(),r(o.value)&&o.value.id&&(s.value=q(o.value.id))}catch(a){console.error(a)}finally{u.loading.hide()}}function C(){if(s.value){const a=e(s.value,1);a?s.value=a:s.value=void 0}}function P(){if(s.value){const a=e(s.value,-1);a?s.value=a:s.value=void 0}}async function i(a,B){try{let m=null;a?.id?m=await f.updateProduct(a):(g.value&&g.value.generateFormData(),m=await f.createProduct(B)),m&&(o.value.id=m.id,u.notify({color:"primary",message:"Успешно сохранено"}),b("refresh-data"),S.back())}catch(m){console.error(m)}}async function t(){if(v?.params?.id)try{u.loading.show();const a=await f.fetchProductsById(+v.params.id);a&&(o.value=a,o.value.id&&(s.value=q(o.value.id)))}catch(a){console.error(a)}finally{u.loading.hide()}}return(a,B)=>(n(),c("div",se,[V(y)?(n(),c("div",ie,[l(re,{ref_key:"productFormRef",ref:g,product:o.value,onSubmit:i,onRefreshData:t},null,8,["product"])])):(n(),c("div",le,[o.value?.images?.length?(n(),w(j,{key:0,images:o.value.images},null,8,["images"])):_("",!0),d("div",ne,[o.value?.name?(n(),c("h6",de,p(o.value.name),1)):_("",!0),o.value?.old_price?(n(),c("div",ue,p(o.value.old_price)+" ₽",1)):_("",!0),d("div",{class:H(["text-bold text-18 q-mb-md",o.value?.old_price?"text-red":""])},p(o.value.price)+" ₽ ",3),o.value.description?(n(),c("div",ce,p(o.value.description),1)):_("",!0)]),d("div",me,[s.value?.id?(n(),c("div",pe,[d("div",ve,[l(D,{name:"remove",color:"white",size:"30px",onClick:P})]),d("span",fe,p(s.value.quantity),1),d("div",ge,[l(D,{name:"add",color:"white",size:"30px",onClick:C})])])):(n(),w(A,{key:0,color:"green",label:"Добавить в корзину",onClick:x}))])]))]))}}),Be=N(ye,[["__scopeId","data-v-9fee2380"]]);export{Be as default};
