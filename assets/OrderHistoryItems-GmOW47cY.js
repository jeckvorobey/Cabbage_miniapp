import{b as o,Q,a as f}from"./QItem-CvscSjwt.js";import{Q as E}from"./QList-CoJo7pCm.js";import{Q as F}from"./QBtnDropdown-CT4FJ4iT.js";import{C as $}from"./ClosePopup-Bsd5CNnU.js";import{d as B,u as W}from"./use-quasar-DyaPQ0f9.js";import{u as X}from"./orderStore-D6m0024p.js";import{b as Y,h as Z,V as M,r as S,X as p,Y as l,ad as j,Z as e,$ as t,a0 as J,aa as V,_ as g,a9 as h,a7 as O,a5 as u,a6 as i,a4 as A,Q as K,a8 as w,a1 as _,a2 as L,a3 as I,W as ee,al as te}from"./index-Dbv4EQ-c.js";import{Q as ae}from"./QBadge-CsV6K_VW.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";var C=(c=>(c.CREATED="created",c.ASSEMBLING="assembling",c.DELIVERING="delivering",c.COMPLETED="completed",c.CANCELLED="cancelled",c))(C||{});const se=Y({name:"QSpace",setup(){const c=Z("div",{class:"q-space"});return()=>c}}),le={class:"text-h6 q-mt-xs"},oe={class:"q-mb-sm"},ne={class:"row"},re={key:0,class:"text-italic text-grey"},ue={key:1,class:"text-italic text-grey"},ie={class:"col-12 col-md-4 text-right"},de={class:"text-h5 text-weight-bold text-green"},ce=M({__name:"OrderHistoryModal",props:{orderHistoryData:{},orderStatus:{}},setup(c){const x=c,b=S(!1);function v(d){const a=x.orderStatus.find(y=>y.value===d);return{color:a?.value===C.CANCELLED?"negative":"positive",label:a?.label||"-"}}return(d,a)=>(l(),p(j,{ref:"dialogRef",modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=m=>b.value=m),persistent:""},{default:e(()=>[t(J,{class:"order-history-modal"},{default:e(()=>[t(V,{class:"row items-center q-pb-xs q-pr-xs q-pt-xs"},{default:e(()=>[g("div",le,[t(o,null,{default:e(()=>[...a[1]||(a[1]=[u("Детали Заказа",-1)])]),_:1}),t(o,{caption:""},{default:e(()=>[u(i(A(B)(d.orderHistoryData.order_date)),1)]),_:1})]),t(se),d.orderHistoryData?.status?(l(),p(o,{key:0,class:"q-mr-sm"},{default:e(()=>[t(ae,{class:"q-pa-xs",color:v(d.orderHistoryData.status).color},{default:e(()=>[u(i(v(d.orderHistoryData.status).label),1)]),_:1},8,["color"])]),_:1})):h("",!0),O(t(K,{icon:"close",flat:"",round:"",dense:""},null,512),[[$]])]),_:1}),t(w),t(V,{class:"q-pt-none"},{default:e(()=>[g("div",oe,[t(E,null,{default:e(()=>[t(Q,{dense:"",class:"q-pa-none"},{default:e(()=>[t(f,null,{default:e(()=>[t(o,{caption:"",lines:"1"},{default:e(()=>[...a[2]||(a[2]=[u("Товар",-1)])]),_:1})]),_:1}),t(f,null,{default:e(()=>[t(o,{caption:"",lines:"1"},{default:e(()=>[...a[3]||(a[3]=[u("Кол.",-1)])]),_:1})]),_:1}),t(f,null,{default:e(()=>[t(o,{caption:"",lines:"1"},{default:e(()=>[...a[4]||(a[4]=[u("Цена",-1)])]),_:1})]),_:1})]),_:1}),(l(!0),_(L,null,I(d.orderHistoryData.items,(m,y)=>(l(),p(Q,{key:y,dense:"",class:"q-pa-none"},{default:e(()=>[t(f,null,{default:e(()=>[t(o,null,{default:e(()=>[u(i(m?.name||"-"),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:e(()=>[t(o,null,{default:e(()=>[u(i(m?.quantity),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:e(()=>[t(o,null,{default:e(()=>[u(i(m?.price)+" ₽",1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(w)]),g("div",ne,[g("div",null,[d.orderHistoryData.comment?(l(),_("div",re,"Комментарий: "+i(d.orderHistoryData.comment),1)):(l(),_("div",ue,"Комментарий отсутствует."))]),g("div",ie,[a[5]||(a[5]=g("div",{class:"text-subtitle1 text-weight-medium"},"Итого:",-1)),g("div",de,i(d.orderHistoryData.total_amount)+" ₽",1)])])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),me=R(ce,[["__scopeId","data-v-7926bdba"]]),fe={class:"order-history"},pe=["href"],_e={key:1},ve=M({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},emits:["refresh"],setup(c,{emit:x}){const b=x,v=W(),d=X(),a=S(!1),m=S(),y=[{label:"создан",value:C.CREATED},{label:"собирается",value:C.ASSEMBLING},{label:"в пути",value:C.DELIVERING},{label:"завершён",value:C.COMPLETED},{label:"отменён",value:C.CANCELLED}];function T(n,r){v.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{U(n,r)})}async function U(n,r){try{v.loading.show(),await d.updateOrderStatus(n,r)&&(v.notify({color:"primary",message:"Статус успешно изменен"}),b("refresh"))}catch(D){console.error(D)}finally{v.loading.hide()}}function G(n){return y.find(D=>D.value===n)?.label}function q(n){const r=n.username?.trim().replace(/^@/,"");return r?`https://t.me/${encodeURIComponent(r)}`:null}function N(n){if(!n.phone)return null;const r=n.phone.trim();return r.length?r:null}function H(n){m.value=n,a.value=!a.value}return(n,r)=>{const D=ee("q-item-action");return l(),_("div",fe,[t(E,null,{default:e(()=>[(l(!0),_(L,null,I(n.orderData,(s,P)=>(l(),p(Q,{key:s.id??P,class:te(["border-bot",s.is_paid?"light-red":"light-green"])},{default:e(()=>[t(f,{onClick:k=>H(s)},{default:e(()=>[N(s.user)?(l(),p(o,{key:0,caption:"",class:"text-10"},{default:e(()=>[u(i(N(s.user)),1)]),_:2},1024)):h("",!0),t(o,null,{default:e(()=>[q(s.user)?(l(),_("a",{key:0,href:q(s.user),target:"_blank",rel:"noopener noreferrer",class:"text-primary text-decoration-none"},i(s.user.full_name),9,pe)):(l(),_("span",_e,i(s.user.full_name),1))]),_:2},1024)]),_:2},1032,["onClick"]),t(f,{onClick:k=>H(s)},{default:e(()=>[t(o,{caption:"",class:"text-10"},{default:e(()=>[u(i(A(B)(s.order_date)),1)]),_:2},1024),t(o,null,{default:e(()=>[u(i(G(s.status)),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(f,{onClick:k=>H(s)},{default:e(()=>[t(o,{caption:"",class:"text-10"},{default:e(()=>[...r[1]||(r[1]=[u("Общая сумма",-1)])]),_:1}),t(o,null,{default:e(()=>[u(i(s.total_amount),1)]),_:2},1024)]),_:2},1032,["onClick"]),n.adminMode?(l(),p(D,{key:0},{default:e(()=>[t(F,{size:"10px",color:"green",dense:""},{default:e(()=>[(l(),_(L,null,I(y,(k,z)=>t(E,{key:z},{default:e(()=>[O((l(),p(Q,{clickable:"",onClick:ye=>T(s.id,k.value)},{default:e(()=>[t(f,null,{default:e(()=>[t(o,null,{default:e(()=>[u(i(k.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[$]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):h("",!0)]),_:2},1032,["class"]))),128))]),_:1}),a.value&&m.value?(l(),p(me,{key:0,modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=s=>a.value=s),orderHistoryData:m.value,orderStatus:y},null,8,["modelValue","orderHistoryData"])):h("",!0)])}}}),Ee=R(ve,[["__scopeId","data-v-230fbece"]]);export{Ee as O};
