import{Q as W}from"./QImg-RMZdJMEm.js";import{aM as X,r as p,aN as w,d as I,o as M,ah as Q,ac as A,aC as Y,ad as i,f as e,aF as P,ap as z,aD as B,ao as m,ai as k,as as C,aO as ee,aE as se,U as te,af as q,u as ae,c as $,aB as U,at as le,aq as oe,ab as b,ak as x,a4 as g,aA as de,aj as ne}from"./index-8MdLOqeh.js";import{Q as re}from"./QBtnToggle-BTamFARA.js";import{Q as ie,a as ue,b as ce}from"./QItem-DjKE1Hlo.js";import{Q as N}from"./QSelect-DZ4BOxqm.js";import{u as j}from"./use-quasar-D2HNf42d.js";import{Q as me}from"./QForm-CNvpgfc8.js";import{C as ve}from"./ClosePopup-CEHjpygQ.js";import{r as D,g as pe}from"./useUtils-pFXNg6ez.js";import{u as fe}from"./usersStore-D1BSrEsY.js";import"./QBtnGroup-D6B0R9hW.js";import"./QMenu-CkDp_7xx.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const Z=X("Addresses",()=>{const V=p(),r=p();async function v(){return w.get("addresses").then(t=>t.data).catch(t=>{throw console.error("[AddressesStore] - An error occurred while fetching via fetchAddresses",t.message),t})}async function f(t){return w.post("addresses",t).then(a=>a.data).catch(a=>{throw console.error("[AddressesStore] - An error occurred while createing via createAddress",a.message),a})}async function h(t){return w.patch(`/addresses/${t.id}`,t).then(a=>a.data).catch(a=>{throw console.error("[AddressesStore] - An error occurred while creating via updateAddress",a.message),a})}async function y(t){return w.delete(`addresses/${t}`).then(a=>a.data).catch(a=>{throw console.error("[AddressesStore] - An error occurred while deleting via deleteAddress",a.message),a})}async function o(){return w.get("delivery-zones").then(t=>t.data).catch(t=>{throw console.error("[AddressesStore] - An error occurred while fetching via fetchAddresses",t.message),t})}return{addresses:V,deliveryZones:r,fetchAddresses:v,createAddress:f,updateAddress:h,deleteAddress:y,fetchDeliveryZones:o}}),ge=I({__name:"AddAddressModal",props:{newAddress:{}},setup(V){const r=V,v=j(),f=Z(),h=p(!0),y=p(),o=p();M(async()=>{try{const a={area_id:null,address_line:"",comment:"",is_default:!1};r.newAddress?o.value=r.newAddress:o.value=a,v.loading.show();const s=await f.fetchDeliveryZones();s&&(f.deliveryZones=s)}catch(a){console.error(a)}finally{v.loading.hide()}});async function t(){try{await(o?.value?.id?f.updateAddress:f.createAddress)(o.value)}catch(a){console.error(a)}finally{y.value.hide()}}return(a,s)=>(A(),Q(Y,{ref_key:"dialogRef",ref:y,modelValue:h.value,"onUpdate:modelValue":s[5]||(s[5]=u=>h.value=u),persistent:""},{default:i(()=>[e(P,{class:""},{default:i(()=>[e(me,{greedy:"",onSubmit:s[4]||(s[4]=u=>t())},{default:i(()=>[o.value?(A(),Q(B,{key:0},{default:i(()=>[s[6]||(s[6]=m("div",{class:"text-h6"},"Создание нового адреса доставки",-1)),e(N,{modelValue:o.value.area_id,"onUpdate:modelValue":s[0]||(s[0]=u=>o.value.area_id=u),options:k(f).deliveryZones,class:"q-mb-xs",outlined:"",label:"Зона доставки *","emit-value":"","map-options":"","option-label":"title","option-value":"id",rules:[k(D)]},null,8,["modelValue","options","rules"]),e(C,{class:"q-mb-sm",outlined:"",modelValue:o.value.address_line,"onUpdate:modelValue":s[1]||(s[1]=u=>o.value.address_line=u),label:"Адрес *",rules:[k(D)]},null,8,["modelValue","rules"]),e(C,{label:"Комментарий",modelValue:o.value.comment,"onUpdate:modelValue":s[2]||(s[2]=u=>o.value.comment=u),outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"]),e(ee,{modelValue:o.value.is_default,"onUpdate:modelValue":s[3]||(s[3]=u=>o.value.is_default=u),label:"Активный аддрес"},null,8,["modelValue"])]),_:1})):z("",!0),e(se,{align:"right"},{default:i(()=>[te(e(q,{color:"red",flat:"",label:"Отмена"},null,512),[[ve]]),e(q,{color:"primary",flat:"",label:"Сохранить",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),he={class:"q-pa-sm"},ye={class:"justify-center row q-mb-md"},Ae={class:"text-h5 justify-between q-mb-sm row"},we={class:"items-center"},ke={class:"items-center"},Ve={key:0,class:"row items-center q-mb-sm text-h6"},_e={style:{height:"40px"},class:"col-10 content-center"},be={key:1,class:"row items-center q-mb-sm"},xe={class:"row items-center q-mb-sm"},Ze=I({__name:"UserPage",setup(V){const r=j(),v=Z(),f=fe(),h=ae(),y=$(()=>U.isActive),o=le({dark:"dark",light:"light"}),t=p(!1),a=$(()=>y.value?o.dark:o.light),s=p(!1),u=p("dark"),c=p({full_name:"",mail:"",phone:"",addres:null}),_=p();M(()=>{c.value=h.user,J()});function T(n){c.value.addres=n,console.log(c.value.addres),L(n)}function R(){_.value=null,s.value=!s.value}async function E(n){try{r.loading.show(),await v.deleteAddress(n.id)}catch(l){console.error(l)}finally{r.loading.hide()}}function F(n){_.value=n,s.value=!s.value}async function L(n){try{r.loading.show(),await v.updateAddress(n)}catch(l){console.error(l)}finally{r.loading.hide()}}const O=()=>{U.toggle(),window.localStorage.setItem("theme",a.value)};function G(){r.dialog({title:"Смена номера телефона",message:"Вы уверенны что хотите изменить номер?",cancel:!0,persistent:!0}).onOk(()=>{H()})}async function H(){try{r.loading.show(),await f.updateMyPhone(c.value.phone)}catch(n){console.error(n)}finally{r.loading.hide()}}async function J(){try{r.loading.show();const n=await v.fetchAddresses();n&&(v.addresses=n)}catch(n){console.error(n)}finally{r.loading.hide()}}return(n,l)=>{const K=oe("q-item-action");return A(),b("div",null,[l[9]||(l[9]=m("h6",{class:"text-center q-mb-md"},"Личный кабинет",-1)),m("div",he,[e(P,{class:"my-card full-height",flat:"",bordered:""},{default:i(()=>[e(B,null,{default:i(()=>[m("div",ye,[e(W,{class:"radius-100",height:"120px",width:"120px",src:c.value?.main_image_url?c.value.main_image_url:k(pe)("/card-shop.jpg")},null,8,["src"])]),m("div",Ae,[m("div",null,x(c.value.full_name),1),m("div",null,[e(re,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=d=>u.value=d),size:"sm","no-caps":"",unelevated:"",dense:"","toggle-color":"grey-9",color:"white","text-color":"grey-9",options:[{value:"dark",slot:"dark",title:"Dark mode"},{value:"light",slot:"light",title:"Light mode"}],onClick:l[1]||(l[1]=d=>O())},{dark:i(()=>[m("div",we,[e(g,{name:"nightlight"})])]),light:i(()=>[m("div",ke,[e(g,{name:"light_mode"})])]),_:1},8,["modelValue"])])]),!t.value&&c.value?.phone?(A(),b("div",Ve,[m("div",_e,x(c.value.phone),1),e(g,{onClick:l[2]||(l[2]=d=>t.value=!t.value),name:"edit",size:"30px",color:"green",class:"col-2"})])):(A(),b("div",be,[e(g,{onClick:l[3]||(l[3]=d=>t.value=!t.value),name:"close",size:"30px",color:"red",class:"col-1"}),e(C,{class:"col-9",dense:"",outlined:"",modelValue:c.value.phone,"onUpdate:modelValue":l[4]||(l[4]=d=>c.value.phone=d),label:"Телефон",mask:"+# (###) ###-##-##",type:"tel"},null,8,["modelValue"]),e(g,{onClick:l[5]||(l[5]=d=>G()),name:"save",size:"30px",color:"green",class:"col-2"})])),m("div",xe,[e(N,{modelValue:c.value.addres,"onUpdate:modelValue":l[6]||(l[6]=d=>c.value.addres=d),options:k(v).addresses,class:"col-10",dense:"",outlined:"",label:"Адрес","emit-value":"","map-options":"","option-label":"address_line","option-value":"id"},{option:i(d=>[e(ie,de(d.itemProps,{class:"justify-between flex"}),{default:i(()=>[e(ue,{onClick:S=>T(d.opt)},{default:i(()=>[e(ce,null,{default:i(()=>[ne(x(d.opt.address_line),1)]),_:2},1024)]),_:2},1032,["onClick"]),e(K,null,{default:i(()=>[e(g,{class:"q-mr-sm",color:"red",name:"delete",size:"26px",onClick:S=>E(d.opt)},null,8,["onClick"]),e(g,{color:"green",name:"edit",size:"26px",onClick:S=>F(d.opt)},null,8,["onClick"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),e(g,{onClick:l[7]||(l[7]=d=>R()),name:"add",size:"34px",color:"green",class:"col-2"})])]),_:1})]),_:1})]),s.value?(A(),Q(ge,{key:0,modelValue:s.value,"onUpdate:modelValue":l[8]||(l[8]=d=>s.value=d),newAddress:_.value},null,8,["modelValue","newAddress"])):z("",!0)])}}});export{Ze as default};
