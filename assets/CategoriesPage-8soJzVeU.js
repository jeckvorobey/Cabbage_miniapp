import{d as M,u as N,c as j,r as f,ac as P,ad as C,ae as d,ak as m,f as a,af as g,ag as v,ai as i,av as c,aj as o,F as z,am as E,aw as b,al as Q,a7 as T,aF as x,aD as V,a9 as O,aB as q,aE as G,U as H,aC as J}from"./index-Djkm3zme.js";import{Q as K,b as W,a as h}from"./QItem-Cjcxivxx.js";import{Q as X}from"./QList-BgzL8v1z.js";import{Q as Y,a as Z}from"./QUploader-Dh4MaUNy.js";import{Q as ee}from"./QImg-GnK-wHK0.js";import{Q as ae}from"./QForm-zIXkxfsE.js";import{C as te}from"./ClosePopup-DqIBm_1M.js";import{u as oe}from"./use-quasar-CcK_rPTO.js";import{f as le,r as re}from"./useUtils-DqW0zkjO.js";import{u as ie}from"./categoriesStore-BLEC_anc.js";import{u as se}from"./usePermissionVisibility.hook-j3cw2fap.js";import"./format-CJebrXOQ.js";const ne={class:"q-mx-md"},de={class:"text-h6"},ue={class:"text-center upload-title"},me={key:0,class:"flex justify-center q-mb-md"},Ve=M({__name:"CategoriesPage",setup(ce){const s=oe(),S=N(),u=ie(),{isManager:_,isAdmin:y}=se(j(()=>S.user)),w=f(),p=f(!1),F=f({name:"",parent_id:null,description:""}),t=f({id:null,name:"",parent_id:null,description:"",image:""}),n=new FormData;function D(){t?.value?.id&&n.append("id",t.value.id.toString()),t.value?.name&&n.append("name",t.value.name),t.value?.parent_id&&n.append("price",t.value.parent_id.toString()),t.value?.description&&n.append("category_id",t.value.description.toString())}function k(l){l?.id?t.value=l:t.value=F.value,p.value=!p.value}function I(l){const e=new FileReader;e.readAsDataURL(l[0]),e.onload=()=>{t.value.image=e.result},n.delete("image"),n.append("image",l[0])}function R(l){s.dialog({title:"Удаление категорию",message:"Вы уверенны что хотите удалить категорию?",cancel:!0,persistent:!0}).onOk(()=>{U(l)})}async function U(l){try{s.loading.show(),await u.deleteCategorie(l)}catch(e){console.error(e)}finally{await u.fetchCategories(),s.loading.hide()}}async function A(){try{if(D(),s.loading.show(),!t.value)return;await(t.value.id?u.updateCategorie:u.createCategories)(n)&&(await u.fetchCategories(),s.notify({message:"Категория успешно добавлена",color:"primary"}))}catch(l){console.error(l)}finally{w.value.hide(),s.loading.hide()}}return(l,e)=>{const B=P("q-item-action");return d(),C("div",null,[m("div",ne,[i(_)||i(y)?(d(),g(c,{key:0,onClick:e[0]||(e[0]=r=>k()),class:"full-width q-mb-sm",color:"green",label:"Добавление категории"})):v("",!0)]),e[8]||(e[8]=m("h6",{class:"text-center q-mt-md q-mb-md"},"Категории",-1)),a(x,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:o(()=>[(d(!0),C(z,null,E(i(u).categories,(r,$)=>(d(),g(X,{key:$},{default:o(()=>[a(K,null,{default:o(()=>[a(W,null,{default:o(()=>[a(h,null,{default:o(()=>[b(Q(r.name),1)]),_:2},1024),a(h,{caption:""},{default:o(()=>[b(Q(r.description),1)]),_:2},1024)]),_:2},1024),a(B,null,{default:o(()=>[i(y)?(d(),g(c,{key:0,flat:"",round:"",color:"red",icon:"delete",onClick:L=>R(r.id)},null,8,["onClick"])):v("",!0),i(_)||i(y)?(d(),g(c,{key:1,flat:"",round:"",color:"secondary",icon:"mode_edit",onClick:L=>k(r)},null,8,["onClick"])):v("",!0)]),_:2},1024)]),_:2},1024),a(T)]),_:2},1024))),128))]),_:1}),a(J,{ref_key:"dialogRef",ref:w,modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=r=>p.value=r)},{default:o(()=>[a(x,{style:{"min-width":"90svw"}},{default:o(()=>[a(ae,{greedy:"",onSubmit:e[4]||(e[4]=r=>A())},{default:o(()=>[a(V,null,{default:o(()=>[m("div",de,Q(t.value.id?"Редактировать категорию":"Добавить категорию"),1)]),_:1}),a(V,{class:"q-pt-none"},{default:o(()=>[a(Y,{ref:"uploaderRef",color:"primary",flat:"","max-file-size":"15728640",onAdded:I,onRejected:e[1]||(e[1]=r=>i(le)(i(s)))},{header:o(()=>[...e[6]||(e[6]=[])]),list:o(()=>[a(Z),m("div",ue,[a(O,{class:"q-mr-sm",name:"note_add",size:"24px"}),e[7]||(e[7]=m("span",null,"Загрузить картинку",-1))])]),_:1},512),t.value.image?(d(),C("div",me,[a(ee,{class:"cursor-pointer radius-8",src:t.value.image,height:"120px",width:"120px",fit:"cover"},null,8,["src"])])):v("",!0),a(q,{rules:[i(re)],modelValue:t.value.name,"onUpdate:modelValue":e[2]||(e[2]=r=>t.value.name=r),class:"q-mb-xs",outlined:"",label:"Наиминование категории *"},null,8,["rules","modelValue"]),a(q,{class:"q-mt-sm",modelValue:t.value.description,"onUpdate:modelValue":e[3]||(e[3]=r=>t.value.description=r),filled:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),a(G,{align:"right"},{default:o(()=>[H(a(c,{flat:"",label:"Отмена",color:"negative"},null,512),[[te]]),a(c,{flat:"",label:"Подтвердить",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{Ve as default};
