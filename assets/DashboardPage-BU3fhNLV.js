import{b as ae,i as E,O,bh as P,bm as te,bn as oe,e as z,k as ne,m as le,r as Q,V as A,a4 as h,M as c,ac as re,$ as l,_ as o,Z as b,a0 as M,N as g,a1 as x,a8 as se,a5 as R,a9 as S,aa as N,ab as F,S as k,L as j,a2 as ie,W as ue,Y as de,X as ce,a6 as pe,ai as me,a7 as fe}from"./index-lR2VyFMA.js";import{Q as W}from"./QImg-xW095Ima.js";import{Q as ge,a as U,b as H}from"./QItem-yTDSvijc.js";import{Q as ve}from"./QList-CfBeZ910.js";import{Q as ye}from"./QInfiniteScroll-Ca1hDXi3.js";import{u as X}from"./productsStore-C0fYsaLf.js";import{u as Y}from"./use-quasar-BpGytDB4.js";import{g as _e,Q as he,a as be}from"./QUploader-BhA2irR-.js";import{Q as xe}from"./QSelect-BCHP3_Mp.js";import{Q as K}from"./QForm-BdEenjpN.js";import{C as I}from"./ClosePopup-DjQNiBEZ.js";import{u as Z}from"./usePermissionVisibility.hook-D3EpKoy2.js";import{P as T}from"./ProductImgCarusel-BMPn5lA_.js";import{u as Ce}from"./categoriesStore-Cy3lBI3q.js";import{f as Qe,g as G}from"./useUtils-DvRo9GAg.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ve}from"./useCart-DN6YZeCZ.js";import"./format-CJebrXOQ.js";import"./QMenu-voHclf0S.js";import"./rtl-DFPa-2ov.js";const Pe=ae({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(v,{slots:m}){const{proxy:{$q:u}}=E(),t=O(te,P);if(t===P)return console.error("QPage needs to be a deep child of QLayout"),P;if(O(oe,P)===P)return console.error("QPage needs to be child of QPageContainer"),P;const _=z(()=>{const d=(t.header.space===!0?t.header.size:0)+(t.footer.space===!0?t.footer.size:0);if(typeof v.styleFn=="function"){const D=t.isContainer.value===!0?t.containerHeight.value:u.screen.height;return v.styleFn(d,D)}return{minHeight:t.isContainer.value===!0?t.containerHeight.value-d+"px":u.screen.height===0?d!==0?`calc(100vh - ${d}px)`:"100vh":u.screen.height-d+"px"}}),C=z(()=>`q-page${v.padding===!0?" q-layout-padding":""}`);return()=>ne("main",{class:C.value,style:_.value},le(m.default))}});function B(){const{emit:v,proxy:m}=E(),u=Q(null);function t(){u.value.show()}function y(){u.value.hide()}function _(d){v("ok",d),y()}function C(){v("hide")}return Object.assign(m,{show:t,hide:y}),{dialogRef:u,onDialogHide:C,onDialogOK:_,onDialogCancel:y}}const ee=["ok","hide"];B.emits=ee;B.emitsObject=_e(ee);const ke={class:"text-h6 q-mb-md"},De={class:"text-center upload-title"},$e={key:1},we={class:"text-h6 text-center q-mt-sm"},qe={class:"text-bold"},Se=A({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(v,{emit:m}){const u=v,t=m,y=Y(),_=X(),C=Ce(),{dialogRef:d}=B(),{isManager:D}=Z(),w=Q(!1),V=Q(),e=Q({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),p=new FormData;u.productData&&(e.value=u.productData);async function q(){try{let s=null;e.value?.id?s=_.updateProduct(e.value):(n(),s=await _.createProduct(p)),s&&(e.value.id=s.id,y.notify({color:"primary",message:"Успешно сохранено"}),t("refresh-data"))}catch(s){console.error(s)}}function f(){t("add-product",e.value)}function n(){e?.value?.id&&p.append("id",e.value.id.toString()),e.value?.name&&p.append("name",e.value.name),e.value?.price&&p.append("price",e.value.price.toString()),e.value?.category_id&&p.append("category_id",e.value.category_id.toString()),e.value?.qty&&p.append("qty",e.value.qty.toString()),e.value?.description&&p.append("description",e.value.description),e.value?.origin_country&&p.append("origin_country",e.value.origin_country)}function i(s){const a=new FileReader;a.readAsDataURL(s[0]),a.onload=()=>{},p.delete("images"),p.append("images",s[0]),e.value?.id&&L(s[0])}async function L(s){const a=new FormData;a.append("file",s),a.append("is_primary","true");try{await _.uploadFile(e.value.id,a)&&($(),y.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(r){console.error(r)}finally{V.value&&V.value.reset()}}async function $(){try{const s=await _.fetchProductsById(e.value.id);e.value=s}catch(s){console.error(s)}}return(s,a)=>(c(),h(re,{ref_key:"dialogRef",ref:d,modelValue:w.value,"onUpdate:modelValue":a[9]||(a[9]=r=>w.value=r),persistent:""},{default:l(()=>[o(ie,{class:"add-product"},{default:l(()=>[b(D)?(c(),h(K,{key:0,greedy:""},{default:l(()=>[o(M,null,{default:l(()=>[g("div",ke,x(e.value.id?"Редактирование товара":"Добавление товара"),1),o(he,{ref_key:"uploaderRef",ref:V,color:"primary",flat:"","max-file-size":"15728640",onAdded:i,onRejected:a[0]||(a[0]=r=>b(Qe)(b(y)))},{header:l(()=>[...a[10]||(a[10]=[])]),list:l(()=>[o(be),g("div",De,[o(se,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[11]||(a[11]=g("span",null,"Загрузить картинку",-1))])]),_:1},512),g("div",null,[e.value?.images?.length?(c(),h(T,{key:0,images:e.value.images,onRefreshData:a[1]||(a[1]=r=>$())},null,8,["images"])):R("",!0)]),o(S,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=r=>e.value.name=r),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),o(S,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=r=>e.value.price=r),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),o(S,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[4]||(a[4]=r=>e.value.origin_country=r),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),o(xe,{modelValue:e.value.category_id,"onUpdate:modelValue":a[5]||(a[5]=r=>e.value.category_id=r),options:b(C).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),o(S,{modelValue:e.value.description,"onUpdate:modelValue":a[6]||(a[6]=r=>e.value.description=r),class:"q-mt-sm",outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),o(N,{align:"right"},{default:l(()=>[F(o(k,{color:"red",label:"Отмена"},null,512),[[I]]),F(o(k,{color:"primary",label:"Подтвердить",onClick:a[7]||(a[7]=r=>q())},null,512),[[I]])]),_:1})]),_:1})):(c(),h(K,{key:1},{default:l(()=>[o(M,null,{default:l(()=>[g("div",null,[e.value?.images?.length?(c(),h(T,{key:0,images:e.value.images},null,8,["images"])):(c(),j("div",$e,[o(W,{class:"q-mt-sm",src:b(G)("/card-shop.jpg")},null,8,["src"])]))]),g("div",we,x(e.value.name),1),g("div",qe,"Стоимость товара: "+x(e.value.price),1),g("div",null,"Страна происхождения: "+x(e.value.origin_country),1),g("div",null,"Описание: "+x(e.value.description),1)]),_:1}),o(N,{align:"right"},{default:l(()=>[F(o(k,{color:"red",label:"Отмена"},null,512),[[I]]),F(o(k,{color:"primary",label:"Добавить в корзину",onClick:a[8]||(a[8]=r=>f())},null,512),[[I]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),Fe=J(Se,[["__scopeId","data-v-2d8637e0"]]),Ie={class:"product-card"},Re={key:0,class:"text-grey old-price"},Le=A({__name:"ProductList",setup(v){const m=Y(),u=ue(),t=X(),{isManager:y}=Z(),{addToCart:_}=Ve(),C=Q(!1),d=Q(!1),D=Q();function w(){t.pagination.offset=0,V()}async function V(){try{m.loading.show();const f={limit:t.pagination.limit,offset:t.pagination.offset},n=await t.fetchProducts(f);n&&(t.pagination.total=n.total,t.pagination.has_more=n.has_more,t?.products?.length?t.products.push(n.items):t.products=n.items)}catch(f){console.error(f)}finally{m.loading.hide()}}function e(f){try{m.loading.show(),_(f)}catch(n){console.error(n)}finally{m.loading.hide()}}const p=async(f,n)=>{if(!t.pagination.has_more){C.value=!0,n(!0);return}await V(),t.pagination.offset+=t.pagination.limit,n()};function q(f){u.push({name:"products-edit",params:{id:f.id}})}return(f,n)=>(c(),h(ye,{offset:250,onLoad:p},{default:l(()=>[b(y)?(c(),h(k,{key:0,class:"full-width q-mb-sm",color:"green",label:"Добавить товар",onClick:n[0]||(n[0]=i=>b(u).push({name:"products-create"}))})):R("",!0),g("div",Ie,[(c(!0),j(ce,null,de(b(t).products,(i,L)=>(c(),h(ve,{key:L},{default:l(()=>[o(ge,null,{default:l(()=>[o(U,{top:"",avatar:"",onClick:$=>q(i)},{default:l(()=>[o(W,{class:"cursor-pointer radius-8",src:i[0]?.primary_image?i[0].primary_image:b(G)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),o(U,{class:"column justify-between",onClick:$=>q(i)},{default:l(()=>[o(H,{caption:"",class:"text-size-16"},{default:l(()=>[pe(x(i.name),1)]),_:2},1024),o(H,null,{default:l(()=>[i?.old_price?(c(),j("div",Re,x(i.old_price)+" ₽",1)):R("",!0),g("div",{class:me(i?.old_price?"text-red":"")},x(i.price)+" ₽",3)]),_:2},1024)]),_:2},1032,["onClick"]),o(U,{side:"",class:"column justify-between"},{default:l(()=>[o(k,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:$=>e(i)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),o(fe,{spaced:"",inset:""})]),_:2},1024))),128))]),d.value?(c(),h(Fe,{key:1,modelValue:d.value,"onUpdate:modelValue":n[1]||(n[1]=i=>d.value=i),productData:D.value,onRefreshData:n[2]||(n[2]=i=>w()),onAddProduct:e},null,8,["modelValue","productData"])):R("",!0)]),_:1}))}}),Ue=J(Le,[["__scopeId","data-v-0b468d4a"]]),oa=A({__name:"DashboardPage",setup(v){return(m,u)=>(c(),h(Pe,{class:"q-mx-xs"},{default:l(()=>[o(Ue,{class:"q-mb-lg"})]),_:1}))}});export{oa as default};
