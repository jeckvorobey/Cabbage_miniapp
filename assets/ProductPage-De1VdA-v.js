import{a as M,Q as E}from"./QUploader-D06tUKxt.js";import{d as G,ab as J,aa as T,u as H,r as b,c as K,o as W,ad as d,ae as n,ai as p,ak as i,f as l,al as u,aj as w,a9 as V,af as x,ag as c,aB as v,U as S,av as h,ah as X,aG as P}from"./index-B6Ss7_sK.js";import{Q as C}from"./QSelect-C4qQeSvC.js";import{C as U}from"./ClosePopup-B5aMjGFf.js";import{u as Y}from"./use-quasar-D4lwK1bb.js";import{u as Z}from"./productsStore-BtE0-URt.js";import{P as D}from"./ProductImgCarusel-CxnIVPqL.js";import{u as ee}from"./usePermissionVisibility.hook-BWCC8YOp.js";import{u as ae}from"./categoriesStore-B9Gj0qU1.js";import{u as oe}from"./unitsStore-BOzLf7c9.js";import{e as te}from"./orderStore-3aggBZDc.js";import{f as le}from"./useUtils-BlK2jOMY.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./format-CJebrXOQ.js";import"./QItem-DtXzaPRO.js";import"./QMenu-Az2G3t3g.js";import"./rtl-DFPa-2ov.js";const se={class:"q-pa-md product"},ne={key:0},re={class:"text-h6 q-mb-md"},de={class:"text-center upload-title"},ue={class:"row justify-end"},me={key:1},pe={class:"q-mb-sm"},ce={key:0,class:"q-my-md"},ve={key:1,class:"text-grey old-price"},fe={key:2,class:"q-pa-md bg-light-gray radius-16"},ge={class:"row justify-end"},ye={key:1,class:"row"},_e={class:"bg-green q-pa-xs radius-100"},be={class:"q-mx-sm self-center"},Ve={class:"bg-green q-pa-xs radius-100"},xe=G({__name:"ProductPage",emits:["refresh-data","add-product"],setup(qe,{emit:Q}){const r=Y(),R=Q,q=J(),F=T(),f=Z(),B=H(),I=ae(),g=te(),$=oe(),y=b(),{isManager:z}=ee(K(()=>B.user)),e=b({id:null,name:"",price:null,category_id:null,unit_id:null,qty:null,description:"",images:"",origin_country:"",unit:null}),m=b([]),s=new FormData;W(()=>{_()});function j(t){const a=m.value.findIndex(o=>o.id===t);m.value.splice(a,1),g.basketData.splice(a,1)}function k(t){try{r.loading.show(),m.value.push(structuredClone(P(t))),g.basketData.push(structuredClone(P(t))),window.localStorage.setItem("basket",JSON.stringify(g.basketData))}catch(a){console.error(a)}finally{r.loading.hide()}}async function A(){try{let t=null;e.value?.id?t=f.updateProduct(e.value):(N(),t=await f.createProduct(s)),t&&(e.value.id=t.id,r.notify({message:"Успешно сохранено",color:"primary"}),R("refresh-data"),F.back())}catch(t){console.error(t)}}function N(){e?.value?.id&&s.append("id",e.value.id.toString()),e.value?.name&&s.append("name",e.value.name),e.value?.price&&s.append("price",e.value.price.toString()),e.value?.category_id&&s.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&s.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&s.append("qty",e.value.qty.toString()),e.value?.description&&s.append("description",e.value.description),e.value?.origin_country&&s.append("origin_country",e.value.origin_country)}function O(t){const a=new FileReader;a.readAsDataURL(t[0]),a.onload=()=>{},s.append("images",t[0]),e.value?.id&&L(t[0])}async function L(t){const a=new FormData;a.append("file",t),a.append("is_primary","true");try{await f.uploadFile(e.value.id,a)&&(_(),r.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(o){console.error(o)}finally{y.value&&y.value.reset()}}async function _(){if(q?.params?.id)try{r.loading.show();const t=await f.fetchProductsById(+q.params.id);t&&(e.value=t)}catch(t){console.error(t)}finally{r.loading.hide()}}return(t,a)=>(n(),d("div",se,[p(z)?(n(),d("div",ne,[i("div",re,u(e.value.id?"Редактирование товара":"Добавление товара"),1),l(E,{ref_key:"uploaderRef",ref:y,color:"primary",flat:"","max-file-size":"15728640",onAdded:O,onRejected:a[0]||(a[0]=o=>p(le)(p(r)))},{header:w(()=>[...a[13]||(a[13]=[])]),list:w(()=>[l(M),i("div",de,[l(V,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[14]||(a[14]=i("span",null,"Загрузить картинку",-1))])]),_:1},512),i("div",null,[e.value?.images?.length?(n(),x(D,{key:0,onRefreshData:a[1]||(a[1]=o=>_()),images:e.value.images},null,8,["images"])):c("",!0)]),l(v,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=o=>e.value.name=o),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),l(v,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=o=>e.value.price=o),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),l(v,{modelValue:e.value.qty,"onUpdate:modelValue":a[4]||(a[4]=o=>e.value.qty=o),class:"q-mb-xs",outlined:"",label:"Количество"},null,8,["modelValue"]),l(v,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[5]||(a[5]=o=>e.value.origin_country=o),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),l(C,{modelValue:e.value.category_id,"onUpdate:modelValue":a[6]||(a[6]=o=>e.value.category_id=o),options:p(I).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),l(C,{modelValue:e.value.unit_id,"onUpdate:modelValue":a[7]||(a[7]=o=>e.value.unit_id=o),options:p($).units,outlined:"",label:"Единица измерения","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),l(v,{class:"q-mt-sm q-mb-sm",modelValue:e.value.description,"onUpdate:modelValue":a[8]||(a[8]=o=>e.value.description=o),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"]),i("div",ue,[S(l(h,{color:"green",label:"Подтвердить",onClick:a[9]||(a[9]=o=>A())},null,512),[[U]])])])):(n(),d("div",me,[e.value?.images?.length?(n(),x(D,{key:0,images:e.value.images},null,8,["images"])):c("",!0),i("div",pe,[e.value?.name?(n(),d("h6",ce,u(e.value.name),1)):c("",!0),e.value?.old_price?(n(),d("div",ve,u(e.value.old_price)+" ₽",1)):c("",!0),i("div",{class:X(["text-bold text-18 q-mb-md",e.value?.old_price?"text-red":""])},u(e.value.price)+" ₽/ "+u(e.value.unit_name),3),e.value.description?(n(),d("div",fe,u(e.value.description),1)):c("",!0)]),i("div",ge,[m.value?.length?(n(),d("div",ye,[i("div",_e,[l(V,{name:"remove",color:"white",size:"30px",onClick:a[11]||(a[11]=o=>j(e.value.id))})]),i("span",be,u(m.value?.length),1),i("div",Ve,[l(V,{name:"add",color:"white",size:"30px",onClick:a[12]||(a[12]=o=>k(e.value))})])])):S((n(),x(h,{key:0,color:"green",label:"Добавить в корзину",onClick:a[10]||(a[10]=o=>k(e.value))},null,512)),[[U]])])]))]))}}),Ne=ie(xe,[["__scopeId","data-v-1fe2dd83"]]);export{Ne as default};
