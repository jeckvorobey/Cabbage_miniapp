import{Q as v,a as _,b as i}from"./QItem-2O6vaS4w.js";import{Q as D}from"./QList-CwLhIy7y.js";import{Q as T}from"./QBtnDropdown-HfUBajFf.js";import{V as O,W as R,a1 as f,Y as o,$ as n,Z as e,a2 as h,a3 as I,X as p,ab as E,a5 as d,a6 as c,a4 as k,a7 as V,z as w}from"./index-BNSJDQ6S.js";import{C as G}from"./ClosePopup-BoLQBjQh.js";import{u as $,d as P}from"./use-quasar-R_w6vjvW.js";import{u as x}from"./orderStore-BARtzaO2.js";var r=(s=>(s.CREATED="created",s.ASSEMBLING="assembling",s.DELIVERING="delivering",s.COMPLETED="completed",s.CANCELLED="cancelled",s))(r||{});const U=["href"],q={key:1},J=O({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},setup(s){const m=$(),N=x(),g=[{label:"создан",value:r.CREATED},{label:"собирается",value:r.ASSEMBLING},{label:"в пути",value:r.DELIVERING},{label:"завершён",value:r.COMPLETED},{label:"отменён",value:r.CANCELLED}];function Q(t,l){m.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{L(t,l)})}async function L(t,l){try{m.loading.show(),await N.updateOrderStatus(t,l)&&m.notify({color:"primary",message:"Статус успешно изменен"})}catch(u){console.error(u)}finally{m.loading.hide()}}function S(t){return g.find(u=>u.value===t)?.label}function A(t){m.dialog({cancel:!0,message:"Вы уверенны что хотите отменить заказ?",persistent:!0,title:"Отмена заказа"}).onOk(()=>{L(t,r.CANCELLED)})}function y(t){const l=t.username?.trim().replace(/^@/,"");return l?`https://t.me/${encodeURIComponent(l)}`:null}function b(t){if(!t.phone)return null;const l=t.phone.trim();return l.length?l:null}return(t,l)=>{const u=R("q-item-action");return o(),f("div",null,[n(D,null,{default:e(()=>[(o(!0),f(h,null,I(t.orderData,(a,B)=>(o(),p(v,{key:a.id??B,class:"border-bot"},{default:e(()=>[n(_,null,{default:e(()=>[b(a.user)?(o(),p(i,{key:0,caption:""},{default:e(()=>[d(c(b(a.user)),1)]),_:2},1024)):E("",!0),n(i,null,{default:e(()=>[y(a.user)?(o(),f("a",{key:0,href:y(a.user),target:"_blank",rel:"noopener noreferrer",class:"text-primary text-decoration-none"},c(a.user.full_name),9,U)):(o(),f("span",q,c(a.user.full_name),1))]),_:2},1024)]),_:2},1024),n(_,null,{default:e(()=>[n(i,{caption:""},{default:e(()=>[d(c(k(P)(a.order_date)),1)]),_:2},1024),n(i,null,{default:e(()=>[d(c(S(a.status)),1)]),_:2},1024)]),_:2},1024),n(_,null,{default:e(()=>[n(i,{caption:"",lines:"2"},{default:e(()=>[...l[0]||(l[0]=[d("Общая сумма",-1)])]),_:1}),n(i,null,{default:e(()=>[d(c(a.total_amount),1)]),_:2},1024)]),_:2},1024),t.adminMode?(o(),p(u,{key:0},{default:e(()=>[n(T,{color:"green",dense:""},{default:e(()=>[(o(),f(h,null,I(g,(C,M)=>n(D,{key:M},{default:e(()=>[V((o(),p(v,{clickable:"",onClick:z=>Q(a.id,C.value)},{default:e(()=>[n(_,null,{default:e(()=>[n(i,null,{default:e(()=>[d(c(C.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[G]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):E("",!0),!t.adminMode&&(a.status===k(r).CREATED||a.status===k(r).ASSEMBLING)?(o(),p(u,{key:1},{default:e(()=>[n(w,{round:"",color:"deep-orange",icon:"close",onClick:C=>A(a.id)},null,8,["onClick"])]),_:2},1024)):E("",!0)]),_:2},1024))),128))]),_:1})])}}});export{J as _};
