import{V as B,r as b,w as j,f as M,a4 as w,R as n,$ as C,S as d,_ as i,a1 as m,a8 as R,a5 as v,a9 as h,Z as k,Q as $,aO as E,W as L,p as O,P as u,ai as W}from"./index-BZjd7GBC.js";import{u as A}from"./use-quasar-Bj_W2G9s.js";import{u as z}from"./productsStore-CsZbc7f9.js";import{P as N}from"./ProductImgCarusel-DOCWp5SJ.js";import{Q as Z,a as G}from"./QUploader-CkjVN_b9.js";import{Q as H}from"./QSelect-CHecBd17.js";import{Q as J}from"./QForm-DVqTc2pL.js";import{u as K}from"./categoriesStore-CzHBp1kn.js";import{r as I}from"./useUtils-QC3uEKhj.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as X}from"./usePermissionVisibility.hook-BbKMUw0E.js";import{u as Y}from"./useCart-BG6gfmdO.js";import"./format-CJebrXOQ.js";import"./QItem-DDMqTswZ.js";import"./QMenu-C3gO3s83.js";import"./rtl-DFPa-2ov.js";const ee={class:"text-h6 q-mb-md"},ae={class:"text-center upload-title"},te={class:"row justify-end"},oe=B({__name:"ProductForm",props:{product:{}},emits:["submit","refresh-data"],setup(D,{expose:S,emit:c}){const q=D,f=c,F=A(),y=z(),g=K(),_=b(),r=new FormData,e=b({...q.product});j(()=>q.product,s=>{e.value={...s}},{deep:!0});const x=M(()=>g.categories||[]);function o(){V(),f("submit",e.value,r)}function l(){f("refresh-data")}function V(){r.delete("id"),r.delete("name"),r.delete("price"),r.delete("category_id"),r.delete("qty"),r.delete("description"),r.delete("origin_country"),e.value?.id&&r.append("id",e.value.id.toString()),e.value?.name&&r.append("name",e.value.name),e.value?.price&&r.append("price",e.value.price.toString()),e.value?.category_id&&r.append("category_id",e.value.category_id.toString()),e.value?.qty&&r.append("qty",e.value.qty.toString()),e.value?.description&&r.append("description",e.value.description),e.value?.origin_country&&r.append("origin_country",e.value.origin_country)}function P(s){const t=new FileReader;t.readAsDataURL(s[0]),t.onload=()=>{},r.append("images",s[0]),e.value?.id&&Q(s[0])}async function Q(s){const t=new FormData;t.append("file",s),t.append("is_primary","true");try{await y.uploadFile(e.value.id,t)&&(l(),F.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(a){console.error(a)}finally{_.value&&_.value.reset()}}return S({generateFormData:V}),(s,t)=>(n(),w(J,{greedy:"",onSubmit:o},{default:C(()=>[d("div",ee,m(s.product.id?"Редактирование товара":"Добавление товара"),1),i(Z,{ref_key:"uploaderRef",ref:_,color:"primary",flat:"","max-file-size":"15728640",onAdded:P},{header:C(()=>[...t[6]||(t[6]=[])]),list:C(()=>[i(G),d("div",ae,[i(R,{class:"q-mr-sm",name:"note_add",size:"24px"}),t[7]||(t[7]=d("span",null,"Загрузить картинку",-1))])]),_:1},512),d("div",null,[s.product?.images?.length?(n(),w(N,{key:0,images:s.product.images,onRefreshData:l},null,8,["images"])):v("",!0)]),i(h,{modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.name=a),rules:[k(I)],class:"q-mb-xs",outlined:"",label:"Наименование товара *"},null,8,["modelValue","rules"]),i(h,{modelValue:e.value.price,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.price=a),rules:[k(I)],class:"q-mb-xs",outlined:"",label:"Стоимость товара *"},null,8,["modelValue","rules"]),i(h,{modelValue:e.value.qty,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.qty=a),class:"q-mb-xs",outlined:"",label:"Количество",type:"number"},null,8,["modelValue"]),i(h,{modelValue:e.value.origin_country,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.origin_country=a),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),i(H,{modelValue:e.value.category_id,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.category_id=a),rules:[k(I)],options:x.value,class:"q-mb-xs",outlined:"",label:"Категория *","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","rules","options"]),i(h,{modelValue:e.value.description,"onUpdate:modelValue":t[5]||(t[5]=a=>e.value.description=a),class:"q-mb-xs",outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"]),d("div",te,[i($,{color:"green",label:"Подтвердить",type:"submit"})])]),_:1}))}}),re=T(oe,[["__scopeId","data-v-3fb4f12a"]]),le={class:"q-pa-md product"},se={key:0},ie={key:1},ne={class:"q-mb-sm"},de={key:0,class:"q-my-md text-center"},ue={key:1,class:"text-grey"},ce={key:2,class:"text-grey old-price"},me={key:3,class:"q-pa-md bg-light-gray radius-16"},pe={class:"row justify-end"},ve={key:1,class:"row"},fe={class:"bg-green q-pa-xs radius-100"},ye={class:"q-mx-sm self-center"},ge={class:"bg-green q-pa-xs radius-100"},_e=B({__name:"ProductActionPage",emits:["refresh-data","add-product"],setup(D,{emit:S}){const c=A(),q=S,f=E(),F=L(),y=z(),g=b(),{isManager:_}=X(),{addToCart:r,updateQuantity:e,getCartItem:x}=Y(),o=b({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),l=b([]);O(()=>{t()});function V(){try{c.loading.show(),r(o.value)&&o.value.id&&(l.value=x(o.value.id))}catch(a){console.error(a)}finally{c.loading.hide()}}function P(){if(l.value){const a=e(l.value,1);a?l.value=a:l.value=void 0}}function Q(){if(l.value){const a=e(l.value,-1);a?l.value=a:l.value=void 0}}async function s(a,U){try{let p=null;a?.id?p=await y.updateProduct(a):(g.value&&g.value.generateFormData(),p=await y.createProduct(U)),p&&(o.value.id=p.id,c.notify({color:"primary",message:"Успешно сохранено"}),q("refresh-data"),F.back())}catch(p){console.error(p)}}async function t(){if(f?.params?.id)try{c.loading.show();const a=await y.fetchProductsById(+f.params.id);a&&(o.value=a,o.value.id&&(l.value=x(o.value.id)))}catch(a){console.error(a)}finally{c.loading.hide()}}return(a,U)=>(n(),u("div",le,[k(_)?(n(),u("div",se,[i(re,{ref_key:"productFormRef",ref:g,product:o.value,onSubmit:s,onRefreshData:t},null,8,["product"])])):(n(),u("div",ie,[o.value?.images?.length?(n(),w(N,{key:0,images:o.value.images},null,8,["images"])):v("",!0),d("div",ne,[o.value?.name?(n(),u("h6",de,m(o.value.name),1)):v("",!0),o.value.origin_country?(n(),u("div",ue,"Страна производитель: "+m(o.value.origin_country),1)):v("",!0),o.value?.old_price?(n(),u("div",ce,"Старая цена: "+m(o.value.old_price)+" ₽",1)):v("",!0),d("div",{class:W(["text-bold text-18 q-mb-md",o.value?.old_price?"text-red":""])}," Цена: "+m(o.value.price)+" ₽ ",3),o.value.description?(n(),u("div",me,m(o.value.description),1)):v("",!0)]),d("div",pe,[l.value?.id?(n(),u("div",ve,[d("div",fe,[i(R,{name:"remove",color:"white",size:"30px",onClick:Q})]),d("span",ye,m(l.value.quantity),1),d("div",ge,[i(R,{name:"add",color:"white",size:"30px",onClick:P})])])):(n(),w($,{key:0,color:"green",label:"Добавить в корзину",onClick:V}))])]))]))}}),Be=T(_e,[["__scopeId","data-v-64f64ec9"]]);export{Be as default};
