import{X as L,r as h,Y as U,Z as m,_ as s,$ as e,a0 as D,a1 as a,a2 as N,a3 as v,a4 as y,a5 as Q,a6 as g,M as R,a7 as f,a8 as d,a9 as V,aa as $}from"./index-TWMozEHe.js";import{Q as k,a as u,b as p}from"./QItem-DJ-6SN4N.js";import{Q as w}from"./QList-D51DKjrd.js";import{Q as P}from"./QBtnDropdown-DtfsLo1K.js";import{Q as E}from"./QInfiniteScroll-BLdF2Hhk.js";import{C as F}from"./ClosePopup-DWWMCTrG.js";import{u as M}from"./use-quasar-DXTtSasI.js";import{a as O}from"./useUtils-B-leiMkc.js";import{u as T}from"./usersStore-DxPFIJ0f.js";import"./QMenu-BjoEkX2-.js";const ae=L({__name:"UsersPage",setup(X){const r=M(),n=T(),l=h({has_more:!0,limit:20,offset:0,total:0}),C=h([{name:"Администратор",value:1},{name:"Менеджер",value:2},{name:"Пользователь",value:9}]),b=async(t,o)=>{if(!l.value.has_more){o(!0);return}await x(),l.value.offset+=l.value.limit,o()};async function x(){try{r.loading.show();const t=await n.fetchUsers(l.value);t&&(l.value.total=t.total,l.value.has_more=t.has_more,n.users=t.items)}catch(t){console.error(t)}finally{r.loading.hide()}}function I(t,o){r.dialog({cancel:!0,message:"Вы уверенны что хотите изменить права этого пользователя?",persistent:!0,title:"Изменение прав пользователя"}).onOk(()=>{S(t,o)})}async function S(t,o){try{r.loading.show(),await n.updateUserRole(t.id,o)&&(t.role=o,r.notify({color:"primary",message:"Роль изменена"}))}catch(i){console.error(i)}finally{r.loading.hide()}}return(t,o)=>{const i=U("q-item-action");return s(),m(E,{offset:250,onLoad:b},{default:e(()=>[o[0]||(o[0]=D("h6",{class:"text-center q-mt-md q-mb-md"},"Пользователи",-1)),a(N,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:e(()=>[(s(!0),v(y,null,Q(g(n).users,(c,q)=>(s(),m(w,{key:q},{default:e(()=>[a(k,null,{default:e(()=>[a(u,{avatar:""},{default:e(()=>[a(R,{color:"primary",name:"local_bar"})]),_:1}),a(u,null,{default:e(()=>[a(p,null,{default:e(()=>[f(d(c.full_name),1)]),_:2},1024)]),_:2},1024),a(u,null,{default:e(()=>[a(p,{caption:""},{default:e(()=>[f(d(g(O)(c.role)),1)]),_:2},1024)]),_:2},1024),a(i,null,{default:e(()=>[a(P,{dense:"",flat:"",color:"primary","dropdown-icon":"change_history"},{default:e(()=>[a(w,null,{default:e(()=>[(s(!0),v(y,null,Q(C.value,(_,B)=>V((s(),m(k,{key:B,clickable:"",onClick:Y=>I(c,_.value)},{default:e(()=>[a(u,null,{default:e(()=>[a(p,null,{default:e(()=>[f(d(_.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[F]])),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a($)]),_:2},1024))),128))]),_:1})]),_:1})}}});export{ae as default};
