import{d as h,r as v,aj as Q,ai as m,an as l,f as e,as as D,b0 as F,ao as I,ap as U,av as k,b1 as L,Y as C,Q as f,aW as R,u as j,c as E,o as O,ag as T,ah as _,ak as q,am as g,F as W,aq as Y,at as w,ab as z}from"./index-oIPrszfy.js";import{u as B,Q as G,b as x,a as S}from"./useUtils-bN9W8TGK.js";import{Q as H}from"./QList-DdjOcUIL.js";import{u as M,Q as J}from"./unitsStore-54Mvku-0.js";import{C as $}from"./ClosePopup-BN8HCf2M.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as X}from"./usePermissionVisibility.hook-BN8VzsBe.js";const Z={class:"text-h6 q-mb-md"},ee=h({__name:"AddUnitModal",props:{unitData:{default:()=>({name:"",symbol:""})}},emits:["update"],setup(V,{emit:c}){const y=V,r=c,p=B(),s=v(!1),i=M(),t=v(y.unitData);async function b(){try{t.value?.id?await i.updateUnit(t.value.id,t.value)&&p.notify({message:"Единица измерения успешно обновлена",color:"primary"}):await i.createUnit(t.value)&&p.notify({message:"Единица измерения успешно создана",color:"primary"})}catch(d){console.error(d)}finally{s.value=!1,r("update")}}return(d,n)=>(m(),Q(R,{ref:"dialogRef",modelValue:s.value,"onUpdate:modelValue":n[3]||(n[3]=a=>s.value=a),persistent:""},{default:l(()=>[e(D,{class:"add-product"},{default:l(()=>[e(J,{greedy:""},{default:l(()=>[e(F,null,{default:l(()=>[I("div",Z,U(t.value.id?"Редактирование":"Добавление")+" единицы измерения ",1),e(k,{modelValue:t.value.name,"onUpdate:modelValue":n[0]||(n[0]=a=>t.value.name=a),class:"q-mb-xs",label:"Наименование (пример: кг, гр, шт)",outlined:""},null,8,["modelValue"]),e(k,{modelValue:t.value.symbol,"onUpdate:modelValue":n[1]||(n[1]=a=>t.value.symbol=a),class:"q-mb-xs",label:"Символ (пример: kg, gr, sh)",outlined:""},null,8,["modelValue"])]),_:1}),e(L,{align:"right"},{default:l(()=>[C(e(f,{color:"red",flat:"",label:"Отмена"},null,512),[[$]]),C(e(f,{color:"primary",flat:"",label:"Сохранить",onClick:n[2]||(n[2]=a=>b())},null,512),[[$]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ae=K(ee,[["__scopeId","data-v-498fea6f"]]),te={key:0},de=h({__name:"UnitsPage",setup(V){const c=B(),y=j(),r=M(),{isManager:p}=X(E(()=>y.user?.role)),s=v(!1),i=v();O(()=>{t()});async function t(){try{await r.fetchUnits(),c.loading.show()}catch(a){console.error(a)}finally{c.loading.hide()}}function b(a){c.dialog({title:"Удаление единицы измерения",message:"Вы уверенны что хотите удалить единицу измерения?",cancel:!0,persistent:!0}).onOk(()=>{d(a)})}async function d(a){try{await r.deleteUnit(a)}catch(o){console.error(o)}finally{await t()}}function n(a){i.value=r.units.find(o=>o.id===a),i.value&&(s.value=!s.value)}return(a,o)=>{const A=T("q-item-action");return m(),_("div",null,[e(f,{onClick:o[0]||(o[0]=u=>s.value=!s.value),class:"full-width q-mb-sm",color:"secondary",label:"Добавление единицы измерения"}),g(r).units?(m(),_("div",te,[o[3]||(o[3]=I("h6",{class:"text-center q-mt-md q-mb-md"},"Единицы измерения",-1)),e(D,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:l(()=>[(m(!0),_(W,null,Y(g(r).units,(u,N)=>(m(),Q(H,{key:N},{default:l(()=>[e(G,null,{default:l(()=>[e(x,null,{default:l(()=>[e(S,null,{default:l(()=>[w(U(u.name),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:l(()=>[e(S,null,{default:l(()=>[w(U(u.symbol),1)]),_:2},1024)]),_:2},1024),e(A,null,{default:l(()=>[g(p)?(m(),Q(f,{key:0,flat:"",round:"",color:"red",icon:"delete",onClick:P=>b(u.id)},null,8,["onClick"])):q("",!0),e(f,{flat:"",round:"",color:"primary",icon:"mode_edit",onClick:P=>n(u.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),e(z)]),_:2},1024))),128))]),_:1})])):q("",!0),e(ae,{modelValue:s.value,"onUpdate:modelValue":o[1]||(o[1]=u=>s.value=u),label:"test","unit-data":i.value,onUpdate:o[2]||(o[2]=u=>t())},null,8,["modelValue","unit-data"])])}}});export{de as default};
