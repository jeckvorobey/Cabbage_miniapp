import{Q as B}from"./QInfiniteScroll-Be6oHdbZ.js";import{u as Q}from"./use-quasar-CEIDDOSE.js";import{u as k}from"./orderStore-BQ5EwhYp.js";import{Q as b,a as p,b as l}from"./QItem-ey8mJpZS.js";import{Q as v}from"./QList-d5IR2hej.js";import{Q as V}from"./QBtnDropdown-B42U04UY.js";import{C as x}from"./ClosePopup-DA1o9lh2.js";import{u as M}from"./usePermissionVisibility.hook-s6Ty05tH.js";import{X as N,Y as A,a3 as g,_ as u,a1 as o,$ as a,a4 as L,a5 as I,Z as h,ad as q,a7 as i,a8 as _,a6 as S,a9 as P,m as T,a0 as $}from"./index-DJ9SSKXY.js";import"./QBtnGroup-vSguqPXd.js";import"./QMenu-CfS2TLFZ.js";import"./useUtils-CXWl0HVg.js";var d=(n=>(n.CREATED="created",n.ASSEMBLING="assembling",n.DELIVERING="delivering",n.COMPLETED="completed",n.CANCELLED="cancelled",n))(d||{});const G=N({__name:"OrderHistoryItems",props:{orderData:{}},setup(n){const{isManager:m}=M(),e=Q(),D=k(),y=[{label:"создан",value:d.CREATED},{label:"собирается",value:d.ASSEMBLING},{label:"в пути",value:d.DELIVERING},{label:"завершён",value:d.COMPLETED},{label:"отменён",value:d.CANCELLED}];function C(r,t){e.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{s(r,t)})}async function s(r,t){try{e.loading.show(),await D.updateOrderStatus(r,t)&&e.notify({color:"primary",message:"Статус успешно изменен"})}catch(f){console.error(f)}finally{e.loading.hide()}}return(r,t)=>{const f=A("q-item-action");return u(),g("div",null,[o(v,null,{default:a(()=>[(u(!0),g(L,null,I(r.orderData,(c,O)=>(u(),h(b,{key:O,class:"border-bot"},{default:a(()=>[o(p,null,{default:a(()=>[o(l,{caption:"",lines:"2"},{default:a(()=>[...t[0]||(t[0]=[i("Дата",-1)])]),_:1}),o(l,null,{default:a(()=>[i(_(c.order_date),1)]),_:2},1024)]),_:2},1024),o(p,null,{default:a(()=>[o(l,{caption:"",lines:"2"},{default:a(()=>[...t[1]||(t[1]=[i("Статус",-1)])]),_:1}),o(l,null,{default:a(()=>[i(_(c.status),1)]),_:2},1024)]),_:2},1024),o(p,null,{default:a(()=>[o(l,{caption:"",lines:"2"},{default:a(()=>[...t[2]||(t[2]=[i("Общая сумма",-1)])]),_:1}),o(l,null,{default:a(()=>[i(_(c.total_amount),1)]),_:2},1024)]),_:2},1024),S(m)?(u(),h(f,{key:0},{default:a(()=>[o(V,{color:"green",dense:""},{default:a(()=>[(u(),g(L,null,I(y,(E,w)=>o(v,{key:w},{default:a(()=>[P((u(),h(b,{clickable:"",onClick:R=>C(c.id,E.value)},{default:a(()=>[o(p,null,{default:a(()=>[o(l,null,{default:a(()=>[i(_(E.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):q("",!0)]),_:2},1024))),128))]),_:1})])}}}),te=N({__name:"OrderHistoryPage",setup(n){const m=Q(),e=k(),{isManager:D}=M();T(async()=>{console.log("fetchOrders history"),await C()});const y=(s,r)=>{if(!e.pagination.has_more){r(!0);return}e.pagination.offset+=e.pagination.limit,r()};async function C(){try{m.loading.show();const s={limit:e.pagination.limit,offset:e.pagination.offset},t=await(D.value?e.fetchOrders:e.fetchMyOrder)(s);t&&(e.pagination.total=t.total,e.pagination.has_more=t.has_more,e.ordersData?.length?e.ordersData.push(t.items):e.ordersData=t.items),t&&(e.ordersData=t.items)}catch(s){console.error(s)}finally{m.loading.hide()}}return(s,r)=>(u(),g("div",null,[o(B,{offset:250,onLoad:y},{default:a(()=>[r[0]||(r[0]=$("h6",{class:"text-center q-mt-md q-mb-md"},"История заказов",-1)),o(G,{orderData:S(e).ordersData},null,8,["orderData"])]),_:1})]))}});export{te as default};
