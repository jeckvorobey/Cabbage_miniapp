import{b as oe,n as Y,ai as z,bi as x,bn as le,bo as ne,f as M,h as se,p as re,r as k,V as B,X as y,Y as c,ad as ie,Z as r,$ as l,a4 as h,aa as H,_ as f,a6 as b,C as de,a9 as P,ab as w,ac as N,a7 as S,Q as V,a1 as I,a0 as ue,am as ce,a3 as pe,a2 as me,al as K,a5 as T,a8 as fe,m as ge}from"./index-Dbv4EQ-c.js";import{Q as Z}from"./QImg-R_4or7cX.js";import{Q as ve,a as L,b as j}from"./QItem-CvscSjwt.js";import{Q as ye}from"./QList-CoJo7pCm.js";import{Q as _e}from"./QInfiniteScroll-NygkX0HK.js";import{u as G}from"./productsStore-BcvjXMPv.js";import{u as J,f as he,g as W}from"./use-quasar-DyaPQ0f9.js";import{g as be,Q as Ce,a as Qe}from"./QUploader-F1be8MJo.js";import{Q as Ve}from"./QSelect-kFDmziQD.js";import{Q as E}from"./QForm-DE9B1_E9.js";import{C as F}from"./ClosePopup-Bsd5CNnU.js";import{u as ee}from"./usePermissionVisibility.hook-BSTD79Np.js";import{P as X}from"./ProductImgCarusel-Dn_nw9EX.js";import{u as ke}from"./categoriesStore-Dj49nKc-.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as xe}from"./useCart-qx7BFarq.js";import{u as Pe}from"./addressesStore-Bji-hKhI.js";import"./format-CJebrXOQ.js";import"./QMenu-BJLEo7xX.js";import"./rtl-DFPa-2ov.js";import"./QBtnDropdown-CT4FJ4iT.js";import"./orderStore-D6m0024p.js";const qe=oe({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(_,{slots:i}){const{proxy:{$q:u}}=Y(),a=z(le,x);if(a===x)return console.error("QPage needs to be a deep child of QLayout"),x;if(z(ne,x)===x)return console.error("QPage needs to be child of QPageContainer"),x;const g=M(()=>{const v=(a.header.space===!0?a.header.size:0)+(a.footer.space===!0?a.footer.size:0);if(typeof _.styleFn=="function"){const Q=a.isContainer.value===!0?a.containerHeight.value:u.screen.height;return _.styleFn(v,Q)}return{minHeight:a.isContainer.value===!0?a.containerHeight.value-v+"px":u.screen.height===0?v!==0?`calc(100vh - ${v}px)`:"100vh":u.screen.height-v+"px"}}),C=M(()=>`q-page${_.padding===!0?" q-layout-padding":""}`);return()=>se("main",{class:C.value,style:g.value},re(i.default))}});function O(){const{emit:_,proxy:i}=Y(),u=k(null);function a(){u.value.show()}function p(){u.value.hide()}function g(v){_("ok",v),p()}function C(){_("hide")}return Object.assign(i,{show:a,hide:p}),{dialogRef:u,onDialogHide:C,onDialogOK:g,onDialogCancel:p}}const te=["ok","hide"];O.emits=te;O.emitsObject=be(te);const we={class:"text-h6 q-mb-md"},$e={class:"text-center upload-title"},De={class:"q-mb-md"},Se={key:1},Fe={class:"text-h6 text-center q-mt-sm"},Ie={class:"text-bold"},Ae=B({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(_,{emit:i}){const u=_,a=i,p=J(),g=G(),C=ke(),{dialogRef:v}=O(),{isManager:Q}=ee(),$=k(!1),q=k(),e=k({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),m=new FormData;u.productData&&(e.value=u.productData);async function A(){try{let t=null;e.value?.id?t=g.updateProduct(e.value):(U(),t=await g.createProduct(m)),t&&(e.value.id=t.id,p.notify({color:"primary",message:"Успешно сохранено"}),a("refresh-data"))}catch(t){console.error(t)}}function R(){a("add-product",e.value)}function U(){e?.value?.id&&m.append("id",e.value.id.toString()),e.value?.name&&m.append("name",e.value.name),e.value?.price&&m.append("price",e.value.price.toString()),e.value?.category_id&&m.append("category_id",e.value.category_id.toString()),e.value?.qty&&m.append("qty",e.value.qty.toString()),e.value?.description&&m.append("description",e.value.description),e.value?.origin_country&&m.append("origin_country",e.value.origin_country)}function D(t){const o=new FileReader;o.readAsDataURL(t[0]),o.onload=()=>{},m.delete("images"),m.append("images",t[0]),e.value?.id&&d(t[0])}async function d(t){const o=new FormData;o.append("file",t),o.append("is_primary","true");try{await g.uploadFile(e.value.id,o)&&(n(),p.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(s){console.error(s)}finally{q.value&&q.value.reset()}}async function n(){try{const t=await g.fetchProductsById(e.value.id);e.value=t}catch(t){console.error(t)}}return(t,o)=>(c(),y(ie,{ref_key:"dialogRef",ref:v,modelValue:$.value,"onUpdate:modelValue":o[10]||(o[10]=s=>$.value=s),persistent:""},{default:r(()=>[l(ue,{class:"add-product"},{default:r(()=>[h(Q)?(c(),y(E,{key:0,greedy:""},{default:r(()=>[l(H,null,{default:r(()=>[f("div",we,b(e.value.id?"Редактирование товара":"Добавление товара"),1),l(Ce,{ref_key:"uploaderRef",ref:q,class:"q-mb-md",color:"primary",flat:"","max-file-size":"15728640",onAdded:D,onRejected:o[0]||(o[0]=s=>h(he)(h(p)))},{header:r(()=>[...o[11]||(o[11]=[])]),list:r(()=>[l(Qe),f("div",$e,[l(de,{class:"q-mr-sm",name:"note_add",size:"24px"}),o[12]||(o[12]=f("span",null,"Загрузить картинку",-1))])]),_:1},512),f("div",De,[e.value?.images?.length?(c(),y(X,{key:0,images:e.value.images,onRefreshData:o[1]||(o[1]=s=>n())},null,8,["images"])):P("",!0)]),l(w,{modelValue:e.value.name,"onUpdate:modelValue":o[2]||(o[2]=s=>e.value.name=s),class:"q-mb-md",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),l(w,{modelValue:e.value.price,"onUpdate:modelValue":o[3]||(o[3]=s=>e.value.price=s),class:"q-mb-md",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),l(w,{modelValue:e.value.qty,"onUpdate:modelValue":o[4]||(o[4]=s=>e.value.qty=s),class:"q-mb-md",outlined:"",label:"Количество",type:"number"},null,8,["modelValue"]),l(w,{modelValue:e.value.origin_country,"onUpdate:modelValue":o[5]||(o[5]=s=>e.value.origin_country=s),class:"q-mb-md",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),l(Ve,{modelValue:e.value.category_id,"onUpdate:modelValue":o[6]||(o[6]=s=>e.value.category_id=s),options:h(C).categories,class:"q-mb-md",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),l(w,{modelValue:e.value.description,"onUpdate:modelValue":o[7]||(o[7]=s=>e.value.description=s),class:"q-mb-md",outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),l(N,{align:"right"},{default:r(()=>[S(l(V,{color:"red",label:"Отмена"},null,512),[[F]]),S(l(V,{color:"primary",label:"Подтвердить",onClick:o[8]||(o[8]=s=>A())},null,512),[[F]])]),_:1})]),_:1})):(c(),y(E,{key:1},{default:r(()=>[l(H,null,{default:r(()=>[f("div",null,[e.value?.images?.length?(c(),y(X,{key:0,images:e.value.images},null,8,["images"])):(c(),I("div",Se,[l(Z,{class:"q-mt-sm",src:h(W)("/card-shop.jpg")},null,8,["src"])]))]),f("div",Fe,b(e.value.name),1),f("div",Ie,"Стоимость товара: "+b(e.value.price),1),f("div",null,"Страна происхождения: "+b(e.value.origin_country),1),f("div",null,"Описание: "+b(e.value.description),1)]),_:1}),l(N,{align:"right"},{default:r(()=>[S(l(V,{color:"red",label:"Отмена"},null,512),[[F]]),S(l(V,{color:"primary",label:"Добавить в корзину",onClick:o[9]||(o[9]=s=>R())},null,512),[[F]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),Re=ae(Ae,[["__scopeId","data-v-4c606175"]]),Ue={class:"product-card"},Le={key:0,class:"text-grey old-price"},je={key:0,class:"q-mb-sm"},Be=B({__name:"ProductList",setup(_){const i=J(),u=ce(),a=G(),{addToCart:p}=xe(),{isManager:g,isAdmin:C}=ee(),v=k(!1),Q=k(!1),$=k();function q(){a.pagination.offset=0,e()}async function e(){try{i.loading.show();const d={limit:a.pagination.limit,offset:a.pagination.offset},n=await a.fetchProducts(d);n&&(a.pagination.total=n.total,a.pagination.has_more=n.has_more,a?.products?.length?a.products.push(n.items):a.products=n.items)}catch(d){console.error(d)}finally{i.loading.hide()}}function m(d){try{i.loading.show(),p(d)}catch(n){console.error(n)}finally{i.loading.hide()}}const A=async(d,n)=>{if(!a.pagination.has_more){v.value=!0,n(!0);return}await e(),a.pagination.offset+=a.pagination.limit,n()};function R(d){i.dialog({cancel:!0,message:"Вы уверенны что хотите удалить товар?",persistent:!0,title:"Удаление товара"}).onOk(()=>{U(d)})}async function U(d){try{if(!d?.id)return;await a.deleteProduct(d.id),i.loading.show()}catch(n){console.error(n)}finally{i.loading.hide()}}function D(d){u.push({name:"products-edit",params:{id:d.id}})}return(d,n)=>(c(),y(_e,{offset:250,onLoad:A},{default:r(()=>[h(g)?(c(),y(V,{key:0,class:"full-width q-mb-sm",color:"green",label:"Добавить товар",onClick:n[0]||(n[0]=t=>h(u).push({name:"products-create"}))})):P("",!0),f("div",Ue,[(c(!0),I(me,null,pe(h(a).products,(t,o)=>(c(),y(ye,{key:o},{default:r(()=>[l(ve,null,{default:r(()=>[l(L,{top:"",avatar:"",onClick:s=>D(t)},{default:r(()=>[l(Z,{class:K(["radius-8",t.available_qty?"cursor-pointer":"image-grayscale-100"]),src:t.primary_image?t.primary_image:h(W)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["class","src"])]),_:2},1032,["onClick"]),l(L,{class:"column justify-between",onClick:s=>D(t)},{default:r(()=>[l(j,{caption:"",class:"text-size-16"},{default:r(()=>[T(b(t.name),1)]),_:2},1024),t.available_qty?P("",!0):(c(),y(j,{key:0,caption:"",class:"text-18 text-red"},{default:r(()=>[...n[3]||(n[3]=[T(" Нет в наличии",-1)])]),_:1})),l(j,null,{default:r(()=>[t?.old_price?(c(),I("div",Le,b(t.old_price)+" ₽",1)):P("",!0),f("div",{class:K(t?.old_price?"text-red":"")},b(t.price)+" ₽/шт.",3)]),_:2},1024)]),_:2},1032,["onClick"]),l(L,{side:"",top:"",class:"column justify-between"},{default:r(()=>[f("div",null,[h(C)?(c(),I("div",je,[l(V,{dense:"",round:"",color:"red",icon:"delete",onClick:s=>R(t)},null,8,["onClick"])])):P("",!0),f("div",null,[l(V,{disabled:!t.available_qty,dense:"",round:"",color:"green",icon:"shopping_cart",onClick:s=>m(t)},null,8,["disabled","onClick"])])])]),_:2},1024)]),_:2},1024),l(fe,{spaced:"",inset:""})]),_:2},1024))),128))]),Q.value?(c(),y(Re,{key:1,modelValue:Q.value,"onUpdate:modelValue":n[1]||(n[1]=t=>Q.value=t),productData:$.value,onRefreshData:n[2]||(n[2]=t=>q()),onAddProduct:m},null,8,["modelValue","productData"])):P("",!0)]),_:1}))}}),Oe=ae(Be,[["__scopeId","data-v-f0947087"]]),da=B({__name:"DashboardPage",setup(_){const i=Pe();ge(()=>{u()});async function u(){try{const a=await i.fetchAddresses();if(a){i.addresses=a;const p=a.find(g=>g.is_default===!0);p&&(i.addressId=p.id)}}catch(a){console.error(a)}}return(a,p)=>(c(),y(qe,{class:"q-mx-xs"},{default:r(()=>[l(Oe,{class:"q-mb-lg"})]),_:1}))}});export{da as default};
