import{Q as K}from"./QImg-CDhWFuM8.js";import{V as P,r as p,h as z,a4 as D,M as y,ac as W,$ as n,_ as e,a2 as L,a5 as j,a0 as R,N as m,a1 as $,a9 as E,al as X,aa as Y,ab as ee,S as N,am as se,u as ae,e as B,an as M,ao as te,a3 as le,L as q,Z as f,a8 as g,ap as oe,a6 as ne}from"./index-DzMPjyn1.js";import{u as O,Q as de}from"./addressesStore-DZkQTvev.js";import{Q as re,a as ie,b as ue}from"./QItem-BezlGzCn.js";import{Q as T}from"./QSelect-Brj-BH3q.js";import{u as Z}from"./use-quasar-DRFLew1W.js";import{Q as me}from"./QForm-Cim0s9mt.js";import{C as ce}from"./ClosePopup-DxhkswOl.js";import{g as pe}from"./useUtils-CMzPU-jz.js";import{u as ve}from"./usersStore-B6_TYqNv.js";import{_ as fe,a as ge,b as he,d as ye}from"./vue-yandex-maps-ChOvwSMz.js";import"./QBtnGroup-DiUjhDwq.js";import"./QMenu-CbJNr8k-.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const _e={class:"row q-pl-sm flex-center justify-between"},we={class:"text-grey-6"},Ve=P({__name:"AddAddressModal",props:{newAddress:{}},setup(I){const V=[[55.97,37.12],[56.02,37.33]],d=p([]),c=p(!1),_=p("Начните вводить адрес..."),b=I,w=Z(),h=O(),v=p(!0),k=p(),l=p();z(async()=>{try{const r={area_id:1,address_line:"",comment:"",is_default:!1};b.newAddress?l.value=b.newAddress:l.value=r,w.loading.show();const a=await h.fetchDeliveryZones();a&&(h.deliveryZones=a)}catch(r){console.error(r)}finally{w.loading.hide()}});async function A(){try{await(l?.value?.id?h.updateAddress:h.createAddress)(l.value)}catch(r){console.error(r)}finally{k.value.hide()}}async function i(r,a){if(!r){_.value="Начните вводить адрес...",a(()=>{d.value=[]});return}const u=window.ymaps;if(!u){w.notify({type:"negative",message:"Сервис карт недоступен."});return}c.value=!0;try{const Q=(await u.geocode(r,{results:5,boundedBy:V,strictBounds:!0})).geoObjects.toArray().map(C=>({displayName:C.properties.get("text"),coords:C.geometry.getCoordinates()}));a(()=>{if(!Q?.length){d.value=[],_.value="Адрес не найден";return}d.value=Q})}catch(x){console.error("Ошибка геокодирования:",x)}finally{c.value=!1}}return(r,a)=>(y(),D(W,{ref_key:"dialogRef",ref:k,modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=u=>v.value=u),persistent:""},{default:n(()=>[e(L,{class:""},{default:n(()=>[e(me,{greedy:"",onSubmit:a[3]||(a[3]=u=>A())},{default:n(()=>[l.value?(y(),D(R,{key:0},{default:n(()=>[a[5]||(a[5]=m("div",{class:"text-h6"},"Создание нового адреса доставки",-1)),e(T,{class:"q-mb-sm",clearable:"",outlined:"","use-input":"","emit-value":"","map-options":"",modelValue:l.value.address_line,"onUpdate:modelValue":a[0]||(a[0]=u=>l.value.address_line=u),options:d.value,"option-label":"displayName","option-value":"displayName",label:"Адрес доставки",onFilter:i},{"no-option":n(()=>[m("div",_e,[m("div",we,$(_.value),1)])]),_:1},8,["modelValue","options"]),e(E,{label:"Комментарий",modelValue:l.value.comment,"onUpdate:modelValue":a[1]||(a[1]=u=>l.value.comment=u),outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"]),e(X,{modelValue:l.value.is_default,"onUpdate:modelValue":a[2]||(a[2]=u=>l.value.is_default=u),label:"Активный аддрес"},null,8,["modelValue"])]),_:1})):j("",!0),e(Y,{align:"right"},{default:n(()=>[ee(e(N,{color:"red",flat:"",label:"Отмена"},null,512),[[ce]]),e(N,{color:"primary",flat:"",label:"Сохранить",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),be={class:"q-pa-sm"},ke={class:"justify-center row q-mb-md"},Ae={class:"text-h5 justify-between q-mb-sm row"},xe={class:"items-center"},Qe={class:"items-center"},Ce={key:0,class:"row items-center q-mb-sm text-h6"},$e={style:{height:"40px"},class:"col-10 content-center"},Se={key:1,class:"row items-center q-mb-sm"},qe={class:"row items-center q-mb-sm"},Fe=P({__name:"UserPage",setup(I){const V=se(null),d=Z(),c=O(),_=ve(),b=ae(),w=B(()=>M.isActive),h=te({dark:"dark",light:"light"}),v=p(!1),k=B(()=>w.value?h.dark:h.light),l=p(!1),A=p("dark"),i=p({full_name:"",mail:"",phone:"",addres:null}),r=p();z(()=>{i.value=b.user,J()});function a(o){i.value.addres=o,console.log(i.value.addres),C(o)}function u(){r.value=null,l.value=!l.value}async function x(o){try{d.loading.show(),await c.deleteAddress(o.id)}catch(s){console.error(s)}finally{d.loading.hide()}}function Q(o){r.value=o,l.value=!l.value}async function C(o){try{d.loading.show(),await c.updateAddress(o)}catch(s){console.error(s)}finally{d.loading.hide()}}const F=()=>{M.toggle(),window.localStorage.setItem("theme",k.value)};function G(){d.dialog({title:"Смена номера телефона",message:"Вы уверенны что хотите изменить номер?",cancel:!0,persistent:!0}).onOk(()=>{H()})}async function H(){try{d.loading.show(),await _.updateMyPhone(i.value.phone)}catch(o){console.error(o)}finally{d.loading.hide()}}async function J(){try{d.loading.show();const o=await c.fetchAddresses();if(o){c.addresses=o;const s=o.find(S=>S.is_default===!0);c.addressId=s.id}}catch(o){console.error(o)}finally{d.loading.hide()}}return(o,s)=>{const S=le("q-item-action");return y(),q("div",null,[s[10]||(s[10]=m("h6",{class:"text-center q-mb-md"},"Личный кабинет",-1)),m("div",be,[e(L,{class:"my-card full-height",flat:"",bordered:""},{default:n(()=>[e(R,null,{default:n(()=>[m("div",ke,[e(K,{class:"radius-100",height:"120px",width:"120px",src:i.value?.main_image_url?i.value.main_image_url:f(pe)("/card-shop.jpg")},null,8,["src"])]),m("div",Ae,[m("div",null,$(i.value.full_name),1),m("div",null,[e(de,{modelValue:A.value,"onUpdate:modelValue":s[0]||(s[0]=t=>A.value=t),size:"sm","no-caps":"",unelevated:"",dense:"","toggle-color":"grey-9",color:"white","text-color":"grey-9",options:[{value:"dark",slot:"dark",title:"Dark mode"},{value:"light",slot:"light",title:"Light mode"}],onClick:s[1]||(s[1]=t=>F())},{dark:n(()=>[m("div",xe,[e(g,{name:"nightlight"})])]),light:n(()=>[m("div",Qe,[e(g,{name:"light_mode"})])]),_:1},8,["modelValue"])])]),!v.value&&i.value?.phone?(y(),q("div",Ce,[m("div",$e,$(i.value.phone),1),e(g,{onClick:s[2]||(s[2]=t=>v.value=!v.value),name:"edit",size:"30px",color:"green",class:"col-2"})])):(y(),q("div",Se,[e(g,{onClick:s[3]||(s[3]=t=>v.value=!v.value),name:"close",size:"30px",color:"red",class:"col-1"}),e(E,{class:"col-9",dense:"",outlined:"",modelValue:i.value.phone,"onUpdate:modelValue":s[4]||(s[4]=t=>i.value.phone=t),label:"Телефон",mask:"+# (###) ###-##-##",type:"tel"},null,8,["modelValue"]),e(g,{onClick:s[5]||(s[5]=t=>G()),name:"save",size:"30px",color:"green",class:"col-2"})])),m("div",qe,[e(T,{modelValue:f(c).addressId,"onUpdate:modelValue":s[6]||(s[6]=t=>f(c).addressId=t),options:f(c).addresses,class:"col-10",dense:"",outlined:"",label:"Адрес","emit-value":"","map-options":"","option-label":"address_line","option-value":"id"},{option:n(t=>[e(re,oe(t.itemProps,{class:"justify-between flex"}),{default:n(()=>[e(ie,{onClick:U=>a(t.opt)},{default:n(()=>[e(ue,null,{default:n(()=>[ne($(t.opt.address_line),1)]),_:2},1024)]),_:2},1032,["onClick"]),e(S,null,{default:n(()=>[e(g,{class:"q-mr-sm",color:"red",name:"delete",size:"26px",onClick:U=>x(t.opt)},null,8,["onClick"]),e(g,{color:"green",name:"edit",size:"26px",onClick:U=>Q(t.opt)},null,8,["onClick"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),e(g,{onClick:s[7]||(s[7]=t=>u()),name:"add",size:"34px",color:"green",class:"col-2"})])]),_:1})]),_:1})]),l.value?(y(),D(Ve,{key:0,modelValue:l.value,"onUpdate:modelValue":s[8]||(s[8]=t=>l.value=t),newAddress:r.value},null,8,["modelValue","newAddress"])):j("",!0),e(f(ye),{modelValue:V.value,"onUpdate:modelValue":s[9]||(s[9]=t=>V.value=t),settings:{location:{center:[37.617644,55.755819],zoom:9}},width:"100%",height:"500px"},{default:n(()=>[e(f(fe)),e(f(ge)),e(f(he),{settings:{coordinates:[37.617644,55.755819]}})]),_:1},8,["modelValue"])])}}});export{Fe as default};
