import{a as O,Q as E,P as x}from"./ProductImgCarusel-C6jUp7PG.js";import{d as L,ab as T,aa as G,u as H,c as J,r as k,o as K,ad as r,ae as n,ai as f,ak as s,f as l,al as u,aj as h,a9 as y,af as _,ag as p,aA as c,U as w,av as S,ah as W,aF as P}from"./index-C5OPW76n.js";import{Q as C}from"./QSelect-BBmMG8vo.js";import{C as U}from"./ClosePopup-t_WY4bjf.js";import{u as X}from"./use-quasar-DHz9wDzy.js";import{u as Y}from"./productsStore-B2-pRd8u.js";import{u as Z}from"./usePermissionVisibility.hook-Cbyt0fm1.js";import{u as ee}from"./categoriesStore-CeVbMcxo.js";import{u as ae}from"./unitsStore-DG0mWTrQ.js";import{e as oe}from"./orderStore-CFxBRblT.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./rtl-D3GObVCM.js";import"./QItem-BKVUcLfv.js";import"./QMenu-2kJLarbi.js";import"./useUtils-DO7iCsb-.js";const le={class:"q-pa-md product"},se={key:0},ie={class:"text-h6 q-mb-md"},ne={class:"text-center upload-title"},re={class:"row justify-end"},ue={key:1},de={class:"q-mb-sm"},me={key:0,class:"q-my-md"},pe={key:1,class:"text-grey old-price"},ce={key:2,class:"q-pa-md bg-light-gray radius-16"},ve={class:"row justify-end"},ge={key:1,class:"row"},fe={class:"bg-green q-pa-xs radius-100"},ye={class:"q-mx-sm self-center"},_e={class:"bg-green q-pa-xs radius-100"},be=L({__name:"ProductPage",emits:["refresh-data","add-product"],setup(Ve,{emit:D}){const d=X(),F=D,b=T(),Q=G(),v=Y(),R=H(),B=ee(),V=oe(),I=ae(),{isManager:$}=Z(J(()=>R.user?.role)),e=k({id:null,name:"",price:null,category_id:null,unit_id:null,qty:null,description:"",images:"",origin_country:"",unit:null}),m=k([]),i=new FormData;K(()=>{g()});function A(o){const a=m.value.findIndex(t=>t.id===o);m.value.splice(a,1),V.basketData.splice(a,1)}function q(o){try{d.loading.show(),m.value.push(structuredClone(P(o))),V.basketData.push(structuredClone(P(o)))}catch(a){console.error(a)}finally{d.loading.hide()}}async function z(){try{let o=null;e.value?.id?o=v.updateProduct(e.value):(j(),o=await v.createProduct(i)),o&&(e.value.id=o.id,d.notify({message:"Успешно сохранено",color:"primary"}),F("refresh-data"),Q.back())}catch(o){console.error(o)}}function j(){e?.value?.id&&i.append("id",e.value.id.toString()),e.value?.name&&i.append("name",e.value.name),e.value?.price&&i.append("price",e.value.price.toString()),e.value?.category_id&&i.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&i.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&i.append("qty",e.value.qty.toString()),e.value?.description&&i.append("description",e.value.description),e.value?.origin_country&&i.append("origin_country",e.value.origin_country)}function N(o){const a=new FileReader;a.readAsDataURL(o[0]),a.onload=()=>{},i.append("images",o[0]),e.value?.id&&M(o[0])}async function M(o){const a=new FormData;a.append("file",o),a.append("is_primary","true");try{await v.uploadFile(e.value.id,a)&&(g(),d.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(t){console.error(t)}}async function g(){if(b?.params?.id)try{d.loading.show();const o=await v.fetchProductsById(+b.params.id);o&&(e.value=o)}catch(o){console.error(o)}finally{d.loading.hide()}}return(o,a)=>(n(),r("div",le,[f($)?(n(),r("div",se,[s("div",ie,u(e.value.id?"Редактирование товара":"Добавление товара"),1),l(E,{ref:"uploaderRef",color:"primary",flat:"",onAdded:N},{header:h(()=>[...a[12]||(a[12]=[])]),list:h(()=>[l(O),s("div",ne,[l(y,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[13]||(a[13]=s("span",null,"Загрузить картинку",-1))])]),_:1},512),s("div",null,[e.value?.images?.length?(n(),_(x,{key:0,onRefreshData:a[0]||(a[0]=t=>g()),images:e.value.images},null,8,["images"])):p("",!0)]),l(c,{modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.name=t),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),l(c,{modelValue:e.value.price,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.price=t),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),l(c,{modelValue:e.value.qty,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.qty=t),class:"q-mb-xs",outlined:"",label:"Количество"},null,8,["modelValue"]),l(c,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.origin_country=t),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),l(C,{modelValue:e.value.category_id,"onUpdate:modelValue":a[5]||(a[5]=t=>e.value.category_id=t),options:f(B).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),l(C,{modelValue:e.value.unit_id,"onUpdate:modelValue":a[6]||(a[6]=t=>e.value.unit_id=t),options:f(I).units,outlined:"",label:"Единица измерения","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),l(c,{class:"q-mt-sm q-mb-sm",modelValue:e.value.description,"onUpdate:modelValue":a[7]||(a[7]=t=>e.value.description=t),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"]),s("div",re,[w(l(S,{color:"green",label:"Подтвердить",onClick:a[8]||(a[8]=t=>z())},null,512),[[U]])])])):(n(),r("div",ue,[e.value?.images?.length?(n(),_(x,{key:0,images:e.value.images},null,8,["images"])):p("",!0),s("div",de,[e.value?.name?(n(),r("h6",me,u(e.value.name),1)):p("",!0),e.value?.old_price?(n(),r("div",pe,u(e.value.old_price)+" ₽",1)):p("",!0),s("div",{class:W(["text-bold text-18 q-mb-md",e.value?.old_price?"text-red":""])},u(e.value.price)+" ₽/ "+u(e.value.unit_name),3),e.value.description?(n(),r("div",ce,u(e.value.description),1)):p("",!0)]),s("div",ve,[m.value?.length?(n(),r("div",ge,[s("div",fe,[l(y,{name:"remove",color:"white",size:"30px",onClick:a[10]||(a[10]=t=>A(e.value.id))})]),s("span",ye,u(m.value?.length),1),s("div",_e,[l(y,{name:"add",color:"white",size:"30px",onClick:a[11]||(a[11]=t=>q(e.value))})])])):w((n(),_(S,{key:0,color:"green",label:"Добавить в корзину",onClick:a[9]||(a[9]=t=>q(e.value))},null,512)),[[U]])])]))]))}}),$e=te(be,[["__scopeId","data-v-09a73a8b"]]);export{$e as default};
