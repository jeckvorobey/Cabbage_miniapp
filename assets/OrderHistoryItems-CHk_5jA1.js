import{b as o,Q as x,a as m}from"./QItem-me-TR8Qj.js";import{Q as E}from"./QList-mVHah_O-.js";import{Q as P}from"./QBtnDropdown-Bu0s32kx.js";import{C as $}from"./ClosePopup-B8XAWI8M.js";import{d as B,u as z}from"./use-quasar-w1OI9H8r.js";import{u as F}from"./orderStore-Cuk03w4W.js";import{b as W,h as X,V as M,r as S,X as _,Y as s,ad as Y,Z as e,$ as t,a0 as Z,aa as V,_ as y,a9 as Q,a7 as O,a5 as u,a6 as d,a4 as A,Q as j,a8 as w,a1 as v,a2 as L,a3 as I,W as J,al as K}from"./index-S2HywuQa.js";import{Q as ee}from"./QBadge-NYbjg2GX.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";var g=(c=>(c.CREATED="created",c.ASSEMBLING="assembling",c.DELIVERING="delivering",c.COMPLETED="completed",c.CANCELLED="cancelled",c))(g||{});const te=W({name:"QSpace",setup(){const c=X("div",{class:"q-space"});return()=>c}}),ae={class:"text-h6 q-mt-xs"},le={class:"q-mb-sm"},se={class:"row"},oe={key:0,class:"text-italic text-grey"},ne={key:1,class:"text-italic text-grey"},re={class:"col-12 col-md-4 text-right"},ue={class:"text-h5 text-weight-bold text-green"},ie=M({__name:"OrderHistoryModal",props:{orderHistoryData:{},orderStatus:{}},setup(c){const C=c,h=S(!1);function f(i){const a=C.orderStatus.find(k=>k.value===i);return{color:a?.value===g.CANCELLED?"negative":"positive",label:a?.label||"-"}}return(i,a)=>(s(),_(Y,{ref:"dialogRef",modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=p=>h.value=p),persistent:""},{default:e(()=>[t(Z,{class:"order-history-modal"},{default:e(()=>[t(V,{class:"row items-center q-pb-xs q-pr-xs q-pt-xs"},{default:e(()=>[y("div",ae,[t(o,null,{default:e(()=>[...a[1]||(a[1]=[u("Детали Заказа",-1)])]),_:1}),t(o,{caption:""},{default:e(()=>[u(d(A(B)(i.orderHistoryData.order_date))+"г",1)]),_:1})]),t(te),i.orderHistoryData?.status?(s(),_(o,{key:0,class:"q-mr-sm"},{default:e(()=>[t(ee,{class:"q-pa-xs",color:f(i.orderHistoryData.status).color},{default:e(()=>[u(d(f(i.orderHistoryData.status).label),1)]),_:1},8,["color"])]),_:1})):Q("",!0),O(t(j,{icon:"close",flat:"",round:"",dense:""},null,512),[[$]])]),_:1}),t(w),t(V,{class:"q-pt-none"},{default:e(()=>[y("div",le,[t(E,null,{default:e(()=>[t(x,{dense:"",class:"q-pa-none"},{default:e(()=>[t(m,null,{default:e(()=>[t(o,{caption:"",lines:"1"},{default:e(()=>[...a[2]||(a[2]=[u("Товар",-1)])]),_:1})]),_:1}),t(m,null,{default:e(()=>[t(o,{caption:"",lines:"1"},{default:e(()=>[...a[3]||(a[3]=[u("Кол.",-1)])]),_:1})]),_:1}),t(m,null,{default:e(()=>[t(o,{caption:"",lines:"1"},{default:e(()=>[...a[4]||(a[4]=[u("Цена",-1)])]),_:1})]),_:1})]),_:1}),(s(!0),v(L,null,I(i.orderHistoryData.items,(p,k)=>(s(),_(x,{key:k,dense:"",class:"q-pa-none"},{default:e(()=>[t(m,null,{default:e(()=>[t(o,null,{default:e(()=>[u(d(p?.name||"-"),1)]),_:2},1024)]),_:2},1024),t(m,null,{default:e(()=>[t(o,null,{default:e(()=>[u(d(p?.quantity),1)]),_:2},1024)]),_:2},1024),t(m,null,{default:e(()=>[t(o,null,{default:e(()=>[u(d(p?.price)+" ₽",1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(w)]),y("div",se,[y("div",null,[i.orderHistoryData.comment?(s(),v("div",oe,"Комментарий: "+d(i.orderHistoryData.comment),1)):(s(),v("div",ne,"Комментарий отсутствует."))]),y("div",re,[a[5]||(a[5]=y("div",{class:"text-subtitle1 text-weight-medium"},"Итого:",-1)),y("div",ue,d(i.orderHistoryData.total_amount)+" ₽",1)])])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),de=R(ie,[["__scopeId","data-v-7a03c6c2"]]),ce={class:"order-history"},me=["href"],fe={key:1},pe=M({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},setup(c){const C=z(),h=F(),f=S(!1),i=S(),a=[{label:"создан",value:g.CREATED},{label:"собирается",value:g.ASSEMBLING},{label:"в пути",value:g.DELIVERING},{label:"завершён",value:g.COMPLETED},{label:"отменён",value:g.CANCELLED}];function p(n,r){C.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{k(n,r)})}async function k(n,r){try{C.loading.show(),await h.updateOrderStatus(n,r)&&C.notify({color:"primary",message:"Статус успешно изменен"})}catch(D){console.error(D)}finally{C.loading.hide()}}function T(n){return a.find(D=>D.value===n)?.label}function q(n){const r=n.username?.trim().replace(/^@/,"");return r?`https://t.me/${encodeURIComponent(r)}`:null}function N(n){if(!n.phone)return null;const r=n.phone.trim();return r.length?r:null}function H(n){i.value=n,f.value=!f.value}return(n,r)=>{const D=J("q-item-action");return s(),v("div",ce,[t(E,null,{default:e(()=>[(s(!0),v(L,null,I(n.orderData,(l,U)=>(s(),_(x,{key:l.id??U,class:K(["border-bot",l.is_paid?"light-red":"light-green"])},{default:e(()=>[t(m,{onClick:b=>H(l)},{default:e(()=>[N(l.user)?(s(),_(o,{key:0,caption:"",class:"text-10"},{default:e(()=>[u(d(N(l.user)),1)]),_:2},1024)):Q("",!0),t(o,null,{default:e(()=>[q(l.user)?(s(),v("a",{key:0,href:q(l.user),target:"_blank",rel:"noopener noreferrer",class:"text-primary text-decoration-none"},d(l.user.full_name),9,me)):(s(),v("span",fe,d(l.user.full_name),1))]),_:2},1024)]),_:2},1032,["onClick"]),t(m,{onClick:b=>H(l)},{default:e(()=>[t(o,{caption:"",class:"text-10"},{default:e(()=>[u(d(A(B)(l.order_date)),1)]),_:2},1024),t(o,null,{default:e(()=>[u(d(T(l.status)),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(m,{onClick:b=>H(l)},{default:e(()=>[t(o,{caption:"",class:"text-10"},{default:e(()=>[...r[1]||(r[1]=[u("Общая сумма",-1)])]),_:1}),t(o,null,{default:e(()=>[u(d(l.total_amount),1)]),_:2},1024)]),_:2},1032,["onClick"]),n.adminMode?(s(),_(D,{key:0},{default:e(()=>[t(P,{size:"10px",color:"green",dense:""},{default:e(()=>[(s(),v(L,null,I(a,(b,G)=>t(E,{key:G},{default:e(()=>[O((s(),_(x,{clickable:"",onClick:_e=>p(l.id,b.value)},{default:e(()=>[t(m,null,{default:e(()=>[t(o,null,{default:e(()=>[u(d(b.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[$]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):Q("",!0)]),_:2},1032,["class"]))),128))]),_:1}),f.value&&i.value?(s(),_(de,{key:0,modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=l=>f.value=l),orderHistoryData:i.value,orderStatus:a},null,8,["modelValue","orderHistoryData"])):Q("",!0)])}}}),xe=R(pe,[["__scopeId","data-v-8d32da98"]]);export{xe as O};
