import{k as M,g as K,a as W,u as V,v as me,O as ge,c as I,h as w,l as z,t as pe,P as he,r as x,w as k,ai as le,aj as se,n as De,o as ne,x as be,ak as A,S as N,al as X,q as O,am as R,R as ye,an as Be,ao as xe,K as Z,N as _e,ap as Pe,d as Y,a7 as J,a6 as q,ab as B,f,ac as C,L as G,Q as L,a5 as U,ae as Se,aa as Ve,F as Ce,ad as $,ag as ee,a8 as qe,aq as te}from"./index-JCx6HPdl.js";import{h as re,j as Ee,Q as ae,i as ie,C as oe,k as ke,l as Fe}from"./orderStore-eSr3hx30.js";import{e as Qe,Q as H,d as j}from"./QCardSection-D-MOdFf1.js";import{Q as ue}from"./QCard-DiS5Epve.js";import{u as ce}from"./use-quasar-Co2ycpvu.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ae=M({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(s,{slots:p}){const{proxy:{$q:v}}=K(),n=W(me,V);if(n===V)return console.error("QPage needs to be a deep child of QLayout"),V;if(W(ge,V)===V)return console.error("QPage needs to be child of QPageContainer"),V;const c=I(()=>{const g=(n.header.space===!0?n.header.size:0)+(n.footer.space===!0?n.footer.size:0);if(typeof s.styleFn=="function"){const t=n.isContainer.value===!0?n.containerHeight.value:v.screen.height;return s.styleFn(g,t)}return{minHeight:n.isContainer.value===!0?n.containerHeight.value-g+"px":v.screen.height===0?g!==0?`calc(100vh - ${g}px)`:"100vh":v.screen.height-g+"px"}}),d=I(()=>`q-page${s.padding===!0?" q-layout-padding":""}`);return()=>w("main",{class:d.value,style:c.value},z(p.default))}}),{passive:P}=pe,$e=M({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:he,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(s,{slots:p,emit:v}){const n=x(!1),e=x(!0),c=x(null),d=x(null);let g=s.initialIndex,t,o;const m=I(()=>"q-infinite-scroll__loading"+(n.value===!0?"":" invisible"));function l(){if(s.disable===!0||n.value===!0||e.value===!1)return;const i=A(t),y=N(t),E=X(t);s.reverse===!1?Math.round(y+E+s.offset)>=Math.round(i)&&r():Math.round(y)<=s.offset&&r()}function r(){if(s.disable===!0||n.value===!0||e.value===!1)return;g++,n.value=!0;const i=A(t);v("load",g,y=>{e.value===!0&&(n.value=!1,O(()=>{if(s.reverse===!0){const E=A(t),fe=N(t),ve=E-i;R(t,fe+ve)}y===!0?_():c.value&&c.value.closest("body")&&o()}))})}function a(){g=0}function D(){e.value===!1&&(e.value=!0,t.addEventListener("scroll",o,P)),l()}function _(){e.value===!0&&(e.value=!1,n.value=!1,t.removeEventListener("scroll",o,P),o?.cancel?.())}function S(){if(t&&e.value===!0&&t.removeEventListener("scroll",o,P),t=ye(c.value,s.scrollTarget),e.value===!0){if(t.addEventListener("scroll",o,P),s.reverse===!0){const i=A(t),y=X(t);R(t,i-y)}l()}}function F(i){g=i}function T(i){i=parseInt(i,10);const y=o;o=i<=0?l:Be(l,isNaN(i)===!0?100:i),t&&e.value===!0&&(y!==void 0&&t.removeEventListener("scroll",y,P),t.addEventListener("scroll",o,P))}function u(i){if(h.value===!0){if(d.value===null){i!==!0&&O(()=>{u(!0)});return}const y=`${n.value===!0?"un":""}pauseAnimations`;Array.from(d.value.getElementsByTagName("svg")).forEach(E=>{E[y]()})}}const h=I(()=>s.disable!==!0&&e.value===!0);k([n,h],()=>{u()}),k(()=>s.disable,i=>{i===!0?_():D()}),k(()=>s.reverse,()=>{n.value===!1&&e.value===!0&&l()}),k(()=>s.scrollTarget,S),k(()=>s.debounce,T);let b=!1;le(()=>{b!==!1&&t&&R(t,b)}),se(()=>{b=t?N(t):!1}),De(()=>{e.value===!0&&t.removeEventListener("scroll",o,P)}),ne(()=>{T(s.debounce),S(),n.value===!1&&u()});const Q=K();return Object.assign(Q.proxy,{poll:()=>{o?.()},trigger:r,stop:_,reset:a,resume:D,setIndex:F,updateScrollTarget:S}),()=>{const i=be(p.default,[]);return h.value===!0&&i[s.reverse===!1?"push":"unshift"](w("div",{ref:d,class:m.value},z(p.loading))),w("div",{class:"q-infinite-scroll",ref:c},i)}}}),Ie=M({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(s,{slots:p,emit:v}){const n=K(),e=x(null);let c=0;const d=[];function g(a){const D=typeof a=="boolean"?a:s.noErrorFocus!==!0,_=++c,S=(u,h)=>{v(`validation${u===!0?"Success":"Error"}`,h)},F=u=>{const h=u.validate();return typeof h.then=="function"?h.then(b=>({valid:b,comp:u}),b=>({valid:!1,comp:u,err:b})):Promise.resolve({valid:h,comp:u})};return(s.greedy===!0?Promise.all(d.map(F)).then(u=>u.filter(h=>h.valid!==!0)):d.reduce((u,h)=>u.then(()=>F(h).then(b=>{if(b.valid===!1)return Promise.reject(b)})),Promise.resolve()).catch(u=>[u])).then(u=>{if(u===void 0||u.length===0)return _===c&&S(!0),!0;if(_===c){const{comp:h,err:b}=u[0];if(b!==void 0&&console.error(b),S(!1,h),D===!0){const Q=u.find(({comp:i})=>typeof i.focus=="function"&&xe(i.$)===!1);Q!==void 0&&Q.comp.focus()}}return!1})}function t(){c++,d.forEach(a=>{typeof a.resetValidation=="function"&&a.resetValidation()})}function o(a){a!==void 0&&Z(a);const D=c+1;g().then(_=>{D===c&&_===!0&&(s.onSubmit!==void 0?v("submit",a):a?.target!==void 0&&typeof a.target.submit=="function"&&a.target.submit())})}function m(a){a!==void 0&&Z(a),v("reset"),O(()=>{t(),s.autofocus===!0&&s.noResetFocus!==!0&&l()})}function l(){Qe(()=>{if(e.value===null)return;(e.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||e.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||e.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(e.value.querySelectorAll("[tabindex]"),D=>D.tabIndex!==-1))?.focus({preventScroll:!0})})}_e(Pe,{bindComponent(a){d.push(a)},unbindComponent(a){const D=d.indexOf(a);D!==-1&&d.splice(D,1)}});let r=!1;return se(()=>{r=!0}),le(()=>{r===!0&&s.autofocus===!0&&l()}),ne(()=>{s.autofocus===!0&&l()}),Object.assign(n.proxy,{validate:g,resetValidation:t,submit:o,reset:m,focus:l,getValidationComponents:()=>d}),()=>w("form",{class:"q-form",ref:e,onSubmit:o,onReset:m},z(p.default))}}),we=Y({__name:"AddProductModal",setup(s){const p=ce(),v=re(),n=x(!1),e=x({name:"",category_id:"",unit_id:"",qty:null,description:""}),c=[{label:"Овощи",value:1},{label:"Фрукты",value:2},{label:"Ягоды",value:3}],d=[{label:"Кг",value:1},{label:"г",value:2},{label:"Шт",value:3}];async function g(){try{await v.createProduct(e.value)&&p.notify({message:"Товар успешно создан",color:"primary"})}catch(t){console.error(t)}}return(t,o)=>(q(),J(Ee,{ref:"dialogRef",modelValue:n.value,"onUpdate:modelValue":o[6]||(o[6]=m=>n.value=m),persistent:""},{default:B(()=>[f(ue,{class:"add-product"},{default:B(()=>[f(Ie,{greedy:""},{default:B(()=>[f(H,null,{default:B(()=>[o[7]||(o[7]=C("div",{class:"text-h6 q-mb-md"},"Добавление товара",-1)),f(j,{modelValue:e.value.name,"onUpdate:modelValue":o[0]||(o[0]=m=>e.value.name=m),label:"Наименование товара","stack-label":""},null,8,["modelValue"]),f(j,{modelValue:e.value.qty,"onUpdate:modelValue":o[1]||(o[1]=m=>e.value.qty=m),label:"Количество","stack-label":""},null,8,["modelValue"]),f(ae,{modelValue:e.value.category_id,"onUpdate:modelValue":o[2]||(o[2]=m=>e.value.category_id=m),options:c,label:"Тип тары","emit-value":"","map-options":""},null,8,["modelValue"]),f(ae,{modelValue:e.value.unit_id,"onUpdate:modelValue":o[3]||(o[3]=m=>e.value.unit_id=m),options:d,label:"Вес","emit-value":"","map-options":""},null,8,["modelValue"]),f(j,{class:"q-mt-sm",modelValue:e.value.description,"onUpdate:modelValue":o[4]||(o[4]=m=>e.value.description=m),filled:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),f(ie,{align:"right"},{default:B(()=>[G(f(L,{color:"red",label:"Отмена"},null,512),[[oe]]),G(f(L,{color:"primary",label:"Подтвердить",onClick:o[5]||(o[5]=m=>g())},null,512),[[oe]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Le=de(we,[["__scopeId","data-v-3a03af60"]]),Te={class:"product-card row q-col-gutter-xs"},Ne={class:"text-center card-title"},Re={class:"text-center"},Ue={class:"text-bold"},je={key:0,class:"text-grey old-price"},Oe=Y({__name:"ProductList",setup(s){const p=ce(),v=re(),n=ke(),e=x(!1),c=x(!1),d=x({offset:0,limit:20,totla:0});async function g(){try{p.loading.show();const l=await v.fetchProducts(d.value);l&&(v?.products?.length?v.products.push(l.items):(v.products=l.items,d.value.totla=l.total))}catch(l){console.error(l)}finally{p.loading.hide()}}function t(l){try{if(p.loading.show(),n.basketData?.length){const r=n.basketData.find(a=>a.id===l.id);r?o(r,l):n.basketData.push(structuredClone(te(l)))}else n.basketData.push(structuredClone(te(l)))}catch(r){console.error(r)}finally{p.notify({message:`Товар ${l.name} добавлен в корзину`,color:"primary"}),p.loading.hide()}}function o(l,r){l.price&&(l.price+=r.price),l.weight&&(l.weight+=r.weight),l.oldPrice&&(l.oldPrice+=r.oldPrice)}const m=(l,r)=>{if(v?.products?.length>=d.value.totla){e.value=!0,r(!0);return}g(),d.value.offset++,r()};return(l,r)=>(q(),J($e,{onLoad:m,offset:250},{default:B(()=>[f(L,{onClick:r[0]||(r[0]=a=>c.value=!c.value),class:"full-width q-mb-sm",color:"secondary",label:"Добавление товара"}),C("div",Te,[(q(!0),U(Ce,null,Se(Ve(v).products,(a,D)=>(q(),U("div",{class:"col-6",key:D},[f(ue,{class:"my-card radius-12 full-height",style:{"border-radius":"20px"},flat:"",bordered:""},{default:B(()=>[f(H,{class:"q-pa-sm full-height"},{default:B(()=>[C("div",null,[f(Fe,{class:"cursor-pointer",src:"https://media.istockphoto.com/id/1141529240/ru/%D0%B2%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%BD%D0%B0%D1%8F/%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%D0%B5-%D1%8F%D0%B1%D0%BB%D0%BE%D0%BA%D0%BE-%D0%B2-%D0%BF%D0%BB%D0%BE%D1%81%D0%BA%D0%BE%D0%BC-%D1%81%D1%82%D0%B8%D0%BB%D0%B5-%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%B2%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0.jpg?s=612x612&w=0&k=20&c=B-KXrA7VTm8E6t4jk9qcuFz8bDFzTJwiIGaYGYUcsZI="})]),f(H,{class:"q-pa-sm"},{default:B(()=>[C("div",Ne,$(a.name),1),C("div",Re,[C("span",Ue,$(a.price),1),r[2]||(r[2]=ee(" ₽ ",-1)),a?.oldPrice?(q(),U("span",je,$(a.old_price)+" ₽",1)):qe("",!0),ee(" / "+$(a.unit_symbol),1)])]),_:2},1024),f(ie,{class:"justify-center"},{default:B(()=>[f(L,{dense:"","no-caps":"",class:"full-width",color:"secondary",icon:"add_shopping_cart",label:"В корзину",onClick:_=>t(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),f(Le,{modelValue:c.value,"onUpdate:modelValue":r[1]||(r[1]=a=>c.value=a),label:"test"},null,8,["modelValue"])]),_:1}))}}),He=de(Oe,[["__scopeId","data-v-5cbc2935"]]),Xe=Y({__name:"DashboardPage",setup(s){return(p,v)=>(q(),J(Ae,{class:"q-mx-xs"},{default:B(()=>[f(He,{class:"q-mb-lg"})]),_:1}))}});export{Xe as default};
