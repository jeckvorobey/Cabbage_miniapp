import{k as E,aK as N,aL as j,g as z,r as b,a8 as K,c as y,z as T,w as L,o as W,h as m,ac as F,l as G,Q as q,K as J,aI as X,aJ as P,d as Y,af as Z,ai as B,ah as h,am as s,an as ee,f as r,ar as ae,ag as H,F as O,ap as $,al as R,as as S,ao as C,aj as te,X as ne,aa as oe}from"./index-FiVUXmGD.js";import{u as le,Q as p,b as Q,a as k}from"./use-quasar-BK5dcviZ.js";import{Q as M}from"./QList-CJeNeEYF.js";import{Q as se}from"./QBtnGroup-DOBVGuTr.js";import{Q as re}from"./QMenu-vdFMgmXi.js";import{Q as ie}from"./QInfiniteScroll-D-IZ8sGd.js";import{C as ue}from"./ClosePopup-RwPN_dFR.js";import{b as ce,a as de}from"./useUtils-CuRKjlLr.js";import"./selection-DcDhta-M.js";const fe=Object.keys(j);function me(e){return fe.reduce((t,n)=>{const l=e[n];return l!==void 0&&(t[n]=l),t},{})}const he=E({name:"QBtnDropdown",props:{...j,...N,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noEscDismiss:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,noRefocus:Boolean,noFocus:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:t,emit:n}){const{proxy:l}=z(),i=b(e.modelValue),c=b(null),w=K(),v=y(()=>{const a={"aria-expanded":i.value===!0?"true":"false","aria-haspopup":"true","aria-controls":w.value,"aria-label":e.toggleAriaLabel||l.$q.lang.label[i.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(a["aria-disabled"]="true"),a}),D=y(()=>"q-btn-dropdown__arrow"+(i.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),_=y(()=>T(e)),o=y(()=>me(e));L(()=>e.modelValue,a=>{c.value?.[a?"show":"hide"]()}),L(()=>e.split,I);function u(a){i.value=!0,n("beforeShow",a)}function f(a){n("show",a),n("update:modelValue",!0)}function d(a){i.value=!1,n("beforeHide",a)}function A(a){n("hide",a),n("update:modelValue",!1)}function g(a){n("click",a)}function U(a){J(a),I(),n("click",a)}function V(a){c.value?.toggle(a)}function x(a){c.value?.show(a)}function I(a){c.value?.hide(a)}return Object.assign(l,{show:x,hide:I,toggle:V}),W(()=>{e.modelValue===!0&&x()}),()=>{const a=[m(F,{class:D.value,name:e.dropdownIcon||l.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&a.push(m(re,{ref:c,id:w.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noEscDismiss:e.noEscDismiss,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,noFocus:e.noFocus,noRefocus:e.noRefocus,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:u,onShow:f,onBeforeHide:d,onHide:A},t.default)),e.split===!1?m(q,{class:"q-btn-dropdown q-btn-dropdown--simple",...o.value,...v.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:g},{default:()=>G(t.label,[]).concat(a),loading:t.loading}):m(se,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,..._.value,glossy:e.glossy,stretch:e.stretch},()=>[m(q,{class:"q-btn-dropdown--current",...o.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:U},{default:t.label,loading:t.loading}),m(q,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...v.value,..._.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>a)])}}}),ge=X("Users",()=>{const e=b();async function t(l){return P.get("users",{params:l}).then(i=>i.data).catch(i=>{throw console.error("[UsersStore] - An error occurred while fetching via Users",i.message),i})}async function n(l,i){return P.patch(`/users/${l}/toggle-role`,{role:i}).then(c=>c.data).catch(c=>{throw console.error("[UsersStore] - An error occurred while creating via updateUserRole",c.message),c})}return{users:e,fetchUsers:t,updateUserRole:n}}),ke=Y({__name:"UsersPage",setup(e){const t=le(),n=ge(),l=b({offset:0,limit:20,total:0,has_more:!0}),i=b([{name:"Администратор",value:1},{name:"Мунуджер",value:2},{name:"Пользователь",value:9}]),c=async(o,u)=>{if(console.log(o),!l.value.has_more){u(!0);return}await w(),l.value.offset+=l.value.limit,u()};async function w(){try{t.loading.show();const o=await n.fetchUsers(l.value);o&&(l.value.total=o.total,l.value.has_more=o.has_more,n?.users?.length?n.users.push(o.items):n.users=o.items)}catch(o){console.error(o)}finally{t.loading.hide()}}function v(o,u){t.dialog({title:"Изменение прав пользователя",message:"Вы уверенны что хотите изменить права этого пользователя?",cancel:!0,persistent:!0}).onOk(()=>{D(o,u)})}async function D(o,u){try{t.loading.show(),await n.updateUserRole(o,u)&&t.notify({message:"Роль изменена",color:"primary"})}catch(f){console.error(f)}finally{t.loading.hide()}}function _(o){try{t.loading.show()}catch(u){console.error(u)}finally{t.notify({message:`Пользователь ${o.name} заблокирован`,color:"primary"}),t.loading.hide()}}return(o,u)=>{const f=Z("q-item-action");return h(),B(ie,{onLoad:c,offset:250},{default:s(()=>[u[0]||(u[0]=ee("h6",{class:"text-center q-mt-md q-mb-md"},"Пользователи",-1)),r(ae,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:s(()=>[(h(!0),H(O,null,$(R(n).users,(d,A)=>(h(),B(M,{key:A},{default:s(()=>[r(p,null,{default:s(()=>[r(Q,{avatar:""},{default:s(()=>[r(F,{color:"primary",name:"local_bar"})]),_:1}),r(Q,null,{default:s(()=>[r(k,null,{default:s(()=>[S(C(d.name),1)]),_:2},1024),r(k,{caption:""},{default:s(()=>[S(C(d.telegram_id),1)]),_:2},1024)]),_:2},1024),r(Q,null,{default:s(()=>[r(k,{caption:""},{default:s(()=>[S(C(R(ce)(d.role)),1)]),_:2},1024)]),_:2},1024),r(f,null,{default:s(()=>[R(de)?(h(),B(q,{key:0,flat:"",round:"",color:"red",icon:"disabled_visible",onClick:g=>_(d)},null,8,["onClick"])):te("",!0),r(he,{dense:"",flat:"",color:"primary","dropdown-icon":"change_history"},{default:s(()=>[r(M,null,{default:s(()=>[(h(!0),H(O,null,$(i.value,(g,U)=>ne((h(),B(p,{key:U,clickable:"",onClick:V=>v(d.id,g.value)},{default:s(()=>[r(Q,null,{default:s(()=>[r(k,null,{default:s(()=>[S(C(g.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[ue]])),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),r(oe)]),_:2},1024))),128))]),_:1})]),_:1})}}});export{ke as default};
