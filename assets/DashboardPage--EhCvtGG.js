import{e as ae,h as E,aj as B,bi as k,bn as te,bo as oe,m as O,i as le,j as ne,r as P,V as A,X as _,Y as c,ae as re,Z as s,$ as o,a4 as h,aa as M,_ as m,a6 as b,Q as se,ab as w,ac as q,ad as H,a7 as S,z as V,a1 as I,a0 as ie,a9 as de,g as ue,a3 as ce,a2 as pe,a5 as me,am as fe,a8 as ge}from"./index-CK0ElmSy.js";import{Q as X}from"./QImg-BZfkuw8f.js";import{Q as ve,a as L,b as N}from"./QItem-CDNw1yBw.js";import{Q as ye}from"./QList-C6U-Gmfn.js";import{Q as _e}from"./QInfiniteScroll-CppfKf_c.js";import{u as Y}from"./productsStore-BBaxZjf2.js";import{u as Z,f as he,g as G}from"./use-quasar-BMwnSylD.js";import{g as be,Q as Ce,a as Qe}from"./QUploader-D2WVCJ1S.js";import{Q as Ve}from"./QSelect-rnXUgCQq.js";import{Q as K}from"./QForm-BtKP1jSZ.js";import{C as F}from"./ClosePopup-B68BiOGn.js";import{u as J}from"./usePermissionVisibility.hook-BUuVN6HZ.js";import{P as T}from"./ProductImgCarusel-DoNYH9KE.js";import{u as Pe}from"./categoriesStore-CeGWl9cr.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ke}from"./useCart-B5pKpYg9.js";import"./format-CJebrXOQ.js";import"./QMenu-bnlJw1lk.js";import"./rtl-DFPa-2ov.js";import"./QBtnDropdown-mvQ9i95i.js";import"./orderStore-zH59pHZU.js";const xe=ae({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(g,{slots:d}){const{proxy:{$q:u}}=E(),l=B(te,k);if(l===k)return console.error("QPage needs to be a deep child of QLayout"),k;if(B(oe,k)===k)return console.error("QPage needs to be child of QPageContainer"),k;const y=O(()=>{const f=(l.header.space===!0?l.header.size:0)+(l.footer.space===!0?l.footer.size:0);if(typeof g.styleFn=="function"){const Q=l.isContainer.value===!0?l.containerHeight.value:u.screen.height;return g.styleFn(f,Q)}return{minHeight:l.isContainer.value===!0?l.containerHeight.value-f+"px":u.screen.height===0?f!==0?`calc(100vh - ${f}px)`:"100vh":u.screen.height-f+"px"}}),C=O(()=>`q-page${g.padding===!0?" q-layout-padding":""}`);return()=>le("main",{class:C.value,style:y.value},ne(d.default))}});function z(){const{emit:g,proxy:d}=E(),u=P(null);function l(){u.value.show()}function v(){u.value.hide()}function y(f){g("ok",f),v()}function C(){g("hide")}return Object.assign(d,{show:l,hide:v}),{dialogRef:u,onDialogHide:C,onDialogOK:y,onDialogCancel:v}}const ee=["ok","hide"];z.emits=ee;z.emitsObject=be(ee);const qe={class:"text-h6 q-mb-md"},we={class:"text-center upload-title"},$e={class:"q-mb-md"},De={key:1},Se={class:"text-h6 text-center q-mt-sm"},Fe={class:"text-bold"},Ie=A({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(g,{emit:d}){const u=g,l=d,v=Z(),y=Y(),C=Pe(),{dialogRef:f}=z(),{isManager:Q}=J(),$=P(!1),x=P(),e=P({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),p=new FormData;u.productData&&(e.value=u.productData);async function R(){try{let t=null;e.value?.id?t=y.updateProduct(e.value):(U(),t=await y.createProduct(p)),t&&(e.value.id=t.id,v.notify({color:"primary",message:"Успешно сохранено"}),l("refresh-data"))}catch(t){console.error(t)}}function j(){l("add-product",e.value)}function U(){e?.value?.id&&p.append("id",e.value.id.toString()),e.value?.name&&p.append("name",e.value.name),e.value?.price&&p.append("price",e.value.price.toString()),e.value?.category_id&&p.append("category_id",e.value.category_id.toString()),e.value?.qty&&p.append("qty",e.value.qty.toString()),e.value?.description&&p.append("description",e.value.description),e.value?.origin_country&&p.append("origin_country",e.value.origin_country)}function D(t){const a=new FileReader;a.readAsDataURL(t[0]),a.onload=()=>{},p.delete("images"),p.append("images",t[0]),e.value?.id&&i(t[0])}async function i(t){const a=new FormData;a.append("file",t),a.append("is_primary","true");try{await y.uploadFile(e.value.id,a)&&(r(),v.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(n){console.error(n)}finally{x.value&&x.value.reset()}}async function r(){try{const t=await y.fetchProductsById(e.value.id);e.value=t}catch(t){console.error(t)}}return(t,a)=>(c(),_(re,{ref_key:"dialogRef",ref:f,modelValue:$.value,"onUpdate:modelValue":a[10]||(a[10]=n=>$.value=n),persistent:""},{default:s(()=>[o(ie,{class:"add-product"},{default:s(()=>[h(Q)?(c(),_(K,{key:0,greedy:""},{default:s(()=>[o(M,null,{default:s(()=>[m("div",qe,b(e.value.id?"Редактирование товара":"Добавление товара"),1),o(Ce,{ref_key:"uploaderRef",ref:x,class:"q-mb-md",color:"primary",flat:"","max-file-size":"15728640",onAdded:D,onRejected:a[0]||(a[0]=n=>h(he)(h(v)))},{header:s(()=>[...a[11]||(a[11]=[])]),list:s(()=>[o(Qe),m("div",we,[o(se,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[12]||(a[12]=m("span",null,"Загрузить картинку",-1))])]),_:1},512),m("div",$e,[e.value?.images?.length?(c(),_(T,{key:0,images:e.value.images,onRefreshData:a[1]||(a[1]=n=>r())},null,8,["images"])):w("",!0)]),o(q,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=n=>e.value.name=n),class:"q-mb-md",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),o(q,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=n=>e.value.price=n),class:"q-mb-md",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),o(q,{modelValue:e.value.qty,"onUpdate:modelValue":a[4]||(a[4]=n=>e.value.qty=n),class:"q-mb-md",outlined:"",label:"Количество",type:"number"},null,8,["modelValue"]),o(q,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[5]||(a[5]=n=>e.value.origin_country=n),class:"q-mb-md",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),o(Ve,{modelValue:e.value.category_id,"onUpdate:modelValue":a[6]||(a[6]=n=>e.value.category_id=n),options:h(C).categories,class:"q-mb-md",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),o(q,{modelValue:e.value.description,"onUpdate:modelValue":a[7]||(a[7]=n=>e.value.description=n),class:"q-mb-md",outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),o(H,{align:"right"},{default:s(()=>[S(o(V,{color:"red",label:"Отмена"},null,512),[[F]]),S(o(V,{color:"primary",label:"Подтвердить",onClick:a[8]||(a[8]=n=>R())},null,512),[[F]])]),_:1})]),_:1})):(c(),_(K,{key:1},{default:s(()=>[o(M,null,{default:s(()=>[m("div",null,[e.value?.images?.length?(c(),_(T,{key:0,images:e.value.images},null,8,["images"])):(c(),I("div",De,[o(X,{class:"q-mt-sm",src:h(G)("/card-shop.jpg")},null,8,["src"])]))]),m("div",Se,b(e.value.name),1),m("div",Fe,"Стоимость товара: "+b(e.value.price),1),m("div",null,"Страна происхождения: "+b(e.value.origin_country),1),m("div",null,"Описание: "+b(e.value.description),1)]),_:1}),o(H,{align:"right"},{default:s(()=>[S(o(V,{color:"red",label:"Отмена"},null,512),[[F]]),S(o(V,{color:"primary",label:"Добавить в корзину",onClick:a[9]||(a[9]=n=>j())},null,512),[[F]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),Re=W(Ie,[["__scopeId","data-v-4c606175"]]),je={class:"product-card"},Ue={key:0,class:"text-grey old-price"},Le={key:0,class:"q-mb-sm"},Ae=A({__name:"ProductList",setup(g){const d=Z(),u=de(),l=Y(),{addToCart:v}=ke(),{isManager:y,isAdmin:C}=J(),f=P(!1),Q=P(!1),$=P();ue(async()=>{await e()});function x(){l.pagination.offset=0,e()}async function e(){try{d.loading.show();const i={limit:l.pagination.limit,offset:l.pagination.offset},r=await l.fetchProducts(i);r&&(l.pagination.total=r.total,l.pagination.has_more=r.has_more,l?.products?.length?l.products.push(r.items):l.products=r.items)}catch(i){console.error(i)}finally{d.loading.hide()}}function p(i){try{d.loading.show(),v(i)}catch(r){console.error(r)}finally{d.loading.hide()}}const R=async(i,r)=>{if(!l.pagination.has_more){f.value=!0,r(!0);return}await e(),l.pagination.offset+=l.pagination.limit,r()};function j(i){d.dialog({cancel:!0,message:"Вы уверенны что хотите удалить товар?",persistent:!0,title:"Удаление товара"}).onOk(()=>{U(i)})}async function U(i){try{if(!i?.id)return;await l.deleteProduct(i.id),d.loading.show()}catch(r){console.error(r)}finally{d.loading.hide()}}function D(i){u.push({name:"products-edit",params:{id:i.id}})}return(i,r)=>(c(),_(_e,{offset:250,onLoad:R},{default:s(()=>[h(y)?(c(),_(V,{key:0,class:"full-width q-mb-sm",color:"green",label:"Добавить товар",onClick:r[0]||(r[0]=t=>h(u).push({name:"products-create"}))})):w("",!0),m("div",je,[(c(!0),I(pe,null,ce(h(l).products,(t,a)=>(c(),_(ye,{key:a},{default:s(()=>[o(ve,null,{default:s(()=>[o(L,{top:"",avatar:"",onClick:n=>D(t)},{default:s(()=>[o(X,{class:"cursor-pointer radius-8",src:t.primary_image?t.primary_image:h(G)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),o(L,{class:"column justify-between",onClick:n=>D(t)},{default:s(()=>[o(N,{caption:"",class:"text-size-16"},{default:s(()=>[me(b(t.name),1)]),_:2},1024),o(N,null,{default:s(()=>[t?.old_price?(c(),I("div",Ue,b(t.old_price)+" ₽",1)):w("",!0),m("div",{class:fe(t?.old_price?"text-red":"")},b(t.price)+" ₽/шт.",3)]),_:2},1024)]),_:2},1032,["onClick"]),o(L,{side:"",top:"",class:"column justify-between"},{default:s(()=>[m("div",null,[h(C)?(c(),I("div",Le,[o(V,{dense:"",round:"",color:"red",icon:"delete",onClick:n=>j(t)},null,8,["onClick"])])):w("",!0),m("div",null,[o(V,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:n=>p(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024),o(ge,{spaced:"",inset:""})]),_:2},1024))),128))]),Q.value?(c(),_(Re,{key:1,modelValue:Q.value,"onUpdate:modelValue":r[1]||(r[1]=t=>Q.value=t),productData:$.value,onRefreshData:r[2]||(r[2]=t=>x()),onAddProduct:p},null,8,["modelValue","productData"])):w("",!0)]),_:1}))}}),ze=W(Ae,[["__scopeId","data-v-b2584d57"]]),sa=A({__name:"DashboardPage",setup(g){return(d,u)=>(c(),_(xe,{class:"q-mx-xs"},{default:s(()=>[o(ze,{class:"q-mb-lg"})]),_:1}))}});export{sa as default};
