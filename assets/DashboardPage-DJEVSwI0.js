import{m as le,g as Z,a as M,z as Q,A as ie,Z as re,c as H,h as de,n as ue,r as x,d as z,aj as b,ae as g,aF as ce,af as r,f as o,ak as _,aG as K,aq as m,am as v,a6 as pe,as as q,av as $,aH as E,W as F,ah as C,ad as R,aI as me,ac as fe,o as X,ag as ge,F as ve,aJ as ye,al as J,aC as _e,ai as he}from"./index-Bmsp0X1_.js";import{u as B}from"./use-quasar-Cyd-yKEk.js";import{Q as Y}from"./QImg-VeAQv5NL.js";import{Q as be,a as L,b as O}from"./QItem-B2Wb2A3e.js";import{Q as ke}from"./QList-CwgFID1B.js";import{Q as Ce}from"./QInfiniteScroll-BMAHSRah.js";import{u as ee}from"./productsStore-BnYUxcMI.js";import{e as xe}from"./orderStore-vD3kNbp7.js";import{g as Qe,Q as we,a as Pe}from"./QUploader-B6yD7K_h.js";import{Q as T}from"./QSelect-BjaZNCiM.js";import{Q as G}from"./QForm-CcNZtsbb.js";import{C as I}from"./ClosePopup-D_cdtQAh.js";import{u as te}from"./usePermissionVisibility.hook-COzHra5R.js";import{P as W}from"./ProductImgCarusel-rtGDn04E.js";import{u as Ve}from"./categoriesStore-SpltPsNQ.js";import{u as ae}from"./unitsStore-BPLg8kQv.js";import{f as qe,g as oe}from"./useUtils-CrkES8ah.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as De}from"./addressesStore-Bp_SVIDs.js";import"./QMenu-CPyLGiuP.js";import"./format-CJebrXOQ.js";import"./rtl-DFPa-2ov.js";const Se=le({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(h,{slots:d}){const{proxy:{$q:c}}=Z(),u=M(ie,Q);if(u===Q)return console.error("QPage needs to be a deep child of QLayout"),Q;if(M(re,Q)===Q)return console.error("QPage needs to be child of QPageContainer"),Q;const p=H(()=>{const y=(u.header.space===!0?u.header.size:0)+(u.footer.space===!0?u.footer.size:0);if(typeof h.styleFn=="function"){const w=u.isContainer.value===!0?u.containerHeight.value:c.screen.height;return h.styleFn(y,w)}return{minHeight:u.isContainer.value===!0?u.containerHeight.value-y+"px":c.screen.height===0?y!==0?`calc(100vh - ${y}px)`:"100vh":c.screen.height-y+"px"}}),k=H(()=>`q-page${h.padding===!0?" q-layout-padding":""}`);return()=>de("main",{class:k.value,style:p.value},ue(d.default))}});function N(){const{emit:h,proxy:d}=Z(),c=x(null);function u(){c.value.show()}function n(){c.value.hide()}function p(y){h("ok",y),n()}function k(){h("hide")}return Object.assign(d,{show:u,hide:n}),{dialogRef:c,onDialogHide:k,onDialogOK:p,onDialogCancel:n}}const se=["ok","hide"];N.emits=se;N.emitsObject=Qe(se);const $e={class:"text-h6 q-mb-md"},Fe={class:"text-center upload-title"},Ie={key:1},Re={class:"text-h6 text-center q-mt-sm"},Ue={class:"text-bold"},Ae=z({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(h,{emit:d}){const c=h,u=d,n=B(),p=ee(),k=Ve(),{dialogRef:y}=N(),{isManager:w}=te(),P=ae(),D=x(!1),V=x(),e=x({id:null,name:"",price:null,category_id:null,unit_id:null,description:"",images:"",origin_country:"",unit:null}),f=new FormData;c.productData&&(e.value=c.productData);async function U(){try{let t=null;e.value?.id?t=p.updateProduct(e.value):(j(),t=await p.createProduct(f)),t&&(e.value.id=t.id,n.notify({message:"Успешно сохранено",color:"primary"}),u("refresh-data"))}catch(t){console.error(t)}}function A(){u("add-product",e.value)}function j(){e?.value?.id&&f.append("id",e.value.id.toString()),e.value?.name&&f.append("name",e.value.name),e.value?.price&&f.append("price",e.value.price.toString()),e.value?.category_id&&f.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&f.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&f.append("qty",e.value.qty.toString()),e.value?.description&&f.append("description",e.value.description),e.value?.origin_country&&f.append("origin_country",e.value.origin_country)}function S(t){const a=new FileReader;a.readAsDataURL(t[0]),a.onload=()=>{},f.delete("images"),f.append("images",t[0]),e.value?.id&&i(t[0])}async function i(t){const a=new FormData;a.append("file",t),a.append("is_primary","true");try{await p.uploadFile(e.value.id,a)&&(s(),n.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(l){console.error(l)}finally{V.value&&V.value.reset()}}async function s(){try{const t=await p.fetchProductsById(e.value.id);e.value=t}catch(t){console.error(t)}}return(t,a)=>(g(),b(ce,{ref_key:"dialogRef",ref:y,modelValue:D.value,"onUpdate:modelValue":a[10]||(a[10]=l=>D.value=l),persistent:""},{default:r(()=>[o(me,{class:"add-product"},{default:r(()=>[_(w)?(g(),b(G,{key:0,greedy:""},{default:r(()=>[o(K,null,{default:r(()=>[m("div",$e,v(e.value.id?"Редактирование товара":"Добавление товара"),1),o(we,{ref_key:"uploaderRef",ref:V,color:"primary",flat:"","max-file-size":"15728640",onAdded:S,onRejected:a[0]||(a[0]=l=>_(qe)(_(n)))},{header:r(()=>[...a[11]||(a[11]=[])]),list:r(()=>[o(Pe),m("div",Fe,[o(pe,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[12]||(a[12]=m("span",null,"Загрузить картинку",-1))])]),_:1},512),m("div",null,[e.value?.images?.length?(g(),b(W,{key:0,onRefreshData:a[1]||(a[1]=l=>s()),images:e.value.images},null,8,["images"])):q("",!0)]),o($,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.name=l),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),o($,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.price=l),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),o($,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.origin_country=l),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),o(T,{modelValue:e.value.category_id,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.category_id=l),options:_(k).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),o(T,{modelValue:e.value.unit_id,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.unit_id=l),options:_(P).units,outlined:"",label:"Единица измерения","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),o($,{class:"q-mt-sm",modelValue:e.value.description,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.description=l),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),o(E,{align:"right"},{default:r(()=>[F(o(C,{color:"red",label:"Отмена"},null,512),[[I]]),F(o(C,{color:"primary",label:"Подтвердить",onClick:a[8]||(a[8]=l=>U())},null,512),[[I]])]),_:1})]),_:1})):(g(),b(G,{key:1},{default:r(()=>[o(K,null,{default:r(()=>[m("div",null,[e.value?.images?.length?(g(),b(W,{key:0,images:e.value.images},null,8,["images"])):(g(),R("div",Ie,[o(Y,{class:"q-mt-sm",src:_(oe)("/card-shop.jpg")},null,8,["src"])]))]),m("div",Re,v(e.value.name),1),m("div",Ue,"Стоимость товара: "+v(e.value.price),1),m("div",null,"Вес: 11 "+v(e.value?.unit?.name||"")+".",1),m("div",null,"Страна происхождения: "+v(e.value.origin_country),1),m("div",null,"Описание: "+v(e.value.description),1)]),_:1}),o(E,{align:"right"},{default:r(()=>[F(o(C,{color:"red",label:"Отмена"},null,512),[[I]]),F(o(C,{color:"primary",label:"Добавить в корзину",onClick:a[9]||(a[9]=l=>A())},null,512),[[I]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),je=ne(Ae,[["__scopeId","data-v-76a805e9"]]),Le={class:"product-card"},Oe={key:0,class:"text-grey old-price"},ze={class:"row items-end"},Be={key:0,class:"q-mb-sm"},Ne=z({__name:"ProductList",setup(h){const d=B(),c=fe(),u=ae(),n=ee(),p=xe(),{isManager:k,isAdmin:y}=te(),w=x(!1),P=x(!1),D=x();X(async()=>{try{await u.fetchUnits(),d.loading.show()}catch(i){console.error(i)}finally{d.loading.hide()}});function V(){n.pagination.offset=0,e()}async function e(){try{d.loading.show();const i={offset:n.pagination.offset,limit:n.pagination.limit},s=await n.fetchProducts(i);s&&(n.pagination.total=s.total,n.pagination.has_more=s.has_more,n?.products?.length?n.products.push(s.items):n.products=s.items)}catch(i){console.error(i)}finally{d.loading.hide()}}function f(i){try{const s={...structuredClone(ye(i)),quantity:1,product_id:i.id,price:typeof i.price=="string"?parseFloat(i.price):Number(i.price)||0};if(d.loading.show(),!p.basketData.length)p.basketData.push(s);else{const t=p.basketData.find(a=>a.id===i.id);if(t){const a=typeof t.quantity=="string"?parseInt(t.quantity,10):Number(t.quantity)||0;t.quantity=a+1}else p.basketData.push(s)}window.localStorage.setItem("basket",JSON.stringify(p.basketData))}catch(s){console.error(s)}finally{d.loading.hide()}}const U=async(i,s)=>{if(!n.pagination.has_more){w.value=!0,s(!0);return}await e(),n.pagination.offset+=n.pagination.limit,s()};function A(i){d.dialog({title:"Удаление товара",message:"Вы уверенны что хотите удалить товар?",cancel:!0,persistent:!0}).onOk(()=>{j(i)})}async function j(i){try{if(!i?.id)return;await n.deleteProduct(i.id),d.loading.show()}catch(s){console.error(s)}finally{d.loading.hide()}}function S(i){c.push({name:"products-edit",params:{id:i.id}})}return(i,s)=>(g(),b(Ce,{onLoad:U,offset:250},{default:r(()=>[_(k)?(g(),b(C,{key:0,onClick:s[0]||(s[0]=t=>_(c).push({name:"products-create"})),class:"full-width q-mb-sm",color:"green",label:"Добавить товар"})):q("",!0),m("div",Le,[(g(!0),R(ve,null,ge(_(n).products,(t,a)=>(g(),b(ke,{key:a},{default:r(()=>[o(be,null,{default:r(()=>[o(L,{top:"",avatar:"",onClick:l=>S(t)},{default:r(()=>[o(Y,{class:"cursor-pointer radius-8",src:t[0]?.primary_image?t[0].primary_image:_(oe)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),o(L,{class:"column justify-between",onClick:l=>S(t)},{default:r(()=>[o(O,{caption:"",class:"text-size-16"},{default:r(()=>[J(v(t.name),1)]),_:2},1024),o(O,null,{default:r(()=>[t?.old_price?(g(),R("div",Oe,v(t.old_price)+" ₽",1)):q("",!0),m("div",{class:_e(t?.old_price?"text-red":"")},v(t.price)+" ₽/ "+v(t.unit_name),3)]),_:2},1024)]),_:2},1032,["onClick"]),o(L,{side:"",top:"",class:"column justify-between"},{default:r(()=>[s[3]||(s[3]=m("div",null,null,-1)),m("div",ze,[o(O,{class:"q-mr-xs",caption:""},{default:r(()=>[J(v(t.price)+" ₽/ "+v(t.unit_name),1)]),_:2},1024),m("div",null,[_(y)?(g(),R("div",Be,[o(C,{dense:"",round:"",color:"red",icon:"delete",onClick:l=>A(t)},null,8,["onClick"])])):q("",!0),m("div",null,[o(C,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:l=>f(t)},null,8,["onClick"])])])])]),_:2},1024)]),_:2},1024),o(he,{spaced:"",inset:""})]),_:2},1024))),128))]),P.value?(g(),b(je,{key:1,modelValue:P.value,"onUpdate:modelValue":s[1]||(s[1]=t=>P.value=t),productData:D.value,onRefreshData:s[2]||(s[2]=t=>V()),onAddProduct:f},null,8,["modelValue","productData"])):q("",!0)]),_:1}))}}),Me=ne(Ne,[["__scopeId","data-v-38ea5495"]]),pt=z({__name:"DashboardPage",setup(h){const d=B(),c=De();X(()=>{u()});async function u(){try{d.loading.show();const n=await c.fetchAddresses();if(n){c.addresses=n;const p=n.find(k=>k.is_default===!0);c.addressId=p.id}}catch(n){console.error(n)}finally{d.loading.hide()}}return(n,p)=>(g(),b(Se,{class:"q-mx-xs"},{default:r(()=>[o(Me,{class:"q-mb-lg"})]),_:1}))}});export{pt as default};
