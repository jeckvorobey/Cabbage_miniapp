import{V as A,r as b,B as z,f as E,X as S,Y as d,Z as D,_ as u,$ as n,a6 as m,C as U,a9 as y,ab as h,a4 as w,Q as N,aY as L,am as O,m as X,a1 as c,al as $}from"./index-CzvVlkJm.js";import{u as T,r as R}from"./use-quasar-DyxdFqbr.js";import{u as j}from"./productsStore-DvmEhshr.js";import{P as M}from"./ProductImgCarusel-C2Q8nTvi.js";import{Q as Z,a as G}from"./QUploader-DpT-rby_.js";import{Q as H}from"./QSelect-fyib9V47.js";import{Q as J}from"./QForm-3OWiQFa8.js";import{u as K}from"./categoriesStore-De9k38N-.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as W}from"./usePermissionVisibility.hook-B48mZyp7.js";import{u as ee}from"./useCart-Cj6cMlMN.js";import{u as ae}from"./orderStore-DRSZu_BZ.js";import"./QItem-COm4KtQe.js";import"./QList-Cddpp3pA.js";import"./QBtnDropdown-_AzfaLBC.js";import"./QMenu-Cn-XbHXO.js";import"./ClosePopup-Bw8GIkKR.js";import"./format-CJebrXOQ.js";import"./rtl-DFPa-2ov.js";const te={class:"text-h6 q-mb-md"},oe={class:"text-center upload-title"},le={class:"row justify-end"},re=A({__name:"ProductForm",props:{product:{}},emits:["submit","refresh-data"],setup(B,{expose:F,emit:p}){const q=B,g=p,Q=T(),_=j(),C=K(),v=b(),l=new FormData,e=b({...q.product});z(()=>q.product,s=>{e.value={...s}},{deep:!0});const V=E(()=>C.categories||[]);function k(){r(),g("submit",e.value,l)}function a(){g("refresh-data")}function r(){l.delete("id"),l.delete("name"),l.delete("price"),l.delete("category_id"),l.delete("qty"),l.delete("description"),l.delete("origin_country"),e.value?.id&&l.append("id",e.value.id.toString()),e.value?.name&&l.append("name",e.value.name),e.value?.price&&l.append("price",e.value.price.toString()),e.value?.category_id&&l.append("category_id",e.value.category_id.toString()),e.value?.qty&&l.append("qty",e.value.qty.toString()),e.value?.description&&l.append("description",e.value.description),e.value?.origin_country&&l.append("origin_country",e.value.origin_country)}function P(s){const t=new FileReader;t.readAsDataURL(s[0]),t.onload=()=>{},l.append("images",s[0]),e.value?.id&&I(s[0])}async function I(s){const t=new FormData;t.append("file",s),t.append("is_primary","true");try{await _.uploadFile(e.value.id,t)&&(a(),Q.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(i){console.error(i)}finally{v.value&&v.value.reset()}}return F({generateFormData:r}),(s,t)=>(d(),S(J,{class:"column q-gutter-md",greedy:"",onSubmit:k},{default:D(()=>[u("div",te,m(s.product.id?"Редактирование товара":"Добавление товара"),1),n(Z,{ref_key:"uploaderRef",ref:v,color:"primary",flat:"","max-file-size":"15728640",onAdded:P},{header:D(()=>[...t[6]||(t[6]=[])]),list:D(()=>[n(G),u("div",oe,[n(U,{class:"q-mr-sm",name:"note_add",size:"24px"}),t[7]||(t[7]=u("span",null,"Загрузить картинку",-1))])]),_:1},512),u("div",null,[s.product?.images?.length?(d(),S(M,{key:0,images:s.product.images,onRefreshData:a},null,8,["images"])):y("",!0)]),n(h,{modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=i=>e.value.name=i),rules:[w(R)],outlined:"",label:"Наименование товара *"},null,8,["modelValue","rules"]),n(H,{modelValue:e.value.category_id,"onUpdate:modelValue":t[1]||(t[1]=i=>e.value.category_id=i),rules:[w(R)],options:V.value,outlined:"",label:"Категория *","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","rules","options"]),n(h,{modelValue:e.value.price,"onUpdate:modelValue":t[2]||(t[2]=i=>e.value.price=i),rules:[w(R)],outlined:"",label:"Стоимость товара *"},null,8,["modelValue","rules"]),n(h,{modelValue:e.value.qty,"onUpdate:modelValue":t[3]||(t[3]=i=>e.value.qty=i),outlined:"",label:"Количество",type:"number"},null,8,["modelValue"]),n(h,{modelValue:e.value.origin_country,"onUpdate:modelValue":t[4]||(t[4]=i=>e.value.origin_country=i),outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),n(h,{modelValue:e.value.description,"onUpdate:modelValue":t[5]||(t[5]=i=>e.value.description=i),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"]),u("div",le,[n(N,{color:"green",label:"Подтвердить",type:"submit"})])]),_:1}))}}),ie=Y(re,[["__scopeId","data-v-fe18954d"]]),se={class:"q-pa-md product"},ne={key:0},de={key:1},ue={class:"q-mb-sm"},ce={key:0,class:"q-my-md text-center"},me={key:1,class:"text-grey"},pe={class:"text-grey"},ve={key:2,class:"text-grey old-price"},fe={key:3,class:"q-pa-md bg-light-gray radius-16"},ye={class:"row justify-end"},ge={key:1,class:"row"},_e={class:"bg-green q-pa-xs radius-100"},he={class:"q-mx-sm self-center"},be={class:"bg-green q-pa-xs radius-100"},qe=A({__name:"ProductActionPage",emits:["refresh-data","add-product"],setup(B,{emit:F}){const p=T(),q=F,g=L(),Q=O(),_=j(),C=ae(),v=b(),{isManager:l}=W(),{addToCart:e,updateQuantity:V,getCartItem:k}=ee(),a=b({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),r=b([]);z(C.basketData,o=>{r.value=o.find(x=>x.id===r.value.id)}),X(()=>{i()});function P(){try{p.loading.show(),e(a.value)&&a.value.id&&(r.value=k(a.value.id))}catch(o){console.error(o)}finally{p.loading.hide()}}function I(){if(r.value){const o=V(r.value,1);o?r.value=o:r.value=void 0}}function s(){if(r.value){const o=V(r.value,-1);o?r.value=o:r.value=void 0}}async function t(o,x){try{let f=null;o?.id?f=await _.updateProduct(o):(v.value&&v.value.generateFormData(),f=await _.createProduct(x)),f&&(a.value.id=f.id,p.notify({color:"primary",message:"Успешно сохранено"}),q("refresh-data"),Q.back())}catch(f){console.error(f)}}async function i(){if(g?.params?.id)try{p.loading.show();const o=await _.fetchProductsById(+g.params.id);o&&(a.value=o,a.value.id&&(r.value=k(a.value.id)))}catch(o){console.error(o)}finally{p.loading.hide()}}return(o,x)=>(d(),c("div",se,[w(l)?(d(),c("div",ne,[n(ie,{ref_key:"productFormRef",ref:v,product:a.value,onSubmit:t,onRefreshData:i},null,8,["product"])])):(d(),c("div",de,[a.value?.images?.length?(d(),S(M,{key:0,class:$(a.value?.available_qty?"":"image-grayscale-100"),images:a.value.images},null,8,["class","images"])):y("",!0),u("div",ue,[a.value?.name?(d(),c("h6",ce,m(a.value.name),1)):y("",!0),a.value?.origin_country?(d(),c("div",me,"Страна производитель: "+m(a.value.origin_country),1)):y("",!0),u("div",pe,"Остаток: "+m(a.value?.available_qty?`${a.value.available_qty} шт.`:"Нет в наличии"),1),a.value?.old_price?(d(),c("div",ve,"Старая цена: "+m(a.value.old_price)+" ₽",1)):y("",!0),u("div",{class:$(["text-bold text-18 q-mb-md",a.value?.old_price?"text-red":""])}," Цена: "+m(a.value.price)+" ₽ ",3),a.value.description?(d(),c("div",fe,m(a.value.description),1)):y("",!0)]),u("div",ye,[r.value?.id?(d(),c("div",ge,[u("div",_e,[n(U,{name:"remove",color:"white",size:"30px",onClick:s})]),u("span",he,m(r.value.quantity),1),u("div",be,[n(U,{name:"add",color:"white",size:"30px",onClick:I})])])):(d(),S(N,{key:0,disabled:!a.value.available_qty,color:"green",label:"Добавить в корзину",onClick:P},null,8,["disabled"]))])]))]))}}),je=Y(qe,[["__scopeId","data-v-3283b2e1"]]);export{je as default};
