import{X as A,r as b,A as T,f as j,Z as w,_ as n,$ as C,a0 as d,a1 as s,a8 as m,M as D,ad as v,ae as h,a6 as x,Q as B,aX as X,ab as E,m as L,a3 as u,am as Z}from"./index-TWMozEHe.js";import{u as $}from"./use-quasar-DXTtSasI.js";import{u as z}from"./productsStore-54SbMLgD.js";import{P as M}from"./ProductImgCarusel-BYBrjKdP.js";import{Q as G,a as H}from"./QUploader-L8vOaE80.js";import{Q as J}from"./QSelect-jNZ90F6F.js";import{Q as K}from"./QForm-CE0RiKDN.js";import{u as O}from"./categoriesStore-CL3uD23a.js";import{r as I}from"./useUtils-B-leiMkc.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as W}from"./usePermissionVisibility.hook-CmS_Rd9u.js";import{u as Y}from"./useCart-F50_ESqI.js";import"./QItem-DJ-6SN4N.js";import"./QList-D51DKjrd.js";import"./QBtnDropdown-DtfsLo1K.js";import"./QMenu-BjoEkX2-.js";import"./ClosePopup-DWWMCTrG.js";import"./format-CJebrXOQ.js";import"./rtl-DFPa-2ov.js";import"./orderStore-DFJCX0HK.js";const ee={class:"text-h6 q-mb-md"},te={class:"text-center upload-title"},ae={class:"row justify-end"},oe=A({__name:"ProductForm",props:{product:{}},emits:["submit","refresh-data"],setup(R,{expose:F,emit:c}){const V=R,f=c,Q=$(),y=z(),g=O(),_=b(),r=new FormData,e=b({...V.product});T(()=>V.product,l=>{e.value={...l}},{deep:!0});const q=j(()=>g.categories||[]);function o(){k(),f("submit",e.value,r)}function i(){f("refresh-data")}function k(){r.delete("id"),r.delete("name"),r.delete("price"),r.delete("category_id"),r.delete("qty"),r.delete("description"),r.delete("origin_country"),e.value?.id&&r.append("id",e.value.id.toString()),e.value?.name&&r.append("name",e.value.name),e.value?.price&&r.append("price",e.value.price.toString()),e.value?.category_id&&r.append("category_id",e.value.category_id.toString()),e.value?.qty&&r.append("qty",e.value.qty.toString()),e.value?.description&&r.append("description",e.value.description),e.value?.origin_country&&r.append("origin_country",e.value.origin_country)}function S(l){const a=new FileReader;a.readAsDataURL(l[0]),a.onload=()=>{},r.append("images",l[0]),e.value?.id&&P(l[0])}async function P(l){const a=new FormData;a.append("file",l),a.append("is_primary","true");try{await y.uploadFile(e.value.id,a)&&(i(),Q.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(t){console.error(t)}finally{_.value&&_.value.reset()}}return F({generateFormData:k}),(l,a)=>(n(),w(K,{class:"column q-gutter-md",greedy:"",onSubmit:o},{default:C(()=>[d("div",ee,m(l.product.id?"Редактирование товара":"Добавление товара"),1),s(G,{ref_key:"uploaderRef",ref:_,color:"primary",flat:"","max-file-size":"15728640",onAdded:S},{header:C(()=>[...a[6]||(a[6]=[])]),list:C(()=>[s(H),d("div",te,[s(D,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[7]||(a[7]=d("span",null,"Загрузить картинку",-1))])]),_:1},512),d("div",null,[l.product?.images?.length?(n(),w(M,{key:0,images:l.product.images,onRefreshData:i},null,8,["images"])):v("",!0)]),s(h,{modelValue:e.value.name,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.name=t),rules:[x(I)],outlined:"",label:"Наименование товара *"},null,8,["modelValue","rules"]),s(J,{modelValue:e.value.category_id,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.category_id=t),rules:[x(I)],options:q.value,outlined:"",label:"Категория *","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","rules","options"]),s(h,{modelValue:e.value.price,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.price=t),rules:[x(I)],outlined:"",label:"Стоимость товара *"},null,8,["modelValue","rules"]),s(h,{modelValue:e.value.qty,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.qty=t),outlined:"",label:"Количество",type:"number"},null,8,["modelValue"]),s(h,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.origin_country=t),outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),s(h,{modelValue:e.value.description,"onUpdate:modelValue":a[5]||(a[5]=t=>e.value.description=t),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"]),d("div",ae,[s(B,{color:"green",label:"Подтвердить",type:"submit"})])]),_:1}))}}),re=N(oe,[["__scopeId","data-v-fe18954d"]]),ie={class:"q-pa-md product"},le={key:0},se={key:1},ne={class:"q-mb-sm"},de={key:0,class:"q-my-md text-center"},ue={key:1,class:"text-grey"},ce={key:2,class:"text-grey old-price"},me={key:3,class:"q-pa-md bg-light-gray radius-16"},pe={class:"row justify-end"},ve={key:1,class:"row"},fe={class:"bg-green q-pa-xs radius-100"},ye={class:"q-mx-sm self-center"},ge={class:"bg-green q-pa-xs radius-100"},_e=A({__name:"ProductActionPage",emits:["refresh-data","add-product"],setup(R,{emit:F}){const c=$(),V=F,f=X(),Q=E(),y=z(),g=b(),{isManager:_}=W(),{addToCart:r,updateQuantity:e,getCartItem:q}=Y(),o=b({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),i=b([]);L(()=>{a()});function k(){try{c.loading.show(),r(o.value)&&o.value.id&&(i.value=q(o.value.id))}catch(t){console.error(t)}finally{c.loading.hide()}}function S(){if(i.value){const t=e(i.value,1);t?i.value=t:i.value=void 0}}function P(){if(i.value){const t=e(i.value,-1);t?i.value=t:i.value=void 0}}async function l(t,U){try{let p=null;t?.id?p=await y.updateProduct(t):(g.value&&g.value.generateFormData(),p=await y.createProduct(U)),p&&(o.value.id=p.id,c.notify({color:"primary",message:"Успешно сохранено"}),V("refresh-data"),Q.back())}catch(p){console.error(p)}}async function a(){if(f?.params?.id)try{c.loading.show();const t=await y.fetchProductsById(+f.params.id);t&&(o.value=t,o.value.id&&(i.value=q(o.value.id)))}catch(t){console.error(t)}finally{c.loading.hide()}}return(t,U)=>(n(),u("div",ie,[x(_)?(n(),u("div",le,[s(re,{ref_key:"productFormRef",ref:g,product:o.value,onSubmit:l,onRefreshData:a},null,8,["product"])])):(n(),u("div",se,[o.value?.images?.length?(n(),w(M,{key:0,images:o.value.images},null,8,["images"])):v("",!0),d("div",ne,[o.value?.name?(n(),u("h6",de,m(o.value.name),1)):v("",!0),o.value.origin_country?(n(),u("div",ue,"Страна производитель: "+m(o.value.origin_country),1)):v("",!0),o.value?.old_price?(n(),u("div",ce,"Старая цена: "+m(o.value.old_price)+" ₽",1)):v("",!0),d("div",{class:Z(["text-bold text-18 q-mb-md",o.value?.old_price?"text-red":""])}," Цена: "+m(o.value.price)+" ₽ ",3),o.value.description?(n(),u("div",me,m(o.value.description),1)):v("",!0)]),d("div",pe,[i.value?.id?(n(),u("div",ve,[d("div",fe,[s(D,{name:"remove",color:"white",size:"30px",onClick:P})]),d("span",ye,m(i.value.quantity),1),d("div",ge,[s(D,{name:"add",color:"white",size:"30px",onClick:S})])])):(n(),w(B,{key:0,color:"green",label:"Добавить в корзину",onClick:k}))])]))]))}}),Me=N(_e,[["__scopeId","data-v-64f64ec9"]]);export{Me as default};
