import{V as L,r as h,W as U,X as m,Y as s,Z as e,_ as D,$ as a,a0 as V,a1 as v,a2 as y,a3 as Q,a4 as g,Q as N,a5 as f,a6 as d,a7 as R,a8 as $}from"./index-uHYAwrN6.js";import{Q as k,a as u,b as _}from"./QItem-C7guVh2W.js";import{Q as w}from"./QList-CDrZ7gFU.js";import{Q as P}from"./QBtnDropdown-DcKpnKEv.js";import{Q as E}from"./QInfiniteScroll-bYsRyaf-.js";import{C as F}from"./ClosePopup-DNobT9tp.js";import{u as O,a as T}from"./use-quasar-BmoZ4Q_8.js";import{u as W}from"./usersStore-DcAEKJsz.js";import"./QMenu-CrMQXal9.js";const ee=L({__name:"UsersPage",setup(X){const l=O(),n=W(),r=h({has_more:!0,limit:20,offset:0,total:0}),C=h([{name:"Администратор",value:1},{name:"Менеджер",value:2},{name:"Пользователь",value:9}]),b=async(t,o)=>{if(!r.value.has_more){o(!0);return}await x(),r.value.offset+=r.value.limit,o()};async function x(){try{l.loading.show();const t=await n.fetchUsers(r.value);t&&(r.value.total=t.total,r.value.has_more=t.has_more,n.users=t.items)}catch(t){console.error(t)}finally{l.loading.hide()}}function I(t,o){l.dialog({cancel:!0,message:"Вы уверенны что хотите изменить права этого пользователя?",persistent:!0,title:"Изменение прав пользователя"}).onOk(()=>{S(t,o)})}async function S(t,o){try{l.loading.show(),await n.updateUserRole(t.id,o)&&(t.role=o,l.notify({color:"primary",message:"Роль изменена"}))}catch(i){console.error(i)}finally{l.loading.hide()}}return(t,o)=>{const i=U("q-item-action");return s(),m(E,{offset:250,onLoad:b},{default:e(()=>[o[0]||(o[0]=D("h6",{class:"text-center q-mt-md q-mb-md"},"Пользователи",-1)),a(V,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:e(()=>[(s(!0),v(y,null,Q(g(n).users,(c,q)=>(s(),m(w,{key:q},{default:e(()=>[a(k,null,{default:e(()=>[a(u,{avatar:""},{default:e(()=>[a(N,{color:"primary",name:"local_bar"})]),_:1}),a(u,null,{default:e(()=>[a(_,null,{default:e(()=>[f(d(c.full_name),1)]),_:2},1024)]),_:2},1024),a(u,null,{default:e(()=>[a(_,{caption:""},{default:e(()=>[f(d(g(T)(c.role)),1)]),_:2},1024)]),_:2},1024),a(i,null,{default:e(()=>[a(P,{dense:"",flat:"",color:"primary","dropdown-icon":"change_history"},{default:e(()=>[a(w,null,{default:e(()=>[(s(!0),v(y,null,Q(C.value,(p,B)=>R((s(),m(k,{key:B,clickable:"",onClick:Y=>I(c,p.value)},{default:e(()=>[a(u,null,{default:e(()=>[a(_,null,{default:e(()=>[f(d(p.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[F]])),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a($)]),_:2},1024))),128))]),_:1})]),_:1})}}});export{ee as default};
