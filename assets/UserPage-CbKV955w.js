import{Q as K}from"./QImg-CoJoqBmb.js";import{V as M,r as c,h as P,a4 as q,M as y,ac as W,$ as n,_ as e,a2 as z,a5 as L,a0 as j,N as m,a1 as $,a9 as R,al as X,aa as Y,ab as ee,S as N,am as se,u as ae,e as B,an as I,ao as le,a3 as te,L as S,Z as h,a8 as f,ap as oe,a6 as ne}from"./index-hzzl6ab0.js";import{u as E,Q as de}from"./addressesStore-BbggWeP7.js";import{Q as re,a as ie,b as ue}from"./QItem-BzmsrDAC.js";import{Q as O}from"./QSelect-CUJpoEcs.js";import{u as T}from"./use-quasar-DuobLYDZ.js";import{Q as me}from"./QForm-3gq9mbns.js";import{C as ce}from"./ClosePopup-CqMmanln.js";import{g as pe}from"./useUtils-BSX_MfPo.js";import{u as ve}from"./usersStore-CQkcan4M.js";import{_ as fe,a as ge,b as he,d as ye}from"./vue-yandex-maps-COedU013.js";import"./QBtnGroup-D2FDx-vM.js";import"./QMenu-Dge-Erou.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const _e={class:"row q-pl-sm flex-center justify-between"},we={class:"text-grey-6"},Ve=M({__name:"AddAddressModal",props:{newAddress:{}},setup(D){const V=[[55.97,37.12],[56.02,37.33]],r=c([]),p=c(!1),_=c("Начните вводить адрес..."),b=D,w=T(),g=E(),v=c(!0),k=c(),t=c();P(async()=>{try{const i={area_id:null,address_line:"",comment:"",is_default:!1};b.newAddress?t.value=b.newAddress:t.value=i,w.loading.show();const a=await g.fetchDeliveryZones();a&&(g.deliveryZones=a)}catch(i){console.error(i)}finally{w.loading.hide()}});async function A(){try{await(t?.value?.id?g.updateAddress:g.createAddress)(t.value)}catch(i){console.error(i)}finally{k.value.hide()}}async function d(i,a){if(!i){_.value="Начните вводить адрес...",a(()=>{r.value=[]});return}const u=window.ymaps;if(!u){w.notify({type:"negative",message:"Сервис карт недоступен."});return}p.value=!0;try{const Q=(await u.geocode(i,{results:5,boundedBy:V,strictBounds:!0})).geoObjects.toArray().map(C=>({displayName:C.properties.get("text"),coords:C.geometry.getCoordinates()}));a(()=>{if(!Q?.length){r.value=[],_.value="Адрес не найден";return}r.value=Q})}catch(x){console.error("Ошибка геокодирования:",x)}finally{p.value=!1}}return(i,a)=>(y(),q(W,{ref_key:"dialogRef",ref:k,modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=u=>v.value=u),persistent:""},{default:n(()=>[e(z,{class:""},{default:n(()=>[e(me,{greedy:"",onSubmit:a[3]||(a[3]=u=>A())},{default:n(()=>[t.value?(y(),q(j,{key:0},{default:n(()=>[a[5]||(a[5]=m("div",{class:"text-h6"},"Создание нового адреса доставки",-1)),e(O,{class:"q-mb-sm",clearable:"",outlined:"","use-input":"",modelValue:t.value.address_line,"onUpdate:modelValue":a[0]||(a[0]=u=>t.value.address_line=u),options:r.value,"option-label":"displayName",label:"Адрес доставки",onFilter:d},{"no-option":n(()=>[m("div",_e,[m("div",we,$(_.value),1)])]),_:1},8,["modelValue","options"]),e(R,{label:"Комментарий",modelValue:t.value.comment,"onUpdate:modelValue":a[1]||(a[1]=u=>t.value.comment=u),outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"]),e(X,{modelValue:t.value.is_default,"onUpdate:modelValue":a[2]||(a[2]=u=>t.value.is_default=u),label:"Активный аддрес"},null,8,["modelValue"])]),_:1})):L("",!0),e(Y,{align:"right"},{default:n(()=>[ee(e(N,{color:"red",flat:"",label:"Отмена"},null,512),[[ce]]),e(N,{color:"primary",flat:"",label:"Сохранить",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),be={class:"q-pa-sm"},ke={class:"justify-center row q-mb-md"},Ae={class:"text-h5 justify-between q-mb-sm row"},xe={class:"items-center"},Qe={class:"items-center"},Ce={key:0,class:"row items-center q-mb-sm text-h6"},$e={style:{height:"40px"},class:"col-10 content-center"},Se={key:1,class:"row items-center q-mb-sm"},qe={class:"row items-center q-mb-sm"},Fe=M({__name:"UserPage",setup(D){const V=se(null),r=T(),p=E(),_=ve(),b=ae(),w=B(()=>I.isActive),g=le({dark:"dark",light:"light"}),v=c(!1),k=B(()=>w.value?g.dark:g.light),t=c(!1),A=c("dark"),d=c({full_name:"",mail:"",phone:"",addres:null}),i=c();P(()=>{d.value=b.user,H()});function a(o){d.value.addres=o,console.log(d.value.addres),C(o)}function u(){i.value=null,t.value=!t.value}async function x(o){try{r.loading.show(),await p.deleteAddress(o.id)}catch(s){console.error(s)}finally{r.loading.hide()}}function Q(o){i.value=o,t.value=!t.value}async function C(o){try{r.loading.show(),await p.updateAddress(o)}catch(s){console.error(s)}finally{r.loading.hide()}}const Z=()=>{I.toggle(),window.localStorage.setItem("theme",k.value)};function F(){r.dialog({title:"Смена номера телефона",message:"Вы уверенны что хотите изменить номер?",cancel:!0,persistent:!0}).onOk(()=>{G()})}async function G(){try{r.loading.show(),await _.updateMyPhone(d.value.phone)}catch(o){console.error(o)}finally{r.loading.hide()}}async function H(){try{r.loading.show();const o=await p.fetchAddresses();o&&(p.addresses=o)}catch(o){console.error(o)}finally{r.loading.hide()}}return(o,s)=>{const J=te("q-item-action");return y(),S("div",null,[s[10]||(s[10]=m("h6",{class:"text-center q-mb-md"},"Личный кабинет",-1)),m("div",be,[e(z,{class:"my-card full-height",flat:"",bordered:""},{default:n(()=>[e(j,null,{default:n(()=>[m("div",ke,[e(K,{class:"radius-100",height:"120px",width:"120px",src:d.value?.main_image_url?d.value.main_image_url:h(pe)("/card-shop.jpg")},null,8,["src"])]),m("div",Ae,[m("div",null,$(d.value.full_name),1),m("div",null,[e(de,{modelValue:A.value,"onUpdate:modelValue":s[0]||(s[0]=l=>A.value=l),size:"sm","no-caps":"",unelevated:"",dense:"","toggle-color":"grey-9",color:"white","text-color":"grey-9",options:[{value:"dark",slot:"dark",title:"Dark mode"},{value:"light",slot:"light",title:"Light mode"}],onClick:s[1]||(s[1]=l=>Z())},{dark:n(()=>[m("div",xe,[e(f,{name:"nightlight"})])]),light:n(()=>[m("div",Qe,[e(f,{name:"light_mode"})])]),_:1},8,["modelValue"])])]),!v.value&&d.value?.phone?(y(),S("div",Ce,[m("div",$e,$(d.value.phone),1),e(f,{onClick:s[2]||(s[2]=l=>v.value=!v.value),name:"edit",size:"30px",color:"green",class:"col-2"})])):(y(),S("div",Se,[e(f,{onClick:s[3]||(s[3]=l=>v.value=!v.value),name:"close",size:"30px",color:"red",class:"col-1"}),e(R,{class:"col-9",dense:"",outlined:"",modelValue:d.value.phone,"onUpdate:modelValue":s[4]||(s[4]=l=>d.value.phone=l),label:"Телефон",mask:"+# (###) ###-##-##",type:"tel"},null,8,["modelValue"]),e(f,{onClick:s[5]||(s[5]=l=>F()),name:"save",size:"30px",color:"green",class:"col-2"})])),m("div",qe,[e(O,{modelValue:d.value.addres,"onUpdate:modelValue":s[6]||(s[6]=l=>d.value.addres=l),options:h(p).addresses,class:"col-10",dense:"",outlined:"",label:"Адрес","emit-value":"","map-options":"","option-label":"address_line","option-value":"id"},{option:n(l=>[e(re,oe(l.itemProps,{class:"justify-between flex"}),{default:n(()=>[e(ie,{onClick:U=>a(l.opt)},{default:n(()=>[e(ue,null,{default:n(()=>[ne($(l.opt.address_line),1)]),_:2},1024)]),_:2},1032,["onClick"]),e(J,null,{default:n(()=>[e(f,{class:"q-mr-sm",color:"red",name:"delete",size:"26px",onClick:U=>x(l.opt)},null,8,["onClick"]),e(f,{color:"green",name:"edit",size:"26px",onClick:U=>Q(l.opt)},null,8,["onClick"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),e(f,{onClick:s[7]||(s[7]=l=>u()),name:"add",size:"34px",color:"green",class:"col-2"})])]),_:1})]),_:1})]),t.value?(y(),q(Ve,{key:0,modelValue:t.value,"onUpdate:modelValue":s[8]||(s[8]=l=>t.value=l),newAddress:i.value},null,8,["modelValue","newAddress"])):L("",!0),e(h(ye),{modelValue:V.value,"onUpdate:modelValue":s[9]||(s[9]=l=>V.value=l),settings:{location:{center:[37.617644,55.755819],zoom:9}},width:"100%",height:"500px"},{default:n(()=>[e(h(fe)),e(h(ge)),e(h(he),{settings:{coordinates:[37.617644,55.755819]}})]),_:1},8,["modelValue"])])}}});export{Fe as default};
