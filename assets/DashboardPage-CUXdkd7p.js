import{b as te,n as E,ai as O,bi as k,bn as oe,bo as ne,f as z,h as le,p as se,r as P,V as j,X as _,Y as p,ad as re,Z as r,$ as n,a4 as h,aa as M,_ as f,a6 as b,C as ie,a9 as w,ab as q,ac as H,a7 as S,Q as V,a1 as I,a0 as de,am as ue,m as X,a3 as ce,a2 as pe,a5 as me,al as fe,a8 as ge}from"./index-CsES-pSE.js";import{Q as Y}from"./QImg-sQVTuwej.js";import{Q as ve,a as L,b as N}from"./QItem-BO2aprUs.js";import{Q as ye}from"./QList-B9qCDLQe.js";import{Q as _e}from"./QInfiniteScroll-BaW07jmM.js";import{u as Z}from"./productsStore-0WxfD4T8.js";import{u as G,f as he,g as J}from"./use-quasar-znpKNyCr.js";import{g as be,Q as Ce,a as Qe}from"./QUploader-BlKXDXXx.js";import{Q as Ve}from"./QSelect-CkKzdWNB.js";import{Q as K}from"./QForm-gYIoKIOo.js";import{C as F}from"./ClosePopup-buC4N4si.js";import{u as W}from"./usePermissionVisibility.hook-Blsl2b3S.js";import{P as T}from"./ProductImgCarusel-p6TLY3on.js";import{u as Pe}from"./categoriesStore-CH-9i1rG.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ke}from"./useCart-Dbqr0KGj.js";import{u as xe}from"./addressesStore-ZN9DvHBU.js";import"./format-CJebrXOQ.js";import"./QMenu-DVinDEj7.js";import"./rtl-DFPa-2ov.js";import"./QBtnDropdown-DBNgHU5o.js";import"./orderStore-CxGrwaKQ.js";const qe=te({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(y,{slots:i}){const{proxy:{$q:u}}=E(),a=O(oe,k);if(a===k)return console.error("QPage needs to be a deep child of QLayout"),k;if(O(ne,k)===k)return console.error("QPage needs to be child of QPageContainer"),k;const g=z(()=>{const v=(a.header.space===!0?a.header.size:0)+(a.footer.space===!0?a.footer.size:0);if(typeof y.styleFn=="function"){const Q=a.isContainer.value===!0?a.containerHeight.value:u.screen.height;return y.styleFn(v,Q)}return{minHeight:a.isContainer.value===!0?a.containerHeight.value-v+"px":u.screen.height===0?v!==0?`calc(100vh - ${v}px)`:"100vh":u.screen.height-v+"px"}}),C=z(()=>`q-page${y.padding===!0?" q-layout-padding":""}`);return()=>le("main",{class:C.value,style:g.value},se(i.default))}});function B(){const{emit:y,proxy:i}=E(),u=P(null);function a(){u.value.show()}function c(){u.value.hide()}function g(v){y("ok",v),c()}function C(){y("hide")}return Object.assign(i,{show:a,hide:c}),{dialogRef:u,onDialogHide:C,onDialogOK:g,onDialogCancel:c}}const ae=["ok","hide"];B.emits=ae;B.emitsObject=be(ae);const we={class:"text-h6 q-mb-md"},$e={class:"text-center upload-title"},De={class:"q-mb-md"},Se={key:1},Fe={class:"text-h6 text-center q-mt-sm"},Ie={class:"text-bold"},Ae=j({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(y,{emit:i}){const u=y,a=i,c=G(),g=Z(),C=Pe(),{dialogRef:v}=B(),{isManager:Q}=W(),$=P(!1),x=P(),e=P({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),m=new FormData;u.productData&&(e.value=u.productData);async function A(){try{let o=null;e.value?.id?o=g.updateProduct(e.value):(U(),o=await g.createProduct(m)),o&&(e.value.id=o.id,c.notify({color:"primary",message:"Успешно сохранено"}),a("refresh-data"))}catch(o){console.error(o)}}function R(){a("add-product",e.value)}function U(){e?.value?.id&&m.append("id",e.value.id.toString()),e.value?.name&&m.append("name",e.value.name),e.value?.price&&m.append("price",e.value.price.toString()),e.value?.category_id&&m.append("category_id",e.value.category_id.toString()),e.value?.qty&&m.append("qty",e.value.qty.toString()),e.value?.description&&m.append("description",e.value.description),e.value?.origin_country&&m.append("origin_country",e.value.origin_country)}function D(o){const t=new FileReader;t.readAsDataURL(o[0]),t.onload=()=>{},m.delete("images"),m.append("images",o[0]),e.value?.id&&d(o[0])}async function d(o){const t=new FormData;t.append("file",o),t.append("is_primary","true");try{await g.uploadFile(e.value.id,t)&&(s(),c.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(l){console.error(l)}finally{x.value&&x.value.reset()}}async function s(){try{const o=await g.fetchProductsById(e.value.id);e.value=o}catch(o){console.error(o)}}return(o,t)=>(p(),_(re,{ref_key:"dialogRef",ref:v,modelValue:$.value,"onUpdate:modelValue":t[10]||(t[10]=l=>$.value=l),persistent:""},{default:r(()=>[n(de,{class:"add-product"},{default:r(()=>[h(Q)?(p(),_(K,{key:0,greedy:""},{default:r(()=>[n(M,null,{default:r(()=>[f("div",we,b(e.value.id?"Редактирование товара":"Добавление товара"),1),n(Ce,{ref_key:"uploaderRef",ref:x,class:"q-mb-md",color:"primary",flat:"","max-file-size":"15728640",onAdded:D,onRejected:t[0]||(t[0]=l=>h(he)(h(c)))},{header:r(()=>[...t[11]||(t[11]=[])]),list:r(()=>[n(Qe),f("div",$e,[n(ie,{class:"q-mr-sm",name:"note_add",size:"24px"}),t[12]||(t[12]=f("span",null,"Загрузить картинку",-1))])]),_:1},512),f("div",De,[e.value?.images?.length?(p(),_(T,{key:0,images:e.value.images,onRefreshData:t[1]||(t[1]=l=>s())},null,8,["images"])):w("",!0)]),n(q,{modelValue:e.value.name,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.name=l),class:"q-mb-md",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),n(q,{modelValue:e.value.price,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.price=l),class:"q-mb-md",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),n(q,{modelValue:e.value.qty,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.qty=l),class:"q-mb-md",outlined:"",label:"Количество",type:"number"},null,8,["modelValue"]),n(q,{modelValue:e.value.origin_country,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.origin_country=l),class:"q-mb-md",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),n(Ve,{modelValue:e.value.category_id,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.category_id=l),options:h(C).categories,class:"q-mb-md",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),n(q,{modelValue:e.value.description,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.description=l),class:"q-mb-md",outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),n(H,{align:"right"},{default:r(()=>[S(n(V,{color:"red",label:"Отмена"},null,512),[[F]]),S(n(V,{color:"primary",label:"Подтвердить",onClick:t[8]||(t[8]=l=>A())},null,512),[[F]])]),_:1})]),_:1})):(p(),_(K,{key:1},{default:r(()=>[n(M,null,{default:r(()=>[f("div",null,[e.value?.images?.length?(p(),_(T,{key:0,images:e.value.images},null,8,["images"])):(p(),I("div",Se,[n(Y,{class:"q-mt-sm",src:h(J)("/card-shop.jpg")},null,8,["src"])]))]),f("div",Fe,b(e.value.name),1),f("div",Ie,"Стоимость товара: "+b(e.value.price),1),f("div",null,"Страна происхождения: "+b(e.value.origin_country),1),f("div",null,"Описание: "+b(e.value.description),1)]),_:1}),n(H,{align:"right"},{default:r(()=>[S(n(V,{color:"red",label:"Отмена"},null,512),[[F]]),S(n(V,{color:"primary",label:"Добавить в корзину",onClick:t[9]||(t[9]=l=>R())},null,512),[[F]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),Re=ee(Ae,[["__scopeId","data-v-4c606175"]]),Ue={class:"product-card"},Le={key:0,class:"text-grey old-price"},je={key:0,class:"q-mb-sm"},Be=j({__name:"ProductList",setup(y){const i=G(),u=ue(),a=Z(),{addToCart:c}=ke(),{isManager:g,isAdmin:C}=W(),v=P(!1),Q=P(!1),$=P();X(async()=>{a.products=[],await e()});function x(){a.pagination.offset=0,e()}async function e(){try{i.loading.show();const d={limit:a.pagination.limit,offset:a.pagination.offset},s=await a.fetchProducts(d);s&&(a.pagination.total=s.total,a.pagination.has_more=s.has_more,a?.products?.length?a.products.push(s.items):a.products=s.items)}catch(d){console.error(d)}finally{i.loading.hide()}}function m(d){try{i.loading.show(),c(d)}catch(s){console.error(s)}finally{i.loading.hide()}}const A=async(d,s)=>{if(!a.pagination.has_more){v.value=!0,s(!0);return}await e(),a.pagination.offset+=a.pagination.limit,s()};function R(d){i.dialog({cancel:!0,message:"Вы уверенны что хотите удалить товар?",persistent:!0,title:"Удаление товара"}).onOk(()=>{U(d)})}async function U(d){try{if(!d?.id)return;await a.deleteProduct(d.id),i.loading.show()}catch(s){console.error(s)}finally{i.loading.hide()}}function D(d){u.push({name:"products-edit",params:{id:d.id}})}return(d,s)=>(p(),_(_e,{offset:250,onLoad:A},{default:r(()=>[h(g)?(p(),_(V,{key:0,class:"full-width q-mb-sm",color:"green",label:"Добавить товар",onClick:s[0]||(s[0]=o=>h(u).push({name:"products-create"}))})):w("",!0),f("div",Ue,[(p(!0),I(pe,null,ce(h(a).products,(o,t)=>(p(),_(ye,{key:t},{default:r(()=>[n(ve,null,{default:r(()=>[n(L,{top:"",avatar:"",onClick:l=>D(o)},{default:r(()=>[n(Y,{class:"cursor-pointer radius-8",src:o.primary_image?o.primary_image:h(J)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),n(L,{class:"column justify-between",onClick:l=>D(o)},{default:r(()=>[n(N,{caption:"",class:"text-size-16"},{default:r(()=>[me(b(o.name),1)]),_:2},1024),n(N,null,{default:r(()=>[o?.old_price?(p(),I("div",Le,b(o.old_price)+" ₽",1)):w("",!0),f("div",{class:fe(o?.old_price?"text-red":"")},b(o.price)+" ₽/шт.",3)]),_:2},1024)]),_:2},1032,["onClick"]),n(L,{side:"",top:"",class:"column justify-between"},{default:r(()=>[f("div",null,[h(C)?(p(),I("div",je,[n(V,{dense:"",round:"",color:"red",icon:"delete",onClick:l=>R(o)},null,8,["onClick"])])):w("",!0),f("div",null,[n(V,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:l=>m(o)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024),n(ge,{spaced:"",inset:""})]),_:2},1024))),128))]),Q.value?(p(),_(Re,{key:1,modelValue:Q.value,"onUpdate:modelValue":s[1]||(s[1]=o=>Q.value=o),productData:$.value,onRefreshData:s[2]||(s[2]=o=>x()),onAddProduct:m},null,8,["modelValue","productData"])):w("",!0)]),_:1}))}}),Oe=ee(Be,[["__scopeId","data-v-30b66e95"]]),da=j({__name:"DashboardPage",setup(y){const i=xe();X(()=>{u()});async function u(){try{const a=await i.fetchAddresses();if(a){i.addresses=a;const c=a.find(g=>g.is_default===!0);c&&(i.addressId=c.id)}}catch(a){console.error(a)}}return(a,c)=>(p(),_(qe,{class:"q-mx-xs"},{default:r(()=>[n(Oe,{class:"q-mb-lg"})]),_:1}))}});export{da as default};
