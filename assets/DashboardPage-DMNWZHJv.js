import{b as le,i as X,O as B,bh as Q,bm as ie,bn as se,e as M,k as re,m as ue,r as C,V as N,a4 as b,M as g,ac as de,$ as r,_ as o,Z as _,a0 as H,N as c,a1 as v,a8 as ce,a5 as D,a9 as $,aa as K,ab as F,S as x,L as R,a2 as pe,W as me,h as fe,Y as ge,X as ve,ak as ye,a6 as E,ai as _e,a7 as he}from"./index-DzMPjyn1.js";import{Q as Y}from"./QImg-CDhWFuM8.js";import{Q as be,a as j,b as A}from"./QItem-BezlGzCn.js";import{Q as ke}from"./QList-BwTEbdim.js";import{Q as xe}from"./QInfiniteScroll-C_Mpbh-3.js";import{u as Z}from"./productsStore-BjyLQnTa.js";import{u as Ce}from"./orderStore-Dss2NJn-.js";import{u as G}from"./use-quasar-DRFLew1W.js";import{g as Qe,Q as Ve,a as Pe}from"./QUploader-CN5pIXQb.js";import{Q as T}from"./QSelect-Brj-BH3q.js";import{Q as J}from"./QForm-Cim0s9mt.js";import{C as I}from"./ClosePopup-DxhkswOl.js";import{u as ee}from"./usePermissionVisibility.hook-CGqqxrom.js";import{P as W}from"./ProductImgCarusel-Ck4oqDC4.js";import{u as we}from"./categoriesStore-BiY-iP7a.js";import{u as te}from"./unitsStore-D59E1kID.js";import{f as De,g as ae}from"./useUtils-CMzPU-jz.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QMenu-CbJNr8k-.js";import"./format-CJebrXOQ.js";import"./rtl-DFPa-2ov.js";const qe=le({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(h,{slots:u}){const{proxy:{$q:p}}=X(),d=B(ie,Q);if(d===Q)return console.error("QPage needs to be a deep child of QLayout"),Q;if(B(se,Q)===Q)return console.error("QPage needs to be child of QPageContainer"),Q;const m=M(()=>{const y=(d.header.space===!0?d.header.size:0)+(d.footer.space===!0?d.footer.size:0);if(typeof h.styleFn=="function"){const V=d.isContainer.value===!0?d.containerHeight.value:p.screen.height;return h.styleFn(y,V)}return{minHeight:d.isContainer.value===!0?d.containerHeight.value-y+"px":p.screen.height===0?y!==0?`calc(100vh - ${y}px)`:"100vh":p.screen.height-y+"px"}}),k=M(()=>`q-page${h.padding===!0?" q-layout-padding":""}`);return()=>re("main",{class:k.value,style:m.value},ue(u.default))}});function z(){const{emit:h,proxy:u}=X(),p=C(null);function d(){p.value.show()}function i(){p.value.hide()}function m(y){h("ok",y),i()}function k(){h("hide")}return Object.assign(u,{show:d,hide:i}),{dialogRef:p,onDialogHide:k,onDialogOK:m,onDialogCancel:i}}const ne=["ok","hide"];z.emits=ne;z.emitsObject=Qe(ne);const Se={class:"text-h6 q-mb-md"},$e={class:"text-center upload-title"},Fe={key:1},Ie={class:"text-h6 text-center q-mt-sm"},Re={class:"text-bold"},Ue=N({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(h,{emit:u}){const p=h,d=u,i=G(),m=Z(),k=we(),{dialogRef:y}=z(),{isManager:V}=ee(),P=te(),q=C(!1),w=C(),e=C({id:null,name:"",price:null,category_id:null,unit_id:null,description:"",images:"",origin_country:"",unit:null}),f=new FormData;p.productData&&(e.value=p.productData);async function U(){try{let t=null;e.value?.id?t=m.updateProduct(e.value):(O(),t=await m.createProduct(f)),t&&(e.value.id=t.id,i.notify({message:"Успешно сохранено",color:"primary"}),d("refresh-data"))}catch(t){console.error(t)}}function L(){d("add-product",e.value)}function O(){e?.value?.id&&f.append("id",e.value.id.toString()),e.value?.name&&f.append("name",e.value.name),e.value?.price&&f.append("price",e.value.price.toString()),e.value?.category_id&&f.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&f.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&f.append("qty",e.value.qty.toString()),e.value?.description&&f.append("description",e.value.description),e.value?.origin_country&&f.append("origin_country",e.value.origin_country)}function S(t){const a=new FileReader;a.readAsDataURL(t[0]),a.onload=()=>{},f.delete("images"),f.append("images",t[0]),e.value?.id&&s(t[0])}async function s(t){const a=new FormData;a.append("file",t),a.append("is_primary","true");try{await m.uploadFile(e.value.id,a)&&(n(),i.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(l){console.error(l)}finally{w.value&&w.value.reset()}}async function n(){try{const t=await m.fetchProductsById(e.value.id);e.value=t}catch(t){console.error(t)}}return(t,a)=>(g(),b(de,{ref_key:"dialogRef",ref:y,modelValue:q.value,"onUpdate:modelValue":a[10]||(a[10]=l=>q.value=l),persistent:""},{default:r(()=>[o(pe,{class:"add-product"},{default:r(()=>[_(V)?(g(),b(J,{key:0,greedy:""},{default:r(()=>[o(H,null,{default:r(()=>[c("div",Se,v(e.value.id?"Редактирование товара":"Добавление товара"),1),o(Ve,{ref_key:"uploaderRef",ref:w,color:"primary",flat:"","max-file-size":"15728640",onAdded:S,onRejected:a[0]||(a[0]=l=>_(De)(_(i)))},{header:r(()=>[...a[11]||(a[11]=[])]),list:r(()=>[o(Pe),c("div",$e,[o(ce,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[12]||(a[12]=c("span",null,"Загрузить картинку",-1))])]),_:1},512),c("div",null,[e.value?.images?.length?(g(),b(W,{key:0,onRefreshData:a[1]||(a[1]=l=>n()),images:e.value.images},null,8,["images"])):D("",!0)]),o($,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.name=l),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),o($,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.price=l),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),o($,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.origin_country=l),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),o(T,{modelValue:e.value.category_id,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.category_id=l),options:_(k).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),o(T,{modelValue:e.value.unit_id,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.unit_id=l),options:_(P).units,outlined:"",label:"Единица измерения","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),o($,{class:"q-mt-sm",modelValue:e.value.description,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.description=l),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),o(K,{align:"right"},{default:r(()=>[F(o(x,{color:"red",label:"Отмена"},null,512),[[I]]),F(o(x,{color:"primary",label:"Подтвердить",onClick:a[8]||(a[8]=l=>U())},null,512),[[I]])]),_:1})]),_:1})):(g(),b(J,{key:1},{default:r(()=>[o(H,null,{default:r(()=>[c("div",null,[e.value?.images?.length?(g(),b(W,{key:0,images:e.value.images},null,8,["images"])):(g(),R("div",Fe,[o(Y,{class:"q-mt-sm",src:_(ae)("/card-shop.jpg")},null,8,["src"])]))]),c("div",Ie,v(e.value.name),1),c("div",Re,"Стоимость товара: "+v(e.value.price),1),c("div",null,"Вес: 11 "+v(e.value?.unit?.name||"")+".",1),c("div",null,"Страна происхождения: "+v(e.value.origin_country),1),c("div",null,"Описание: "+v(e.value.description),1)]),_:1}),o(K,{align:"right"},{default:r(()=>[F(o(x,{color:"red",label:"Отмена"},null,512),[[I]]),F(o(x,{color:"primary",label:"Добавить в корзину",onClick:a[9]||(a[9]=l=>L())},null,512),[[I]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),Le=oe(Ue,[["__scopeId","data-v-76a805e9"]]),Oe={class:"product-card"},je={key:0,class:"text-grey old-price"},Ae={class:"row items-end"},Ne={key:0,class:"q-mb-sm"},ze=N({__name:"ProductList",setup(h){const u=G(),p=me(),d=te(),i=Z(),m=Ce(),{isManager:k,isAdmin:y}=ee(),V=C(!1),P=C(!1),q=C();fe(async()=>{try{await d.fetchUnits(),u.loading.show()}catch(s){console.error(s)}finally{u.loading.hide()}});function w(){i.pagination.offset=0,e()}async function e(){try{u.loading.show();const s={offset:i.pagination.offset,limit:i.pagination.limit},n=await i.fetchProducts(s);n&&(i.pagination.total=n.total,i.pagination.has_more=n.has_more,i?.products?.length?i.products.push(n.items):i.products=n.items)}catch(s){console.error(s)}finally{u.loading.hide()}}function f(s){try{const n={...structuredClone(ye(s)),quantity:1,product_id:s.id,price:typeof s.price=="string"?parseFloat(s.price):Number(s.price)||0};if(u.loading.show(),!m.basketData.length)m.basketData.push(n);else{const t=m.basketData.find(a=>a.id===s.id);if(t){const a=typeof t.quantity=="string"?parseInt(t.quantity,10):Number(t.quantity)||0;t.quantity=a+1}else m.basketData.push(n)}window.localStorage.setItem("basket",JSON.stringify(m.basketData))}catch(n){console.error(n)}finally{u.loading.hide()}}const U=async(s,n)=>{if(!i.pagination.has_more){V.value=!0,n(!0);return}await e(),i.pagination.offset+=i.pagination.limit,n()};function L(s){u.dialog({title:"Удаление товара",message:"Вы уверенны что хотите удалить товар?",cancel:!0,persistent:!0}).onOk(()=>{O(s)})}async function O(s){try{if(!s?.id)return;await i.deleteProduct(s.id),u.loading.show()}catch(n){console.error(n)}finally{u.loading.hide()}}function S(s){p.push({name:"products-edit",params:{id:s.id}})}return(s,n)=>(g(),b(xe,{onLoad:U,offset:250},{default:r(()=>[_(k)?(g(),b(x,{key:0,onClick:n[0]||(n[0]=t=>_(p).push({name:"products-create"})),class:"full-width q-mb-sm",color:"green",label:"Добавить товар"})):D("",!0),c("div",Oe,[(g(!0),R(ve,null,ge(_(i).products,(t,a)=>(g(),b(ke,{key:a},{default:r(()=>[o(be,null,{default:r(()=>[o(j,{top:"",avatar:"",onClick:l=>S(t)},{default:r(()=>[o(Y,{class:"cursor-pointer radius-8",src:t[0]?.primary_image?t[0].primary_image:_(ae)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),o(j,{class:"column justify-between",onClick:l=>S(t)},{default:r(()=>[o(A,{caption:"",class:"text-size-16"},{default:r(()=>[E(v(t.name),1)]),_:2},1024),o(A,null,{default:r(()=>[t?.old_price?(g(),R("div",je,v(t.old_price)+" ₽",1)):D("",!0),c("div",{class:_e(t?.old_price?"text-red":"")},v(t.price)+" ₽/ "+v(t.unit_name),3)]),_:2},1024)]),_:2},1032,["onClick"]),o(j,{side:"",top:"",class:"column justify-between"},{default:r(()=>[n[3]||(n[3]=c("div",null,null,-1)),c("div",Ae,[o(A,{class:"q-mr-xs",caption:""},{default:r(()=>[E(v(t.price)+" ₽/ "+v(t.unit_name),1)]),_:2},1024),c("div",null,[_(y)?(g(),R("div",Ne,[o(x,{dense:"",round:"",color:"red",icon:"delete",onClick:l=>L(t)},null,8,["onClick"])])):D("",!0),c("div",null,[o(x,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:l=>f(t)},null,8,["onClick"])])])])]),_:2},1024)]),_:2},1024),o(he,{spaced:"",inset:""})]),_:2},1024))),128))]),P.value?(g(),b(Le,{key:1,modelValue:P.value,"onUpdate:modelValue":n[1]||(n[1]=t=>P.value=t),productData:q.value,onRefreshData:n[2]||(n[2]=t=>w()),onAddProduct:f},null,8,["modelValue","productData"])):D("",!0)]),_:1}))}}),Be=oe(ze,[["__scopeId","data-v-38ea5495"]]),dt=N({__name:"DashboardPage",setup(h){return(u,p)=>(g(),b(qe,{class:"q-mx-xs"},{default:r(()=>[o(Be,{class:"q-mb-lg"})]),_:1}))}});export{dt as default};
