import{V as L,r as f,a3 as M,P as C,R as d,S as m,_ as a,a4 as g,a5 as v,Z as i,Q as c,$ as o,X as N,Y as P,a6 as V,a1 as Q,a7 as j,a2 as k,a0 as x,a8 as z,a9 as q,aa as T,ab as E,ac as O}from"./index-BZjd7GBC.js";import{Q as X,a as Y,b as S}from"./QItem-DDMqTswZ.js";import{Q as Z}from"./QList-BElwcuPt.js";import{Q as G,a as H}from"./QUploader-CkjVN_b9.js";import{Q as J}from"./QImg-B6zw0J4j.js";import{Q as K}from"./QForm-DVqTc2pL.js";import{C as W}from"./ClosePopup-DlC2R70j.js";import{u as ee}from"./use-quasar-Bj_W2G9s.js";import{f as ae,r as te}from"./useUtils-QC3uEKhj.js";import{u as oe}from"./categoriesStore-CzHBp1kn.js";import{u as le}from"./usePermissionVisibility.hook-BbKMUw0E.js";import"./format-CJebrXOQ.js";const re={class:"q-mx-md"},ie={class:"text-h6"},ne={class:"text-center upload-title"},se={key:0,class:"flex justify-center q-mb-md"},we=L({__name:"CategoriesPage",setup(de){const n=ee(),u=oe(),{isManager:_,isAdmin:y}=le(),b=f(),p=f(!1),h=f({description:"",name:"",parent_id:null}),t=f({description:"",id:null,image:"",name:"",parent_id:null}),s=new FormData;function R(){t?.value?.id&&s.append("id",t.value.id.toString()),t.value?.name&&s.append("name",t.value.name),t.value?.parent_id&&s.append("price",t.value.parent_id.toString()),t.value?.description&&s.append("category_id",t.value.description.toString())}function w(l){l?.id?t.value=l:t.value=h.value,p.value=!p.value}function D(l){const e=new FileReader;e.readAsDataURL(l[0]),e.onload=()=>{t.value.image=e.result},s.delete("image"),s.append("image",l[0])}function F(l){n.dialog({cancel:!0,message:"Вы уверенны что хотите удалить категорию?",persistent:!0,title:"Удаление категорию"}).onOk(()=>{I(l)})}async function I(l){try{n.loading.show(),await u.deleteCategorie(l)}catch(e){console.error(e)}finally{await u.fetchCategories(),n.loading.hide()}}async function $(){try{if(R(),n.loading.show(),!t.value)return;await(t.value.id?u.updateCategorie:u.createCategories)(s)&&(await u.fetchCategories(),n.notify({color:"primary",message:"Категория успешно добавлена"}))}catch(l){console.error(l)}finally{b.value.hide(),n.loading.hide()}}return(l,e)=>{const U=M("q-item-action");return d(),C("div",null,[m("div",re,[i(_)||i(y)?(d(),g(c,{key:0,class:"full-width q-mb-sm",color:"green",label:"Добавление категории",onClick:e[0]||(e[0]=r=>w())})):v("",!0)]),e[8]||(e[8]=m("h6",{class:"text-center q-mt-md q-mb-md"},"Категории",-1)),a(k,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:o(()=>[(d(!0),C(N,null,P(i(u).categories,(r,A)=>(d(),g(Z,{key:A},{default:o(()=>[a(X,null,{default:o(()=>[a(Y,null,{default:o(()=>[a(S,null,{default:o(()=>[V(Q(r.name),1)]),_:2},1024),a(S,{caption:""},{default:o(()=>[V(Q(r.description),1)]),_:2},1024)]),_:2},1024),a(U,null,{default:o(()=>[i(y)?(d(),g(c,{key:0,flat:"",round:"",color:"red",icon:"delete",onClick:B=>F(r.id)},null,8,["onClick"])):v("",!0),i(_)||i(y)?(d(),g(c,{key:1,flat:"",round:"",color:"secondary",icon:"mode_edit",onClick:B=>w(r)},null,8,["onClick"])):v("",!0)]),_:2},1024)]),_:2},1024),a(j)]),_:2},1024))),128))]),_:1}),a(O,{ref_key:"dialogRef",ref:b,modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=r=>p.value=r)},{default:o(()=>[a(k,{style:{"min-width":"90svw"}},{default:o(()=>[a(K,{greedy:"",onSubmit:e[4]||(e[4]=r=>$())},{default:o(()=>[a(x,null,{default:o(()=>[m("div",ie,Q(t.value.id?"Редактировать категорию":"Добавить категорию"),1)]),_:1}),a(x,{class:"q-pt-none"},{default:o(()=>[a(G,{ref:"uploaderRef",color:"primary",flat:"","max-file-size":"15728640",onAdded:D,onRejected:e[1]||(e[1]=r=>i(ae)(i(n)))},{header:o(()=>[...e[6]||(e[6]=[])]),list:o(()=>[a(H),m("div",ne,[a(z,{class:"q-mr-sm",name:"note_add",size:"24px"}),e[7]||(e[7]=m("span",null,"Загрузить картинку",-1))])]),_:1},512),t.value.image?(d(),C("div",se,[a(J,{class:"cursor-pointer radius-8",src:t.value.image,height:"120px",width:"120px",fit:"cover"},null,8,["src"])])):v("",!0),a(q,{modelValue:t.value.name,"onUpdate:modelValue":e[2]||(e[2]=r=>t.value.name=r),rules:[i(te)],class:"q-mb-xs",outlined:"",label:"Наиминование категории *"},null,8,["modelValue","rules"]),a(q,{modelValue:t.value.description,"onUpdate:modelValue":e[3]||(e[3]=r=>t.value.description=r),class:"q-mt-sm",filled:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),a(T,{align:"right"},{default:o(()=>[E(a(c,{flat:"",label:"Отмена",color:"negative"},null,512),[[W]]),a(c,{flat:"",label:"Подтвердить",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{we as default};
