import{b as n,Q,a as f}from"./QItem-CzDA6JiL.js";import{Q as x}from"./QList-DnChnSB6.js";import{Q as F}from"./QBtnDropdown-D573kKNx.js";import{e as W,i as X,V as w,r as H,X as p,Y as o,ad as Y,Z as e,$ as t,a0 as Z,aa as M,_ as D,a9 as b,a7 as A,a5 as u,a6 as d,a4 as L,A as B,a8 as $,a1 as y,a2 as I,a3 as N,W as j,al as J}from"./index-C9JHQAkC.js";import{C as O}from"./ClosePopup-BfLvFG_Z.js";import{d as R,u as K}from"./use-quasar-CC8g8L5-.js";import{u as ee}from"./orderStore-B7xUu9wZ.js";import{Q as te}from"./QBadge-Drc84RQX.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";var m=(c=>(c.CREATED="created",c.ASSEMBLING="assembling",c.DELIVERING="delivering",c.COMPLETED="completed",c.CANCELLED="cancelled",c))(m||{});const ae=W({name:"QSpace",setup(){const c=X("div",{class:"q-space"});return()=>c}}),le={class:"text-h6 q-mt-xs"},se={class:"q-mb-sm"},oe={class:"row"},ne={key:0,class:"text-italic text-grey"},re={key:1,class:"text-italic text-grey"},ue={class:"col-12 col-md-4 text-right"},ie={class:"text-h5 text-weight-bold text-green"},de=w({__name:"OrderHistoryModal",props:{orderHistoryData:{},orderStatus:{}},setup(c){const C=c,h=H(!1);function _(i){const l=C.orderStatus.find(k=>k.value===i);return{color:l?.value===m.CANCELLED?"negative":"positive",label:l?.label||"-"}}return(i,l)=>(o(),p(Y,{ref:"dialogRef",modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=v=>h.value=v),persistent:""},{default:e(()=>[t(Z,{class:"order-history-modal"},{default:e(()=>[t(M,{class:"row items-center q-pb-xs q-pr-xs q-pt-xs"},{default:e(()=>[D("div",le,[t(n,null,{default:e(()=>[...l[1]||(l[1]=[u("Детали Заказа",-1)])]),_:1}),t(n,{caption:""},{default:e(()=>[u(d(L(R)(i.orderHistoryData.order_date))+"г",1)]),_:1})]),t(ae),i.orderHistoryData?.status?(o(),p(n,{key:0,class:"q-mr-sm"},{default:e(()=>[t(te,{class:"q-pa-xs",color:_(i.orderHistoryData.status).color},{default:e(()=>[u(d(_(i.orderHistoryData.status).label),1)]),_:1},8,["color"])]),_:1})):b("",!0),A(t(B,{icon:"close",flat:"",round:"",dense:""},null,512),[[O]])]),_:1}),t($),t(M,{class:"q-pt-none"},{default:e(()=>[D("div",se,[t(x,null,{default:e(()=>[t(Q,{dense:"",class:"q-pa-none"},{default:e(()=>[t(f,null,{default:e(()=>[t(n,{caption:"",lines:"1"},{default:e(()=>[...l[2]||(l[2]=[u("Товар",-1)])]),_:1})]),_:1}),t(f,null,{default:e(()=>[t(n,{caption:"",lines:"1"},{default:e(()=>[...l[3]||(l[3]=[u("Кол.",-1)])]),_:1})]),_:1}),t(f,null,{default:e(()=>[t(n,{caption:"",lines:"1"},{default:e(()=>[...l[4]||(l[4]=[u("Цена",-1)])]),_:1})]),_:1})]),_:1}),(o(!0),y(I,null,N(i.orderHistoryData.items,(v,k)=>(o(),p(Q,{key:k,dense:"",class:"q-pa-none"},{default:e(()=>[t(f,null,{default:e(()=>[t(n,null,{default:e(()=>[u(d(v?.name||"-"),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:e(()=>[t(n,null,{default:e(()=>[u(d(v?.quantity),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:e(()=>[t(n,null,{default:e(()=>[u(d(v?.price)+" ₽",1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t($)]),D("div",oe,[D("div",null,[i.orderHistoryData.comment?(o(),y("div",ne,"Комментарий: "+d(i.orderHistoryData.comment),1)):(o(),y("div",re,"Комментарий отсутствует."))]),D("div",ue,[l[5]||(l[5]=D("div",{class:"text-subtitle1 text-weight-medium"},"Итого:",-1)),D("div",ie,d(i.orderHistoryData.total_amount)+" ₽",1)])])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ce=T(de,[["__scopeId","data-v-7a03c6c2"]]),me={class:"order-history"},fe=["href"],pe={key:1},_e=w({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},setup(c){const C=K(),h=ee(),_=H(!1),i=H(),l=[{label:"создан",value:m.CREATED},{label:"собирается",value:m.ASSEMBLING},{label:"в пути",value:m.DELIVERING},{label:"завершён",value:m.COMPLETED},{label:"отменён",value:m.CANCELLED}];function v(s,r){C.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{k(s,r)})}async function k(s,r){try{C.loading.show(),await h.updateOrderStatus(s,r)&&C.notify({color:"primary",message:"Статус успешно изменен"})}catch(g){console.error(g)}finally{C.loading.hide()}}function G(s){return l.find(g=>g.value===s)?.label}function U(s){C.dialog({cancel:!0,message:"Вы уверенны что хотите отменить заказ?",persistent:!0,title:"Отмена заказа"}).onOk(()=>{k(s,m.CANCELLED)})}function q(s){const r=s.username?.trim().replace(/^@/,"");return r?`https://t.me/${encodeURIComponent(r)}`:null}function V(s){if(!s.phone)return null;const r=s.phone.trim();return r.length?r:null}function S(s){i.value=s,_.value=!_.value}return(s,r)=>{const g=j("q-item-action");return o(),y("div",me,[t(x,null,{default:e(()=>[(o(!0),y(I,null,N(s.orderData,(a,P)=>(o(),p(Q,{key:a.id??P,class:J(["border-bot",a.is_paid?"light-red":"light-green"])},{default:e(()=>[t(f,{onClick:E=>S(a)},{default:e(()=>[V(a.user)?(o(),p(n,{key:0,caption:"",class:"text-10"},{default:e(()=>[u(d(V(a.user)),1)]),_:2},1024)):b("",!0),t(n,null,{default:e(()=>[q(a.user)?(o(),y("a",{key:0,href:q(a.user),target:"_blank",rel:"noopener noreferrer",class:"text-primary text-decoration-none"},d(a.user.full_name),9,fe)):(o(),y("span",pe,d(a.user.full_name),1))]),_:2},1024)]),_:2},1032,["onClick"]),t(f,{onClick:E=>S(a)},{default:e(()=>[t(n,{caption:"",class:"text-10"},{default:e(()=>[u(d(L(R)(a.order_date)),1)]),_:2},1024),t(n,null,{default:e(()=>[u(d(G(a.status)),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(f,{onClick:E=>S(a)},{default:e(()=>[t(n,{caption:"",class:"text-10"},{default:e(()=>[...r[1]||(r[1]=[u("Общая сумма",-1)])]),_:1}),t(n,null,{default:e(()=>[u(d(a.total_amount),1)]),_:2},1024)]),_:2},1032,["onClick"]),s.adminMode?(o(),p(g,{key:0},{default:e(()=>[t(F,{size:"10px",color:"green",dense:""},{default:e(()=>[(o(),y(I,null,N(l,(E,z)=>t(x,{key:z},{default:e(()=>[A((o(),p(Q,{clickable:"",onClick:ve=>v(a.id,E.value)},{default:e(()=>[t(f,null,{default:e(()=>[t(n,null,{default:e(()=>[u(d(E.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[O]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):b("",!0),!s.adminMode&&(a.status===L(m).CREATED||a.status===L(m).ASSEMBLING)?(o(),p(g,{key:1},{default:e(()=>[t(B,{size:"10px",round:"",color:"deep-orange",icon:"close",onClick:E=>U(a.id)},null,8,["onClick"])]),_:2},1024)):b("",!0)]),_:2},1032,["class"]))),128))]),_:1}),_.value&&i.value?(o(),p(ce,{key:0,modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=a=>_.value=a),orderHistoryData:i.value,orderStatus:l},null,8,["modelValue","orderHistoryData"])):b("",!0)])}}}),Qe=T(_e,[["__scopeId","data-v-efe00ec6"]]);export{Qe as O};
