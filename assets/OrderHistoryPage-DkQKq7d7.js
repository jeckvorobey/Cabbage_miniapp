import{Q as O}from"./QInfiniteScroll-DdOCTzzJ.js";import{u as k}from"./use-quasar-CG5UumNs.js";import{u as M}from"./orderStore-Dgr0u4ko.js";import{Q as E,a as u,b as o}from"./QItem-BdNSuNM7.js";import{X as N,Y as x,a3 as g,_ as d,a1 as t,$ as e,a4 as I,a5 as Q,a7 as n,Z as v,ad as B,a8 as _,a6 as S,C as V,a9 as A,m as q,a0 as P}from"./index-qt0NPJKR.js";import{Q as L}from"./QList-tXXj-vu5.js";import{Q as T}from"./QBtnDropdown-Wei9eLtT.js";import{C as $}from"./ClosePopup-CRikUSB1.js";import{u as w}from"./usePermissionVisibility.hook-CvAc65q-.js";import"./QBtnGroup-D6lrO81o.js";import"./QMenu-cTLd6Nyg.js";import"./useUtils-Bevdbczi.js";var m=(s=>(s.CREATED="created",s.ASSEMBLING="assembling",s.DELIVERING="delivering",s.COMPLETED="completed",s.CANCELLED="cancelled",s))(m||{});const G=N({__name:"OrderHistoryItems",props:{orderData:{}},setup(s){const{isManager:c}=w(),l=k(),D=M(),y=[{label:"создан",value:m.CREATED},{label:"собирается",value:m.ASSEMBLING},{label:"в пути",value:m.DELIVERING},{label:"завершён",value:m.COMPLETED},{label:"отменён",value:m.CANCELLED}];function C(r,a){l.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{i(r,a)})}async function i(r,a){try{l.loading.show(),await D.updateOrderStatus(r,a)&&l.notify({color:"primary",message:"Статус успешно изменен"})}catch(p){console.error(p)}finally{l.loading.hide()}}return(r,a)=>{const p=x("q-item-action");return d(),g("div",null,[t(L,null,{default:e(()=>[(d(!0),g(I,null,Q(r.orderData,(f,b)=>(d(),v(E,{key:b,class:"border-bot"},{default:e(()=>[t(u,null,{default:e(()=>[t(o,{caption:"",lines:"2"},{default:e(()=>[...a[0]||(a[0]=[n("Дата",-1)])]),_:1}),t(o,null,{default:e(()=>[n(_(f.order_date),1)]),_:2},1024)]),_:2},1024),t(u,null,{default:e(()=>[t(o,{caption:"",lines:"2"},{default:e(()=>[...a[1]||(a[1]=[n("Статус",-1)])]),_:1}),t(o,null,{default:e(()=>[n(_(f.status),1)]),_:2},1024)]),_:2},1024),t(u,null,{default:e(()=>[t(o,{caption:"",lines:"2"},{default:e(()=>[...a[2]||(a[2]=[n("Общая сумма",-1)])]),_:1}),t(o,null,{default:e(()=>[n(_(f.total_amount),1)]),_:2},1024)]),_:2},1024),S(c)?(d(),v(p,{key:0},{default:e(()=>[t(o,null,{default:e(()=>[t(V,{name:"edit",color:"green",size:"24px"})]),_:1})]),_:1})):B("",!0)]),_:2},1024))),128))]),_:1}),t(L,null,{default:e(()=>[t(E,{class:"border-bot"},{default:e(()=>[t(u,null,{default:e(()=>[t(o,{caption:"",lines:"2"},{default:e(()=>[...a[3]||(a[3]=[n("Дата",-1)])]),_:1}),t(o,null,{default:e(()=>[...a[4]||(a[4]=[n("1212",-1)])]),_:1})]),_:1}),t(u,null,{default:e(()=>[t(o,{caption:"",lines:"2"},{default:e(()=>[...a[5]||(a[5]=[n("Статус",-1)])]),_:1}),t(o,null,{default:e(()=>[...a[6]||(a[6]=[n("2121",-1)])]),_:1})]),_:1}),t(u,null,{default:e(()=>[t(o,{caption:"",lines:"2"},{default:e(()=>[...a[7]||(a[7]=[n("Общая сумма",-1)])]),_:1}),t(o,null,{default:e(()=>[...a[8]||(a[8]=[n("1212",-1)])]),_:1})]),_:1}),t(p,null,{default:e(()=>[t(o,null,{default:e(()=>[t(T,{color:"green",dense:""},{default:e(()=>[(d(),g(I,null,Q(y,(f,b)=>t(L,{key:b},{default:e(()=>[A((d(),v(E,{clickable:"",onClick:R=>C(1,f.value)},{default:e(()=>[t(u,null,{default:e(()=>[t(o,null,{default:e(()=>[n(_(f.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[$]])]),_:2},1024)),64))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ee=N({__name:"OrderHistoryPage",setup(s){const c=k(),l=M(),{isManager:D}=w();q(async()=>{await C()});const y=(i,r)=>{if(!l.pagination.has_more){r(!0);return}l.pagination.offset+=l.pagination.limit,r()};async function C(){try{c.loading.show();const i={limit:l.pagination.limit,offset:l.pagination.offset},a=await(D.value?l.fetchOrders:l.fetchMyOrder)(i);a&&(l.pagination.total=a.total,l.pagination.has_more=a.has_more,l.ordersData?.length?l.ordersData.push(a.items):l.ordersData=a.items),a&&(l.ordersData=a.items)}catch(i){console.error(i)}finally{c.loading.hide()}}return(i,r)=>(d(),g("div",null,[t(O,{offset:250,onLoad:y},{default:e(()=>[r[0]||(r[0]=P("h6",{class:"text-center q-mt-md q-mb-md"},"История заказов",-1)),t(G,{orderData:S(l).ordersData},null,8,["orderData"])]),_:1})]))}});export{ee as default};
