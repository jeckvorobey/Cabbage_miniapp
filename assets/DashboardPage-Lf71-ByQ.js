import{m as le,g as W,a as N,z as q,A as ie,Z as se,c as M,h as re,n as ue,r as V,d as A,aj as x,ae as v,aE as de,af as s,f as a,ak as b,aF as H,aq as m,am as y,a6 as ce,as as U,au as F,aG as E,W as I,ah as w,ad as z,aH as pe,ac as me,o as fe,ag as ge,F as ve,aI as ye,al as K,aB as _e,ai as he}from"./index-DQJWnsQl.js";import{Q as Z}from"./QImg-BiJw49VP.js";import{Q as be,a as L,b as O}from"./QItem-C2kr5JJk.js";import{Q as xe}from"./QList-B4G_Ijk1.js";import{Q as Qe}from"./QInfiniteScroll-vCWLrf9-.js";import{u as X}from"./productsStore-DsiJKLCo.js";import{e as ke}from"./orderStore-l6D_K3FR.js";import{u as Y}from"./use-quasar-C0efl0Fr.js";import{g as Ce,Q as Ve,a as De}from"./QUploader-DPbtm18T.js";import{Q as T}from"./QSelect-CXgcnHHn.js";import{Q as G}from"./QForm-Bn0ZICi9.js";import{C as R}from"./ClosePopup-BfPhfk0u.js";import{u as ee}from"./usePermissionVisibility.hook-Cwqrqq5_.js";import{P as J}from"./ProductImgCarusel-BUJzQfUa.js";import{u as qe}from"./categoriesStore-DtrtKCaY.js";import{u as te}from"./unitsStore-Bh_TKXUh.js";import{f as we,g as ae}from"./useUtils-CerYhqaL.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QMenu-B7auRJFs.js";import"./format-CJebrXOQ.js";import"./rtl-DFPa-2ov.js";const Pe=le({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(h,{slots:f}){const{proxy:{$q:c}}=W(),d=N(ie,q);if(d===q)return console.error("QPage needs to be a deep child of QLayout"),q;if(N(se,q)===q)return console.error("QPage needs to be child of QPageContainer"),q;const p=M(()=>{const _=(d.header.space===!0?d.header.size:0)+(d.footer.space===!0?d.footer.size:0);if(typeof h.styleFn=="function"){const k=d.isContainer.value===!0?d.containerHeight.value:c.screen.height;return h.styleFn(_,k)}return{minHeight:d.isContainer.value===!0?d.containerHeight.value-_+"px":c.screen.height===0?_!==0?`calc(100vh - ${_}px)`:"100vh":c.screen.height-_+"px"}}),Q=M(()=>`q-page${h.padding===!0?" q-layout-padding":""}`);return()=>re("main",{class:Q.value,style:p.value},ue(f.default))}});function B(){const{emit:h,proxy:f}=W(),c=V(null);function d(){c.value.show()}function l(){c.value.hide()}function p(_){h("ok",_),l()}function Q(){h("hide")}return Object.assign(f,{show:d,hide:l}),{dialogRef:c,onDialogHide:Q,onDialogOK:p,onDialogCancel:l}}const ne=["ok","hide"];B.emits=ne;B.emitsObject=Ce(ne);const Se={class:"text-h6 q-mb-md"},$e={class:"text-center upload-title"},Fe={key:1},Ie={class:"text-h6 text-center q-mt-sm"},Re={class:"text-bold"},Ue=A({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(h,{emit:f}){const c=h,d=f,l=Y(),p=X(),Q=qe(),{dialogRef:_}=B(),{isManager:k}=ee(),j=te(),S=V(!1),D=V(),e=V({id:null,name:"",price:null,category_id:null,unit_id:null,description:"",images:"",origin_country:"",unit:null}),g=new FormData;c.productData&&(e.value=c.productData);async function $(){try{let u=null;e.value?.id?u=p.updateProduct(e.value):(n(),u=await p.createProduct(g)),u&&(e.value.id=u.id,l.notify({message:"Успешно сохранено",color:"primary"}),d("refresh-data"))}catch(u){console.error(u)}}function r(){d("add-product",e.value)}function n(){e?.value?.id&&g.append("id",e.value.id.toString()),e.value?.name&&g.append("name",e.value.name),e.value?.price&&g.append("price",e.value.price.toString()),e.value?.category_id&&g.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&g.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&g.append("qty",e.value.qty.toString()),e.value?.description&&g.append("description",e.value.description),e.value?.origin_country&&g.append("origin_country",e.value.origin_country)}function o(u){const t=new FileReader;t.readAsDataURL(u[0]),t.onload=()=>{},g.delete("images"),g.append("images",u[0]),e.value?.id&&C(u[0])}async function C(u){const t=new FormData;t.append("file",u),t.append("is_primary","true");try{await p.uploadFile(e.value.id,t)&&(P(),l.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(i){console.error(i)}finally{D.value&&D.value.reset()}}async function P(){try{const u=await p.fetchProductsById(e.value.id);e.value=u}catch(u){console.error(u)}}return(u,t)=>(v(),x(de,{ref_key:"dialogRef",ref:_,modelValue:S.value,"onUpdate:modelValue":t[10]||(t[10]=i=>S.value=i),persistent:""},{default:s(()=>[a(pe,{class:"add-product"},{default:s(()=>[b(k)?(v(),x(G,{key:0,greedy:""},{default:s(()=>[a(H,null,{default:s(()=>[m("div",Se,y(e.value.id?"Редактирование товара":"Добавление товара"),1),a(Ve,{ref_key:"uploaderRef",ref:D,color:"primary",flat:"","max-file-size":"15728640",onAdded:o,onRejected:t[0]||(t[0]=i=>b(we)(b(l)))},{header:s(()=>[...t[11]||(t[11]=[])]),list:s(()=>[a(De),m("div",$e,[a(ce,{class:"q-mr-sm",name:"note_add",size:"24px"}),t[12]||(t[12]=m("span",null,"Загрузить картинку",-1))])]),_:1},512),m("div",null,[e.value?.images?.length?(v(),x(J,{key:0,onRefreshData:t[1]||(t[1]=i=>P()),images:e.value.images},null,8,["images"])):U("",!0)]),a(F,{modelValue:e.value.name,"onUpdate:modelValue":t[2]||(t[2]=i=>e.value.name=i),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),a(F,{modelValue:e.value.price,"onUpdate:modelValue":t[3]||(t[3]=i=>e.value.price=i),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),a(F,{modelValue:e.value.origin_country,"onUpdate:modelValue":t[4]||(t[4]=i=>e.value.origin_country=i),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),a(T,{modelValue:e.value.category_id,"onUpdate:modelValue":t[5]||(t[5]=i=>e.value.category_id=i),options:b(Q).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),a(T,{modelValue:e.value.unit_id,"onUpdate:modelValue":t[6]||(t[6]=i=>e.value.unit_id=i),options:b(j).units,outlined:"",label:"Единица измерения","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),a(F,{class:"q-mt-sm",modelValue:e.value.description,"onUpdate:modelValue":t[7]||(t[7]=i=>e.value.description=i),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),a(E,{align:"right"},{default:s(()=>[I(a(w,{color:"red",label:"Отмена"},null,512),[[R]]),I(a(w,{color:"primary",label:"Подтвердить",onClick:t[8]||(t[8]=i=>$())},null,512),[[R]])]),_:1})]),_:1})):(v(),x(G,{key:1},{default:s(()=>[a(H,null,{default:s(()=>[m("div",null,[e.value?.images?.length?(v(),x(J,{key:0,images:e.value.images},null,8,["images"])):(v(),z("div",Fe,[a(Z,{class:"q-mt-sm",src:b(ae)("/card-shop.jpg")},null,8,["src"])]))]),m("div",Ie,y(e.value.name),1),m("div",Re,"Стоимость товара: "+y(e.value.price),1),m("div",null,"Вес: 11 "+y(e.value?.unit?.name||"")+".",1),m("div",null,"Страна происхождения: "+y(e.value.origin_country),1),m("div",null,"Описание: "+y(e.value.description),1)]),_:1}),a(E,{align:"right"},{default:s(()=>[I(a(w,{color:"red",label:"Отмена"},null,512),[[R]]),I(a(w,{color:"primary",label:"Добавить в корзину",onClick:t[9]||(t[9]=i=>r())},null,512),[[R]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),je=oe(Ue,[["__scopeId","data-v-76a805e9"]]),Le={class:"product-card"},Oe={key:0,class:"text-grey old-price"},ze={class:"row items-end"},Ae=A({__name:"ProductList",setup(h){const f=Y(),c=me(),d=te(),l=X(),p=ke(),{isManager:Q}=ee(),_=V(!1),k=V(!1),j=V();fe(async()=>{try{await d.fetchUnits(),f.loading.show()}catch(r){console.error(r)}finally{f.loading.hide()}});function S(){l.pagination.offset=0,D()}async function D(){try{f.loading.show();const r={offset:l.pagination.offset,limit:l.pagination.limit},n=await l.fetchProducts(r);n&&(l.pagination.total=n.total,l.pagination.has_more=n.has_more,l?.products?.length?l.products.push(n.items):l.products=n.items)}catch(r){console.error(r)}finally{f.loading.hide()}}function e(r){try{const n={...structuredClone(ye(r)),quantity:1,product_id:r.id,price:typeof r.price=="string"?parseFloat(r.price):Number(r.price)||0};if(f.loading.show(),!p.basketData.length)p.basketData.push(n);else{const o=p.basketData.find(C=>C.id===r.id);if(o){const C=typeof o.quantity=="string"?parseInt(o.quantity,10):Number(o.quantity)||0;o.quantity=C+1}else p.basketData.push(n)}window.localStorage.setItem("basket",JSON.stringify(p.basketData))}catch(n){console.error(n)}finally{f.loading.hide()}}const g=async(r,n)=>{if(!l.pagination.has_more){_.value=!0,n(!0);return}await D(),l.pagination.offset+=l.pagination.limit,n()};function $(r){c.push({name:"products-edit",params:{id:r.id}})}return(r,n)=>(v(),x(Qe,{onLoad:g,offset:250},{default:s(()=>[b(Q)?(v(),x(w,{key:0,onClick:n[0]||(n[0]=o=>b(c).push({name:"products-create"})),class:"full-width q-mb-sm",color:"green",label:"Добавить товар"})):U("",!0),m("div",Le,[(v(!0),z(ve,null,ge(b(l).products,(o,C)=>(v(),x(xe,{key:C},{default:s(()=>[a(be,null,{default:s(()=>[a(L,{top:"",avatar:"",onClick:P=>$(o)},{default:s(()=>[a(Z,{class:"cursor-pointer radius-8",src:o[0]?.primary_image?o[0].primary_image:b(ae)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),a(L,{class:"column justify-between",onClick:P=>$(o)},{default:s(()=>[a(O,{caption:"",class:"text-size-16"},{default:s(()=>[K(y(o.name),1)]),_:2},1024),a(O,null,{default:s(()=>[o?.old_price?(v(),z("div",Oe,y(o.old_price)+" ₽",1)):U("",!0),m("div",{class:_e(o?.old_price?"text-red":"")},y(o.price)+" ₽/ "+y(o.unit_name),3)]),_:2},1024)]),_:2},1032,["onClick"]),a(L,{side:"",top:"",class:"column justify-between"},{default:s(()=>[n[3]||(n[3]=m("div",null,null,-1)),m("div",ze,[a(O,{class:"q-mr-xs",caption:""},{default:s(()=>[K(y(o.price)+" ₽/ "+y(o.unit_name),1)]),_:2},1024),a(w,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:P=>e(o)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024),a(he,{spaced:"",inset:""})]),_:2},1024))),128))]),k.value?(v(),x(je,{key:1,modelValue:k.value,"onUpdate:modelValue":n[1]||(n[1]=o=>k.value=o),productData:j.value,onRefreshData:n[2]||(n[2]=o=>S()),onAddProduct:e},null,8,["modelValue","productData"])):U("",!0)]),_:1}))}}),Be=oe(Ae,[["__scopeId","data-v-dae92557"]]),ut=A({__name:"DashboardPage",setup(h){return(f,c)=>(v(),x(Pe,{class:"q-mx-xs"},{default:s(()=>[a(Be,{class:"q-mb-lg"})]),_:1}))}});export{ut as default};
