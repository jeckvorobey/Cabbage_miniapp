import{b as ae,n as X,V as O,bh as k,bm as te,bn as oe,f as z,h as ne,p as le,r as P,X as j,Z as _,_ as p,ag as se,$ as r,a1 as n,a6 as h,ac as H,a0 as g,a8 as C,M as re,ad as w,ae as q,af as N,a9 as S,Q as V,a3 as I,a2 as ie,ab as de,a5 as ue,a4 as ce,a7 as pe,am as me,aa as fe,m as ge}from"./index-_eQ6ifiF.js";import{u as B}from"./use-quasar-BDlt-IKv.js";import{Q as Z}from"./QImg-CvrX_SWz.js";import{Q as ve,a as L,b as K}from"./QItem-DQyRjP3b.js";import{Q as ye}from"./QList-BcFRRHg9.js";import{Q as _e}from"./QInfiniteScroll-D3Bt0f8Y.js";import{u as G}from"./productsStore-DvkSCDw8.js";import{g as he,Q as be,a as Ce}from"./QUploader-ULHgVbyn.js";import{Q as Qe}from"./QSelect-BGj2UrZh.js";import{Q as T}from"./QForm-Bv67PRkI.js";import{C as F}from"./ClosePopup-DinItDPI.js";import{u as J}from"./usePermissionVisibility.hook-D9yZds17.js";import{P as E}from"./ProductImgCarusel-n7gV5czA.js";import{u as Ve}from"./categoriesStore-By7kOImW.js";import{f as Pe,g as W}from"./useUtils-CxT89PWc.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ke}from"./useCart-D0bgPpJc.js";import{u as xe}from"./addressesStore-BvfTMuu9.js";import"./format-CJebrXOQ.js";import"./QMenu-C0HWo-MC.js";import"./rtl-DFPa-2ov.js";import"./QBtnDropdown-D1a858nj.js";import"./orderStore-B0RC784Z.js";const qe=ae({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(y,{slots:u}){const{proxy:{$q:i}}=X(),o=O(te,k);if(o===k)return console.error("QPage needs to be a deep child of QLayout"),k;if(O(oe,k)===k)return console.error("QPage needs to be child of QPageContainer"),k;const m=z(()=>{const v=(o.header.space===!0?o.header.size:0)+(o.footer.space===!0?o.footer.size:0);if(typeof y.styleFn=="function"){const Q=o.isContainer.value===!0?o.containerHeight.value:i.screen.height;return y.styleFn(v,Q)}return{minHeight:o.isContainer.value===!0?o.containerHeight.value-v+"px":i.screen.height===0?v!==0?`calc(100vh - ${v}px)`:"100vh":i.screen.height-v+"px"}}),b=z(()=>`q-page${y.padding===!0?" q-layout-padding":""}`);return()=>ne("main",{class:b.value,style:m.value},le(u.default))}});function M(){const{emit:y,proxy:u}=X(),i=P(null);function o(){i.value.show()}function d(){i.value.hide()}function m(v){y("ok",v),d()}function b(){y("hide")}return Object.assign(u,{show:o,hide:d}),{dialogRef:i,onDialogHide:b,onDialogOK:m,onDialogCancel:d}}const ee=["ok","hide"];M.emits=ee;M.emitsObject=he(ee);const we={class:"text-h6 q-mb-md"},$e={class:"text-center upload-title"},De={class:"q-mb-md"},Se={key:1},Fe={class:"text-h6 text-center q-mt-sm"},Ie={class:"text-bold"},Re=j({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(y,{emit:u}){const i=y,o=u,d=B(),m=G(),b=Ve(),{dialogRef:v}=M(),{isManager:Q}=J(),$=P(!1),x=P(),e=P({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),f=new FormData;i.productData&&(e.value=i.productData);async function R(){try{let t=null;e.value?.id?t=m.updateProduct(e.value):(U(),t=await m.createProduct(f)),t&&(e.value.id=t.id,d.notify({color:"primary",message:"Успешно сохранено"}),o("refresh-data"))}catch(t){console.error(t)}}function A(){o("add-product",e.value)}function U(){e?.value?.id&&f.append("id",e.value.id.toString()),e.value?.name&&f.append("name",e.value.name),e.value?.price&&f.append("price",e.value.price.toString()),e.value?.category_id&&f.append("category_id",e.value.category_id.toString()),e.value?.qty&&f.append("qty",e.value.qty.toString()),e.value?.description&&f.append("description",e.value.description),e.value?.origin_country&&f.append("origin_country",e.value.origin_country)}function D(t){const a=new FileReader;a.readAsDataURL(t[0]),a.onload=()=>{},f.delete("images"),f.append("images",t[0]),e.value?.id&&c(t[0])}async function c(t){const a=new FormData;a.append("file",t),a.append("is_primary","true");try{await m.uploadFile(e.value.id,a)&&(s(),d.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(l){console.error(l)}finally{x.value&&x.value.reset()}}async function s(){try{const t=await m.fetchProductsById(e.value.id);e.value=t}catch(t){console.error(t)}}return(t,a)=>(p(),_(se,{ref_key:"dialogRef",ref:v,modelValue:$.value,"onUpdate:modelValue":a[10]||(a[10]=l=>$.value=l),persistent:""},{default:r(()=>[n(ie,{class:"add-product"},{default:r(()=>[h(Q)?(p(),_(T,{key:0,greedy:""},{default:r(()=>[n(H,null,{default:r(()=>[g("div",we,C(e.value.id?"Редактирование товара":"Добавление товара"),1),n(be,{ref_key:"uploaderRef",ref:x,class:"q-mb-md",color:"primary",flat:"","max-file-size":"15728640",onAdded:D,onRejected:a[0]||(a[0]=l=>h(Pe)(h(d)))},{header:r(()=>[...a[11]||(a[11]=[])]),list:r(()=>[n(Ce),g("div",$e,[n(re,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[12]||(a[12]=g("span",null,"Загрузить картинку",-1))])]),_:1},512),g("div",De,[e.value?.images?.length?(p(),_(E,{key:0,images:e.value.images,onRefreshData:a[1]||(a[1]=l=>s())},null,8,["images"])):w("",!0)]),n(q,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.name=l),class:"q-mb-md",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),n(q,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.price=l),class:"q-mb-md",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),n(q,{modelValue:e.value.qty,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.qty=l),class:"q-mb-md",outlined:"",label:"Количество",type:"number"},null,8,["modelValue"]),n(q,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.origin_country=l),class:"q-mb-md",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),n(Qe,{modelValue:e.value.category_id,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.category_id=l),options:h(b).categories,class:"q-mb-md",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),n(q,{modelValue:e.value.description,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.description=l),class:"q-mb-md",outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),n(N,{align:"right"},{default:r(()=>[S(n(V,{color:"red",label:"Отмена"},null,512),[[F]]),S(n(V,{color:"primary",label:"Подтвердить",onClick:a[8]||(a[8]=l=>R())},null,512),[[F]])]),_:1})]),_:1})):(p(),_(T,{key:1},{default:r(()=>[n(H,null,{default:r(()=>[g("div",null,[e.value?.images?.length?(p(),_(E,{key:0,images:e.value.images},null,8,["images"])):(p(),I("div",Se,[n(Z,{class:"q-mt-sm",src:h(W)("/card-shop.jpg")},null,8,["src"])]))]),g("div",Fe,C(e.value.name),1),g("div",Ie,"Стоимость товара: "+C(e.value.price),1),g("div",null,"Страна происхождения: "+C(e.value.origin_country),1),g("div",null,"Описание: "+C(e.value.description),1)]),_:1}),n(N,{align:"right"},{default:r(()=>[S(n(V,{color:"red",label:"Отмена"},null,512),[[F]]),S(n(V,{color:"primary",label:"Добавить в корзину",onClick:a[9]||(a[9]=l=>A())},null,512),[[F]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),Ae=Y(Re,[["__scopeId","data-v-4c606175"]]),Ue={class:"product-card"},Le={key:0,class:"text-grey old-price"},je={key:0,class:"q-mb-sm"},Be=j({__name:"ProductList",setup(y){const u=B(),i=de(),o=G(),{addToCart:d}=ke(),{isManager:m,isAdmin:b}=J(),v=P(!1),Q=P(!1),$=P();function x(){o.pagination.offset=0,e()}async function e(){try{u.loading.show();const c={limit:o.pagination.limit,offset:o.pagination.offset},s=await o.fetchProducts(c);s&&(o.pagination.total=s.total,o.pagination.has_more=s.has_more,o?.products?.length?o.products.push(s.items):o.products=s.items)}catch(c){console.error(c)}finally{u.loading.hide()}}function f(c){try{u.loading.show(),d(c)}catch(s){console.error(s)}finally{u.loading.hide()}}const R=async(c,s)=>{if(!o.pagination.has_more){v.value=!0,s(!0);return}await e(),o.pagination.offset+=o.pagination.limit,s()};function A(c){u.dialog({cancel:!0,message:"Вы уверенны что хотите удалить товар?",persistent:!0,title:"Удаление товара"}).onOk(()=>{U(c)})}async function U(c){try{if(!c?.id)return;await o.deleteProduct(c.id),u.loading.show()}catch(s){console.error(s)}finally{u.loading.hide()}}function D(c){i.push({name:"products-edit",params:{id:c.id}})}return(c,s)=>(p(),_(_e,{offset:250,onLoad:R},{default:r(()=>[h(m)?(p(),_(V,{key:0,class:"full-width q-mb-sm",color:"green",label:"Добавить товар",onClick:s[0]||(s[0]=t=>h(i).push({name:"products-create"}))})):w("",!0),g("div",Ue,[(p(!0),I(ce,null,ue(h(o).products,(t,a)=>(p(),_(ye,{key:a},{default:r(()=>[n(ve,null,{default:r(()=>[n(L,{top:"",avatar:"",onClick:l=>D(t)},{default:r(()=>[n(Z,{class:"cursor-pointer radius-8",src:t.primary_image?t.primary_image:h(W)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),n(L,{class:"column justify-between",onClick:l=>D(t)},{default:r(()=>[n(K,{caption:"",class:"text-size-16"},{default:r(()=>[pe(C(t.name),1)]),_:2},1024),n(K,null,{default:r(()=>[t?.old_price?(p(),I("div",Le,C(t.old_price)+" ₽",1)):w("",!0),g("div",{class:me(t?.old_price?"text-red":"")},C(t.price)+" ₽/шт.",3)]),_:2},1024)]),_:2},1032,["onClick"]),n(L,{side:"",top:"",class:"column justify-between"},{default:r(()=>[g("div",null,[h(b)?(p(),I("div",je,[n(V,{dense:"",round:"",color:"red",icon:"delete",onClick:l=>A(t)},null,8,["onClick"])])):w("",!0),g("div",null,[n(V,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:l=>f(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024),n(fe,{spaced:"",inset:""})]),_:2},1024))),128))]),Q.value?(p(),_(Ae,{key:1,modelValue:Q.value,"onUpdate:modelValue":s[1]||(s[1]=t=>Q.value=t),productData:$.value,onRefreshData:s[2]||(s[2]=t=>x()),onAddProduct:f},null,8,["modelValue","productData"])):w("",!0)]),_:1}))}}),Me=Y(Be,[["__scopeId","data-v-0da61ebe"]]),ua=j({__name:"DashboardPage",setup(y){const u=B(),i=xe();ge(()=>{o()});async function o(){try{u.loading.show();const d=await i.fetchAddresses();if(d){i.addresses=d;const m=d.find(b=>b.is_default===!0);i.addressId=m.id}}catch(d){console.error(d)}finally{u.loading.hide()}}return(d,m)=>(p(),_(qe,{class:"q-mx-xs"},{default:r(()=>[n(Me,{class:"q-mb-lg"})]),_:1}))}});export{ua as default};
