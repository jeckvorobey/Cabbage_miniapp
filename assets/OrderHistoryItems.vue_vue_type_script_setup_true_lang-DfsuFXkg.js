import{b as n,Q as S,a as f}from"./QItem-DDFQnoek.js";import{Q as H}from"./QList-CIHG26K6.js";import{Q as z}from"./QBtnDropdown-B-RHoI3Z.js";import{e as F,i as W,V as A,r as h,X as p,Y as o,ad as X,Z as e,$ as t,a0 as Y,aa as M,_ as g,a9 as b,a7 as B,a5 as u,a6 as d,a4 as Q,A as $,a8 as w,a1 as y,a2 as N,a3 as q,W as Z}from"./index-DnGzFKC9.js";import{C as O}from"./ClosePopup-BJPvVL4Y.js";import{d as R,u as j}from"./use-quasar-CveTaO1z.js";import{u as J}from"./orderStore-OCqELavW.js";import{Q as K}from"./QBadge-BQP4CRha.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";var m=(c=>(c.CREATED="created",c.ASSEMBLING="assembling",c.DELIVERING="delivering",c.COMPLETED="completed",c.CANCELLED="cancelled",c))(m||{});const te=F({name:"QSpace",setup(){const c=W("div",{class:"q-space"});return()=>c}}),ae={class:"text-h6 q-mt-xs"},le={class:"q-mb-sm"},se={class:"row"},oe={key:0,class:"text-italic text-grey"},ne={key:1,class:"text-italic text-grey"},re={class:"col-12 col-md-4 text-right"},ue={class:"text-h5 text-weight-bold text-green"},ie=A({__name:"OrderHistoryModal",props:{orderHistoryData:{},orderStatus:{}},setup(c){const C=c,L=h(!1);function _(i){const a=C.orderStatus.find(k=>k.value===i);return{color:a?.value===m.CANCELLED?"negative":"positive",label:a?.label||"-"}}return(i,a)=>(o(),p(X,{ref:"dialogRef",modelValue:L.value,"onUpdate:modelValue":a[0]||(a[0]=v=>L.value=v),persistent:""},{default:e(()=>[t(Y,{class:"order-history-modal"},{default:e(()=>[t(M,{class:"row items-center q-pb-xs q-pr-xs q-pt-xs"},{default:e(()=>[g("div",ae,[t(n,null,{default:e(()=>[...a[1]||(a[1]=[u("Детали Заказа",-1)])]),_:1}),t(n,{caption:""},{default:e(()=>[u(d(Q(R)(i.orderHistoryData.order_date))+"г",1)]),_:1})]),t(te),i.orderHistoryData?.status?(o(),p(n,{key:0,class:"q-mr-sm"},{default:e(()=>[t(K,{class:"q-pa-xs",color:_(i.orderHistoryData.status).color},{default:e(()=>[u(d(_(i.orderHistoryData.status).label),1)]),_:1},8,["color"])]),_:1})):b("",!0),B(t($,{icon:"close",flat:"",round:"",dense:""},null,512),[[O]])]),_:1}),t(w),t(M,{class:"q-pt-none"},{default:e(()=>[g("div",le,[t(H,null,{default:e(()=>[t(S,{dense:"",class:"q-pa-none"},{default:e(()=>[t(f,null,{default:e(()=>[t(n,{caption:"",lines:"1"},{default:e(()=>[...a[2]||(a[2]=[u("Товар",-1)])]),_:1})]),_:1}),t(f,null,{default:e(()=>[t(n,{caption:"",lines:"1"},{default:e(()=>[...a[3]||(a[3]=[u("Кол.",-1)])]),_:1})]),_:1}),t(f,null,{default:e(()=>[t(n,{caption:"",lines:"1"},{default:e(()=>[...a[4]||(a[4]=[u("Цена",-1)])]),_:1})]),_:1})]),_:1}),(o(!0),y(N,null,q(i.orderHistoryData.items,(v,k)=>(o(),p(S,{key:k,dense:"",class:"q-pa-none"},{default:e(()=>[t(f,null,{default:e(()=>[t(n,null,{default:e(()=>[u(d(v?.name||"-"),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:e(()=>[t(n,null,{default:e(()=>[u(d(v?.quantity),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:e(()=>[t(n,null,{default:e(()=>[u(d(v?.price)+" ₽",1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(w)]),g("div",se,[g("div",null,[i.orderHistoryData.comment?(o(),y("div",oe,"Комментарий: "+d(i.orderHistoryData.comment),1)):(o(),y("div",ne,"Комментарий отсутствует."))]),g("div",re,[a[5]||(a[5]=g("div",{class:"text-subtitle1 text-weight-medium"},"Итого:",-1)),g("div",ue,d(i.orderHistoryData.total_amount)+" ₽",1)])])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),de=ee(ie,[["__scopeId","data-v-7a03c6c2"]]),ce=["href"],me={key:1},be=A({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},setup(c){const C=j(),L=J(),_=h(!1),i=h(),a=[{label:"создан",value:m.CREATED},{label:"собирается",value:m.ASSEMBLING},{label:"в пути",value:m.DELIVERING},{label:"завершён",value:m.COMPLETED},{label:"отменён",value:m.CANCELLED}];function v(s,r){C.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{k(s,r)})}async function k(s,r){try{C.loading.show(),await L.updateOrderStatus(s,r)&&C.notify({color:"primary",message:"Статус успешно изменен"})}catch(D){console.error(D)}finally{C.loading.hide()}}function T(s){return a.find(D=>D.value===s)?.label}function G(s){C.dialog({cancel:!0,message:"Вы уверенны что хотите отменить заказ?",persistent:!0,title:"Отмена заказа"}).onOk(()=>{k(s,m.CANCELLED)})}function I(s){const r=s.username?.trim().replace(/^@/,"");return r?`https://t.me/${encodeURIComponent(r)}`:null}function V(s){if(!s.phone)return null;const r=s.phone.trim();return r.length?r:null}function x(s){i.value=s,_.value=!_.value}return(s,r)=>{const D=Z("q-item-action");return o(),y("div",null,[t(H,null,{default:e(()=>[(o(!0),y(N,null,q(s.orderData,(l,U)=>(o(),p(S,{key:l.id??U,class:"border-bot"},{default:e(()=>[t(f,{onClick:E=>x(l)},{default:e(()=>[V(l.user)?(o(),p(n,{key:0,caption:"",class:"text-10"},{default:e(()=>[u(d(V(l.user)),1)]),_:2},1024)):b("",!0),t(n,null,{default:e(()=>[I(l.user)?(o(),y("a",{key:0,href:I(l.user),target:"_blank",rel:"noopener noreferrer",class:"text-primary text-decoration-none"},d(l.user.full_name),9,ce)):(o(),y("span",me,d(l.user.full_name),1))]),_:2},1024)]),_:2},1032,["onClick"]),t(f,{onClick:E=>x(l)},{default:e(()=>[t(n,{caption:"",class:"text-10"},{default:e(()=>[u(d(Q(R)(l.order_date)),1)]),_:2},1024),t(n,null,{default:e(()=>[u(d(T(l.status)),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(f,{onClick:E=>x(l)},{default:e(()=>[t(n,{caption:"",class:"text-10"},{default:e(()=>[...r[1]||(r[1]=[u("Общая сумма",-1)])]),_:1}),t(n,null,{default:e(()=>[u(d(l.total_amount),1)]),_:2},1024)]),_:2},1032,["onClick"]),s.adminMode?(o(),p(D,{key:0},{default:e(()=>[t(z,{size:"10px",color:"green",dense:""},{default:e(()=>[(o(),y(N,null,q(a,(E,P)=>t(H,{key:P},{default:e(()=>[B((o(),p(S,{clickable:"",onClick:fe=>v(l.id,E.value)},{default:e(()=>[t(f,null,{default:e(()=>[t(n,null,{default:e(()=>[u(d(E.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[O]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):b("",!0),!s.adminMode&&(l.status===Q(m).CREATED||l.status===Q(m).ASSEMBLING)?(o(),p(D,{key:1},{default:e(()=>[t($,{size:"10px",round:"",color:"deep-orange",icon:"close",onClick:E=>G(l.id)},null,8,["onClick"])]),_:2},1024)):b("",!0)]),_:2},1024))),128))]),_:1}),_.value&&i.value?(o(),p(de,{key:0,modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=l=>_.value=l),orderHistoryData:i.value,orderStatus:a},null,8,["modelValue","orderHistoryData"])):b("",!0)])}}});export{be as _};
