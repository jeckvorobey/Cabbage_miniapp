import{k as ie,g as W,a as H,v as C,x as ue,$ as de,c as R,h as ce,l as pe,r as k,d as z,u as X,o as Z,aj as b,ai as g,aE as me,an as r,f as t,am as x,aF as N,ao as m,ap as y,ad as fe,ak as U,aD as q,aG as E,Y as F,Q as V,ah as O,aH as ge,ae as ve,aq as ye,F as _e,aI as K,az as T,al as he,ab as be}from"./index-CcfvS8Eu.js";import{Q as ee}from"./QImg-B_Yl12LD.js";import{Q as xe,b as A,a as B}from"./QItem-bG1dKP_L.js";import{Q as Qe}from"./QList-UD0K1hm9.js";import{Q as Ce}from"./QInfiniteScroll-BaK4_X4H.js";import{u as ae}from"./productsStore-DzjMpNKk.js";import{e as Ve}from"./orderStore-D9jn2M9d.js";import{u as te}from"./use-quasar-DtARRiGq.js";import{g as ke,Q as De,a as Pe,P as G}from"./ProductImgCarusel-Bp7gIf4c.js";import{Q as Y}from"./QSelect-tCYPj9mk.js";import{Q as J}from"./QForm-OuceneqC.js";import{C as I}from"./ClosePopup-BMFTL8MB.js";import{u as oe}from"./usePermissionVisibility.hook-CnNf0ju-.js";import{u as qe}from"./categoriesStore-Dreu2Q7Y.js";import{u as ne}from"./unitsStore-DRBwKrrl.js";import{g as le}from"./useUtils-BCRxd3pn.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QMenu-DeP7sQlF.js";import"./rtl-D3GObVCM.js";const we=ie({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(h,{slots:c}){const{proxy:{$q:p}}=W(),u=H(ue,C);if(u===C)return console.error("QPage needs to be a deep child of QLayout"),C;if(H(de,C)===C)return console.error("QPage needs to be child of QPageContainer"),C;const v=R(()=>{const _=(u.header.space===!0?u.header.size:0)+(u.footer.space===!0?u.footer.size:0);if(typeof h.styleFn=="function"){const D=u.isContainer.value===!0?u.containerHeight.value:p.screen.height;return h.styleFn(_,D)}return{minHeight:u.isContainer.value===!0?u.containerHeight.value-_+"px":p.screen.height===0?_!==0?`calc(100vh - ${_}px)`:"100vh":p.screen.height-_+"px"}}),Q=R(()=>`q-page${h.padding===!0?" q-layout-padding":""}`);return()=>ce("main",{class:Q.value,style:v.value},pe(c.default))}});function M(){const{emit:h,proxy:c}=W(),p=k(null);function u(){p.value.show()}function o(){p.value.hide()}function v(_){h("ok",_),o()}function Q(){h("hide")}return Object.assign(c,{show:u,hide:o}),{dialogRef:p,onDialogHide:Q,onDialogOK:v,onDialogCancel:o}}const re=["ok","hide"];M.emits=re;M.emitsObject=ke(re);const Se={class:"text-h6 q-mb-md"},$e={class:"text-center upload-title"},Fe={key:1},Ie={class:"text-h6 text-center q-mt-sm"},Ue={class:"text-bold"},Re=z({__name:"AddProductModal",props:{productData:{}},emits:["refresh-data","add-product"],setup(h,{emit:c}){const p=h,u=c,o=te(),v=ae(),Q=qe(),{dialogRef:_}=M(),D=X(),{isManager:P}=oe(R(()=>D.user?.role)),j=ne(),w=k(!1),e=k({id:null,name:"",price:null,category_id:null,unit_id:null,qty:null,description:"",images:"",origin_country:"",unit:null}),f=new FormData;Z(()=>{p.productData&&(e.value=p.productData)});async function L(){try{let s=null;e.value?.id?s=v.updateProduct(e.value):(d(),s=await v.createProduct(f)),s&&(e.value.id=s.id,o.notify({message:"Успешно сохранено",color:"primary"}),u("refresh-data"))}catch(s){console.error(s)}}function S(){u("add-product",e.value)}function d(){e?.value?.id&&f.append("id",e.value.id.toString()),e.value?.name&&f.append("name",e.value.name),e.value?.price&&f.append("price",e.value.price.toString()),e.value?.category_id&&f.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&f.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&f.append("qty",e.value.qty.toString()),e.value?.description&&f.append("description",e.value.description),e.value?.origin_country&&f.append("origin_country",e.value.origin_country)}function n(s){const a=new FileReader;a.readAsDataURL(s[0]),a.onload=()=>{},f.append("images",s[0]),e.value?.id&&i(s[0])}async function i(s){const a=new FormData;a.append("file",s),a.append("is_primary","true");try{await v.uploadFile(e.value.id,a)&&($(),o.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(l){console.error(l)}}async function $(){try{const s=await v.fetchProductsById(e.value.id);e.value=s}catch(s){console.error(s)}}return(s,a)=>(g(),b(me,{ref_key:"dialogRef",ref:_,modelValue:w.value,"onUpdate:modelValue":a[10]||(a[10]=l=>w.value=l),persistent:""},{default:r(()=>[t(ge,{class:"add-product"},{default:r(()=>[x(P)?(g(),b(J,{key:0,greedy:""},{default:r(()=>[t(N,null,{default:r(()=>[m("div",Se,y(e.value.id?"Редактирование товара":"Добавление товара"),1),t(De,{ref:"uploaderRef",color:"primary",flat:"",onAdded:n},{header:r(()=>[...a[11]||(a[11]=[])]),list:r(()=>[t(Pe),m("div",$e,[t(fe,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[12]||(a[12]=m("span",null,"Загрузить картинку",-1))])]),_:1},512),m("div",null,[e.value?.images?.length?(g(),b(G,{key:0,onRefreshData:a[0]||(a[0]=l=>$()),images:e.value.images},null,8,["images"])):U("",!0)]),t(q,{modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.name=l),class:"q-mb-xs",outlined:"",label:"Наименование товара"},null,8,["modelValue"]),t(q,{modelValue:e.value.price,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.price=l),class:"q-mb-xs",outlined:"",label:"Стоимость товара"},null,8,["modelValue"]),t(q,{modelValue:e.value.qty,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.qty=l),class:"q-mb-xs",outlined:"",label:"Количество"},null,8,["modelValue"]),t(q,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.origin_country=l),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),t(Y,{modelValue:e.value.category_id,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.category_id=l),options:x(Q).categories,class:"q-mb-xs",outlined:"",label:"Категория","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),t(Y,{modelValue:e.value.unit_id,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.unit_id=l),options:x(j).units,outlined:"",label:"Единица измерения","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","options"]),t(q,{class:"q-mt-sm",modelValue:e.value.description,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.description=l),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"])]),_:1}),t(E,{align:"right"},{default:r(()=>[F(t(V,{color:"red",label:"Отмена"},null,512),[[I]]),F(t(V,{color:"primary",label:"Подтвердить",onClick:a[8]||(a[8]=l=>L())},null,512),[[I]])]),_:1})]),_:1})):(g(),b(J,{key:1},{default:r(()=>[t(N,null,{default:r(()=>[m("div",null,[e.value?.images?.length?(g(),b(G,{key:0,images:e.value.images},null,8,["images"])):(g(),O("div",Fe,[t(ee,{class:"q-mt-sm",src:x(le)("/card-shop.jpg")},null,8,["src"])]))]),m("div",Ie,y(e.value.name),1),m("div",Ue,"Стоимость товара: "+y(e.value.price),1),m("div",null,"Вес: 11 "+y(e.value?.unit?.name||"")+".",1),m("div",null,"Страна происхождения: "+y(e.value.origin_country),1),m("div",null,"Описание: "+y(e.value.description),1)]),_:1}),t(E,{align:"right"},{default:r(()=>[F(t(V,{color:"red",label:"Отмена"},null,512),[[I]]),F(t(V,{color:"primary",label:"Добавить в корзину",onClick:a[9]||(a[9]=l=>S())},null,512),[[I]])]),_:1})]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}}),je=se(Re,[["__scopeId","data-v-74dadd3f"]]),Le={class:"product-card"},Ae={key:0,class:"text-grey old-price"},Be={class:"row items-end"},Oe=z({__name:"ProductList",setup(h){const c=te(),p=ve(),u=ne(),o=ae(),v=Ve(),Q=X(),{isManager:_}=oe(R(()=>Q.user?.role)),D=k(!1),P=k(!1),j=k();Z(async()=>{try{await u.fetchUnits(),c.loading.show()}catch(d){console.error(d)}finally{c.loading.hide()}});function w(){o.pagination.offset=0,e()}async function e(){try{c.loading.show();const d={offset:o.pagination.offset,limit:o.pagination.limit},n=await o.fetchProducts(d);n&&(o.pagination.total=n.total,o.pagination.has_more=n.has_more,o?.products?.length?o.products.push(n.items):o.products=n.items)}catch(d){console.error(d)}finally{c.loading.hide()}}function f(d){try{c.loading.show(),v.basketData?.length?v.basketData.push(structuredClone(K(d))):v.basketData.push(structuredClone(K(d)))}catch(n){console.error(n)}finally{c.notify({message:`Товар ${d.name} добавлен в корзину`,color:"primary"}),c.loading.hide()}}const L=async(d,n)=>{if(!o.pagination.has_more){D.value=!0,n(!0);return}await e(),o.pagination.offset+=o.pagination.limit,n()};function S(d){p.push({name:"products-edit",params:{id:d.id}})}return(d,n)=>(g(),b(Ce,{onLoad:L,offset:250},{default:r(()=>[x(_)?(g(),b(V,{key:0,onClick:n[0]||(n[0]=i=>x(p).push({name:"products-create"})),class:"full-width q-mb-sm",color:"secondary",label:"Добавить товар"})):U("",!0),m("div",Le,[(g(!0),O(_e,null,ye(x(o).products,(i,$)=>(g(),b(Qe,{key:$},{default:r(()=>[t(xe,null,{default:r(()=>[t(A,{top:"",avatar:"",onClick:s=>S(i)},{default:r(()=>[t(ee,{class:"cursor-pointer radius-8",src:i[0]?.primary_image?i[0].primary_image:x(le)("/card-shop.jpg"),height:"80px",width:"80px",fit:"cover"},null,8,["src"])]),_:2},1032,["onClick"]),t(A,{class:"column justify-between",onClick:s=>S(i)},{default:r(()=>[t(B,{caption:"",class:"text-size-16"},{default:r(()=>[T(y(i.name),1)]),_:2},1024),t(B,null,{default:r(()=>[i?.old_price?(g(),O("div",Ae,y(i.old_price)+" ₽",1)):U("",!0),m("div",{class:he(i?.old_price?"text-red":"")},y(i.price)+" ₽/ "+y(i.unit_name),3)]),_:2},1024)]),_:2},1032,["onClick"]),t(A,{side:"",top:"",class:"column justify-between"},{default:r(()=>[n[3]||(n[3]=m("div",null,null,-1)),m("div",Be,[t(B,{class:"q-mr-xs",caption:""},{default:r(()=>[T(y(i.price)+" ₽/ "+y(i.unit_name),1)]),_:2},1024),t(V,{dense:"",round:"",color:"green",icon:"shopping_cart",onClick:s=>f(i)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024),t(be,{spaced:"",inset:""})]),_:2},1024))),128))]),P.value?(g(),b(je,{key:1,modelValue:P.value,"onUpdate:modelValue":n[1]||(n[1]=i=>P.value=i),productData:j.value,onRefreshData:n[2]||(n[2]=i=>w()),onAddProduct:f},null,8,["modelValue","productData"])):U("",!0)]),_:1}))}}),ze=se(Oe,[["__scopeId","data-v-254b455d"]]),ra=z({__name:"DashboardPage",setup(h){return(c,p)=>(g(),b(we,{class:"q-mx-xs"},{default:r(()=>[t(ze,{class:"q-mb-lg"})]),_:1}))}});export{ra as default};
