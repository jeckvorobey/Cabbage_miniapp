import{z as R,r as g,c as U,V as D,w,a4 as Q,M as v,$ as o,_ as a,a2 as I,a0 as z,N as M,a1 as C,a9 as k,aa as E,ab as S,S as h,ac as O,h as T,a3 as X,L as V,a5 as $,Z as b,X as Y,Y as Z,a6 as q,a7 as j}from"./index-lR2VyFMA.js";import{Q as G,a as x,b as A}from"./QItem-yTDSvijc.js";import{Q as H}from"./QList-CfBeZ910.js";import{u as N}from"./use-quasar-BpGytDB4.js";import{Q as J}from"./QForm-BdEenjpN.js";import{C as B}from"./ClosePopup-DjQNiBEZ.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as W}from"./usePermissionVisibility.hook-D3EpKoy2.js";import"./useUtils-DvRo9GAg.js";const L=R("Units",()=>{const y=g([]);async function m(t){return U.post("units",t).then(e=>e.data).catch(e=>{throw console.error("[UnitsStore] - An error occurred while createing via createUnit",e.message),e})}async function l(t){return U.get(`/units/${t}`).then(e=>e.data).catch(e=>{throw console.error("[UnitsStore] - An error occurred while fetching via fetchUnitsById",e.message),e})}async function p(){return U.get("units").then(t=>{y.value=t.data}).catch(t=>{throw console.error("[UnitsStore] - An error occurred while fetching via fetchUnits",t.message),t})}async function u(t,e){return U.put(`/units/${t}`,e).then(c=>c.data).catch(c=>{throw console.error("[UnitsStore] - An error occurred while fetching via updateUnit",c.message),c})}async function d(t){return U.delete(`units/${t}`).then(e=>e.data).catch(e=>{throw console.error("[UnitsStore] - An error occurred while deleting via deleteUnit",e.message),e})}return{createUnit:m,fetchUnitsById:l,fetchUnits:p,updateUnit:u,deleteUnit:d,units:y}}),ee={class:"text-h6 q-mb-md"},te=D({__name:"AddUnitModal",props:{modelValue:{type:Boolean,default:!1},unitData:{default:()=>({name:"",symbol:""})}},emits:["update:modelValue","update"],setup(y,{emit:m}){const l=y,p=m,u=N(),d=L(),t=g(l.modelValue),e=g({...l.unitData});w(()=>l.unitData,s=>{e.value={...s??{name:"",symbol:""}}},{deep:!0,immediate:!0}),w(()=>l.modelValue,s=>{t.value=s},{immediate:!0}),w(t,s=>{p("update:modelValue",s)});async function c(){try{e.value?.id?await d.updateUnit(e.value.id,e.value)&&u.notify({color:"primary",message:"Единица измерения успешно обновлена"}):await d.createUnit(e.value)&&u.notify({color:"primary",message:"Единица измерения успешно создана"})}catch(s){console.error(s)}finally{t.value=!1,p("update")}}return(s,i)=>(v(),Q(O,{ref:"dialogRef",modelValue:t.value,"onUpdate:modelValue":i[3]||(i[3]=n=>t.value=n),persistent:""},{default:o(()=>[a(I,{class:"add-product"},{default:o(()=>[a(J,{greedy:""},{default:o(()=>[a(z,null,{default:o(()=>[M("div",ee,C(e.value.id?"Редактирование":"Добавление")+" единицы измерения ",1),a(k,{modelValue:e.value.name,"onUpdate:modelValue":i[0]||(i[0]=n=>e.value.name=n),class:"q-mb-xs",label:"Наименование (пример: кг, гр, шт)",outlined:""},null,8,["modelValue"]),a(k,{modelValue:e.value.symbol,"onUpdate:modelValue":i[1]||(i[1]=n=>e.value.symbol=n),class:"q-mb-xs",label:"Символ (пример: kg, gr, sh)",outlined:""},null,8,["modelValue"])]),_:1}),a(E,{align:"right"},{default:o(()=>[S(a(h,{color:"red",flat:"",label:"Отмена"},null,512),[[B]]),S(a(h,{color:"primary",flat:"",label:"Сохранить",onClick:i[2]||(i[2]=n=>c())},null,512),[[B]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ae=K(te,[["__scopeId","data-v-ed0ccc69"]]),ne={key:0},fe=D({__name:"UnitsPage",setup(y){const m=N(),l=L(),{isManager:p}=W(),u=g(!1),d=g();T(()=>{t()});async function t(){try{await l.fetchUnits(),m.loading.show()}catch(n){console.error(n)}finally{m.loading.hide()}}function e(n){m.dialog({cancel:!0,message:"Вы уверенны что хотите удалить единицу измерения?",persistent:!0,title:"Удаление единицы измерения"}).onOk(()=>{c(n)})}async function c(n){try{await l.deleteUnit(n)}catch(r){console.error(r)}finally{await t()}}function s(){d.value=void 0,u.value=!0}function i(n){const r=l.units.find(_=>_.id===n);r&&(d.value={...r},u.value=!0)}return(n,r)=>{const _=X("q-item-action");return v(),V("div",null,[a(h,{class:"full-width q-mb-sm",color:"secondary",label:"Добавление единицы измерения",onClick:s}),b(l).units?(v(),V("div",ne,[r[2]||(r[2]=M("h6",{class:"text-center q-mt-md q-mb-md"},"Единицы измерения",-1)),a(I,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:o(()=>[(v(!0),V(Y,null,Z(b(l).units,(f,P)=>(v(),Q(H,{key:P},{default:o(()=>[a(G,null,{default:o(()=>[a(x,null,{default:o(()=>[a(A,null,{default:o(()=>[q(C(f.name),1)]),_:2},1024)]),_:2},1024),a(x,null,{default:o(()=>[a(A,null,{default:o(()=>[q(C(f.symbol),1)]),_:2},1024)]),_:2},1024),a(_,null,{default:o(()=>[b(p)?(v(),Q(h,{key:0,flat:"",round:"",color:"red",icon:"delete",onClick:F=>e(f.id)},null,8,["onClick"])):$("",!0),a(h,{flat:"",round:"",color:"primary",icon:"mode_edit",onClick:F=>i(f.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),a(j)]),_:2},1024))),128))]),_:1})])):$("",!0),a(ae,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=f=>u.value=f),"unit-data":d.value,onUpdate:r[1]||(r[1]=f=>t())},null,8,["modelValue","unit-data"])])}}});export{fe as default};
