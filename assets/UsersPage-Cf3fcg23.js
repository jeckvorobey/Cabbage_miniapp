import{k as J,b4 as le,b5 as K,g as X,r as _,au as se,c as Q,aQ as re,w as C,o as p,h as w,a4 as ee,l as te,af as M,I as ie,v as ue,Y as ce,a9 as de,a8 as fe,p as me,z as ve,b6 as L,_ as N,b7 as j,t as F,b8 as O,Z as ge,aZ as be,d as he,aq as we,ah as U,ac as x,ad as u,ao as _e,f as d,aL as Se,ab as $,F as z,ae as W,ai as Z,aj as P,ak as E,U as ye,ag as Be}from"./index-Cwb1ifOh.js";import{Q as G,a as R,b as H}from"./QItem-Dt-jlVBh.js";import{Q as Y}from"./QList-DD6ry7K_.js";import{Q as qe}from"./QBtnGroup-DPNQuOl-.js";import{Q as Ce}from"./QMenu-BkzIOf4b.js";import{C as De}from"./ClosePopup-DtFScNQ9.js";import{u as Qe}from"./use-quasar-RIQImzqm.js";import{a as ke}from"./useUtils-BAEqTkCD.js";import{u as Ae}from"./usersStore-d-W7KfzV.js";const Ie=Object.keys(K);function xe(e){return Ie.reduce((r,i)=>{const o=e[i];return o!==void 0&&(r[i]=o),r},{})}const Le=J({name:"QBtnDropdown",props:{...K,...le,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noEscDismiss:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,noRefocus:Boolean,noFocus:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:r,emit:i}){const{proxy:o}=X(),l=_(e.modelValue),f=_(null),h=se(),b=Q(()=>{const t={"aria-expanded":l.value===!0?"true":"false","aria-haspopup":"true","aria-controls":h.value,"aria-label":e.toggleAriaLabel||o.$q.lang.label[l.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(t["aria-disabled"]="true"),t}),a=Q(()=>"q-btn-dropdown__arrow"+(l.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),n=Q(()=>re(e)),c=Q(()=>xe(e));C(()=>e.modelValue,t=>{f.value?.[t?"show":"hide"]()}),C(()=>e.split,B);function m(t){l.value=!0,i("beforeShow",t)}function g(t){i("show",t),i("update:modelValue",!0)}function k(t){l.value=!1,i("beforeHide",t)}function S(t){i("hide",t),i("update:modelValue",!1)}function y(t){i("click",t)}function D(t){ie(t),B(),i("click",t)}function V(t){f.value?.toggle(t)}function A(t){f.value?.show(t)}function B(t){f.value?.hide(t)}return Object.assign(o,{show:A,hide:B,toggle:V}),p(()=>{e.modelValue===!0&&A()}),()=>{const t=[w(ee,{class:a.value,name:e.dropdownIcon||o.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&t.push(w(Ce,{ref:f,id:h.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noEscDismiss:e.noEscDismiss,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,noFocus:e.noFocus,noRefocus:e.noRefocus,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:m,onShow:g,onBeforeHide:k,onHide:S},r.default)),e.split===!1?w(M,{class:"q-btn-dropdown q-btn-dropdown--simple",...c.value,...b.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:y},{default:()=>te(r.label,[]).concat(t),loading:r.loading}):w(qe,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...n.value,glossy:e.glossy,stretch:e.stretch},()=>[w(M,{class:"q-btn-dropdown--current",...c.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:D},{default:r.label,loading:r.loading}),w(M,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...b.value,...n.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>t)])}}}),{passive:q}=ue,Pe=J({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:ce,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(e,{slots:r,emit:i}){const o=_(!1),l=_(!0),f=_(null),h=_(null);let b=e.initialIndex,a,n;const c=Q(()=>"q-infinite-scroll__loading"+(o.value===!0?"":" invisible"));function m(){if(e.disable===!0||o.value===!0||l.value===!1)return;const s=L(a),v=N(a),I=j(a);e.reverse===!1?Math.round(v+I+e.offset)>=Math.round(s)&&g():Math.round(v)<=e.offset&&g()}function g(){if(e.disable===!0||o.value===!0||l.value===!1)return;b++,o.value=!0;const s=L(a);i("load",b,v=>{l.value===!0&&(o.value=!1,F(()=>{if(e.reverse===!0){const I=L(a),ne=N(a),oe=I-s;O(a,ne+oe)}v===!0?y():f.value&&f.value.closest("body")&&n()}))})}function k(){b=0}function S(){l.value===!1&&(l.value=!0,a.addEventListener("scroll",n,q)),m()}function y(){l.value===!0&&(l.value=!1,o.value=!1,a.removeEventListener("scroll",n,q),n?.cancel?.())}function D(){if(a&&l.value===!0&&a.removeEventListener("scroll",n,q),a=ge(f.value,e.scrollTarget),l.value===!0){if(a.addEventListener("scroll",n,q),e.reverse===!0){const s=L(a),v=j(a);O(a,s-v)}m()}}function V(s){b=s}function A(s){s=parseInt(s,10);const v=n;n=s<=0?m:be(m,isNaN(s)===!0?100:s),a&&l.value===!0&&(v!==void 0&&a.removeEventListener("scroll",v,q),a.addEventListener("scroll",n,q))}function B(s){if(t.value===!0){if(h.value===null){s!==!0&&F(()=>{B(!0)});return}const v=`${o.value===!0?"un":""}pauseAnimations`;Array.from(h.value.getElementsByTagName("svg")).forEach(I=>{I[v]()})}}const t=Q(()=>e.disable!==!0&&l.value===!0);C([o,t],()=>{B()}),C(()=>e.disable,s=>{s===!0?y():S()}),C(()=>e.reverse,()=>{o.value===!1&&l.value===!0&&m()}),C(()=>e.scrollTarget,D),C(()=>e.debounce,A);let T=!1;de(()=>{T!==!1&&a&&O(a,T)}),fe(()=>{T=a?N(a):!1}),me(()=>{l.value===!0&&a.removeEventListener("scroll",n,q)}),p(()=>{A(e.debounce),D(),o.value===!1&&B()});const ae=X();return Object.assign(ae.proxy,{poll:()=>{n?.()},trigger:g,stop:y,reset:k,resume:S,setIndex:V,updateScrollTarget:D}),()=>{const s=ve(r.default,[]);return t.value===!0&&s[e.reverse===!1?"push":"unshift"](w("div",{ref:h,class:c.value},te(r.loading))),w("div",{class:"q-infinite-scroll",ref:f},s)}}}),je=he({__name:"UsersPage",setup(e){const r=Qe(),i=Ae(),o=_({offset:0,limit:20,total:0,has_more:!0}),l=_([{name:"Администратор",value:1},{name:"Менеджер",value:2},{name:"Пользователь",value:9}]),f=async(n,c)=>{if(!o.value.has_more){c(!0);return}await h(),o.value.offset+=o.value.limit,c()};async function h(){try{r.loading.show();const n=await i.fetchUsers(o.value);n&&(o.value.total=n.total,o.value.has_more=n.has_more,i.users=n.items)}catch(n){console.error(n)}finally{r.loading.hide()}}function b(n,c){r.dialog({title:"Изменение прав пользователя",message:"Вы уверенны что хотите изменить права этого пользователя?",cancel:!0,persistent:!0}).onOk(()=>{a(n,c)})}async function a(n,c){try{r.loading.show(),await i.updateUserRole(n.id,c)&&(n.role=c,r.notify({message:"Роль изменена",color:"primary"}))}catch(m){console.error(m)}finally{r.loading.hide()}}return(n,c)=>{const m=we("q-item-action");return x(),U(Pe,{onLoad:f,offset:250},{default:u(()=>[c[0]||(c[0]=_e("h6",{class:"text-center q-mt-md q-mb-md"},"Пользователи",-1)),d(Se,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:u(()=>[(x(!0),$(z,null,W(Z(i).users,(g,k)=>(x(),U(Y,{key:k},{default:u(()=>[d(G,null,{default:u(()=>[d(R,{avatar:""},{default:u(()=>[d(ee,{color:"primary",name:"local_bar"})]),_:1}),d(R,null,{default:u(()=>[d(H,null,{default:u(()=>[P(E(g.name),1)]),_:2},1024),d(H,{caption:""},{default:u(()=>[P(E(g.telegram_id),1)]),_:2},1024)]),_:2},1024),d(R,null,{default:u(()=>[d(H,{caption:""},{default:u(()=>[P(E(Z(ke)(g.role)),1)]),_:2},1024)]),_:2},1024),d(m,null,{default:u(()=>[d(Le,{dense:"",flat:"",color:"primary","dropdown-icon":"change_history"},{default:u(()=>[d(Y,null,{default:u(()=>[(x(!0),$(z,null,W(l.value,(S,y)=>ye((x(),U(G,{key:y,clickable:"",onClick:D=>b(g,S.value)},{default:u(()=>[d(R,null,{default:u(()=>[d(H,null,{default:u(()=>[P(E(S.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[De]])),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),d(Be)]),_:2},1024))),128))]),_:1})]),_:1})}}});export{je as default};
