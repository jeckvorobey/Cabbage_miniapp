import{Q as B}from"./QInfiniteScroll-WedUomm7.js";import{u as Q}from"./use-quasar-CXhJRBre.js";import{u as k}from"./orderStore-BXVkyrLL.js";import{Q as v,a as p,b as s}from"./QItem-CYzqsgMB.js";import{Q as L}from"./QList-DHU_2D9A.js";import{Q as V}from"./QBtnDropdown-DxqQum9r.js";import{C as x}from"./ClosePopup-B7wp1cXO.js";import{u as M}from"./usePermissionVisibility.hook-YxAo1JbZ.js";import{X as N,Y as A,a3 as g,_ as u,a1 as o,$ as a,a4 as h,a5 as I,Z as E,ad as q,a7 as i,a8 as _,a6 as S,a9 as P,m as T,a0 as $}from"./index-BPMgtN8i.js";import"./QBtnGroup-D-P7VyI8.js";import"./QMenu-BGr4ZeAY.js";import"./useUtils-DITLf1go.js";var d=(n=>(n.CREATED="created",n.ASSEMBLING="assembling",n.DELIVERING="delivering",n.COMPLETED="completed",n.CANCELLED="cancelled",n))(d||{});const G=N({__name:"OrderHistoryItems",props:{orderData:{}},setup(n){const{isManager:m}=M(),e=Q(),D=k(),y=[{label:"создан",value:d.CREATED},{label:"собирается",value:d.ASSEMBLING},{label:"в пути",value:d.DELIVERING},{label:"завершён",value:d.COMPLETED},{label:"отменён",value:d.CANCELLED}];function C(r,t){e.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{l(r,t)})}async function l(r,t){try{e.loading.show(),await D.updateOrderStatus(r,t)&&e.notify({color:"primary",message:"Статус успешно изменен"})}catch(f){console.error(f)}finally{e.loading.hide()}}return(r,t)=>{const f=A("q-item-action");return u(),g("div",null,[o(L,null,{default:a(()=>[(u(!0),g(h,null,I(r.orderData,(c,w)=>(u(),E(v,{key:w,class:"border-bot"},{default:a(()=>[o(p,null,{default:a(()=>[o(s,{caption:"",lines:"2"},{default:a(()=>[...t[0]||(t[0]=[i("Дата",-1)])]),_:1}),o(s,null,{default:a(()=>[i(_(c.order_date),1)]),_:2},1024)]),_:2},1024),o(p,null,{default:a(()=>[o(s,{caption:"",lines:"2"},{default:a(()=>[...t[1]||(t[1]=[i("Статус",-1)])]),_:1}),o(s,null,{default:a(()=>[i(_(c.status),1)]),_:2},1024)]),_:2},1024),o(p,null,{default:a(()=>[o(s,{caption:"",lines:"2"},{default:a(()=>[...t[2]||(t[2]=[i("Общая сумма",-1)])]),_:1}),o(s,null,{default:a(()=>[i(_(c.total_amount),1)]),_:2},1024)]),_:2},1024),S(m)?(u(),E(f,{key:0},{default:a(()=>[o(V,{color:"green",dense:""},{default:a(()=>[(u(),g(h,null,I(y,(b,O)=>o(L,{key:O},{default:a(()=>[P((u(),E(v,{clickable:"",onClick:R=>C(c.id,b.value)},{default:a(()=>[o(p,null,{default:a(()=>[o(s,null,{default:a(()=>[i(_(b.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):q("",!0)]),_:2},1024))),128))]),_:1})])}}}),te=N({__name:"OrderHistoryPage",setup(n){const m=Q(),e=k(),{isManager:D}=M();T(async()=>{await C()});const y=(l,r)=>{if(!e.pagination.has_more){r(!0);return}e.pagination.offset+=e.pagination.limit,r()};async function C(){try{m.loading.show();const l={limit:e.pagination.limit,offset:e.pagination.offset},t=await(D.value?e.fetchOrders:e.fetchMyOrder)(l);t&&(e.pagination.total=t.total,e.pagination.has_more=t.has_more,e.ordersData?.length?e.ordersData.push(t.items):e.ordersData=t.items),t&&(e.ordersData=t.items)}catch(l){console.error(l)}finally{m.loading.hide()}}return(l,r)=>(u(),g("div",null,[o(B,{offset:250,onLoad:y},{default:a(()=>[r[0]||(r[0]=$("h6",{class:"text-center q-mt-md q-mb-md"},"История заказов",-1)),o(G,{orderData:S(e).ordersData},null,8,["orderData"])]),_:1})]))}});export{te as default};
