import{Q as ve,a as fe}from"./QUploader-DrirzW06.js";import{k as G,c as k,h as C,l as le,g as ne,r as D,aC as ge,w as E,aD as Y,aE as pe,o as J,p as ie,M as ye,O as _e,aF as be,V as xe,af as I,m as he,d as re,ah as $,ac as p,ad as Q,ab as S,F as qe,ae as Ce,f as g,ap as V,ai as b,ax as ke,aa as we,ao as q,ak as P,a4 as H,aB as T,U as Z,ay as Se,aG as ee}from"./index-BJZ-AiKO.js";import{Q as te}from"./QSelect-Bx3O1L6W.js";import{Q as Pe}from"./QForm-Cq6oyw-p.js";import{C as ae}from"./ClosePopup-Ow4S3WPu.js";import{u as se}from"./use-quasar-8enr_25Q.js";import{u as ue}from"./productsStore-DvPUT10T.js";import{u as Ve,b as $e,c as Ie,d as Fe,e as De}from"./orderStore-CUHgudSC.js";import{u as ce}from"./usePermissionVisibility.hook-BsjQO-cJ.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Qe}from"./categoriesStore-VJmrap8-.js";import{u as Be}from"./unitsStore-C9wPwDNl.js";import{f as Ue,r as R}from"./useUtils-CFjYfvh8.js";import"./format-CJebrXOQ.js";import"./QItem-4bzrG8tp.js";import"./QMenu-4k1-pb6E.js";import"./rtl-DFPa-2ov.js";const Te=G({name:"QCarouselSlide",props:{...Ve,imgSrc:String},setup(t,{slots:s}){const n=k(()=>t.imgSrc?{backgroundImage:`url("${t.imgSrc}")`}:{});return()=>C("div",{class:"q-carousel__slide",style:n.value},le(s.default))}}),Re=G({name:"QCarouselControl",props:{position:{type:String,default:"bottom-right",validator:t=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(t)},offset:{type:Array,default:()=>[18,18],validator:t=>t.length===2}},setup(t,{slots:s}){const n=k(()=>`q-carousel__control absolute absolute-${t.position}`),u=k(()=>({margin:`${t.offset[1]}px ${t.offset[0]}px`}));return()=>C("div",{class:n.value,style:u.value},le(s.default))}});let N=0;const Ne={fullscreen:Boolean,noRouteFullscreenExit:Boolean},Ee=["update:fullscreen","fullscreen"];function Me(){const t=ne(),{props:s,emit:n,proxy:u}=t;let i,h,y;const c=D(!1);ge(t)===!0&&E(()=>u.$route.fullPath,()=>{s.noRouteFullscreenExit!==!0&&_()}),E(()=>s.fullscreen,v=>{c.value!==v&&m()}),E(c,v=>{n("update:fullscreen",v),n("fullscreen",v)});function m(){c.value===!0?_():w()}function w(){c.value!==!0&&(c.value=!0,y=u.$el.parentNode,y.replaceChild(h,u.$el),document.body.appendChild(u.$el),N++,N===1&&document.body.classList.add("q-body--fullscreen-mixin"),i={handler:_},Y.add(i))}function _(){c.value===!0&&(i!==void 0&&(Y.remove(i),i=void 0),y.replaceChild(u.$el,h),c.value=!1,N=Math.max(0,N-1),N===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),u.$el.scrollIntoView!==void 0&&setTimeout(()=>{u.$el.scrollIntoView()})))}return pe(()=>{h=document.createElement("span")}),J(()=>{s.fullscreen===!0&&w()}),ie(_),Object.assign(u,{toggleFullscreen:m,setFullscreen:w,exitFullscreen:_}),{inFullscreen:c,toggleFullscreen:m}}const Oe=["top","right","bottom","left"],ze=["regular","flat","outline","push","unelevated"],Ae=G({name:"QCarousel",props:{...ye,...Ie,...Ne,transitionPrev:{type:String,default:"fade"},transitionNext:{type:String,default:"fade"},height:String,padding:Boolean,controlColor:String,controlTextColor:String,controlType:{type:String,validator:t=>ze.includes(t),default:"flat"},autoplay:[Number,Boolean],arrows:Boolean,prevIcon:String,nextIcon:String,navigation:Boolean,navigationPosition:{type:String,validator:t=>Oe.includes(t)},navigationIcon:String,navigationActiveIcon:String,thumbnails:Boolean},emits:[...Ee,...$e],setup(t,{slots:s}){const{proxy:{$q:n}}=ne(),u=_e(t,n);let i=null,h;const{updatePanelsList:y,getPanelContent:c,panelDirectives:m,goToPanel:w,previousPanel:_,nextPanel:v,getEnabledPanels:e,panelIndex:r}=Fe(),{inFullscreen:d}=Me(),A=k(()=>d.value!==!0&&t.height!==void 0?{height:t.height}:{}),F=k(()=>t.vertical===!0?"vertical":"horizontal"),M=k(()=>t.navigationPosition||(t.vertical===!0?"right":"bottom")),L=k(()=>`q-carousel q-panel-parent q-carousel--with${t.padding===!0?"":"out"}-padding`+(d.value===!0?" fullscreen":"")+(u.value===!0?" q-carousel--dark q-dark":"")+(t.arrows===!0?` q-carousel--arrows-${F.value}`:"")+(t.navigation===!0?` q-carousel--navigation-${M.value}`:"")),O=k(()=>{const f=[t.prevIcon||n.iconSet.carousel[t.vertical===!0?"up":"left"],t.nextIcon||n.iconSet.carousel[t.vertical===!0?"down":"right"]];return t.vertical===!1&&n.lang.rtl===!0?f.reverse():f}),z=k(()=>t.navigationIcon||n.iconSet.carousel.navigationIcon),B=k(()=>t.navigationActiveIcon||z.value),o=k(()=>({color:t.controlColor,textColor:t.controlTextColor,round:!0,[t.controlType]:!0,dense:!0}));E(()=>t.modelValue,()=>{t.autoplay&&a()}),E(()=>t.autoplay,f=>{f?a():i!==null&&(clearTimeout(i),i=null)});function a(){const f=be(t.autoplay)===!0?Math.abs(t.autoplay):5e3;i!==null&&clearTimeout(i),i=setTimeout(()=>{i=null,f>=0?v():_()},f)}J(()=>{t.autoplay&&a()}),ie(()=>{i!==null&&clearTimeout(i)});function l(f,U){return C("div",{class:`q-carousel__control q-carousel__navigation no-wrap absolute flex q-carousel__navigation--${f} q-carousel__navigation--${M.value}`+(t.controlColor!==void 0?` text-${t.controlColor}`:"")},[C("div",{class:"q-carousel__navigation-inner flex flex-center no-wrap"},e().map(U))])}function me(){const f=[];if(t.navigation===!0){const U=s["navigation-icon"]!==void 0?s["navigation-icon"]:x=>C(I,{key:"nav"+x.name,class:`q-carousel__navigation-icon q-carousel__navigation-icon--${x.active===!0?"":"in"}active`,...x.btnProps,onClick:x.onClick}),j=h-1;f.push(l("buttons",(x,K)=>{const W=x.props.name,X=r.value===K;return U({index:K,maxIndex:j,name:W,active:X,btnProps:{icon:X===!0?B.value:z.value,size:"sm",...o.value},onClick:()=>{w(W)}})}))}else if(t.thumbnails===!0){const U=t.controlColor!==void 0?` text-${t.controlColor}`:"";f.push(l("thumbnails",j=>{const x=j.props;return C("img",{key:"tmb#"+x.name,class:`q-carousel__thumbnail q-carousel__thumbnail--${x.name===t.modelValue?"":"in"}active`+U,src:x.imgSrc||x["img-src"],onClick:()=>{w(x.name)}})}))}return t.arrows===!0&&r.value>=0&&((t.infinite===!0||r.value>0)&&f.push(C("div",{key:"prev",class:`q-carousel__control q-carousel__arrow q-carousel__prev-arrow q-carousel__prev-arrow--${F.value} absolute flex flex-center`},[C(I,{icon:O.value[0],...o.value,onClick:_})])),(t.infinite===!0||r.value<h-1)&&f.push(C("div",{key:"next",class:`q-carousel__control q-carousel__arrow q-carousel__next-arrow q-carousel__next-arrow--${F.value} absolute flex flex-center`},[C(I,{icon:O.value[1],...o.value,onClick:v})]))),he(s.control,f)}return()=>(h=y(s),C("div",{class:L.value,style:A.value},[xe("div",{class:"q-carousel__slides-container"},c(),"sl-cont",t.swipeable,()=>m.value)].concat(me())))}}),Le=re({__name:"ProductImgCarusel",props:{images:{}},emits:["refresh-data"],setup(t,{emit:s}){const n=t,u=s,i=se(),h=ue(),{isManager:y}=ce(),c=D(0),m=D(!1);function w(){i.dialog({title:"Удаление картинки",message:"Вы уверенны что хотите удалить картинку?",cancel:!0,persistent:!0}).onOk(()=>{_()})}async function _(){try{const v=n.images[c.value];await h.deleteFile(v.id),u("refresh-data")}catch(v){console.error(v)}}return(v,e)=>(p(),$(Ae,{swipeable:"",animated:"",arrows:"",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=r=>c.value=r),fullscreen:m.value,"onUpdate:fullscreen":e[3]||(e[3]=r=>m.value=r),infinite:"",height:b(y)?"200px":"250px",class:"q-mb-sm"},{control:Q(()=>[g(Re,{position:"bottom-right",offset:[18,18]},{default:Q(()=>[b(y)?V("",!0):(p(),$(I,{key:0,push:"",round:"",dense:"",color:"white","text-color":"primary",icon:m.value?"fullscreen_exit":"fullscreen",onClick:e[0]||(e[0]=r=>m.value=!m.value)},null,8,["icon"])),b(y)?(p(),$(I,{key:1,round:"",dense:"","text-color":"red",icon:"delete",onClick:e[1]||(e[1]=r=>w())})):V("",!0)]),_:1})]),default:Q(()=>[(p(!0),S(qe,null,Ce(v.images,(r,d)=>(p(),$(Te,{key:d,name:d,"img-src":r.file_path,class:"card-image"},null,8,["name","img-src"]))),128))]),_:1},8,["modelValue","fullscreen","height"]))}}),oe=de(Le,[["__scopeId","data-v-0fe84505"]]),je={class:"q-pa-md product"},He={key:0},Ge={class:"text-h6 q-mb-md"},Je={class:"text-center upload-title"},Ke={class:"row justify-end"},We={key:1},Xe={class:"q-mb-sm"},Ye={key:0,class:"q-my-md"},Ze={key:1,class:"text-grey old-price"},et={key:2,class:"q-pa-md bg-light-gray radius-16"},tt={class:"row justify-end"},at={key:1,class:"row"},ot={class:"bg-green q-pa-xs radius-100"},lt={class:"q-mx-sm self-center"},nt={class:"bg-green q-pa-xs radius-100"},it=re({__name:"ProductPage",emits:["refresh-data","add-product"],setup(t,{emit:s}){const n=se(),u=s,i=ke(),h=we(),y=ue(),c=Qe(),m=De(),w=Be(),_=D(),{isManager:v}=ce(),e=D({id:null,name:"",price:null,category_id:null,unit_id:null,qty:null,description:"",images:"",origin_country:"",unit:null}),r=D([]),d=new FormData;J(()=>{B()});function A(o){const a=r.value.findIndex(l=>l.id===o);r.value.splice(a,1),m.basketData.splice(a,1)}function F(o){try{n.loading.show(),r.value.push(structuredClone(ee(o))),m.basketData.push(structuredClone(ee(o))),window.localStorage.setItem("basket",JSON.stringify(m.basketData))}catch(a){console.error(a)}finally{n.loading.hide()}}async function M(){try{let o=null;e.value?.id?o=y.updateProduct(e.value):(L(),o=await y.createProduct(d)),o&&(e.value.id=o.id,n.notify({message:"Успешно сохранено",color:"primary"}),u("refresh-data"),h.back())}catch(o){console.error(o)}}function L(){e?.value?.id&&d.append("id",e.value.id.toString()),e.value?.name&&d.append("name",e.value.name),e.value?.price&&d.append("price",e.value.price.toString()),e.value?.category_id&&d.append("category_id",e.value.category_id.toString()),e.value?.unit_id&&d.append("unit_id",e.value.unit_id.toString()),e.value?.qty&&d.append("qty",e.value.qty.toString()),e.value?.description&&d.append("description",e.value.description),e.value?.origin_country&&d.append("origin_country",e.value.origin_country)}function O(o){const a=new FileReader;a.readAsDataURL(o[0]),a.onload=()=>{},d.append("images",o[0]),e.value?.id&&z(o[0])}async function z(o){const a=new FormData;a.append("file",o),a.append("is_primary","true");try{await y.uploadFile(e.value.id,a)&&(B(),n.notify({message:"Картинка успешно добавлена",color:"primary"}))}catch(l){console.error(l)}finally{_.value&&_.value.reset()}}async function B(){if(i?.params?.id)try{n.loading.show();const o=await y.fetchProductsById(+i.params.id);o&&(e.value=o)}catch(o){console.error(o)}finally{n.loading.hide()}}return(o,a)=>(p(),S("div",je,[b(v)?(p(),S("div",He,[g(Pe,{greedy:"",onSubmit:a[9]||(a[9]=l=>M())},{default:Q(()=>[q("div",Ge,P(e.value.id?"Редактирование товара":"Добавление товара"),1),g(ve,{ref_key:"uploaderRef",ref:_,color:"primary",flat:"","max-file-size":"15728640",onAdded:O,onRejected:a[0]||(a[0]=l=>b(Ue)(b(n)))},{header:Q(()=>[...a[13]||(a[13]=[])]),list:Q(()=>[g(fe),q("div",Je,[g(H,{class:"q-mr-sm",name:"note_add",size:"24px"}),a[14]||(a[14]=q("span",null,"Загрузить картинку",-1))])]),_:1},512),q("div",null,[e.value?.images?.length?(p(),$(oe,{key:0,onRefreshData:a[1]||(a[1]=l=>B()),images:e.value.images},null,8,["images"])):V("",!0)]),g(T,{rules:[b(R)],modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.name=l),class:"q-mb-xs",outlined:"",label:"Наименование товара *"},null,8,["rules","modelValue"]),g(T,{rules:[b(R)],modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.price=l),class:"q-mb-xs",outlined:"",label:"Стоимость товара *"},null,8,["rules","modelValue"]),g(T,{rules:[b(R)],modelValue:e.value.qty,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.qty=l),class:"q-mb-xs",outlined:"",label:"Количество *"},null,8,["rules","modelValue"]),g(T,{modelValue:e.value.origin_country,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.origin_country=l),class:"q-mb-xs",outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),g(te,{rules:[b(R)],modelValue:e.value.category_id,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.category_id=l),options:b(c).categories,class:"q-mb-xs",outlined:"",label:"Категория *","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["rules","modelValue","options"]),g(te,{rules:[b(R)],modelValue:e.value.unit_id,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.unit_id=l),options:b(w).units,outlined:"",label:"Единица измерения *","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["rules","modelValue","options"]),g(T,{class:"q-mt-sm q-mb-sm",modelValue:e.value.description,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.description=l),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"]),q("div",Ke,[Z(g(I,{color:"green",label:"Подтвердить",type:"submit"},null,512),[[ae]])])]),_:1})])):(p(),S("div",We,[e.value?.images?.length?(p(),$(oe,{key:0,images:e.value.images},null,8,["images"])):V("",!0),q("div",Xe,[e.value?.name?(p(),S("h6",Ye,P(e.value.name),1)):V("",!0),e.value?.old_price?(p(),S("div",Ze,P(e.value.old_price)+" ₽",1)):V("",!0),q("div",{class:Se(["text-bold text-18 q-mb-md",e.value?.old_price?"text-red":""])},P(e.value.price)+" ₽/ "+P(e.value.unit_name),3),e.value.description?(p(),S("div",et,P(e.value.description),1)):V("",!0)]),q("div",tt,[r.value?.length?(p(),S("div",at,[q("div",ot,[g(H,{name:"remove",color:"white",size:"30px",onClick:a[11]||(a[11]=l=>A(e.value.id))})]),q("span",lt,P(r.value?.length),1),q("div",nt,[g(H,{name:"add",color:"white",size:"30px",onClick:a[12]||(a[12]=l=>F(e.value))})])])):Z((p(),$(I,{key:0,color:"green",label:"Добавить в корзину",onClick:a[10]||(a[10]=l=>F(e.value))},null,512)),[[ae]])])]))]))}}),kt=de(it,[["__scopeId","data-v-64d34469"]]);export{kt as default};
