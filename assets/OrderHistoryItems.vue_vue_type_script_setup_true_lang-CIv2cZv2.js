import{Q as v,a as d,b as s}from"./QItem-BpD8FTRy.js";import{Q as I}from"./QList-f7Xr1m01.js";import{Q as O}from"./QBtnDropdown-Bm3O7Xh5.js";import{V as P,W as V,a1 as p,Y as o,$ as a,Z as n,a2 as D,a3 as N,X as _,ab as C,a5 as r,a6 as m,a4 as b,a7 as w,z as G}from"./index-DwgbGLhP.js";import{C as R}from"./ClosePopup-DiyzeA84.js";import{u as $,d as x}from"./use-quasar-DjNStwcC.js";import{u as q}from"./orderStore-IWQzqdxA.js";var i=(c=>(c.CREATED="created",c.ASSEMBLING="assembling",c.DELIVERING="delivering",c.COMPLETED="completed",c.CANCELLED="cancelled",c))(i||{});const U=["href"],z={key:1},K=P({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},setup(c){const f=$(),S=q(),k=[{label:"создан",value:i.CREATED},{label:"собирается",value:i.ASSEMBLING},{label:"в пути",value:i.DELIVERING},{label:"завершён",value:i.COMPLETED},{label:"отменён",value:i.CANCELLED}];function Q(e,t){f.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{y(e,t)})}async function y(e,t){try{f.loading.show(),await S.updateOrderStatus(e,t)&&f.notify({color:"primary",message:"Статус успешно изменен"})}catch(u){console.error(u)}finally{f.loading.hide()}}function A(e){return k.find(u=>u.value===e)?.label}function B(e){f.dialog({cancel:!0,message:"Вы уверенны что хотите отменить заказ?",persistent:!0,title:"Отмена заказа"}).onOk(()=>{y(e,i.CANCELLED)})}function E(e){return`tg://user?id=${e}`}function h(e){const t=e?.user?.telegram_id??e?.user?.telegramId??e?.user?.tg_id??e?.user?.tgId??e?.user?.chat_id??e?.user?.chatId??e?.user?.id;return t==null?null:typeof t=="number"?E(t):typeof t=="string"&&t.trim().length?E(t.trim()):null}function L(e){const t=e?.user?.phone??e?.user?.phone_number??e?.user?.phoneNumber??e?.user?.contact_phone??e?.user?.contactPhone??e?.user?.contacts?.phone??e?.user?.contacts?.phone_number??e?.user?.contacts?.phoneNumber??e?.user_phone??e?.userPhone??e?.phone;if(typeof t=="number")return String(t);if(typeof t!="string")return null;const u=t.trim();return u.length?u:null}return(e,t)=>{const u=V("q-item-action");return o(),p("div",null,[a(I,null,{default:n(()=>[(o(!0),p(D,null,N(e.orderData,(l,M)=>(o(),_(v,{key:M,class:"border-bot"},{default:n(()=>[a(d,null,{default:n(()=>[a(s,{caption:"",lines:"2"},{default:n(()=>[...t[0]||(t[0]=[r("Дата",-1)])]),_:1}),a(s,null,{default:n(()=>[r(m(b(x)(l.order_date)),1)]),_:2},1024)]),_:2},1024),a(d,null,{default:n(()=>[a(s,{caption:"",lines:"2"},{default:n(()=>[...t[1]||(t[1]=[r("Имя",-1)])]),_:1}),a(s,null,{default:n(()=>[h(l)?(o(),p("a",{key:0,href:h(l)||"",target:"_blank",rel:"noopener noreferrer",class:"text-primary text-decoration-none"},m(l.user.full_name),9,U)):(o(),p("span",z,m(l?.user?.full_name),1))]),_:2},1024),L(l)?(o(),_(s,{key:0,caption:""},{default:n(()=>[r(m(L(l)),1)]),_:2},1024)):C("",!0)]),_:2},1024),a(d,null,{default:n(()=>[a(s,{caption:"",lines:"2"},{default:n(()=>[...t[2]||(t[2]=[r("Статус",-1)])]),_:1}),a(s,null,{default:n(()=>[r(m(A(l.status)),1)]),_:2},1024)]),_:2},1024),a(d,null,{default:n(()=>[a(s,{caption:"",lines:"2"},{default:n(()=>[...t[3]||(t[3]=[r("Общая сумма",-1)])]),_:1}),a(s,null,{default:n(()=>[r(m(l.total_amount),1)]),_:2},1024)]),_:2},1024),e.adminMode?(o(),_(u,{key:0},{default:n(()=>[a(O,{color:"green",dense:""},{default:n(()=>[(o(),p(D,null,N(k,(g,T)=>a(I,{key:T},{default:n(()=>[w((o(),_(v,{clickable:"",onClick:F=>Q(l.id,g.value)},{default:n(()=>[a(d,null,{default:n(()=>[a(s,null,{default:n(()=>[r(m(g.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[R]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):C("",!0),!e.adminMode&&(l.status===b(i).CREATED||l.status===b(i).ASSEMBLING)?(o(),_(u,{key:1},{default:n(()=>[a(G,{round:"",color:"deep-orange",icon:"close",onClick:g=>B(l.id)},null,8,["onClick"])]),_:2},1024)):C("",!0)]),_:2},1024))),128))]),_:1})])}}});export{K as _};
