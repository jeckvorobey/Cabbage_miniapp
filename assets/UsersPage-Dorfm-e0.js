import{k as E,bb as N,bc as j,g as z,r as b,a5 as G,c as _,a$ as T,w as x,o as W,h as m,a9 as F,l as X,aA as A,I as Y,aX as J,aY as V,d as K,ac as Z,af as U,ae as h,aj as s,ak as ee,f as r,aG as ae,ad as L,F as P,am as H,ai as O,av as y,al as B,U as te,a7 as ne}from"./index-B2oe_LZP.js";import{Q as M,b as S,a as C}from"./QItem-BnVDEbcZ.js";import{Q as $}from"./QList-DeoaCRdE.js";import{Q as oe}from"./QBtnGroup-CA1sQ3mq.js";import{Q as le}from"./QMenu-CkIlgdwo.js";import{Q as se}from"./QInfiniteScroll-DuWojtfE.js";import{C as re}from"./ClosePopup-BRuIqseI.js";import{u as ie}from"./use-quasar-B3xRNweg.js";import{a as ue}from"./useUtils-DbrnkpiV.js";import"./selection-C1Z_woUr.js";const ce=Object.keys(j);function de(e){return ce.reduce((n,t)=>{const o=e[t];return o!==void 0&&(n[t]=o),n},{})}const fe=E({name:"QBtnDropdown",props:{...j,...N,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noEscDismiss:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,noRefocus:Boolean,noFocus:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:n,emit:t}){const{proxy:o}=z(),i=b(e.modelValue),c=b(null),g=G(),w=_(()=>{const a={"aria-expanded":i.value===!0?"true":"false","aria-haspopup":"true","aria-controls":g.value,"aria-label":e.toggleAriaLabel||o.$q.lang.label[i.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(a["aria-disabled"]="true"),a}),Q=_(()=>"q-btn-dropdown__arrow"+(i.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),l=_(()=>T(e)),u=_(()=>de(e));x(()=>e.modelValue,a=>{c.value?.[a?"show":"hide"]()}),x(()=>e.split,k);function d(a){i.value=!0,t("beforeShow",a)}function f(a){t("show",a),t("update:modelValue",!0)}function q(a){i.value=!1,t("beforeHide",a)}function v(a){t("hide",a),t("update:modelValue",!1)}function D(a){t("click",a)}function I(a){Y(a),k(),t("click",a)}function p(a){c.value?.toggle(a)}function R(a){c.value?.show(a)}function k(a){c.value?.hide(a)}return Object.assign(o,{show:R,hide:k,toggle:p}),W(()=>{e.modelValue===!0&&R()}),()=>{const a=[m(F,{class:Q.value,name:e.dropdownIcon||o.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&a.push(m(le,{ref:c,id:g.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noEscDismiss:e.noEscDismiss,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,noFocus:e.noFocus,noRefocus:e.noRefocus,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:d,onShow:f,onBeforeHide:q,onHide:v},n.default)),e.split===!1?m(A,{class:"q-btn-dropdown q-btn-dropdown--simple",...u.value,...w.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:D},{default:()=>X(n.label,[]).concat(a),loading:n.loading}):m(oe,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...l.value,glossy:e.glossy,stretch:e.stretch},()=>[m(A,{class:"q-btn-dropdown--current",...u.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:I},{default:n.label,loading:n.loading}),m(A,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...w.value,...l.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>a)])}}}),me=J("Users",()=>{const e=b();async function n(o){return V.get("users",{params:o}).then(i=>i.data).catch(i=>{throw console.error("[UsersStore] - An error occurred while fetching via Users",i.message),i})}async function t(o,i){return V.patch(`/users/${o}/toggle-role`,{role:i}).then(c=>c.data).catch(c=>{throw console.error("[UsersStore] - An error occurred while creating via updateUserRole",c.message),c})}return{users:e,fetchUsers:n,updateUserRole:t}}),Qe=K({__name:"UsersPage",setup(e){const n=ie(),t=me(),o=b({offset:0,limit:20,total:0,has_more:!0}),i=b([{name:"Администратор",value:1},{name:"Менеджер",value:2},{name:"Пользователь",value:9}]),c=async(l,u)=>{if(!o.value.has_more){u(!0);return}await g(),o.value.offset+=o.value.limit,u()};async function g(){try{n.loading.show();const l=await t.fetchUsers(o.value);l&&(o.value.total=l.total,o.value.has_more=l.has_more,t.users=l.items)}catch(l){console.error(l)}finally{n.loading.hide()}}function w(l,u){n.dialog({title:"Изменение прав пользователя",message:"Вы уверенны что хотите изменить права этого пользователя?",cancel:!0,persistent:!0}).onOk(()=>{Q(l,u)})}async function Q(l,u){try{n.loading.show(),await t.updateUserRole(l.id,u)&&(l.role=u,n.notify({message:"Роль изменена",color:"primary"}))}catch(d){console.error(d)}finally{n.loading.hide()}}return(l,u)=>{const d=Z("q-item-action");return h(),U(se,{onLoad:c,offset:250},{default:s(()=>[u[0]||(u[0]=ee("h6",{class:"text-center q-mt-md q-mb-md"},"Пользователи",-1)),r(ae,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:s(()=>[(h(!0),L(P,null,H(O(t).users,(f,q)=>(h(),U($,{key:q},{default:s(()=>[r(M,null,{default:s(()=>[r(S,{avatar:""},{default:s(()=>[r(F,{color:"primary",name:"local_bar"})]),_:1}),r(S,null,{default:s(()=>[r(C,null,{default:s(()=>[y(B(f.name),1)]),_:2},1024),r(C,{caption:""},{default:s(()=>[y(B(f.telegram_id),1)]),_:2},1024)]),_:2},1024),r(S,null,{default:s(()=>[r(C,{caption:""},{default:s(()=>[y(B(O(ue)(f.role)),1)]),_:2},1024)]),_:2},1024),r(d,null,{default:s(()=>[r(fe,{dense:"",flat:"",color:"primary","dropdown-icon":"change_history"},{default:s(()=>[r($,null,{default:s(()=>[(h(!0),L(P,null,H(i.value,(v,D)=>te((h(),U(M,{key:D,clickable:"",onClick:I=>w(f,v.value)},{default:s(()=>[r(S,null,{default:s(()=>[r(C,null,{default:s(()=>[y(B(v.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[re]])),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),r(ne)]),_:2},1024))),128))]),_:1})]),_:1})}}});export{Qe as default};
