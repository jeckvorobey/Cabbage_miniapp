import{k as $,b4 as N,b5 as M,g as z,r as C,a5 as T,c as v,aQ as W,w as V,o as p,h as m,a9 as j,l as G,av as A,I as J,d as K,ac as X,af as I,ae as b,aj as o,ak as Y,f as s,aF as Z,ad as L,F as P,am as H,ai as O,aw as _,al as B,U as ee,a7 as ae}from"./index-BwC_XB_e.js";import{Q as U,b as y,a as S}from"./QItem-eZzufJZt.js";import{Q as F}from"./QList-ClqHarfZ.js";import{Q as te}from"./QBtnGroup-Bz9kGjzv.js";import{Q as ne}from"./QMenu-N82fB4oN.js";import{Q as oe}from"./QInfiniteScroll-B-BQk_8B.js";import{C as le}from"./ClosePopup-Ch3uWRBb.js";import{u as se}from"./use-quasar-4Hx1Vfa4.js";import{a as re}from"./useUtils-DQIq_dTD.js";import{u as ie}from"./usersStore-DqqoENs2.js";const ue=Object.keys(M);function de(e){return ue.reduce((l,t)=>{const r=e[t];return r!==void 0&&(l[t]=r),l},{})}const ce=$({name:"QBtnDropdown",props:{...M,...N,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noEscDismiss:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,noRefocus:Boolean,noFocus:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:l,emit:t}){const{proxy:r}=z(),u=C(e.modelValue),d=C(null),w=T(),g=v(()=>{const a={"aria-expanded":u.value===!0?"true":"false","aria-haspopup":"true","aria-controls":w.value,"aria-label":e.toggleAriaLabel||r.$q.lang.label[u.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(a["aria-disabled"]="true"),a}),Q=v(()=>"q-btn-dropdown__arrow"+(u.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),n=v(()=>W(e)),i=v(()=>de(e));V(()=>e.modelValue,a=>{d.value?.[a?"show":"hide"]()}),V(()=>e.split,k);function c(a){u.value=!0,t("beforeShow",a)}function f(a){t("show",a),t("update:modelValue",!0)}function q(a){u.value=!1,t("beforeHide",a)}function h(a){t("hide",a),t("update:modelValue",!1)}function D(a){t("click",a)}function x(a){J(a),k(),t("click",a)}function E(a){d.value?.toggle(a)}function R(a){d.value?.show(a)}function k(a){d.value?.hide(a)}return Object.assign(r,{show:R,hide:k,toggle:E}),p(()=>{e.modelValue===!0&&R()}),()=>{const a=[m(j,{class:Q.value,name:e.dropdownIcon||r.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&a.push(m(ne,{ref:d,id:w.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noEscDismiss:e.noEscDismiss,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,noFocus:e.noFocus,noRefocus:e.noRefocus,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:c,onShow:f,onBeforeHide:q,onHide:h},l.default)),e.split===!1?m(A,{class:"q-btn-dropdown q-btn-dropdown--simple",...i.value,...g.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:D},{default:()=>G(l.label,[]).concat(a),loading:l.loading}):m(te,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...n.value,glossy:e.glossy,stretch:e.stretch},()=>[m(A,{class:"q-btn-dropdown--current",...i.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:x},{default:l.label,loading:l.loading}),m(A,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...g.value,...n.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>a)])}}}),Se=K({__name:"UsersPage",setup(e){const l=se(),t=ie(),r=C({offset:0,limit:20,total:0,has_more:!0}),u=C([{name:"Администратор",value:1},{name:"Менеджер",value:2},{name:"Пользователь",value:9}]),d=async(n,i)=>{if(!r.value.has_more){i(!0);return}await w(),r.value.offset+=r.value.limit,i()};async function w(){try{l.loading.show();const n=await t.fetchUsers(r.value);n&&(r.value.total=n.total,r.value.has_more=n.has_more,t.users=n.items)}catch(n){console.error(n)}finally{l.loading.hide()}}function g(n,i){l.dialog({title:"Изменение прав пользователя",message:"Вы уверенны что хотите изменить права этого пользователя?",cancel:!0,persistent:!0}).onOk(()=>{Q(n,i)})}async function Q(n,i){try{l.loading.show(),await t.updateUserRole(n.id,i)&&(n.role=i,l.notify({message:"Роль изменена",color:"primary"}))}catch(c){console.error(c)}finally{l.loading.hide()}}return(n,i)=>{const c=X("q-item-action");return b(),I(oe,{onLoad:d,offset:250},{default:o(()=>[i[0]||(i[0]=Y("h6",{class:"text-center q-mt-md q-mb-md"},"Пользователи",-1)),s(Z,{class:"my-card q-ma-sm",flat:"",bordered:""},{default:o(()=>[(b(!0),L(P,null,H(O(t).users,(f,q)=>(b(),I(F,{key:q},{default:o(()=>[s(U,null,{default:o(()=>[s(y,{avatar:""},{default:o(()=>[s(j,{color:"primary",name:"local_bar"})]),_:1}),s(y,null,{default:o(()=>[s(S,null,{default:o(()=>[_(B(f.name),1)]),_:2},1024),s(S,{caption:""},{default:o(()=>[_(B(f.telegram_id),1)]),_:2},1024)]),_:2},1024),s(y,null,{default:o(()=>[s(S,{caption:""},{default:o(()=>[_(B(O(re)(f.role)),1)]),_:2},1024)]),_:2},1024),s(c,null,{default:o(()=>[s(ce,{dense:"",flat:"",color:"primary","dropdown-icon":"change_history"},{default:o(()=>[s(F,null,{default:o(()=>[(b(!0),L(P,null,H(u.value,(h,D)=>ee((b(),I(U,{key:D,clickable:"",onClick:x=>g(f,h.value)},{default:o(()=>[s(y,null,{default:o(()=>[s(S,null,{default:o(()=>[_(B(h.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[le]])),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),s(ae)]),_:2},1024))),128))]),_:1})]),_:1})}}});export{Se as default};
