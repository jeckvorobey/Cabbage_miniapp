import{Q as W}from"./QImg-VeAQv5NL.js";import{d as z,r as p,o as j,aj as I,ae as y,aF as J,af as o,f as s,aI as L,as as E,aG as O,aq as i,am as S,av as R,aP as K,aH as X,W as Y,ah as P,u as ee,c as B,aE as M,aw as se,ar as te,ad as q,ak as C,a6 as g,aD as ae,al as le}from"./index-Bmsp0X1_.js";import{Q as oe}from"./QBtnToggle-BQ5fN9Oq.js";import{Q as ne,a as de,b as re}from"./QItem-B2Wb2A3e.js";import{Q as T}from"./QSelect-BjaZNCiM.js";import{u as F}from"./use-quasar-Cyd-yKEk.js";import{u as Z}from"./addressesStore-Bp_SVIDs.js";import{Q as ie}from"./QForm-CcNZtsbb.js";import{C as ue}from"./ClosePopup-D_cdtQAh.js";import{g as me}from"./useUtils-CrkES8ah.js";import{u as ce}from"./usersStore-B5wyC6p5.js";import"./QBtnGroup-CELE7uPB.js";import"./QMenu-CPyLGiuP.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const pe={class:"row q-pl-sm flex-center justify-between"},ve={class:"text-grey-6"},fe=z({__name:"AddAddressModal",props:{newAddress:{}},setup(D){const c=[[55.97,37.12],[56.02,37.33]],d=p([]),k=p(!1),w=p("Начните вводить адрес..."),b=D,h=F(),v=Z(),V=p(!0),f=p(),n=p();j(async()=>{try{const m={area_id:1,address_line:"",comment:"",is_default:!1};b.newAddress?n.value=b.newAddress:n.value=m,h.loading.show();const t=await v.fetchDeliveryZones();t&&(v.deliveryZones=t)}catch(m){console.error(m)}finally{h.loading.hide()}});async function u(){try{await(n?.value?.id?v.updateAddress:v.createAddress)(n.value)}catch(m){console.error(m)}finally{f.value.hide()}}async function _(m,t){if(!m){w.value="Начните вводить адрес...",t(()=>{d.value=[]});return}const r=window.ymaps;if(!r){h.notify({type:"negative",message:"Сервис карт недоступен."});return}k.value=!0;try{const x=(await r.geocode(m,{results:5,boundedBy:c,strictBounds:!0})).geoObjects.toArray().map(Q=>({displayName:Q.properties.get("text"),coords:Q.geometry.getCoordinates()}));t(()=>{if(!x?.length){d.value=[],w.value="Адрес не найден";return}d.value=x})}catch(A){console.error("Ошибка геокодирования:",A)}finally{k.value=!1}}return(m,t)=>(y(),I(J,{ref_key:"dialogRef",ref:f,modelValue:V.value,"onUpdate:modelValue":t[4]||(t[4]=r=>V.value=r),persistent:""},{default:o(()=>[s(L,{class:""},{default:o(()=>[s(ie,{greedy:"",onSubmit:t[3]||(t[3]=r=>u())},{default:o(()=>[n.value?(y(),I(O,{key:0},{default:o(()=>[t[5]||(t[5]=i("div",{class:"text-h6"},"Создание нового адреса доставки",-1)),s(T,{class:"q-mb-sm",clearable:"",outlined:"","use-input":"","emit-value":"","map-options":"",modelValue:n.value.address_line,"onUpdate:modelValue":t[0]||(t[0]=r=>n.value.address_line=r),options:d.value,"option-label":"displayName","option-value":"displayName",label:"Адрес доставки",onFilter:_},{"no-option":o(()=>[i("div",pe,[i("div",ve,S(w.value),1)])]),_:1},8,["modelValue","options"]),s(R,{label:"Комментарий",modelValue:n.value.comment,"onUpdate:modelValue":t[1]||(t[1]=r=>n.value.comment=r),outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"]),s(K,{modelValue:n.value.is_default,"onUpdate:modelValue":t[2]||(t[2]=r=>n.value.is_default=r),label:"Активный аддрес"},null,8,["modelValue"])]),_:1})):E("",!0),s(X,{align:"right"},{default:o(()=>[Y(s(P,{color:"red",flat:"",label:"Отмена"},null,512),[[ue]]),s(P,{color:"primary",flat:"",label:"Сохранить",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ge={class:"q-pa-sm"},he={class:"justify-center row q-mb-md"},ye={class:"text-h5 justify-between q-mb-sm row"},we={class:"items-center"},_e={class:"items-center"},ke={key:0,class:"row items-center q-mb-sm text-h6"},be={style:{height:"40px"},class:"col-10 content-center"},Ve={key:1,class:"row items-center q-mb-sm"},Ae={class:"row items-center q-mb-sm"},Le=z({__name:"UserPage",setup(D){const c=F(),d=Z(),k=ce(),w=ee(),b=B(()=>M.isActive),h=se({dark:"dark",light:"light"}),v=p(!1),V=B(()=>b.value?h.dark:h.light),f=p(!1),n=p("dark"),u=p({full_name:"",mail:"",phone:"",addres:null}),_=p();j(()=>{u.value=w.user});function m(a){a.is_default=!0,u.value.addres=a,x(a)}function t(){_.value=null,f.value=!f.value}async function r(a){try{c.loading.show(),await d.deleteAddress(a.id)&&U()}catch(e){console.error(e)}finally{c.loading.hide()}}function A(a){_.value=a,f.value=!f.value}async function x(a){try{c.loading.show(),await d.updateAddress(a)&&U()}catch(e){console.error(e)}finally{c.loading.hide()}}const Q=()=>{M.toggle(),window.localStorage.setItem("theme",V.value)};function G(){c.dialog({title:"Смена номера телефона",message:"Вы уверенны что хотите изменить номер?",cancel:!0,persistent:!0}).onOk(()=>{H()})}async function H(){try{c.loading.show(),await k.updateMyPhone(u.value.phone)}catch(a){console.error(a)}finally{c.loading.hide()}}async function U(){try{c.loading.show();const a=await d.fetchAddresses();if(a){d.addresses=a;const e=a.find($=>$.is_default===!0);d.addressId=e.id}}catch(a){console.error(a)}finally{c.loading.hide()}}return(a,e)=>{const $=te("q-item-action");return y(),q("div",null,[e[9]||(e[9]=i("h6",{class:"text-center q-mb-md"},"Личный кабинет",-1)),i("div",ge,[s(L,{class:"my-card full-height",flat:"",bordered:""},{default:o(()=>[s(O,null,{default:o(()=>[i("div",he,[s(W,{class:"radius-100",height:"120px",width:"120px",src:u.value?.main_image_url?u.value.main_image_url:C(me)("/card-shop.jpg")},null,8,["src"])]),i("div",ye,[i("div",null,S(u.value.full_name),1),i("div",null,[s(oe,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),size:"sm","no-caps":"",unelevated:"",dense:"","toggle-color":"grey-9",color:"white","text-color":"grey-9",options:[{value:"dark",slot:"dark",title:"Dark mode"},{value:"light",slot:"light",title:"Light mode"}],onClick:e[1]||(e[1]=l=>Q())},{dark:o(()=>[i("div",we,[s(g,{name:"nightlight"})])]),light:o(()=>[i("div",_e,[s(g,{name:"light_mode"})])]),_:1},8,["modelValue"])])]),!v.value&&u.value?.phone?(y(),q("div",ke,[i("div",be,S(u.value.phone),1),s(g,{onClick:e[2]||(e[2]=l=>v.value=!v.value),name:"edit",size:"30px",color:"green",class:"col-2"})])):(y(),q("div",Ve,[s(g,{onClick:e[3]||(e[3]=l=>v.value=!v.value),name:"close",size:"30px",color:"red",class:"col-1"}),s(R,{class:"col-9",dense:"",outlined:"",modelValue:u.value.phone,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.phone=l),label:"Телефон",mask:"+# (###) ###-##-##",type:"tel"},null,8,["modelValue"]),s(g,{onClick:e[5]||(e[5]=l=>G()),name:"save",size:"30px",color:"green",class:"col-2"})])),i("div",Ae,[s(T,{modelValue:C(d).addressId,"onUpdate:modelValue":e[6]||(e[6]=l=>C(d).addressId=l),options:C(d).addresses,class:"col-10",dense:"",outlined:"",label:"Адрес","emit-value":"","map-options":"","option-label":"address_line","option-value":"id"},{option:o(l=>[s(ne,ae(l.itemProps,{class:"justify-between flex"}),{default:o(()=>[s(de,{onClick:N=>m(l.opt)},{default:o(()=>[s(re,null,{default:o(()=>[le(S(l.opt.address_line),1)]),_:2},1024)]),_:2},1032,["onClick"]),s($,null,{default:o(()=>[s(g,{class:"q-mr-sm",color:"red",name:"delete",size:"26px",onClick:N=>r(l.opt)},null,8,["onClick"]),s(g,{color:"green",name:"edit",size:"26px",onClick:N=>A(l.opt)},null,8,["onClick"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),s(g,{onClick:e[7]||(e[7]=l=>t()),name:"add",size:"34px",color:"green",class:"col-2"})])]),_:1})]),_:1})]),f.value?(y(),I(fe,{key:0,modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l),newAddress:_.value},null,8,["modelValue","newAddress"])):E("",!0)])}}});export{Le as default};
