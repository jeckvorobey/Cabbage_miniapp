import{b as n,Q,a as p}from"./QItem-vLP-u-yh.js";import{Q as x}from"./QList-DGPho8M5.js";import{Q as X}from"./QBtnDropdown-Tff00wbJ.js";import{b as Y,h as Z,V as B,r as H,X as _,Y as o,ad as j,Z as e,$ as t,a0 as J,aa as $,_ as D,a9 as b,a7 as O,a5 as u,a6 as i,a4 as E,Q as A,a8 as w,a1 as y,a2 as I,a3 as N,W as K,al as ee}from"./index-DiXfJIYT.js";import{C as R}from"./ClosePopup-BeLyKk46.js";import{d as T,u as te}from"./use-quasar-BJTL4EOP.js";import{u as ae}from"./orderStore-Dkvcsa-K.js";import{Q as se}from"./QBadge-Cpzu69Fh.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";var f=(c=>(c.CREATED="created",c.ASSEMBLING="assembling",c.DELIVERING="delivering",c.COMPLETED="completed",c.CANCELLED="cancelled",c))(f||{});const le=Y({name:"QSpace",setup(){const c=Z("div",{class:"q-space"});return()=>c}}),oe={class:"text-h6 q-mt-xs"},ne={class:"q-mb-sm"},re={class:"row"},ue={key:0,class:"text-italic text-grey"},ie={key:1,class:"text-italic text-grey"},de={class:"col-12 col-md-4 text-right"},ce={class:"text-h5 text-weight-bold text-green"},me=B({__name:"OrderHistoryModal",props:{orderHistoryData:{},orderStatus:{}},setup(c){const L=c,h=H(!1);function v(d){const a=L.orderStatus.find(C=>C.value===d);return{color:a?.value===f.CANCELLED?"negative":"positive",label:a?.label||"-"}}return(d,a)=>(o(),_(j,{ref:"dialogRef",modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=m=>h.value=m),persistent:""},{default:e(()=>[t(J,{class:"order-history-modal"},{default:e(()=>[t($,{class:"row items-center q-pb-xs q-pr-xs q-pt-xs"},{default:e(()=>[D("div",oe,[t(n,null,{default:e(()=>[...a[1]||(a[1]=[u("Детали Заказа",-1)])]),_:1}),t(n,{caption:""},{default:e(()=>[u(i(E(T)(d.orderHistoryData.order_date)),1)]),_:1})]),t(le),d.orderHistoryData?.status?(o(),_(n,{key:0,class:"q-mr-sm"},{default:e(()=>[t(se,{class:"q-pa-xs",color:v(d.orderHistoryData.status).color},{default:e(()=>[u(i(v(d.orderHistoryData.status).label),1)]),_:1},8,["color"])]),_:1})):b("",!0),O(t(A,{icon:"close",flat:"",round:"",dense:""},null,512),[[R]])]),_:1}),t(w),t($,{class:"q-pt-none"},{default:e(()=>[D("div",ne,[t(x,null,{default:e(()=>[t(Q,{dense:"",class:"q-pa-none"},{default:e(()=>[t(p,null,{default:e(()=>[t(n,{caption:"",lines:"1"},{default:e(()=>[...a[2]||(a[2]=[u("Товар",-1)])]),_:1})]),_:1}),t(p,null,{default:e(()=>[t(n,{caption:"",lines:"1"},{default:e(()=>[...a[3]||(a[3]=[u("Кол.",-1)])]),_:1})]),_:1}),t(p,null,{default:e(()=>[t(n,{caption:"",lines:"1"},{default:e(()=>[...a[4]||(a[4]=[u("Цена",-1)])]),_:1})]),_:1})]),_:1}),(o(!0),y(I,null,N(d.orderHistoryData.items,(m,C)=>(o(),_(Q,{key:C,dense:"",class:"q-pa-none"},{default:e(()=>[t(p,null,{default:e(()=>[t(n,null,{default:e(()=>[u(i(m?.name||"-"),1)]),_:2},1024)]),_:2},1024),t(p,null,{default:e(()=>[t(n,null,{default:e(()=>[u(i(m?.quantity),1)]),_:2},1024)]),_:2},1024),t(p,null,{default:e(()=>[t(n,null,{default:e(()=>[u(i(m?.price)+" ₽",1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(w)]),D("div",re,[D("div",null,[d.orderHistoryData.comment?(o(),y("div",ue,"Комментарий: "+i(d.orderHistoryData.comment),1)):(o(),y("div",ie,"Комментарий отсутствует."))]),D("div",de,[a[5]||(a[5]=D("div",{class:"text-subtitle1 text-weight-medium"},"Итого:",-1)),D("div",ce,i(d.orderHistoryData.total_amount)+" ₽",1)])])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),fe=G(me,[["__scopeId","data-v-7926bdba"]]),pe={class:"order-history"},_e=["href"],ve={key:1},ye=B({__name:"OrderHistoryItems",props:{orderData:{},adminMode:{type:Boolean}},emits:["refresh"],setup(c,{emit:L}){const h=L,v=te(),d=ae(),a=H(!1),m=H(),C=[{label:"создан",value:f.CREATED},{label:"собирается",value:f.ASSEMBLING},{label:"в пути",value:f.DELIVERING},{label:"завершён",value:f.COMPLETED},{label:"отменён",value:f.CANCELLED}];function U(l,r){v.dialog({cancel:!0,message:"Вы уверенны что хотите изменить статус?",persistent:!0,title:"Смена статуса"}).onOk(()=>{q(l,r)})}async function q(l,r){try{v.loading.show(),await d.updateOrderStatus(l,r)&&(v.notify({color:"primary",message:"Статус успешно изменен"}),h("refresh"))}catch(g){console.error(g)}finally{v.loading.hide()}}function P(l){return C.find(g=>g.value===l)?.label}function z(l){v.dialog({cancel:!0,message:"Вы уверенны что хотите отменить заказ?",persistent:!0,title:"Отмена заказа"}).onOk(()=>{q(l,f.CANCELLED)})}function V(l){const r=l.username?.trim().replace(/^@/,"");return r?`https://t.me/${encodeURIComponent(r)}`:null}function M(l){if(!l.phone)return null;const r=l.phone.trim();return r.length?r:null}function S(l){m.value=l,a.value=!a.value}return(l,r)=>{const g=K("q-item-action");return o(),y("div",pe,[t(x,null,{default:e(()=>[(o(!0),y(I,null,N(l.orderData,(s,F)=>(o(),_(Q,{key:s.id??F,class:ee(["border-bot",s.is_paid?"light-green":"light-red"])},{default:e(()=>[t(p,{onClick:k=>S(s)},{default:e(()=>[M(s.user)?(o(),_(n,{key:0,caption:"",class:"text-10"},{default:e(()=>[u(i(M(s.user)),1)]),_:2},1024)):b("",!0),t(n,null,{default:e(()=>[V(s.user)?(o(),y("a",{key:0,href:V(s.user),target:"_blank",rel:"noopener noreferrer",class:"text-primary text-decoration-none"},i(s.user.full_name),9,_e)):(o(),y("span",ve,i(s.user.full_name),1))]),_:2},1024)]),_:2},1032,["onClick"]),t(p,{onClick:k=>S(s)},{default:e(()=>[t(n,{caption:"",class:"text-10"},{default:e(()=>[u(i(E(T)(s.order_date)),1)]),_:2},1024),t(n,null,{default:e(()=>[u(i(P(s.status)),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(p,{onClick:k=>S(s)},{default:e(()=>[t(n,{caption:"",class:"text-10"},{default:e(()=>[...r[1]||(r[1]=[u("Общая сумма",-1)])]),_:1}),t(n,null,{default:e(()=>[u(i(s.total_amount),1)]),_:2},1024)]),_:2},1032,["onClick"]),l.adminMode?(o(),_(g,{key:0},{default:e(()=>[t(X,{size:"10px",color:"green",dense:""},{default:e(()=>[(o(),y(I,null,N(C,(k,W)=>t(x,{key:W},{default:e(()=>[O((o(),_(Q,{clickable:"",onClick:Ce=>U(s.id,k.value)},{default:e(()=>[t(p,null,{default:e(()=>[t(n,null,{default:e(()=>[u(i(k.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[R]])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)):b("",!0),!l.adminMode&&(s.status===E(f).CREATED||s.status===E(f).ASSEMBLING)?(o(),_(g,{key:1},{default:e(()=>[t(A,{size:"10px",round:"",color:"deep-orange",icon:"close",onClick:k=>z(s.id)},null,8,["onClick"])]),_:2},1024)):b("",!0)]),_:2},1032,["class"]))),128))]),_:1}),a.value&&m.value?(o(),_(fe,{key:0,modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=s=>a.value=s),orderHistoryData:m.value,orderStatus:C},null,8,["modelValue","orderHistoryData"])):b("",!0)])}}}),xe=G(ye,[["__scopeId","data-v-8b0b5263"]]);export{xe as O};
