import{V as $,r as b,B as M,f as Y,X as w,Y as n,Z as P,_ as d,$ as s,a6 as c,C as D,a9 as v,ab as h,a4 as x,Q as A,aY as E,am as L,m as X,a1 as u,al as B}from"./index-Bh3MUb79.js";import{u as z,r as I}from"./use-quasar-DqeEYihB.js";import{u as N}from"./productsStore-B5DeQThV.js";import{P as T}from"./ProductImgCarusel--Jr6B3ZM.js";import{Q as Z,a as G}from"./QUploader-DwVFd4Lu.js";import{Q as H}from"./QSelect-D3hPnlbz.js";import{Q as J}from"./QForm-DZ7SWK1g.js";import{u as K}from"./categoriesStore-fJRooG0o.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as O}from"./usePermissionVisibility.hook-tHowqrH2.js";import{u as W}from"./useCart-DAXHlGNO.js";import"./QItem-C5FQhyQ4.js";import"./QList-CCnnHzTo.js";import"./QBtnDropdown-ChPka0vW.js";import"./QMenu-FL-nEY3M.js";import"./ClosePopup-Qg_qfPdU.js";import"./format-CJebrXOQ.js";import"./rtl-DFPa-2ov.js";import"./orderStore-CyTCfy3f.js";const ee={class:"text-h6 q-mb-md"},ae={class:"text-center upload-title"},te={class:"row justify-end"},oe=$({__name:"ProductForm",props:{product:{}},emits:["submit","refresh-data"],setup(R,{expose:F,emit:m}){const q=R,f=m,Q=z(),y=N(),g=K(),_=b(),l=new FormData,e=b({...q.product});M(()=>q.product,i=>{e.value={...i}},{deep:!0});const V=Y(()=>g.categories||[]);function t(){k(),f("submit",e.value,l)}function r(){f("refresh-data")}function k(){l.delete("id"),l.delete("name"),l.delete("price"),l.delete("category_id"),l.delete("qty"),l.delete("description"),l.delete("origin_country"),e.value?.id&&l.append("id",e.value.id.toString()),e.value?.name&&l.append("name",e.value.name),e.value?.price&&l.append("price",e.value.price.toString()),e.value?.category_id&&l.append("category_id",e.value.category_id.toString()),e.value?.qty&&l.append("qty",e.value.qty.toString()),e.value?.description&&l.append("description",e.value.description),e.value?.origin_country&&l.append("origin_country",e.value.origin_country)}function S(i){const o=new FileReader;o.readAsDataURL(i[0]),o.onload=()=>{},l.append("images",i[0]),e.value?.id&&C(i[0])}async function C(i){const o=new FormData;o.append("file",i),o.append("is_primary","true");try{await y.uploadFile(e.value.id,o)&&(r(),Q.notify({color:"primary",message:"Картинка успешно добавлена"}))}catch(a){console.error(a)}finally{_.value&&_.value.reset()}}return F({generateFormData:k}),(i,o)=>(n(),w(J,{class:"column q-gutter-md",greedy:"",onSubmit:t},{default:P(()=>[d("div",ee,c(i.product.id?"Редактирование товара":"Добавление товара"),1),s(Z,{ref_key:"uploaderRef",ref:_,color:"primary",flat:"","max-file-size":"15728640",onAdded:S},{header:P(()=>[...o[6]||(o[6]=[])]),list:P(()=>[s(G),d("div",ae,[s(D,{class:"q-mr-sm",name:"note_add",size:"24px"}),o[7]||(o[7]=d("span",null,"Загрузить картинку",-1))])]),_:1},512),d("div",null,[i.product?.images?.length?(n(),w(T,{key:0,images:i.product.images,onRefreshData:r},null,8,["images"])):v("",!0)]),s(h,{modelValue:e.value.name,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.name=a),rules:[x(I)],outlined:"",label:"Наименование товара *"},null,8,["modelValue","rules"]),s(H,{modelValue:e.value.category_id,"onUpdate:modelValue":o[1]||(o[1]=a=>e.value.category_id=a),rules:[x(I)],options:V.value,outlined:"",label:"Категория *","emit-value":"","map-options":"","option-label":"name","option-value":"id"},null,8,["modelValue","rules","options"]),s(h,{modelValue:e.value.price,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.price=a),rules:[x(I)],outlined:"",label:"Стоимость товара *"},null,8,["modelValue","rules"]),s(h,{modelValue:e.value.qty,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.qty=a),outlined:"",label:"Количество",type:"number"},null,8,["modelValue"]),s(h,{modelValue:e.value.origin_country,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.origin_country=a),outlined:"",label:"Страна происхождения"},null,8,["modelValue"]),s(h,{modelValue:e.value.description,"onUpdate:modelValue":o[5]||(o[5]=a=>e.value.description=a),outlined:"",type:"textarea",rows:"2",label:"Описание"},null,8,["modelValue"]),d("div",te,[s(A,{color:"green",label:"Подтвердить",type:"submit"})])]),_:1}))}}),le=j(oe,[["__scopeId","data-v-fe18954d"]]),re={class:"q-pa-md product"},ie={key:0},se={key:1},ne={class:"q-mb-sm"},de={key:0,class:"q-my-md text-center"},ue={key:1,class:"text-grey"},ce={class:"text-grey"},me={key:2,class:"text-grey old-price"},pe={key:3,class:"q-pa-md bg-light-gray radius-16"},ve={class:"row justify-end"},fe={key:1,class:"row"},ye={class:"bg-green q-pa-xs radius-100"},ge={class:"q-mx-sm self-center"},_e={class:"bg-green q-pa-xs radius-100"},he=$({__name:"ProductActionPage",emits:["refresh-data","add-product"],setup(R,{emit:F}){const m=z(),q=F,f=E(),Q=L(),y=N(),g=b(),{isManager:_}=O(),{addToCart:l,updateQuantity:e,getCartItem:V}=W(),t=b({category_id:null,description:"",id:null,images:"",name:"",origin_country:"",price:null}),r=b([]);X(()=>{o()});function k(){try{m.loading.show(),l(t.value)&&t.value.id&&(r.value=V(t.value.id))}catch(a){console.error(a)}finally{m.loading.hide()}}function S(){if(r.value){const a=e(r.value,1);a?r.value=a:r.value=void 0}}function C(){if(r.value){const a=e(r.value,-1);a?r.value=a:r.value=void 0}}async function i(a,U){try{let p=null;a?.id?p=await y.updateProduct(a):(g.value&&g.value.generateFormData(),p=await y.createProduct(U)),p&&(t.value.id=p.id,m.notify({color:"primary",message:"Успешно сохранено"}),q("refresh-data"),Q.back())}catch(p){console.error(p)}}async function o(){if(f?.params?.id)try{m.loading.show();const a=await y.fetchProductsById(+f.params.id);a&&(t.value=a,t.value.id&&(r.value=V(t.value.id)))}catch(a){console.error(a)}finally{m.loading.hide()}}return(a,U)=>(n(),u("div",re,[x(_)?(n(),u("div",ie,[s(le,{ref_key:"productFormRef",ref:g,product:t.value,onSubmit:i,onRefreshData:o},null,8,["product"])])):(n(),u("div",se,[t.value?.images?.length?(n(),w(T,{key:0,class:B(t.value?.available_qty?"":"image-grayscale-100"),images:t.value.images},null,8,["class","images"])):v("",!0),d("div",ne,[t.value?.name?(n(),u("h6",de,c(t.value.name),1)):v("",!0),t.value?.origin_country?(n(),u("div",ue,"Страна производитель: "+c(t.value.origin_country),1)):v("",!0),d("div",ce,"Остаток: "+c(t.value?.available_qty?`${t.value.available_qty} шт.`:"Нет в наличии"),1),t.value?.old_price?(n(),u("div",me,"Старая цена: "+c(t.value.old_price)+" ₽",1)):v("",!0),d("div",{class:B(["text-bold text-18 q-mb-md",t.value?.old_price?"text-red":""])}," Цена: "+c(t.value.price)+" ₽ ",3),t.value.description?(n(),u("div",pe,c(t.value.description),1)):v("",!0)]),d("div",ve,[r.value?.id?(n(),u("div",fe,[d("div",ye,[s(D,{name:"remove",color:"white",size:"30px",onClick:C})]),d("span",ge,c(r.value.quantity),1),d("div",_e,[s(D,{name:"add",color:"white",size:"30px",onClick:S})])])):(n(),w(A,{key:0,disabled:!t.value.available_qty,color:"green",label:"Добавить в корзину",onClick:k},null,8,["disabled"]))])]))]))}}),Ne=j(he,[["__scopeId","data-v-ac5cc025"]]);export{Ne as default};
